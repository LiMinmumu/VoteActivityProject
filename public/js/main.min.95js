!function(e,t,a){function i(){this.connection=t.hubConnection(),this.hub={},this.enabledRetryConnect=!0,this.clientEvent={},this.doneFuncArr=[],this.initPartFuncArr=[],this.initRestartFuncArr=[],this._startStatus=0;var e=this;this.connection.disconnected(function(){e.enabledRetryConnect&&e._setAutoConnection()}),this.connection.stateChanged(function(){}),this._unInitialized=function(){return 0===this._startStatus},this._hasBindEvent=function(){return 1==(1&this._startStatus)},this._hasExecuteCallback=function(){return 2==(2&this._startStatus)},this._setbindEvent=function(){this._startStatus=1|this._startStatus},this._setExecuteCallback=function(){this._startStatus=2|this._startStatus}}var o={qs:{MbrToken:null},imServerUrl:"",retryTimeAfterDisconnection:1e3};i.prototype={initRestart:function(e,a){if(""==t.trim(e))throw new Error("key不能为空");if("function"==typeof a){for(var i=0;i<this.initRestartFuncArr.length;i++){var o=this.initRestartFuncArr[i];if(o.key===e)return this}this.initRestartFuncArr.push({key:e,action:a})}return this},initPart:function(e,a){if(""==t.trim(e))throw new Error("key不能为空");if("function"==typeof a){for(var i=0;i<this.initPartFuncArr.length;i++){var o=this.initPartFuncArr[i];if(o.key===e)return this}this.initPartFuncArr.push({key:e,action:a})}return this},done:function(e,a){if(""==t.trim(e))throw new Error("key不能为空");if("function"==typeof a){for(var i=0;i<this.doneFuncArr.length;i++){var o=this.doneFuncArr[i];if(o.key===e)return this}this.doneFuncArr.push({key:e,action:a})}return this},init:function(e){return e=e||{},this.options=t.extend(!0,this.options||o,e),this.connection.qs=this.options.qs,this.options.imServerUrl&&(this.connection.url=this.options.imServerUrl),this},_setAutoConnection:function(){var e=this;setTimeout(function(){e.start(!0)},this.options.retryTimeAfterDisconnection)},getHub:function(e){return this.hub[e]?this.hub[e]:this.hub[e]=this.connection.createHubProxy(e)},bind:function(e){e=e||{};for(var t in e){this.getHub(t);this.clientEvent[t]||(this.clientEvent[t]={});var a=this.clientEvent[t],i=e[t];for(var o in i)a[o]||(a[o]=[]),a[o].push(i[o])}return this},invoke:function(e,t){if(arguments.length<2)throw new Error("invoke参数数量不能少于两个");for(var a=this.getHub(e),i=[t],o=0;o<arguments.length-2;o++)i.push(arguments[o+2]);return a.invoke.apply(a,i)},_bindEvent:function(){for(var e in this.clientEvent){var a=this.getHub(e),i=this.clientEvent[e];t.each(i,function(e,t){a.on(e,function(){for(var e=0;e<t.length&&t[e].apply(null,arguments);e++);})})}},_getFirstHub:function(){for(var e in this.hub)return this.hub[e];return null},isConnetioned:function(){var e=this._getFirstHub();return!!e&&e.connection.state===t.signalR.connectionState.connected},isDisconnected:function(){var e=this._getFirstHub();return!!e&&e.connection.state===t.signalR.connectionState.disconnected},callRestart:function(){for(var e=0;e<this.initRestartFuncArr.length;e++){var t=this.initRestartFuncArr[e];t.action()}},reStart:function(e){this._unInitialized()||(this.callRestart(),this.stop(),this.options.qs=e,this.connection.qs=e,this.start(!0))},stop:function(){this.enabledRetryConnect=!1,this.connection.stop(!1,!0)},start:function(e){if(console.log("call imClient start"),!this.isConnetioned()){if(this.enabledRetryConnect=!0,!e&&!this._hasBindEvent()){for(var t=0;t<this.initPartFuncArr.length;t++)this.initPartFuncArr[t].action();this._bindEvent(),this._setbindEvent()}var a=this;return this.connection.start().done(function(){console.log("start success");for(var e=0;e<a.doneFuncArr.length;e++)a.doneFuncArr[e].action.apply(null,arguments)}).fail(function(e){console.log(e.message)}),this}}},"function"==typeof a&&a.cmd?a("imClient",["jquery","signalr"],function(e,t){return new i}):e.imClient=new i}(window,jQuery,window.define),function(e,t,a){function i(){this.data=[],this.add=function(e,t){this.indexOf(e)&&this.data.push({key:e,value:t})},this.indexOf=function(e){for(var t=0;t<this.data.length;t++){var a=this.data[t];if(a.key===e)return t}return-1},this.remove=function(e){var t=this.indexOf(e);t!=-1&&this.data.splice(t,1)}}function o(){this.value=0,this._referNum=2,this.status={},this.isValue=function(e){return(this.value&e)==e},this.setValue=function(e){this.value=this.value|e},this._createReferNum=function(e){return Math.pow(this._referNum,e-1)},this._init=function(e){if("object"!=typeof e)throw new Error("传入的参数不是简单对象！");for(var t in e){var a=parseInt(e[t]);isNaN(a)||this._initStatus(t,a)}},this._initStatus=function(e,t){this.status[e]=this._createReferNum(t),this["is"+e]=function(){return this.isValue(this.status[e])},this["set"+e]=function(){this.setValue(this.status[e])},this["clear"+e]=function(){this.value=this.value-this.status[e]}},this._init.apply(this,arguments)}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},a={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+a[this.getDay()+""]));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},Date.prototype.getDaysInMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()},Date.prototype.getDaysInYear=function(){for(var e=0,t=0;t<12;t++){var a=new Date(this.getFullYear(),t,1);e+=a.getDaysInMonth()}return e};var r={stack:["page"],_traceStack:null,_traceChange:!1,traceChange:function(){this._traceChange=!0},getTraceStack:function(){return this._traceStack},clearTraceStack:function(){this._traceStack=null},skipUrl:function(e){this._traceChange=!1,location.pathname.toLocaleLowerCase()==e.toLocaleLowerCase()?(this._traceStack=this.getStack(),imPublic.pageSwitch.showPage()):(this._traceStack=this.getStack(),Global_ReturnHelper.setChangePageCallback(function(){imPublic.pageSwitch.showPage()}),t.mobile.changePage(e,{transition:!0}))},getStack:function(){return this.stack.slice(0)},setStatck:function(e){e.length>0&&"page"==e[0]&&(this.stack=e)},isHide:function(e){return t("[data-module="+e+"]").is(":hidden")},restorePage:function(e){var a=e&&e.length>0&&!this._traceChange;if(a){var i=t("body>[data-module]");this.stack=e;for(var o=this.stack.slice(0),r=o.pop(),n=0;n<o.length;n++)i.filter('[data-module="'+o[n]+'"]').hide();i.filter('[data-module="'+r+'"]').show()}return a},showPage:function(){for(var e=t("body>[data-module]"),a=[],i=[],o=0,r=this.stack.length;o<r;o++){var n=this.stack.pop();"page"!=n?a.push(n):(i.push(n),this.stack.push("page"))}if(a.length>0){for(var l=[],o=0;o<a.length;o++)l.push("[data-module="+a[o]+"]");e.filter(l.join(",")).hide()}if(i.length>0){for(var l=[],o=0;o<i.length;o++)l.push("[data-module="+i[o]+"]");e.filter(l.join(",")).show()}},show:function(e,a,i){var o=t("body>[data-module]"),r=this.stack.length>0?this.stack[this.stack.length-1]:null;r&&o.filter("[data-module="+r+"]").hide(),this.stack.push(e),a?o.filter("[data-module="+e+"]").slideDown(300,function(){"function"===t.type(i)&&i()}):o.filter("[data-module="+e+"]").show()},hide:function(e,a,i){var o=this.stack.length;o>1&&this.stack.pop();var r=t("body>[data-module]");r.filter("[data-module="+e+"]").hide(),i&&i(),o=this.stack.length,r.filter("[data-module="+this.stack[o-1]+"]").show()}},n={PushMessageModule:{Order:1,Product:2,Article:3},ChatObject:{User:1},UserStatus:{Online:1,Offline:2,Busy:3},UserCategory:{Normal:0,SafetySeat:1,Experts:2,Merchants:3,CustomerAssistant:4},ChatMessage:{Text:1,Brow:2,Image:3,Product:4,Order:5,Article:6,SystemMsg:7,Comment:8,Praise:9},ChatGroup:{Twain:1,System:2,Praise:3,Comment:4}},l=new o({BindConnectionEvent:1});e.imPublic={pageSwitch:r,flag:o,map:i,globalOptions:{},enum:n,encode:function(e){return t("<div/>").text(e).html()},encodeObject:function(e){if(e){if(!t.isPlainObject(e))return"string"===t.type(e)?this.encode(e):e;for(var a in e)e[a]=arguments.callee.call(this,e[a])}return e},restoreMap:new i,addRestore:function(e,t){this.restoreMap.add(e,t)},isIPhone:function(){return navigator.userAgent.toLowerCase().indexOf("iphone")!=-1},castDate:function(e){return e instanceof Date?e:"string"==typeof e?new Date(e):null},getTimeMark:function(e){var t=new Date,a="",i=t-e,o=6e4,r=60*o,n=24*r,l=e.getDaysInMonth()*n,s=e.getDaysInYear()*n;return a=i<=o?"刚刚":i<=r?Math.floor(i/o)+"分钟前":i<=n?Math.floor(i/r)+"小时前":i<=l?Math.floor(i/n)+"天前":i<=s?Math.floor(i/(29*n))+"月前":Math.floor(i/(365*n))+"年前"},isLogin:function(){return null!=Global_BaseInfoHelper.GetLoginInfo()},action:function(e,i){this.isLogin()?a.isConnetioned()?"function"==typeof e&&e():(i=i||function(){Global_LoadMask.show()})():t.mobile.changePage("/account/index?ReturnUrl="+location.href)},createChatObject:function(e){return{ObjectType:n.ChatObject.User,ClientID:e}},bindUnLoginEvent:function(){t("#im-messagelink").bind("tap",function(){t.mobile.changePage("/account/index?ReturnUrl="+location.href)})},bindChatEvent:function(a){t(".laibei_page:last #chat").bind("tap",function(){return e.imChatDialog.chatWith(a),!1})},init:function(e){t.extend(!0,this.globalOptions,e),l.isBindConnectionEvent()||(a.connection.error(function(e){try{var i=JSON.parse(e.context.responseText);i&&"04040003"==i.StatusNo&&(a.stop(),Global_PopupHelper.alert({title:i.StatusRemark,confirmCallback:function(){t.mobile.changePage("/account/login?ReturnUrl="+location.href),imPublic.pageSwitch.showPage()}}))}catch(e){console.log(e)}}),a.connection.stateChanged(function(e){1==e.newState&&Global_LoadMask.hide()}),l.setBindConnectionEvent())},_logError:function(e){console.log(e.message)}},a.initPublic=function(t){e.imPublic.init(t);for(var a=0;a<imPublic.restoreMap.data.length;a++){var i=imPublic.restoreMap.data[a];"function"==typeof i.value&&i.value()}return this}}(window,jQuery,imClient),function(e,t){function a(){this.data={User:null,OpenListDate:null,LoadPageIndex:2,MsgPreviewData:{},TotalUnRead:0,IsReset:!0},this.flag=new imPublic.flag({Init:1,LoadedUnRead:2,BindScroll:3,Done:4}),this._haveMsgScroll=function(){var e=t(".meslist-maincontent");return e[0].scrollHeight>e.height()},this._open=function(){imPublic.pageSwitch.traceChange();var e=this;imPublic.action(function(){e.flag.isLoadedUnRead()?(imPublic.pageSwitch.show(r,!0),e.data.IsReset=!1,e.getGroupList(1).done(function(t){t.Data.length>0&&null!=t.Data[0].Group.LastMessage,!e.flag.isBindScroll()&&e._haveMsgScroll()?i(e):e.dropload&&(e.dropload.noData(!1),e.dropload.resetload(),e.dropload.unlock())})):Global_PopupHelper.alert({title:"请先等待聊天数据加载完毕！"})})},this._close=function(){var e=this;imPublic.pageSwitch.hide(r,!0,function(){e._resetData(),e._clearContent()})},this._isClose=function(){return imPublic.pageSwitch.isHide()},this._clearContent=function(){t("#im-meslist").empty()},this._resetData=function(){this.data.OpenListDate=null,this.data.LoadPageIndex=2,this.data.MsgPreviewData={},this.data.IsReset=!0},this._isClosed=function(){return t(".meslist-content").is(":hidden")},this.getTotalUnRead=function(){return this.data.TotalUnRead},this.setTotalUnRead=function(e){var a=parseInt(e);isNaN(a)||(this.data.TotalUnRead=a,a>99&&(a=99),a=a<1?"":a,t("#im-messagelink").attr("data-msg",a))},this.setGroupLastMessage=function(e,a){var i=this.data.MsgPreviewData[e];if(i){i.Group.LastMessage=a;var o=l.msgpreview(i);t('[data-groupid="'+e+'"]').replaceWith(o)}},this.setGroupUnRead=function(e,a){var a=parseInt(a),i=this.data.MsgPreviewData[e];if(i&&!isNaN(a)){i.UnReadTotal=a,a>99&&(a=99),a=a<1?"":a;var o=l.getMsgCls(a);t('[data-groupid="'+e+'"]').find(".left").attr("class","").addClass("left "+o).attr("data-msg",a)}},this.getGroupUnRead=function(e){var t=this.data.MsgPreviewData[e];return t?t.UnReadTotal:0}}function i(e){e.dropload=t(".meslist-maincontent").dropload({autoLoad:!1,loadDownFn:function(t){e._isClose()||(e.data.LoadPageIndex!=-1?e.getGroupList(e.data.LoadPageIndex).done(function(a){a.TotalPage<=e.data.LoadPageIndex?(e.data.LoadPageIndex=-1,t.noData(!0),t.lock()):e.data.LoadPageIndex++,t.resetload()}).fail(function(){t.resetload()}):(t.noData(!0),t.resetload(),t.lock()))}}),e.dropload.lock("up"),e.flag.setBindScroll()}var o=imPublic.enum,r="im-messagelist",n={process:function(e){switch(e.ObjectType){case o.ChatGroup.System:e.GroupTitle="系统提醒",e.GroupIcon="/Content/Images/mes-sys.png";break;case o.ChatGroup.Comment:e.GroupTitle="评论",e.GroupIcon="/Content/Images/mes-comment.png";break;case o.ChatGroup.Praise:e.GroupTitle="收到的赞",e.GroupIcon="/Content/Images/mes-praise.png"}return e}},l={emptyMsgTips:function(e){var t="";switch(parseInt(e)){case o.ChatGroup.System:t="暂无系统消息";break;case o.ChatGroup.Comment:t="还没有收到评论哦";break;case o.ChatGroup.Praise:t="还没有收到赞哦"}return t},msgpreview:function(e){var t={GroupID:e.Group.GroupID},a=JSON.stringify(t).replace(/\"/g,"&quot;"),i=e.UnReadTotal<1?"":e.UnReadTotal,o=this.getMsgCls(i),r="",n="";e.Group.LastMessage?(r=imPublic.getTimeMark(imPublic.castDate(e.Group.LastMessage.SendTime)),n=this.getMsgContent(e.Group.LastMessage)):n=this.emptyMsgTips(e.Group.ObjectType);var l='<section data-groupid="'+t.GroupID+'" data-content="'+a+'" class="meslist"><a href="#" class="padf borderbottom clearfix"><div class="left '+o+'" data-msg="'+i+'"><img src="'+e.GroupPreview.GroupIcon+'" />';return l+='</div><div class="right"><div class="name">'+e.GroupPreview.GroupTitle+'</div><div class="cont">'+n+'</div></div><div class="time">'+r+"</div></a></section>"},getMsgCls:function(e){return e.toString().length<2?"singular":"plurality"},getMsgContent:function(e){var t=null;switch(e.ObjectType){case o.ChatMessage.Text:t=e.MsgContent;break;case o.ChatMessage.Brow:t="[表情]";break;case o.ChatMessage.Image:t="[图片]";break;case o.ChatMessage.Product:t="[商品链接]";break;case o.ChatMessage.SystemMsg:t=e.SystemDetail.MessageContent;break;case o.ChatMessage.Comment:t=e.CommentDetail.Content;break;case o.ChatMessage.Praise:switch(e.PraiseDetail.ObjectType){case o.PushMessageModule.Product:t=e.PraiseDetail.User.Nickname+"赞了您的宝贝";break;case o.PushMessageModule.Article:t=e.PraiseDetail.User.Nickname+"赞了您的说说"}break;default:throw new Error("错误的消息类型")}return t}};a.prototype={init:function(){if(this.flag.isInit())return imClient;if(this.data.User=imPublic.globalOptions.User,!this.data.User)throw new Error("未传入当前聊天用户的ID");var e=this;return t("#im-messagelink").off("tap"),t(document).on("tap","#im-messagelink",function(){return console.log("open"),e._open(),!1}),t("#im-meslist").on("tap",".meslist",function(){var a=JSON.parse(t(this).attr("data-content")),i=e._getMsgPreview(a.GroupID);if(i)switch(i.GroupPreview.ObjectType){case o.ChatGroup.Twain:imChatDialog._setGroupName(i.GroupPreview.GroupTitle),imChatDialog.appendToGroup(i,e.data.User.BaseId);break;case o.ChatGroup.System:imSystemMessage._open(i.Group);break;case o.ChatGroup.Praise:imPraise._open(i.Group);break;case o.ChatGroup.Comment:imComment._open(i.Group)}else Global_PopupHelper.alert({title:"聊天组不存在！"});return!1}),t("#im-meslist-back").on("tap",function(){return e._close(),!1}),this.flag.setInit(),imClient.bind({ChatMessageHub:{ReceiveMessage:function(){return e.receiveMessage.apply(e,arguments)},AppendToGroup:function(){return e.appendToGroup.apply(e,arguments)},ReadedMessage:function(){return e.readedMessage.apply(e,arguments)},ReadedGroup:function(){return e.readedGroup.apply(e,arguments)}}}).done(r,function(){e.done.apply(e,arguments)})},_getMsgPreview:function(e){return this.data.MsgPreviewData[e]},_setMsgPreview:function(e){this.data.MsgPreviewData[e.Group.GroupID]=e},done:function(){if(!this.flag.isLoadedUnRead()){var e=this,t=imClient.getHub("ChatMessageHub");t.invoke("CountUnReadMessage").done(function(t){console.log("CountUnReadMessage result is "+t),e.setTotalUnRead(t),e.flag.setLoadedUnRead()}).fail(imPublic._logError)}this.flag.isDone()||(console.log("im-messagelist done"),this.flag.setDone())},appendMsgPreview:function(e,a){if(!this.data.MsgPreviewData[e.Group.GroupID]){n.process(e.GroupPreview);var i=l.msgpreview(e);a?t("#im-meslist>section[data-groupid]:eq("+a+")").after(i):t("#im-meslist").append(i),this.data.MsgPreviewData[e.Group.GroupID]=e}},replaceMsgPreview:function(e,a){var i=l.msgpreview(e);t('#im-meslist>section[data-groupid="'+e.Group.GroupID+'"]').remove(),t("#im-meslist>section[data-groupid]:eq("+a+")").after(i)},batchAppendMsgPreview:function(e){for(var t=0;t<e.length;t++){var a=e[t];this.appendMsgPreview(a)}},getGroupList:function(e){var t=this,a=imClient.getHub("ChatMessageHub");return a.invoke("GetMessagePreviewList",{PageIndex:e,PageSize:12},this.data.OpenListDate,"").done(function(a){console.log("获取第"+e+"页预览数据成功"),t.batchAppendMsgPreview(a.Data)}).fail(imPublic._logError)},readedMessage:function(e){var t=this.getTotalUnRead();this.setTotalUnRead(t-1);var a=this.getGroupUnRead(e.GroupID);this.setGroupUnRead(e.GroupID,a-1)},readedGroup:function(e,t){var a=this.getTotalUnRead();this.setTotalUnRead(a-t);var i=this.getGroupUnRead(e.GroupID);this.setGroupUnRead(e.GroupID,i-t)},isSystemGroup:function(e){return[o.ChatGroup.System,o.ChatGroup.Praise,o.ChatGroup.Comment].indexOf(e.ObjectType)!=-1},receiveMessage:function(e){var t=this.data.User.BaseId;this.setGroupLastMessage(e.GroupID,e);var a=this._getMsgPreview(e.GroupID);if(e.SenderClientID!=t){var i=this.getTotalUnRead();if(this.setTotalUnRead(i+1),!this.data.IsReset)if(a){this.isSystemGroup(a.Group)||this.replaceMsgPreview(a,2);var o=this.getGroupUnRead(e.GroupID);this.setGroupUnRead(e.GroupID,o+1)}else{this.getGroupPreviewFromServer(e.SenderClientID)}}else a&&(this.isSystemGroup(a.Group)||this.replaceMsgPreview(a,2));return!0},appendToGroup:function(e,t){return!(!this.data.IsReset&&t==this.data.User.BaseId)||(this.appendMsgPreview(e,2),!1)},getGroupPreviewFromServer:function(e,t){var a=imPublic.createChatObject(e);imClient.getHub("ChatMessageHub").invoke("GetGroupPreview",a).done(t||function(e){console.log("GetGroupPreview success")}).fail(imPublic._logError)}};var s=new a;imPublic.addRestore(r,function(){s.flag.isLoadedUnRead()&&s.setTotalUnRead(s.getTotalUnRead())}),imClient.initRestart(r,function(){s.setTotalUnRead(0),s.flag.clearLoadedUnRead()}).initPart(r,function(){return s.init(),this}),e.imMsgList=s}(window,jQuery),function(e,t,a){function i(){var e=this;$("#im-back").on("tap",function(t){e._close(),e._browIsOpen()&&$("#im-keyboard").trigger("tap",{operation:"close"});var a=$.trim($("#im-content").val());return e._setUnSendMsg(a),!1});var t=$("div.dialog-content").dropload({autoLoad:!1,loadUpFn:function(t){e.data.LoadPageIndex!=-1?e.getMessageList(e.data.LoadPageIndex,!1).done(function(a){a.TotalPage<=e.data.LoadPageIndex?e.data.LoadPageIndex=-1:e.data.LoadPageIndex++,t.resetload()}).fail(function(){t.resetload()}):(t.$domUp.html(t.opts.domUp.domNoData),t.resetload())}});t.lock("down"),$("#im-content").bind("input propertychange",function(){e._isReady()&&!e._sendLimitMark&&(""!=$.trim(this.value)?e._enabledSend():e._disabledSend(),this.value.length>100&&e._disabledSend())}).focus(function(t,a){var i=a&&a.CustomTrigger;e._browIsOpen()?($("#im-keyboard").trigger("tap"),setTimeout(function(){var t=$("body")[0];$("body").scrollTop(t.scrollHeight),i||e._fixIOSPosition()},300)):setTimeout(function(){e.scrollToBottom(!0),i||e._fixIOSPosition()},300)}).keydown(function(e){if(this.value.length>=100)return!1}).blur(function(){e._fixIOSPosition(!0)});var i=180;$("#im-blow").bind("tap",function(){return $("#im-content").blur(),$(this).hide(),$("#im-keyboard").show(),$(".dialog-brow").slideDown(),$(".dialog-bottom-send").animate({height:"+="+i},function(){$(".dialog-content").css("bottom",function(e,t){return parseInt(t)+i}),e.scrollToBottom(!0)}),!1}),$("#im-keyboard").bind("tap",function(e,t){return $(this).hide(),$("#im-blow").show(),$(".dialog-brow").slideUp(),$(".dialog-bottom-send").animate({height:"-="+i},function(){$(".dialog-content").animate({bottom:"-="+i},function(){})}),!1}),$("#im-sendMsg").bind("tap",function(){$("#im-content").trigger("focus",{CustomTrigger:!0});var t=$.trim($("#im-content").val());if(""!=t){if(t.length>100)return void Global_PopupHelper.alert({title:"文件消息字数不能多于100！"});var a=l.text(t,e.data.User.BaseId,e.data.Group.GroupID);return e.sendMessage(a,!0),e._setSendTimesLimit(),!1}});var o=!1,n=null;$(".brow-item").bind("touchstart",function(t){try{var a=JSON.parse($(this).attr("data-theme"));return o=!1,t.preventDefault(),n=setTimeout(function(){o=!0,d.showPreview(a)},e.longTouchInterval),!1}catch(e){logError(e),touchStartTime=null,o=!1}}).bind("touchend",function(){if(null!=n&&(d.hidePreview(),clearTimeout(n),n=null),e._isReady()&&!o&&!e._sendLimitMark){var t=l.brow(JSON.parse($(this).attr("data-theme")),e.data.User.BaseId,e.data.Group.GroupID);e.sendMessage(t,!0),e._setSendTimesLimit()}}),$("#im-upload").change(function(){if(this.files.length>0&&e._isReady()&&!e._sendLimitMark){var t=l.emptyImage(e.data.User.BaseId,e.data.Group.GroupID);e.appendMsg(!0,t),e.data.LastSendTime=a.castDate(t.SendTime),Global_ImgHelper.ZipAndUploadImg(this.files[0],1,6,function(a,i,o){c.success(a,i,o,t,e)},c.fail,r())}this.value=""})}function o(){this.maxInterval=432e5,this.sendInterval=3e5,this.longTouchInterval=500,this.sendLimitInterval=1e3,this._sendLimitTime=0,this._sendLimitMark=null,this.flag=new a.flag({Init:1,Done:2}),this.data={Group:null,EndMsgTime:null,LoadPageIndex:2,GroupName:"",LastSendTime:null,IsReady:!1,ChatMsgPreview:null,User:null,ChatRecordLastSendTime:null,UnSendMsgData:{},Link:{LinkType:0,LinkData:null}},this._imageload=function(e){this.scrollToBottom()},this._browIsOpen=function(){return $("#im-keyboard").is(":visible")},this._isReady=function(){return this.data.IsReady},this._open=function(){a.pageSwitch.traceChange(),a.pageSwitch.show("imChatDialog",!0)},this._close=function(){a.pageSwitch.hide("imChatDialog",!0),this._clear()},this._getKeyboardHeight=function(){return $("body").scrollTop()},this._setSendTimesLimit=function(){var e=this;!this._sendLimitMark&&this.sendLimitInterval>0&&(this._disabledSend(),this._sendLimitTime=this.sendLimitInterval,$("#im-sendMsg").text(this._sendLimitTime/1e3+"s"),this._sendLimitMark=setInterval(function(){e._sendLimitTime-=1e3,e._sendLimitTime<=0?($("#im-sendMsg").text("发送"),clearInterval(e._sendLimitMark),e._sendLimitMark=null,$("#im-content").trigger("input")):$("#im-sendMsg").text(e._sendLimitTime/1e3+"s")},1e3))},this._fixIOSPosition=function(e){if(a.isIPhone())if(e)console.log("fix clear"),$("#im-chatContentList section.fixPosition").removeClass("fixPosition").css({marginTop:10});else{console.log("fix"),$("#im-chatContentList section.fixPosition").removeClass("fixPosition").css({marginTop:10});var t=this._getKeyboardHeight(),i=$("#im-chatContentList section:first");i.hasClass("fixPosition")||$("#im-chatContentList section:first").addClass("fixPosition").css({marginTop:t-40})}},this._disabledSend=function(){$("#im-sendMsg").attr("disabled","disabled").addClass("disabled")},this._enabledSend=function(){$("#im-sendMsg").removeAttr("disabled").removeClass("disabled")},this._isClosed=function(){return $(".dialog-wrapper").is(":hidden")},this._setGroupName=function(e){$("#im-groupname").html(e)},this._clear=function(){$("#im-chatContentList").empty()},this._setUnSendMsg=function(e){this.data.Group&&(this.data.UnSendMsgData[this.data.Group.GroupID]=e)},this._getUnSendMsg=function(){return this.data.Group?this.data.UnSendMsgData[this.data.Group.GroupID]:""},this._setLinkData=function(e){this.data.Link.LinkType=e.LinkType,this.data.Link.LinkData=e.LinkData},this._resetGroup=function(){null==this.data.Group,this.data.EndMsgTime=null,this.data.LoadPageIndex=2,this.data.LastSendTime=null,this.data.IsReady=!1,this.data.ChatRecordLastSendTime=null,this.data.ChatMsgPreview=null,this._clear()},this._msgSending=function(e){$("#im-msg"+e.MessageID).find(".beforerefresh").css("display","inline")},this._msgSended=function(e){$("#im-msg"+e.MessageID).find(".beforerefresh").css("display","none")},this._getTimeMark=function(e,t,a){var i=null;e&&(i=new Date(e.toUTCString()));var o=null;t&&(o=new Date(t.toUTCString()));var r=new Date;o||(o=new Date(i.toUTCString()),o.setSeconds(o.getSeconds()+1));var n=r-o>this.maxInterval;if(!i)return a?s.time(o.format("yyyy年MM月dd日 HH:mm:ss")):s.time(o.format("HH:mm:ss"));var l=o-i;return l>=this.sendInterval&&l<this.maxInterval?n?s.time(o.format("yyyy年MM月dd日 HH:mm:ss")):s.time(o.format("HH:mm:ss")):l>this.maxInterval?s.time(o.format("yyyy年MM月dd日 HH:mm:ss")):a?s.time(o.format("yyyy年MM月dd日 HH:mm:ss")):null}}var r=function(){var e=0;return function(){return e++}}(),n=a.enum,l={_base:function(e,t,a){var i=this;return{Content:i.castContent(e),SenderClientID:t,GroupID:a,MessageID:r(),SendTime:new Date}},castContent:function(e){var t=null;if(e)try{t=JSON.parse(e),$.isPlainObject(t)&&(e=t)}catch(e){}return e},text:function(e,t,a){var i=this._base(e,t,a);return i.ObjectType=n.ChatMessage.Text,i.MsgContent=i.Content,i},brow:function(e,t,a){var i=this._base(e,t,a);return i.ObjectType=n.ChatMessage.Brow,i.BrowContent=i.Content,i},emptyImage:function(e,t){var a={ImagePath:"",ImageName:"",ImageID:0};return this.image(JSON.stringify(a),e,t)},image:function(e,t,a){var i=this._base(e,t,a);return i.ObjectType=n.ChatMessage.Image,i.ImageContent=i.Content,i},product:function(e,t,a){var i=this._base(e,t,a);return i.ObjectType=n.ChatMessage.Product,i.ProductDetail=i.Content,i},getMsgFromRecrod:function(e,t){var a=parseInt(e.attr("data-objecttype")),i=e.attr("data-content");return l.switch({Content:i,ObjectType:a,SendClientID:t.data.User.BaseId,GroupID:t.data.Group.GroupID})},switch:function(e){switch(parseInt(e.ObjectType)){case n.ChatMessage.Text:return this.text(e.Content,e.SendClientID,e.GroupID);case n.ChatMessage.Brow:return this.brow(e.Content,e.SendClientID,e.GroupID);case n.ChatMessage.Image:return this.image(e.Content,e.SendClientID,e.GroupID)}throw new Error("错误的消息类型！")}},s={_encodeContent:function(e){e.Content=a.encodeObject(e.Content)},text:function(e,t,a){a||this._encodeContent(t);var i='<section data-objecttype="'+t.ObjectType+'" data-senderid="'+t.SenderClientID+'" data-content="'+t.Content+'" id="im-msg'+t.MessageID+'" class="msg-list">';return e?(i+='<div class="imsg"><p><span class="bubbles content"><i class="refreshicon"></i><i class="beforerefresh"></i>',i+=t.Content+'</span></p><img class="px40" src="'+imChatDialog.data.User.FaceImage+'"></div>'):(i+='<div class="umsg"><img class="px40" src="'+imChatDialog.getMsgPreviewOrCache(t.GroupID).GroupPreview.GroupIcon+'"><p>',i+='<span class="bubbles content">'+t.Content+"</span></p></div>"),i+="</section>"},time:function(e){return'<section class="msg-list"><span class="showtime">'+e+"</span></section>"},buildBrowContent:function(e,t){var a="";return a=t?'<span class="brow-theme'+e.Theme+"-original brow-theme"+(e.Theme+"-"+e.Item)+'-original"></span>':'<span class="brow-theme'+e.Theme+"-thumbnail brow-theme"+(e.Theme+"-"+e.Item)+'"></span>'},brow:function(e,t,a){a||this._encodeContent(t);var i='<section data-objecttype="'+t.ObjectType+'" data-senderid="'+t.SenderClientID+'" id="im-msg'+t.MessageID+'" data-content="'+JSON.stringify(t.Content).replace(/\"/g,"&quot;")+'" class="msg-list">';return e?(i+='<div class="imsg"><p><span style="float:right;" class="content"><i class="refreshicon"></i><i class="beforerefresh"></i>',i+=this.buildBrowContent(t.Content)+'</span></p><img class="px40" src="'+imChatDialog.data.User.FaceImage+'"></div>'):(i+='<div class="umsg"><img class="px40" src="'+imChatDialog.getMsgPreviewOrCache(t.GroupID).GroupPreview.GroupIcon+'"><p>',i+='<span style="float:left;" class="content">'+this.buildBrowContent(t.Content)+"</span></p></div>"),i+="</section>"},errorMsg:function(e,t){var a='<section data-objecttype="'+t.ObjectType+'" data-senderid="'+t.SenderClientID+'" id="im-msg'+t.MessageID+'" data-content="'+JSON.stringify(t.Content).replace(/\"/g,"&quot;")+'" class="msg-list">';return e?(a+='<div class="imsg"><p><span style="float:right;" class="content"><i class="refreshicon"></i><i class="beforerefresh"></i>',a+=this.errorContent(t.Content)+'</span></p><img class="px40" src="'+imChatDialog.data.User.FaceImage+'"></div>'):(a+='<div class="umsg"><img class="px40" src="'+imChatDialog.getMsgPreviewOrCache(t.GroupID).GroupPreview.GroupIcon+'"><p>',a+='<span style="float:left;" class="content">'+this.errorContent(t.Content)+"</span></p></div>"),a+="</section>"},errorContent:function(e){return"<span style='color:red;'>"+e+"</span>"},buildImageUrl:function(e,t){return"http://cdn."+e.ImagePath+".img.95laibei.com/"+e.ImageName+(t?"@!standard_src_M":"@!standard_src_l")},buildImageContent:function(e,t,a){var i="";return i=t?'<img onload="imChatDialog._imageload(this.src)" src="'+(a?"/Content/Images/loading.gif":this.buildImageUrl(e,!0))+'" class="dialog-image" />':'<img onload="imChatDialog._imageload(this.src)" src="'+(a?"/Content/Images/loading.gif":this.buildImageUrl(e,!0))+'" class="dialog-image" />'},image:function(e,t,a,i){i||this._encodeContent(t),void 0===a&&(a=!t.Content.ImageID);var o='<section data-objecttype="'+t.ObjectType+'" data-senderid="'+t.SenderClientID+'" id="im-msg'+t.MessageID+'" data-content="'+JSON.stringify(t.Content).replace(/\"/g,"&quot;")+'" class="msg-list">';return e?(o+='<div class="imsg"><p><span style="float:right;" class="content"><i class="refreshicon"></i><i class="beforerefresh"></i>',o+=this.buildImageContent(t.Content,!1,a)+'</span></p><img class="px40" src="'+imChatDialog.data.User.FaceImage+'"></div>'):(o+='<div class="umsg"><img class="px40" src="'+imChatDialog.getMsgPreviewOrCache(t.GroupID).GroupPreview.GroupIcon+'"><p>',o+='<span style="float:left;" class="content">'+this.buildImageContent(t.Content,!0,a)+"</span></p></div>"),o+="</section>"},product_link:function(e){return this.product(!0,e,!0,!0)},product:function(e,t,a,i){i||this._encodeContent(t);var o=t.Content,r="<section "+(a?"":"data-link")+' data-objecttype="'+t.ObjectType+'" data-senderid="'+t.SenderClientID+'" id="im-msg'+t.MessageID+'" data-content="'+JSON.stringify(t.Content).replace(/\"/g,"&quot;")+'" class="goodsviewed clearfix"><div class="left clearfix"><img src="'+o.Image+'"></div><div class="right"><p class="price"><span>'+Global_CommonHelper.GetPriceHtml(o.Price)+"</span></p><p>"+o.Title+"</p></div>"+(a?'<a data-role="none" class="tobuy">发送商品</a>':"")+"</section>";return r},switch:function(e,t,a){var i="";switch(parseInt(t.ObjectType)){case n.ChatMessage.Text:i=this.text(e,t,a);break;case n.ChatMessage.Brow:i=this.brow(e,t,a);break;case n.ChatMessage.Image:i=this.image(e,t,void 0,a);break;case n.ChatMessage.Product:i=this.product(e,t,!1,a)}return i}},d={showPreview:function(e){$("#im-browpreview").empty().append(s.buildBrowContent(e,!0)).show("slow"),$(".dialog-wrapper").css("opacity","0.7")},hidePreview:function(){$("#im-browpreview").hide("slow"),$(".dialog-wrapper").css("opacity","1")}},c={success:function(e,t,a,i,o){var r=null;"00000000"==e.ResultNo?(i.Content={ImageName:e.ImgName,ImagePath:e.ImgPath,ImageID:e.ImgBaseId},i.ImageContent=i.Content,r=s.image(!0,i),o.sendMessage(i,!1),o._setSendTimesLimit()):(i.Content=e.ResultRemark,r=s.errorMsg(!0,i)),r&&$("#im-msg"+i.MessageID).replaceWith(r)},fail:function(e){Global_PopupHelper.alert({title:"图片上传失败，请重试"})}};o.prototype.receiveMessage=function(e){return this._isClosed()||e.SenderClientID!=this.data.User.BaseId&&e.GroupID==this.data.Group.GroupID&&(this.appendMsg(!1,e),this.data.LastSendTime=a.castDate(e.SendTime),this.scrollToBottom(),delete e._id,t.invoke("ChatMessageHub","ReadedMessage",e).done(function(){console.log("已将消息ID为"+e.MessageID+"的消息设置为已读")}).fail(a._logError)),!0},o.prototype.isChating=function(e){var t=!this._isClosed();return t=!(!t||null==this.data.Group)&&$.inArray(e,data.Group.Members)!=-1;
},o.prototype.chatWith=function(e){var t=this,i=e.ClientID,o=e.Nickname,r=e.LinkType||0,l=e.Data||null,s=null;$.inArray(i,[11579,11580,11640,11879,10053,10059,10056,10055,10052])>=0&&(i=10127),r==n.ChatMessage.Product&&l&&(s={ProductID:l.ProductBaseId,Content:l.Content,Title:l.Title,Price:l.Price,CreateUserId:l.CreateUserId,Image:null},l.ImgList&&l.ImgList.length>0&&(s.Image=l.ImgList[0].Path+"@!standard_square_s"));var d=a.createChatObject(i);a.action(function(){t._setLinkData({LinkData:s,LinkType:r}),t._setGroupName(o),imMsgList.getGroupPreviewFromServer(d.ClientID)})},o.prototype.sendLinkMark=function(){if(0!==this.data.Link.LinkType&&null!=this.data.Link.LinkData&&this.data.Link.LinkType==n.ChatMessage.Product){switch(this.data.Link.LinkType){case n.ChatMessage.Product:var e=l.product(this.data.Link.LinkData,this.data.User.BaseId,this.data.Group.GroupID);this.appendProductLink(e),this.scrollToBottom();break;default:throw new Error("不支持发送此类链接信息")}this.data.Link.LinkType=0,this.data.Link.LinkData=null}},o.prototype.objectStatusChanged=function(e){My_About.initAssistantStatus(e)},o.prototype.appendToGroup=function(e,i){var o=e.Group;if(this.data.User.BaseId==i)return this._isClosed()&&this._open(),this._resetGroup(),o.LastMessage&&(this.data.LastSendTime=a.castDate(o.LastMessage.SendTime)),this.data.ChatMsgPreview=e,this.data.Group=o,this.data.IsReady=!0,$("#im-content").val(this._getUnSendMsg()).trigger("input"),that=this,this.sendLinkMark(),this.getMessageList(1,!0).done(function(e){if(e.Data.length>0){var i=e.Data[0];that.data.EndMsgTime=a.castDate(i.AddTime);var o={ObjectType:n.ChatGroup.Twain,GroupID:i.GroupID};t.invoke("ChatMessageHub","ReadedGroup",o).done(function(){console.log("ReadedGroup is success")}).fail(function(){console.log("ReadedGroup is fail")})}}),!0},o.prototype.joinGroup=function(e){this._open();var i=t.hub.ChatMessageHub;i.invoke("add",e).done(function(){console.log("add group success")}).fail(a._logError)},o.prototype.getMessageList=function(e,i){var o=this;return t.invoke("ChatMessageHub","GetMessageList",{PageIndex:e,PageSize:20},this.data.Group.GroupID,"",this.data.EndMsgTime,null,"").done(function(t){console.log("获取第"+e+"页聊天数据成功"),o.batchAppendMsg(t),i&&o.scrollToBottom()}).fail(a._logError)},o.prototype.scrollToBottom=function(e){var t=$(".dialog-content")[0];t.scrollHeight>t.clientHeight&&(e?$(".dialog-content").animate({scrollTop:t.scrollHeight},500):$(".dialog-content").scrollTop(t.scrollHeight))},o.prototype.batchAppendMsg=function(e){var t=e.TotalPage==e.PageIndex,i=null;if(e.Data.length>0&&(i=e.Data[0].GroupID),i==this.data.Group.GroupID)for(var o=0;o<e.Data.length;o++){var r=e.Data[o],n=r.SenderClientID==this.data.User.BaseId,l=!!t&&o==e.Data.length-1;this.appendMsg(n,r,!0,this.data.ChatRecordLastSendTime,l,!0),this.data.ChatRecordLastSendTime=a.castDate(r.SendTime)}},o.prototype.appendProductLink=function(e){var t=s.product_link(e);$("#im-chatContentList").append(t)},o.prototype.appendMsg=function(e,t,i,o,r,n){if(t.GroupID==this.data.Group.GroupID){var l=s.switch(e,t,n),d=o;void 0===d&&(d=this.data.LastSendTime);var c=null;i?(c=this._getTimeMark(a.castDate(t.SendTime),d,!1),c&&(l+=c),r&&(c=this._getTimeMark(null,a.castDate(t.SendTime),!0),c&&(l=c+l)),$("#im-chatContentList").prepend(l)):(c=this._getTimeMark(d,a.castDate(t.SendTime),r),c&&(l=c+l),$("#im-chatContentList").append(l))}},o.prototype.processError=function(e){if(e.message)try{var t=JSON.parse(e.message);$.isPlainObject(t)&&"04120002"==t.StatusNo&&Global_PopupHelper.alert({title:t.StatusRemark})}catch(e){}},o.prototype.sendMessage=function(e,i){var o=this,r=t.getHub("ChatMessageHub");i&&(this.appendMsg(!0,e),this._msgSending(e),this.scrollToBottom());try{r.invoke("sendMessage",e).done(function(){o._msgSended(e),console.log("send success")}).fail(function(t){console.log(t.message),o._msgSended(e),o.processError(t),$("#im-msg"+e.MessageID).find(".refreshicon").show().end().find(".content").addClass("opacity05")})}catch(t){o._msgSended(e),console.log(t.message),$("#im-msg"+e.MessageID).find(".refreshicon").show().end().find(".content").addClass("opacity05")}this.data.LastSendTime=a.castDate(e.SendTime),e.ObjectType==n.ChatMessage.Text&&($("#im-content").val(""),this._disabledSend())},o.prototype.done=function(){this.flag.isDone()||(console.log("imChatDialog done"),i.call(this),this.flag.setDone())},o.prototype.getMsgPreviewOrCache=function(e){var t=imMsgList._getMsgPreview(e);return t||(t=this.data.ChatMsgPreview),t},o.prototype.init=function(){if(this.flag.isInit())return t;console.log("imChatDialog init");var e=this;if(this.data.User=a.globalOptions.User,!this.data.User)throw new Error("未传入当前聊天用户的ID");return $(".dialog-content").on("tap",function(){return $("#im-content").blur(),e._browIsOpen()&&$("#im-keyboard").trigger("tap"),!1}),$(".dialog-imagepreview").on("tap",function(){return $(this).hide(),$(".dialog-imagepreview>.dialog-original-image").attr("src","/Content/Images/loading.gif"),!1}),$("#im-chatContentList").on("tap",".tobuy",function(){var t=$(this).parents("section[data-objecttype]"),a=JSON.parse(t.attr("data-content")),i=(parseInt(t.attr("data-objecttype")),l.product(a,e.data.User.BaseId,e.data.Group.GroupID)),o=s.product(!0,i);return t.replaceWith(o),e.sendMessage(i,!1),!1}).on("tap","section[data-link]",function(){var e=JSON.parse($(this).attr("data-content")),t=parseInt($(this).attr("data-objecttype"));switch(t){case n.ChatMessage.Product:var i="/Optimization/Detail/"+e.ProductID;a.pageSwitch.skipUrl(i);break;default:throw new Error("错误的链接类型")}return!1}).on("tap",".px40",function(){var e=$(this).parents("section[data-objecttype]"),t=e.data("senderid"),i="/my/PersonalIn/"+t;return a.pageSwitch.skipUrl(i),!1}),$("#im-chatContentList").on("tap",".dialog-image",function(){var t=$(this).parents("section.msg-list"),a=l.getMsgFromRecrod(t,e),i=a.ImageContent;return""!=i.ImageName&&""!=i.ImagePath&&($(".dialog-imagepreview>.dialog-original-image").attr("src",s.buildImageUrl(i,!1)),$(".dialog-imagepreview").show()),!1}),$("#im-chatContentList").on("tap",".refreshicon",function(){var t=$(this).parents("section.msg-list"),a=l.getMsgFromRecrod(t,e);return t.prev().has(">.showtime").remove(),t.remove(),e.sendMessage(a,!0),!1}),this.flag.setInit(),t.bind({ChatMessageHub:{ReceiveMessage:function(){return e.receiveMessage.apply(e,arguments)},AppendToGroup:function(){return e.appendToGroup.apply(e,arguments)},ObjectStatusChanged:function(){return e.objectStatusChanged.apply(e,arguments)}}})},e.imChatDialog=new o,t.initPart("imChatDialog",function(){return e.imChatDialog.init(),this}).done("imChatDialog",function(){e.imChatDialog.done.apply(e.imChatDialog,arguments)})}(window,imClient,window.imPublic),function(e,t,a){function i(e){e.dropload=$(".sysmsg-maincontent").dropload({autoLoad:!1,loadDownFn:function(t){e._isClosed()||(e.data.LoadPageIndex!=-1?e.getMessageList(e.data.LoadPageIndex).done(function(a){a.TotalPage<=e.data.LoadPageIndex?(e.data.LoadPageIndex=-1,t.noData(!0),t.lock()):e.data.LoadPageIndex++,t.resetload()}).fail(function(){t.resetload()}):(t.noData(!0),t.resetload(),t.lock()))}}),e.dropload.lock("up"),e.flag.setBindScroll()}function o(){this.data={User:null,Group:null,LoadDate:null,LoadPageIndex:2},this.flag=new a.flag({Init:1,BindScroll:2,Done:3}),this._haveMsgScroll=function(){var e=$(".sysmsg-maincontent");return e[0].scrollHeight>e.height()},this._open=function(e){a.pageSwitch.traceChange(),this._clear(),this.data.Group=e,a.pageSwitch.show(n,!0);var o=this;this.getMessageList(1).done(function(e){if(e.Data.length>0){var n=e.Data[0];o.data.LoadDate=a.castDate(n.AddTime);var l={ObjectType:r.ChatGroup.System,GroupID:n.GroupID};t.invoke("ChatMessageHub","ReadedGroup",l).done(function(){console.log("[sysmessage] ReadedGroup is success")}).fail(function(){console.log("[sysmessage] ReadedGroup is fail")}),!o.flag.isBindScroll()&&o._haveMsgScroll()?i(o):o.dropload&&(o.dropload.noData(!1),o.dropload.resetload(),o.dropload.unlock())}})},this._close=function(){this._resetData(),a.pageSwitch.hide(n,!0)},this._clear=function(){$("#im-sysmsg").empty(),this._resetData()},this._resetData=function(){this.data.Group=null,this.data.LoadPageIndex=2,this.data.LoadSysMsgDate=null,this.data.LoadDate=null},this._isClosed=function(){return $('[data-module="'+n+'"]').is(":hidden")}}var r=a.enum,n="im-systemmessage",l={order:function(e){var t=JSON.stringify(e.Content).replace(/\"/g,"&quot;"),i='<section data-skip id="im-msg'+e.MessageID+'" data-objecttype="'+e.ObjectType+'" data-content="'+t+'" class="sysmessage"><p class="time">'+a.getTimeMark(a.castDate(e.SendTime))+'</p><p class="content">'+e.SystemDetail.MessageContent+'</p><div class="smgoodsinfo clearfix"><div class="left"><img src="'+e.SystemDetail.GoodsImage+'"  /></div><div class="right">'+e.SystemDetail.GoodsTitle+"</div></div></section>";return i}};o.prototype={init:function(){if(this.flag.isInit())return t;if(this.data.User=a.globalOptions.User,!this.data.User)throw new Error("未传入当前聊天用户的ID");var e=this;return $("#im-sysmsg-back").on("tap",function(){return e._close(),!1}),$("#im-sysmsg").on("tap","[data-skip]",function(){var e=parseInt($(this).attr("data-objecttype")),t=JSON.parse($(this).attr("data-content"));if(e==r.ChatMessage.SystemMsg){var i="";switch(t.ObjectType){case r.PushMessageModule.Order:i=t.IsMySell?"/order/SellDetail/"+t.OrderID:"/order/buydetail/"+t.OrderID;break;default:throw new Error("错误的PushMessageModule类型")}""!=i&&a.pageSwitch.skipUrl(i)}}),this.flag.setInit(),t.bind({ChatMessageHub:{ReceiveMessage:function(){return e.receiveMessage.apply(e,arguments)}}}).done(n,function(){e.done.apply(e,arguments)})},batchAppendMsg:function(e){var t=null;if(e.Data.length>0&&(t=e.Data[0].GroupID),t==this.data.Group.GroupID)for(var a=0;a<e.Data.length;a++){var i=e.Data[a];this.appendMsg(i)}},appendMsg:function(e,t){if(0==$("#im-msg"+e.MessageID).length){$("#NoSysmsg").remove();var a=l.order(e);t?$("#im-sysmsg").prepend(a):$("#im-sysmsg").append(a)}},getMessageList:function(e){var i=this;return t.invoke("ChatMessageHub","GetMessageList",{PageIndex:e,PageSize:20},this.data.Group.GroupID,"",this.data.LoadDate,null,"").done(function(t){console.log("[sysmessage] 获取第"+e+"页聊天数据成功"),i.batchAppendMsg(t)}).fail(a._logError)},receiveMessage:function(e){return this._isClosed()||e.GroupID==this.data.Group.GroupID&&(this.appendMsg(e,!0),delete e._id,t.invoke("ChatMessageHub","ReadedMessage",e).done(function(){console.log("[sysmessage]已将消息ID为"+e.MessageID+"的消息设置为已读")}).fail(a._logError)),!0},done:function(){}};var s=new o;t.initPart(n,function(){s.init()}),e.imSystemMessage=s}(window,imClient,window.imPublic),function(e,t,a){function i(e){e.dropload=$(".praise-maincontent").dropload({autoLoad:!1,loadDownFn:function(t){e._isClosed()||(e.data.LoadPageIndex!=-1?e.getMessageList(e.data.LoadPageIndex).done(function(a){a.TotalPage<=e.data.LoadPageIndex?(e.data.LoadPageIndex=-1,t.noData(!0),t.lock()):e.data.LoadPageIndex++,t.resetload()}).fail(function(){t.resetload()}):(t.noData(!0),t.resetload(),t.lock()))}}),e.dropload.lock("up"),e.flag.setBindScroll()}function o(){this.data={User:null,Group:null,LoadDate:null,LoadPageIndex:2},this.flag=new a.flag({Init:1,BindScroll:2,Done:3}),this._haveMsgScroll=function(){var e=$(".praise-maincontent");return e[0].scrollHeight>e.height()},this._open=function(e){a.pageSwitch.traceChange(),this._clear(),this.data.Group=e,a.pageSwitch.show(n,!0);var o=this;this.getMessageList(1).done(function(e){if(e.Data.length>0){var n=e.Data[0];o.data.LoadDate=a.castDate(n.AddTime);var l={ObjectType:r.ChatGroup.Praise,GroupID:n.GroupID};t.invoke("ChatMessageHub","ReadedGroup",l).done(function(){console.log("[parise] ReadedGroup is success")}).fail(function(){console.log("[parise] ReadedGroup is fail")}),!o.flag.isBindScroll()&&o._haveMsgScroll()?i(o):o.dropload&&(o.dropload.noData(!1),o.dropload.resetload(),o.dropload.unlock())}})},this._close=function(){this._resetData(),a.pageSwitch.hide(n,!0)},this._clear=function(){$("#im-praise").empty(),this._resetData()},this._resetData=function(){this.data.Group=null,this.data.LoadPageIndex=2,this.data.LoadDate=null},this._isClosed=function(){return $('[data-module="'+n+'"]').is(":hidden")}}var r=a.enum,n="im-praise",l={switch:function(e){switch(e.PraiseDetail.ObjectType){case r.PushMessageModule.Article:return this.article(e);case r.PushMessageModule.Product:return this.product(e);default:throw new Error("错误的赞消息")}},article:function(e){var t=JSON.stringify(e.Content).replace(/\"/g,"&quot;"),i='<div id="im-msg'+e.MessageID+'" data-objecttype="'+e.ObjectType+'" data-content="'+t+'"  class="praisei clearfix borderbottom"><div class="avatar"><img data-userdetail src="'+e.PraiseDetail.User.FaceImage+'" /></div><div class="info"><p class="name">'+e.PraiseDetail.User.Nickname+'</p><p class="time">赞了您的说说 | <span>'+a.getTimeMark(a.castDate(e.SendTime))+"</span></p></div>"+(""==e.PraiseDetail.Image?'<div class="article" data-skip><p>'+e.PraiseDetail.Title+"</p></div></div>":'<div class="article" data-skip><img src="'+e.PraiseDetail.Image+'" /></div></div>');return i},product:function(e){var t=JSON.stringify(e.Content).replace(/\"/g,"&quot;"),i='<div id="im-msg'+e.MessageID+'" data-objecttype="'+e.ObjectType+'" data-content="'+t+'" class="praisei clearfix borderbottom"><div class="avatar"><img data-userdetail src="'+e.PraiseDetail.User.FaceImage+'" /></div><div class="info"><p class="name">'+e.PraiseDetail.User.Nickname+'</p><p class="time">赞了您的宝贝 | <span>'+a.getTimeMark(a.castDate(e.SendTime))+'</span></p></div><div class="goods" data-skip><img src="'+e.PraiseDetail.Image+'" /></div></div>';return i}};o.prototype={init:function(){if(this.flag.isInit())return t;if(this.data.User=a.globalOptions.User,!this.data.User)throw new Error("未传入当前聊天用户的ID");var e=this;return $("#im-praise-back").on("tap",function(){return e._close(),!1}),$("#im-praise").on("tap","[data-skip]",function(){var e=$(this).parents("div[data-objecttype]"),t=JSON.parse(e.attr("data-content")),i=parseInt(e.attr("data-objecttype"));if(i==r.ChatMessage.Praise){var o="";switch(t.ObjectType){case r.PushMessageModule.Product:o="/Optimization/Detail/"+t.ProductID;break;case r.PushMessageModule.Article:o="/Article/Detail/"+t.ArticleID;break;default:throw new Error("错误的PushMessageModule类型")}""!=o&&a.pageSwitch.skipUrl(o)}return!1}).on("tap","[data-userdetail]",function(){var e=$(this).parents("div[data-objecttype]"),t=JSON.parse(e.attr("data-content")),i=parseInt(e.attr("data-objecttype"));if(i==r.ChatMessage.Praise){var o="/my/personalin/"+t.UserID;""!=o&&a.pageSwitch.skipUrl(o)}return!1}),this.flag.setInit(),t.bind({ChatMessageHub:{ReceiveMessage:function(){return e.receiveMessage.apply(e,arguments)}}}).done(n,function(){e.done.apply(e,arguments)})},batchAppendMsg:function(e){var t=null;if(e.Data.length>0&&(t=e.Data[0].GroupID),t==this.data.Group.GroupID)for(var a=0;a<e.Data.length;a++){var i=e.Data[a];this.appendMsg(i)}},appendMsg:function(e,t){if(0==$("#im-msg"+e.MessageID).length){$("#NoPraise").remove();var a=l.switch(e);t?$("#im-praise").prepend(a):$("#im-praise").append(a)}},getMessageList:function(e){var i=this;return t.invoke("ChatMessageHub","GetPraiseChatMessageList",{PageIndex:e,PageSize:20},this.data.Group.GroupID,this.data.LoadDate).done(function(t){console.log("[praise] 获取第"+e+"页聊天数据成功"),i.batchAppendMsg(t)}).fail(a._logError)},receiveMessage:function(e){return this._isClosed()||e.GroupID==this.data.Group.GroupID&&(this.appendMsg(e,!0),delete e._id,t.invoke("ChatMessageHub","ReadedMessage",e).done(function(){console.log("[praise]已将消息ID为"+e.MessageID+"的消息设置为已读")}).fail(a._logError)),!0},done:function(){}};var s=new o;t.initPart(n,function(){s.init()}),e.imPraise=s}(window,imClient,window.imPublic),function(e,t,a){function i(e){e.my_dropload=e._getScrollElement(!0).dropload({autoLoad:!1,loadDownFn:function(t){e._isClosed()||(e.data.My_LoadPageIndex!=-1?e.getMessageList(e.data.My_LoadPageIndex,!0).done(function(a){a.TotalPage<=e.data.My_LoadPageIndex?(e.data.My_LoadPageIndex=-1,t.noData(!0),t.lock()):e.data.My_LoadPageIndex++,t.resetload()}).fail(function(){t.resetload()}):(t.noData(!0),t.resetload(),t.lock()))}}),e.my_dropload.lock("up"),e.flag.setBindMyScroll()}function o(e){e.tomy_dropload=e._getScrollElement(!1).dropload({autoLoad:!1,loadDownFn:function(t){e._isClosed()||(e.data.ToMy_LoadPageIndex!=-1?e.getMessageList(e.data.ToMy_LoadPageIndex,!1).done(function(a){a.TotalPage<=e.data.ToMy_LoadPageIndex?(e.data.ToMy_LoadPageIndex=-1,t.noData(!0),t.lock()):e.data.ToMy_LoadPageIndex++,t.resetload()}).fail(function(){t.resetload()}):(t.noData(!0),t.resetload(),t.lock()))}}),e.tomy_dropload.lock("up"),e.flag.setBindToMyScroll()}function r(){this.data={User:null,Group:null,My_LoadDate:null,My_LoadPageIndex:2,ToMy_LoadDate:null,ToMy_LoadPageIndex:2,MyFirstIsLoaded:!1,ToMyFirstIsLoaded:!1,IsMy:!1},this.flag=new a.flag({Init:1,BindMyScroll:2,BindToMyScroll:3,Done:4}),this._getScrollElement=function(e){return $('[data-commenttype="'+(e?1:0)+'"]')},this._getCommentElement=function(e){var t=e?"im-mycomment":"im-tomycomment";return $("#"+t)},this._haveMsgScroll=function(e){var t=this._getScrollElement(e);return t[0].scrollHeight>t.height()},this._open=function(e){a.pageSwitch.traceChange(),this._clear(),this.data.Group=e,a.pageSwitch.show(l,!0);this.switchTab(this.data.IsMy)},this._close=function(){this._resetData(),a.pageSwitch.hide(l,!0)},this._clear=function(e){$("#im-tomycomment").empty(),$("#im-mycomment").empty(),this._resetData()},this._resetData=function(){this.data.Group=null,this.data.My_LoadDate=null,this.data.My_LoadPageIndex=2,this.data.ToMy_LoadDate=null,this.data.ToMy_LoadPageIndex=2,this.data.MyFirstIsLoaded=!1,this.data.ToMyFirstIsLoaded=!1,this.data.IsMy=!1},this._isClosed=function(){return $('[data-module="'+l+'"]').is(":hidden")}}var n=a.enum,l="im-comment",s={switch:function(e,t){switch(e.CommentDetail.ObjectType){case n.PushMessageModule.Article:return t?this.my_article(e):this.tomy_article(e);case n.PushMessageModule.Product:return t?this.my_product(e):this.tomy_product(e);default:throw new Error("错误的赞消息")}},my_article:function(e){var t=JSON.stringify(e.Content).replace(/\"/g,"&quot;"),i='<section data-skip id="im-msg'+e.MessageID+'" data-objecttype="'+e.ObjectType+'" data-content="'+t+'" class="meslist rect"><a class="padf borderbottom clearfix"><div class="left" data-skip>'+(""==e.CommentDetail.Image?"<p>"+e.CommentDetail.Title+"</p>":'<img src="'+e.CommentDetail.Image+'" />')+'</div><div class="right"><div class="name">我</div><div class="cont">'+e.CommentDetail.Content+'</div></div><div class="time">'+a.getTimeMark(a.castDate(e.SendTime))+"</div></a></section>";return i},my_product:function(e){var t=JSON.stringify(e.Content).replace(/\"/g,"&quot;"),i='<section data-skip id="im-msg'+e.MessageID+'" data-objecttype="'+e.ObjectType+'" data-content="'+t+'" class="meslist rect"><a class="padf borderbottom clearfix"><div class="left" data-skip><img src="'+e.CommentDetail.Image+'" /></div><div class="right"><div class="name">我</div><div class="cont">'+e.CommentDetail.Content+'</div></div><div class="time">'+a.getTimeMark(a.castDate(e.SendTime))+"</div></a></section>";return i},tomy_article:function(e){var t=JSON.stringify(e.Content).replace(/\"/g,"&quot;"),i='<section data-skip id="im-msg'+e.MessageID+'" data-objecttype="'+e.ObjectType+'" data-content="'+t+'" class="meslist rect"><a class="padf borderbottom clearfix"><div class="left" data-skip>'+(""==e.CommentDetail.Image?"<p>"+e.CommentDetail.Title+"</p>":'<img src="'+e.CommentDetail.Image+'" />')+'</div><div class="right"><div class="name">'+e.CommentDetail.User.Nickname+'</div><div class="cont">'+e.CommentDetail.Content+'</div></div><div class="time">'+a.getTimeMark(a.castDate(e.SendTime))+"</div></a></section>";return i},tomy_product:function(e){var t=JSON.stringify(e.Content).replace(/\"/g,"&quot;"),i='<section data-skip id="im-msg'+e.MessageID+'" data-objecttype="'+e.ObjectType+'" data-content="'+t+'" class="meslist rect"><a class="padf borderbottom clearfix"><div class="left" data-skip><img src="'+e.CommentDetail.Image+'" /></div><div class="right"><div class="name">'+e.CommentDetail.User.Nickname+'</div><div class="cont">'+e.CommentDetail.Content+'</div></div><div class="time">'+a.getTimeMark(a.castDate(e.SendTime))+"</div></a></section>";return i}};r.prototype={init:function(){if(this.flag.isInit())return t;if(this.data.User=a.globalOptions.User,!this.data.User)throw new Error("未传入当前聊天用户的ID");var e=this;return $("#im-comment-back").on("tap",function(){return e._close(),!1}),$("#im-comment-tab>a").on("tap",function(){var t=parseInt($(this).attr("data-value"));return e.data.IsMy=!!t,e.switchTab(e.data.IsMy),!1}),$("[data-commenttype]").on("tap","[data-skip]",function(){var e=JSON.parse($(this).attr("data-content")),t=parseInt($(this).attr("data-objecttype"));if(t==n.ChatMessage.Comment){var i="";switch(e.ObjectType){case n.PushMessageModule.Product:i="/Optimization/Detail/"+e.ProductID;break;case n.PushMessageModule.Article:i="/Article/Detail/"+e.ArticleID;break;default:throw new Error("错误的PushMessageModule类型")}""!=i&&a.pageSwitch.skipUrl(i)}return!1}),this.flag.setInit(),t.bind({ChatMessageHub:{ReceiveMessage:function(){return e.receiveMessage.apply(e,arguments)}}}).done(l,function(){e.done.apply(e,arguments)})},getMyFirstMessageList:function(){var e=this;this.getMessageList(1,!0).done(function(t){if(e.data.MyFirstIsLoaded=!0,t.Data.length>0){var o=t.Data[0];e.data.My_LoadDate=a.castDate(o.AddTime),!e.flag.isBindMyScroll()&&e._haveMsgScroll(!0)?i(e):e.my_dropload&&(e.my_dropload.noData(!1),e.my_dropload.resetload(),e.my_dropload.unlock())}})},getToMyFirstMessageList:function(){var e=this;this.getMessageList(1,!1).done(function(i){if(e.data.ToMyFirstIsLoaded=!0,i.Data.length>0){var r=i.Data[0];e.data.ToMy_LoadDate=a.castDate(r.AddTime);var l={ObjectType:n.ChatGroup.Comment,GroupID:r.GroupID};t.invoke("ChatMessageHub","ReadedGroup",l).done(function(){console.log("[comment] ReadedGroup is success")}).fail(function(){console.log("[comment] ReadedGroup is fail")}),!e.flag.isBindToMyScroll()&&e._haveMsgScroll(!1)?o(e):e.tomy_dropload&&(e.tomy_dropload.noData(!1),e.tomy_dropload.resetload(),e.tomy_dropload.unlock())}})},switchTab:function(e){var t=e?1:0;$("#im-comment-tab>a").removeClass("checked"),$('#im-comment-tab>a[data-value="'+t+'"]').addClass("checked"),$("[data-commenttype]").hide(),$('[data-commenttype="'+t+'"]').show(),e?this.data.MyFirstIsLoaded||this.getMyFirstMessageList():this.data.ToMyFirstIsLoaded||this.getToMyFirstMessageList()},batchAppendMsg:function(e,t){var a=null;if(e.Data.length>0&&(a=e.Data[0].GroupID),a==this.data.Group.GroupID||t)for(var i=0;i<e.Data.length;i++){var o=e.Data[i];this.appendMsg(o,!1,t)}},appendMsg:function(e,t,a){var i=this._getCommentElement(a);if(0==$("#im-msg"+e.MessageID).length){i.parent().find(".noorder").remove();var o=s.switch(e,a);t?i.prepend(o):i.append(o)}},getMessageList:function(e,i){var o=this;return t.invoke("ChatMessageHub","GetCommentChatMessageList",{PageIndex:e,PageSize:20},this.data.Group.GroupID,i,i?this.data.My_LoadDate:this.data.ToMy_LoadDate).done(function(t){console.log("[comment "+(i?"我的评论":"我收到的评论")+"] 获取第"+e+"页聊天数据成功"),o.batchAppendMsg(t,i)}).fail(a._logError)},receiveMessage:function(e){return this._isClosed()||e.GroupID==this.data.Group.GroupID&&(this.appendMsg(e,!0,this.data.IsMy),this.data.IsMy||(delete e._id,t.invoke("ChatMessageHub","ReadedMessage",e).done(function(){console.log("[comment]已将消息ID为"+e.MessageID+"的消息设置为已读")}).fail(a._logError))),!0},done:function(){}};var d=new r;t.initPart(l,function(){d.init()}),e.imComment=d}(window,imClient,window.imPublic),function(e){var t={getUrlParams:function(e,t){var a=/([^\?#&]+)=([^\?#&]*)/g,i={};t=void 0===t||t;do{var o=a.exec(e);if(o){var r=o[1];t&&(r=r.toLowerCase()),i[r]=decodeURI(o[2])}}while(o);return i}};e.utils=t}(window),function(){function e(e){return!!e.exifdata}function t(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var a=atob(e),i=a.length,o=new ArrayBuffer(i),r=new Uint8Array(o),n=0;n<i;n++)r[n]=a.charCodeAt(n);return o}function a(e,t){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onload=function(e){200!=this.status&&0!==this.status||t(this.response)},a.send()}function i(e,i){function n(t){var a=o(t),n=r(t);e.exifdata=a||{},e.iptcdata=n||{},i&&i.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var l=t(e.src);n(l)}else if(/^blob\:/i.test(e.src)){var s=new FileReader;s.onload=function(e){n(e.target.result)},a(e.src,function(e){s.readAsArrayBuffer(e)})}else{var d=new XMLHttpRequest;d.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";n(d.response),d=null},d.open("GET",e.src,!0),d.responseType="arraybuffer",d.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var s=new FileReader;s.onload=function(e){p&&console.log("Got file of length "+e.target.result.byteLength),n(e.target.result)},s.readAsArrayBuffer(e)}}function o(e){var t=new DataView(e);if(p&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var a,i=2,o=e.byteLength;i<o;){if(255!=t.getUint8(i))return p&&console.log("Not a valid marker at offset "+i+", found: "+t.getUint8(i)),!1;if(a=t.getUint8(i+1),p&&console.log(a),225==a)return p&&console.log("Found 0xFFE1 marker"),u(t,i+4,t.getUint16(i+2)-2);i+=2+t.getUint16(i+2)}}function r(e){var t=new DataView(e);if(p&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var a=2,i=e.byteLength,o=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};a<i;){if(o(t,a)){var r=t.getUint8(a+7);r%2!==0&&(r+=1),0===r&&(r=4);var n=a+8+r,s=t.getUint16(a+6+r);return l(e,n,s)}a++}}function l(e,t,a){for(var i,o,r,n,l,s=new DataView(e),d={},u=t;u<t+a;)28===s.getUint8(u)&&2===s.getUint8(u+1)&&(n=s.getUint8(u+2),n in b&&(r=s.getInt16(u+3),l=r+5,o=b[n],i=c(s,u+5,r),d.hasOwnProperty(o)?d[o]instanceof Array?d[o].push(i):d[o]=[d[o],i]:d[o]=i)),u++;return d}function s(e,t,a,i,o){var r,n,l,s=e.getUint16(a,!o),c={};for(l=0;l<s;l++)r=a+12*l+2,n=i[e.getUint16(r,!o)],!n&&p&&console.log("Unknown tag: "+e.getUint16(r,!o)),c[n]=d(e,r,t,a,o);return c}function d(e,t,a,i,o){var r,n,l,s,d,u,p=e.getUint16(t+2,!o),h=e.getUint32(t+4,!o),m=e.getUint32(t+8,!o)+a;switch(p){case 1:case 7:if(1==h)return e.getUint8(t+8,!o);for(r=h>4?m:t+8,n=[],s=0;s<h;s++)n[s]=e.getUint8(r+s);return n;case 2:return r=h>4?m:t+8,c(e,r,h-1);case 3:if(1==h)return e.getUint16(t+8,!o);for(r=h>2?m:t+8,n=[],s=0;s<h;s++)n[s]=e.getUint16(r+2*s,!o);return n;case 4:if(1==h)return e.getUint32(t+8,!o);for(n=[],s=0;s<h;s++)n[s]=e.getUint32(m+4*s,!o);return n;case 5:if(1==h)return d=e.getUint32(m,!o),u=e.getUint32(m+4,!o),l=new Number(d/u),l.numerator=d,l.denominator=u,l;for(n=[],s=0;s<h;s++)d=e.getUint32(m+8*s,!o),u=e.getUint32(m+4+8*s,!o),n[s]=new Number(d/u),n[s].numerator=d,n[s].denominator=u;return n;case 9:if(1==h)return e.getInt32(t+8,!o);for(n=[],s=0;s<h;s++)n[s]=e.getInt32(m+4*s,!o);return n;case 10:if(1==h)return e.getInt32(m,!o)/e.getInt32(m+4,!o);for(n=[],s=0;s<h;s++)n[s]=e.getInt32(m+8*s,!o)/e.getInt32(m+4+8*s,!o);return n}}function c(e,t,a){var i="";for(n=t;n<t+a;n++)i+=String.fromCharCode(e.getUint8(n));return i}function u(e,t){if("Exif"!=c(e,t,4))return p&&console.log("Not valid EXIF data! "+c(e,t,4)),!1;var a,i,o,r,n,l=t+6;if(18761==e.getUint16(l))a=!1;else{if(19789!=e.getUint16(l))return p&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;a=!0}if(42!=e.getUint16(l+2,!a))return p&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var d=e.getUint32(l+4,!a);if(d<8)return p&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(l+4,!a)),!1;if(i=s(e,l,l+d,f,a),i.ExifIFDPointer){r=s(e,l,l+i.ExifIFDPointer,g,a);for(o in r){switch(o){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":r[o]=y[o][r[o]];break;case"ExifVersion":case"FlashpixVersion":r[o]=String.fromCharCode(r[o][0],r[o][1],r[o][2],r[o][3]);break;case"ComponentsConfiguration":r[o]=y.Components[r[o][0]]+y.Components[r[o][1]]+y.Components[r[o][2]]+y.Components[r[o][3]]}i[o]=r[o]}}if(i.GPSInfoIFDPointer){n=s(e,l,l+i.GPSInfoIFDPointer,v,a);for(o in n){switch(o){case"GPSVersionID":n[o]=n[o][0]+"."+n[o][1]+"."+n[o][2]+"."+n[o][3]}i[o]=n[o]}}return i}var p=!1,h=this,m=function(e){return e instanceof m?e:this instanceof m?void(this.EXIFwrapped=e):new m(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports.EXIF=m):h.EXIF=m;var g=m.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},f=m.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},v=m.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},y=m.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",
6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},b={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};m.getData=function(t,a){return!((t instanceof Image||t instanceof HTMLImageElement)&&!t.complete)&&(e(t)?a&&a.call(t):i(t,a),!0)},m.getTag=function(t,a){if(e(t))return t.exifdata[a]},m.getAllTags=function(t){if(!e(t))return{};var a,i=t.exifdata,o={};for(a in i)i.hasOwnProperty(a)&&(o[a]=i[a]);return o},m.pretty=function(t){if(!e(t))return"";var a,i=t.exifdata,o="";for(a in i)i.hasOwnProperty(a)&&(o+="object"==typeof i[a]?i[a]instanceof Number?a+" : "+i[a]+" ["+i[a].numerator+"/"+i[a].denominator+"]\r\n":a+" : ["+i[a].length+" values]\r\n":a+" : "+i[a]+"\r\n");return o},m.readFromBinaryFile=function(e){return o(e)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return m})}.call(this),function(e,t,a){"use strict";var i,o=t.event;o.special.smartresize={setup:function(){t(this).bind("resize",o.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",o.special.smartresize.handler)},handler:function(e,t){var a=this,r=arguments;e.type="smartresize",i&&clearTimeout(i),i=setTimeout(function(){o.dispatch.apply(a,r)},"execAsap"===t?0:100)}},t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])},t.Mason=function(e,a){this.element=t(a),this._create(e),this._init()},t.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}},t.Mason.prototype={_filterFindBricks:function(e){var t=this.options.itemSelector;return t?e.filter(t).add(e.find(t)):e},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("masonry-brick");return t},_create:function(a){this.options=t.extend(!0,{},t.Mason.settings,a),this.styleQueue=[];var i=this.element[0].style;this.originalStyle={height:i.height||""};var o=this.options.containerStyle;for(var r in o)this.originalStyle[r]=i[r]||"";this.element.css(o),this.horizontalDirection=this.options.isRTL?"right":"left";var n=this.element.css("padding-"+this.horizontalDirection),l=this.element.css("padding-top");this.offset={x:n?parseInt(n,10):0,y:l?parseInt(l,10):0},this.isFluid=this.options.columnWidth&&"function"==typeof this.options.columnWidth;var s=this;setTimeout(function(){s.element.addClass("masonry")},0),this.options.isResizable&&t(e).bind("smartresize.masonry",function(){s.resize()}),this.reloadItems()},_init:function(e){this._getColumns(),this._reLayout(e)},option:function(e,a){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))},layout:function(e,t){for(var a=0,i=e.length;a<i;a++)this._placeBrick(e[a]);var o={};if(o.height=Math.max.apply(Math,this.colYs),this.options.isFitWidth){var r=0;for(a=this.cols;--a&&0===this.colYs[a];)r++;o.width=(this.cols-r)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:o});var n,l=this.isLaidOut&&this.options.isAnimated?"animate":"css",s=this.options.animationOptions;for(a=0,i=this.styleQueue.length;a<i;a++)n=this.styleQueue[a],n.$el[l](n.style,s);this.styleQueue=[],t&&t.call(e),this.isLaidOut=!0},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.isFluid?this.options.columnWidth(t):this.options.columnWidth||this.$bricks.outerWidth(!0)||t,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(e){var a,i,o,r,n,l=t(e);if(a=Math.ceil(l.outerWidth(!0)/this.columnWidth),a=Math.min(a,this.cols),1===a)o=this.colYs;else for(i=this.cols+1-a,o=[],n=0;n<i;n++)r=this.colYs.slice(n,n+a),o[n]=Math.max.apply(Math,r);for(var s=Math.min.apply(Math,o),d=0,c=0,u=o.length;c<u;c++)if(o[c]===s){d=c;break}var p={top:s+this.offset.y};p[this.horizontalDirection]=this.columnWidth*d+this.offset.x,this.styleQueue.push({$el:l,style:p});var h=s+l.outerHeight(!0),m=this.cols+1-u;for(c=0;c<m;c++)this.colYs[d+c]=h},resize:function(){var e=this.cols;this._getColumns(),(this.isFluid||this.cols!==e)&&this._reLayout()},_reLayout:function(e){var t=this.cols;for(this.colYs=[];t--;)this.colYs.push(0);this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems(),this._init(e)},appended:function(e,t,a){if(t){this._filterFindBricks(e).css({top:this.element.height()});var i=this;setTimeout(function(){i._appended(e,a)},1)}else this._appended(e,a)},_appended:function(e,t){var a=this._getBricks(e);this.$bricks=this.$bricks.add(a),this.layout(a,t)},remove:function(e){this.$bricks=this.$bricks.not(e),e.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var a=this.element[0].style;for(var i in this.originalStyle)a[i]=this.originalStyle[i];this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),t(e).unbind(".masonry")}},t.fn.imagesLoaded=function(e){function a(){e.call(o,r)}function i(e){var o=e.target;o.src!==l&&t.inArray(o,s)===-1&&(s.push(o),--n<=0&&(setTimeout(a),r.unbind(".imagesLoaded",i)))}var o=this,r=o.find("img").add(o.filter("img")),n=r.length,l="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",s=[];return n||a(),r.bind("load.imagesLoaded error.imagesLoaded",i).each(function(){var e=this.src;this.src=l,this.src=e}),o};var r=function(t){e.console&&e.console.error(t)};t.fn.masonry=function(e){if("string"==typeof e){var a=Array.prototype.slice.call(arguments,1);this.each(function(){var i=t.data(this,"masonry");return i?t.isFunction(i[e])&&"_"!==e.charAt(0)?void i[e].apply(i,a):void r("no such method '"+e+"' for masonry instance"):void r("cannot call methods on masonry prior to initialization; attempted to call method '"+e+"'")})}else this.each(function(){var a=t.data(this,"masonry");a?(a.option(e||{}),a._init()):t.data(this,"masonry",new t.Mason(e,this))});return this}}(window,jQuery),!function(e,t,a,i){var o=e(t);e.fn.lazyload=function(r){function n(){var t=0;s.each(function(){var a=e(this);if(!d.skip_invisible||a.is(":visible"))if(e.abovethetop(this,d)||e.leftofbegin(this,d));else if(e.belowthefold(this,d)||e.rightoffold(this,d)){if(++t>d.failure_limit)return!1}else a.trigger("appear"),t=0})}var l,s=this,d={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return r&&(i!==r.failurelimit&&(r.failure_limit=r.failurelimit,delete r.failurelimit),i!==r.effectspeed&&(r.effect_speed=r.effectspeed,delete r.effectspeed),e.extend(d,r)),l=d.container===i||d.container===t?o:e(d.container),0===d.event.indexOf("scroll")&&l.bind(d.event,function(){return n()}),this.each(function(){var t=this,a=e(t);t.loaded=!1,(a.attr("src")===i||a.attr("src")===!1)&&a.is("img")&&a.attr("src",d.placeholder),a.one("appear",function(){if(!this.loaded){if(d.appear){var i=s.length;d.appear.call(t,i,d)}e("<img />").bind("load",function(){var i=a.attr("data-"+d.data_attribute);a.hide(),a.is("img")?a.attr("src",i):a.css("background-image","url('"+i+"')"),a[d.effect](d.effect_speed),t.loaded=!0;var o=e.grep(s,function(e){return!e.loaded});if(s=e(o),d.load){var r=s.length;d.load.call(t,r,d)}}).attr("src",a.attr("data-"+d.data_attribute))}}),0!==d.event.indexOf("scroll")&&a.bind(d.event,function(){t.loaded||a.trigger("appear")})}),o.bind("resize",function(){n()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&o.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&s.each(function(){e(this).trigger("appear")})}),e(a).ready(function(){n()}),this},e.belowthefold=function(a,r){var n;return n=r.container===i||r.container===t?(t.innerHeight?t.innerHeight:o.height())+o.scrollTop():e(r.container).offset().top+e(r.container).height(),n<=e(a).offset().top-r.threshold},e.rightoffold=function(a,r){var n;return n=r.container===i||r.container===t?o.width()+o.scrollLeft():e(r.container).offset().left+e(r.container).width(),n<=e(a).offset().left-r.threshold},e.abovethetop=function(a,r){var n;return n=r.container===i||r.container===t?o.scrollTop():e(r.container).offset().top,n>=e(a).offset().top+r.threshold+e(a).height()},e.leftofbegin=function(a,r){var n;return n=r.container===i||r.container===t?o.scrollLeft():e(r.container).offset().left,n>=e(a).offset().left+r.threshold+e(a).width()},e.inviewport=function(t,a){return!(e.rightoffold(t,a)||e.leftofbegin(t,a)||e.belowthefold(t,a)||e.abovethetop(t,a))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window,document);var Global_ServiceUrlHelper=new function(){var e="http://base2.api.95laibei.com";this.APIDomain=e,this.IMServiceUrl="http://im.api.95laibei.com",this.CurrentDomain=location.protocol+"//"+location.host,this.MobileCheckStr=/^\d{11}$/,this.PasswordCheckStr=/^[0-9a-zA-Z]{6,16}$/,this.GeoCoderExpTime=168,this.CategoryExpTime=24,this.TokenExpTime=8760,this.UserSearchExpTime=168,this.Article_GetBaseList=e+"/MWeb/Article/GetBaseList",this.Common_GetTagList=e+"/MWeb/Common/GetTagList",this.Common_PicFileSave=e+"/MWeb/Common/PicFileSave",this.Article_Add=e+"/MWeb/Article/Add",this.Article_ChageBase=e+"/MWeb/Article/ChageBase",this.Common_GetGeoCoder=e+"/MWeb/Common/GetGeoCoder",this.Common_GetCoreRegionByParentId=e+"/MWeb/Common/GetCoreRegionByParentId",this.Product_GetBaseList=e+"/MWeb/Product/GetBaseList",this.Product_GetCategoryTop=e+"/MWeb/Product/GetCategoryTop",this.Product_GetCategorySubByTopId=e+"/MWeb/Product/GetCategorySubByTopId",this.Product_AddBase=e+"/MWeb/Product/AddBase",this.Product_ChangeBase=e+"/MWeb/Product/ChangeBase",this.Account_AddValidCode=e+"/MWeb/Account/AddValidCode",this.Account_CheckLoginByValidCode=e+"/MWeb/Account/CheckLoginByValidCode",this.Account_CheckLoginByPwd=e+"/MWeb/Account/CheckLoginByPwd",this.Account_AddMBRBase=e+"/MWeb/Account/AddMBRBase",this.Account_ChangePassword=e+"/MWeb/Account/ChangePassword",this.Account_GetBaseByToken=e+"/MWeb/Account/GetMbrBase",this.Article_DelBase=e+"/MWeb/Article/DelBase",this.Product_DelBase=e+"/MWeb/Product/DelBase",this.Article_GetBaseListByUserId=e+"/MWeb/Article/GetBaseListByUserId",this.Product_GetBaseListByUserId=e+"/MWeb/Product/GetBaseListByUserId",this.Search_GetHotSearch=e+"/MWeb/Search/GetHotSearch",this.Search_GetUserList=e+"/MWeb/Search/GetUserList",this.Search_GetArticleOrProduct=e+"/MWeb/Search/GetArticleOrProduct",this.Account_ChangeBaseSex=e+"/MWeb/Account/ChangeBaseSex",this.Goods_GetBaseListByProductId=e+"/MWeb/Goods/GetBaseListByProductId",this.Goods_GetBaseConsigneeByUserId=e+"/MWeb/Goods/GetBaseConsigneeByUserId",this.Account_GetConsigneeByMbrBaseId=e+"/MWeb/Account/GetConsigneeByMbrBaseId",this.Account_SetConsigneeIsDefault=e+"/MWeb/Account/SetConsigneeIsDefault",this.Account_RemoveConsignee=e+"/MWeb/Account/RemoveConsignee",this.Points_GetBaseList=e+"/MWeb/Points/GetBaseList",this.WeiXin_GetJsApiParam=e+"/MWeb/WeiXin/GetJsApiParam",this.Order_AddBase=e+"/MWeb/Order/AddBase",this.Order_GetBaseById=e+"/MWeb/Order/GetBaseById",this.Order_Pay=e+"/MWeb/Order/Pay",this.Account_GetConsigneeById=e+"/MWeb/Account/GetConsigneeById",this.Account_AddConsignee=e+"/MWeb/Account/AddConsignee",this.Order_GetMyList=e+"/MWeb/Order/GetMyList",this.Order_CancelBase=e+"/MWeb/Order/CancelBase",this.WeiXin_GetOauthUrl=e+"/MWeb/WeiXin/GetOauthUrl",this.Order_GetBaseDetailByID=e+"/MWeb/Order/GetBaseDetailByID",this.Order_GetRefundByOrderId=e+"/MWeb/Order/GetRefundByOrderId",this.Order_ChangeRefundByOrderId=e+"/MWeb/Order/ChangeRefundByOrderId",this.Order_CancelRefund=e+"/MWeb/Order/CancelRefund",this.Order_GetReplyByOrderId=e+"/MWeb/Order/GetReplyByOrderId",this.Order_ReplyRefundByOrderId=e+"/MWeb/Order/ReplyRefundByOrderId",this.Order_GetSendGoodsByOrderId=e+"/MWeb/Order/GetSendGoodsByOrderId",this.Order_SendGoodsByOrderId=e+"/MWeb/Order/SendGoodsByOrderId",this.Order_ConfirmExpress=e+"/MWeb/Order/ConfirmExpress",this.Order_ChangeBasePice=e+"/MWeb/Order/ChangeBasePice",this.Order_GetRefundListByOrderId=e+"/MWeb/Order/GetRefundListByOrderId",this.Order_BaseRefund=e+"/MWeb/Order/BaseRefund",this.Account_GetMbrInfoByToken=e+"/MWeb/Account/GetMbrInfoByToken",this.Account_GetBankCardListByMbrBaseId=e+"/MWeb/Account/GetBankCardListByMbrBaseId",this.Account_DelBankCard=e+"/MWeb/Account/DelBankCard",this.Account_AddBankCard=e+"/MWeb/Account/AddBankCard",this.Account_GetBankList=e+"/MWeb/Account/GetBankList",this.Account_SetBankCardDefault=e+"/MWeb/Account/SetBankCardDefault",this.Account_GetDefaultBankCard=e+"/MWeb/Account/GetDefaultBankCard",this.Account_GetBankCard=e+"/MWeb/Account/GetBankCard",this.Account_AddWithdraw=e+"/MWeb/Account/AddWithdraw",this.Order_CashPaySuccess=e+"/MWeb/Order/CashPaySuccess",this.Order_CheckPayment=e+"/MWeb/Order/CheckPayment",this.Order_CashPayFail=e+"/MWeb/Order/CashPayFail",this.Home_GetBaseList=e+"/MWeb/Home/GetBaseList",this.Account_GetWithdrawBase=e+"/MWeb/Account/GetWithdrawBase",this.Article_AddArticleComment=e+"/MWeb/Article/AddArticleComment",this.Product_AddProductComment=e+"/MWeb/Product/AddProductComment",this.Common_SetErrLog=e+"/MWeb/Common/SetErrLog",this.Common_SetMonitorHijackingLog=e+"/MWeb/Common/SetMonitorHijackingLog",this.Common_SetServerLog=e+"/MWeb/Common/SetServerLog",this.Article_BasePraise=e+"/MWeb/Article/BasePraise",this.Article_GetBaseById=e+"/MWeb/Article/GetBaseById",this.Product_GetBaseById=e+"/MWeb/Product/GetBaseById",this.Account_BaseAttention=e+"/MWeb/Account/BaseAttention",this.Account_GetMyHomePage=e+"/MWeb/Account/GetMyHomePage",this.Account_GetUserArticleList=e+"/MWeb/Account/GetUserArticleList",this.Account_GetPraiseList=e+"/MWeb/Account/GetPraiseList",this.Account_GetAttrntionList=e+"/MWeb/Account/GetAttrntionList",this.WeiXin_GetJsApiConfig=e+"/MWeb/WeiXin/GetJsApiConfig",this.Account_CheckBaseByToken=e+"/MWeb/Account/CheckBaseByToken",this.Article_GetForwardByID=e+"/MWeb/Article/GetForwardByID",this.Article_BaseForward=e+"/MWeb/Article/BaseForward",this.Account_ChangeFaceImg=e+"/MWeb/Account/ChangeFaceImg",this.Account_ChangeNickName=e+"/MWeb/Account/ChangeNickName",this.Account_ChangeBirthday=e+"/MWeb/Account/ChangeBirthday",this.Account_ChangeSignature=e+"/MWeb/Account/ChangeSignature",this.Account_SetPassword=e+"/MWeb/Account/SetPassword",this.Common_GetExpressByOrderId=e+"/MWeb/Common/GetExpressByOrderId",this.Account_GetMyIndex=e+"/MWeb/Account/GetMyIndex",this.Account_GetBackgroundImage=e+"/MWeb/Account/GetBackgroundImage",this.Account_ChangeBackgroundImg=e+"/MWeb/Account/ChangeBackgroundImg",this.Alipay_Pay=e+"/MWeb/Alipay/Pay",this.Account_CheckPassword=e+"/MWeb/Account/CheckPassword",this.Account_ModifyPassword=e+"/MWeb/Account/ModifyPassword",this.Points_GetCommonPayById=e+"/MWeb/Points/GetCommonPayById",this.Order_ReminderDelivery=e+"/MWeb/Order/ReminderDelivery",this.Article_GetCommentList=e+"/MWeb/Article/GetCommentList",this.Product_GetCommentList=e+"/MWeb/Product/GetCommentList",this.Account_SignOut=e+"/MWeb/Account/SignOut",this.SSO_GetSSOInfo=e+"/MWeb/SSO/GetSSOInfo",this.Account_CheckValidCode=e+"/MWeb/Account/CheckValidCode",this.Alipay_AppPay=e+"/MWeb/Alipay/AppPay",this.WeiXin_GetOrderId=e+"/MWeb/WeiXin/GetOrderId",this.Product_GetBaseListByCategory=e+"/MWeb/Product/GetBaseListByCategory",this.Article_Channels=e+"/MWeb/SysConfig/GetArticleChannels",this.Article_GetRecommendList=e+"/MWeb/Article/GetRecommendList",this.WeChatActivity_SaveCharacterTestActivityResult=e+"/MWeb/WeChatActivity/SaveCharacterTestActivityResult",this.WeChatActivity_GetCharacterTestActivityResult=e+"/MWeb/WeChatActivity/GetCharacterTestActivityResult",this.Common_AddSiteAccessLog=e+"/MWeb/Common/AddSiteAccessLog",this.Charity_AddBase=e+"/MWeb/Charity/AddBase",this.Charity_GetListByBaseID=e+"/MWeb/Charity/GetListByBaseID",this.Account_CheckLoginByConnect=e+"/MWeb/Account/CheckLoginByConnect",this.Account_AddConnectMBRBase=e+"/MWeb/Account/AddConnectMBRBase",this.Account_ChangeCategoryDesc=e+"/MWeb/Account/ChangeCategoryDesc",this.Account_GetBindInfo=e+"/MWeb/Account/GetBindInfo",this.Account_RemoveBindingConnect=e+"/MWeb/Account/RemoveBindingConnect",this.Account_BindingConnect=e+"/MWeb/Account/BindingConnect",this.BehaviorAnalysis_AddPageVisit=e+"/MWeb/BehaviorAnalysis/AddPageVisit",this.BehaviorAnalysis_AddPageDuration=e+"/MWeb/BehaviorAnalysis/AddPageDuration",this.Charity_GetBaseById=e+"/MWeb/Charity/GetBaseById",this.Charity_GetHelpers=e+"/MWeb/Charity/GetHelperList",this.Charity_GetList=e+"/MWeb/Charity/GetList",this.Charity_GetBaseProductById=e+"/MWeb/Charity/GetBaseProductById",this.Charity_GetMyCharityOrders=e+"/MWeb/Charity/GetMyCharityOrders",this.Charity_GetSendRecords=e+"/MWeb/Charity/GetSendRecords",this.WeChatActivity_GetScratchBase=e+"/MWeb/WeChatActivity/GetScratchBase",this.WeChatActivity_AddDrawScratchBase=e+"/MWeb/WeChatActivity/AddDrawScratchBase",this.WeChatActivity_ScratchShare=e+"/MWeb/WeChatActivity/ScratchShare",this.WeChatActivity_ScancodeActivityResult=e+"/MWeb/WeChatActivity/ScancodeActivityResult",this.Preferred_GetEffectPreferredList=e+"/MWeb/Preferred/GetEffectPreferredList",this.Preferred_GetExpiredPreferredList=e+"/MWeb/Preferred/GetExpiredPreferredList",this.Preferred_GetBannerList=e+"/MWeb/Common/GetBannerList",this.Product_GetProductListByCategory=e+"/MWeb/Product/GetProductListByCategory",this.Preferred_GetBaseById=e+"/MWeb/Preferred/GetBaseById",this.Preferred_GetProductListById=e+"/MWeb/Preferred/GetProductListById",this.Preferred_GetFinalComment=e+"/MWeb/Preferred/GetFinalComment",this.Preferred_GetMamaCommentList=e+"/MWeb/Preferred/GetMamaCommentList",this.Product_GetProductDetail=e+"/MWeb/Product/GetProductDetail",this.Account_GetRecommendBase=e+"/MWeb/Account/GetRecommendBase",this.Video_GetBaseList=e+"/MWeb/Video/GetBaseList"},Global_ImgHelper=new function(){function e(e){var t=null;if(void 0!=window.createObjectURL)t=window.createObjectURL(e);else if(void 0!=window.URL){var a=[];a.push(e),t=window.URL.createObjectURL(new Blob(a,{type:"application/zip"}))}else void 0!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e));return t}function t(e,t,a,i){this.base64=e,this.path=t,this.imgType=a,this.Orientation=i}var a=this;this._getCanvas=function(){var e=$("#zipimg_canvas");return 0==e.length&&($("body").append('<canvas id="zipimg_canvas" style="display:none;"></canvas>'),e=$("#zipimg_canvas")),e[0]},this.ZipImg=function(t,i){var o,r=e(t),n=new Image,l=750;n.src=r,n.onload=function(){var e=a._getCanvas;n.width>l?(imageWidth=l,imageHeight=l*(n.height/n.width)):(imageWidth=n.width,imageHeight=n.height),e.width=imageWidth,e.height=imageHeight;var t=e.getContext("2d");n.naturalWidth,n.naturalHeight;t.clearRect(0,0,e.width,e.height),t.drawImage(n,0,0,imageWidth,imageHeight),o=e.toDataURL("image/jpeg",.5).substr(23),$.isFunction(i)&&i(o)}},this.UploadImg=function(e,a,i,o,r,n,l,s){var d=new t(e,i,a,s);$.ajax({url:Global_ServiceUrlHelper.Common_PicFileSave,type:"POST",data:{reqJson:JSON.stringify(d)},dataType:"json",success:function(e){$.isFunction(r)&&r(e,o,l)},error:function(e,t,a){$.isFunction(n)&&n(t)},beforeSend:function(e,t){},complete:function(e,t){}})},this.ZipAndUploadImg=function(t,o,r,n,l,s){var d,c=e(t),u=new Image,p=this,h=750;u.src=c;var m=/^(image\/jpeg|image\/png)$/i;if(m.test(t.type)){var g=null;i({image:c,onFix:function(e){g=e;var t=a._getCanvas();u.width>h?(imageWidth=h,imageHeight=h*(u.height/u.width)):(imageWidth=u.width,imageHeight=u.height),t.width=imageWidth,t.height=imageHeight;var i=t.getContext("2d");u.naturalWidth,u.naturalHeight;i.clearRect(0,0,t.width,t.height),i.drawImage(u,0,0,imageWidth,imageHeight),d=t.toDataURL("image/jpeg",.5).substr(23),null!=g&&void 0!=g||(g=0),p.UploadImg(d,o,r,c,n,l,s,g)}})}};var i=function(e){var t={image:"",imgType:"url",onFix:function(e){}},a={},i="";$.extend(t,e);var o={init:function(){var e=new Image,o=this;i=e,e.onload=function(){EXIF.getData(this,function(){a=EXIF.getAllTags(this),o.__fix()})},"image"==t.imgType?e.src=$(t.image).attr("src"):e.src=t.image},__fix:function(){var e=null;e=a.Orientation,void 0==e&&(e=1),t.onFix(e)}};o.init();var r={getExif:function(){return a}};return r}},Global_StorageHelper=new function(){this.CacheType={Local:1,Session:2},this.OperationType={Set:1,Remove:2},this._storageChangeEvents=[],this._indexOfKey=function(e){for(var t=0;t<this._storageChangeEvents.length;t++){var a=this._storageChangeEvents[t];if(e==a.key)return t}return-1},this.NoticeChange=function(){for(var e=0;e<this._storageChangeEvents.length;e++){var t=this._storageChangeEvents[e];t.event.apply(this,arguments)}},this._ComboArguments=function(e,t){e=e||[];for(var a=0;a<t.length;a++)e.push(t[a]);return e},this.Subscribe=function(e,t){return this._indexOfKey(e)!=-1?void console.log("error : 已经存在了相同的key"):void("function"===$.type(t)&&this._storageChangeEvents.push({key:e,event:t}))},this.UnSubscribe=function(e){var t=this._indexOfKey(e);t!=-1&&this._storageChangeEvents.splice(t,1)},GetImgObject=function(e,t){var e=e,t=t;return{ExpTime:e,ObjectData:t}},this.GetStorageByKey=function(e,t,a,i,o){var r=window.localStorage,n=r.getItem(e),l="";if(null!=n){l=JSON.parse(n);var s=new Date,d=new Date(l.ExpTime);if(s<d&&$.isFunction(o))return void o(l.ObjectData)}$.ajax({url:t,type:"POST",data:{reqJson:a},dataType:"json",async:!1,success:function(t){var a="";if(null!=t.Content&&t.Content.length>0){var n=new Date;n.setHours(n.getHours()+i),r.setItem(e,JSON.stringify(GetImgObject(n,JSON.stringify(t.Content)))),a=JSON.stringify(t.Content)}else a="err";if($.isFunction(o))return void o(a)}})},this.SetDataToStorage=function(e,t,a){var i=window.localStorage,o=new Date;o.setHours(o.getHours()+a),i.setItem(e,JSON.stringify(GetImgObject(o,JSON.stringify(t)))),this.NoticeChange.apply(this,this._ComboArguments([this.CacheType.Local,this.OperationType.Set],arguments))},this.GetStorageDataByKey=function(e){var t=window.localStorage,a=t.getItem(e),i="";if(this.StorageData=null,null!=a){i=JSON.parse(a);var o=new Date,r=new Date(i.ExpTime);o<r&&(this.StorageData=i.ObjectData)}},this.SetDataToStorageWithExpTimeSeconds=function(e,t,a){var i=window.localStorage,o=new Date,r=o.setSeconds(a);i.setItem(e,JSON.stringify(GetImgObject(r,JSON.stringify(t)))),this.NoticeChange.apply(this,this._ComboArguments([this.CacheType.Local,this.OperationType.Set],arguments))},this.GetStorageDataByKeyWithExpTimeSeconds=function(e){var t=window.localStorage,a=t.getItem(e),i="";if(this.StorageData=null,null!=a){i=JSON.parse(a);var o=(new Date).getTime(),r=i.ExpTime;o<r&&(this.StorageData=i.ObjectData)}},this.GetBankDataByKey=function(e){return this.GetStorageByKey("Pay_Bank",Global_ServiceUrlHelper.Account_GetBankList,"{}",Global_ServiceUrlHelper.CategoryExpTime,e)},this.GetCoreDataByKey=function(e,t){return this.GetStorageByKey("Core_Parent"+e,Global_ServiceUrlHelper.Common_GetCoreRegionByParentId,'{"ParentId":"'+e+'"}',Global_ServiceUrlHelper.GeoCoderExpTime,t)},this.GetSubCategoryDataByKey=function(e,t){return this.GetStorageByKey("Category_Top"+e,Global_ServiceUrlHelper.Product_GetCategorySubByTopId,'{"CategoryTopId":"'+e+'"}',Global_ServiceUrlHelper.CategoryExpTime,t)},this.GetTopCategoryDataByKey=function(e,t){return this.GetStorageByKey("Category_Top"+e,Global_ServiceUrlHelper.Product_GetCategoryTop,"{}",Global_ServiceUrlHelper.CategoryExpTime,t)},this.SetUserTokenToStorage=function(e){this.SetDataToStorage("UserToken",e,Global_ServiceUrlHelper.TokenExpTime)},this.DelStorageByKey=function(e){var t=window.localStorage;t.removeItem(e),this.NoticeChange.apply(this,this._ComboArguments([this.CacheType.Local,this.OperationType.Remove],arguments))},this.SetLocalToStorage=function(e,t){var a=window.localStorage;a.setItem(e,t),this.NoticeChange.apply(this,this._ComboArguments([this.CacheType.Local,this.OperationType.Set],arguments))},this.GetLocalToStorage=function(e){var t=window.localStorage;this.StorageData=t.getItem(e)},this.SetSessionToStorage=function(e,t){var a=window.sessionStorage;a.setItem(e,t),this.NoticeChange.apply(this,this._ComboArguments([this.CacheType.Session,this.OperationType.Set],arguments))},this.GetSessionToStorage=function(e){var t=window.sessionStorage;this.StorageData=t.getItem(e)},this.DelSessionByKey=function(e){var t=window.sessionStorage;t.removeItem(e),this.NoticeChange.apply(this,this._ComboArguments([this.CacheType.Session,this.OperationType.Remove],arguments))}},TemplateHelper=new function(){function e(e,t,a){e.indexOf(m)>=0?(b.Other.appendType=a,b.Other.container=t):(b.Page.appendType=a,b.Page.container=t)}function t(e){var t=h+r(e),a=!1;return $.each(_,function(e,i){if(i.storagekey==t)return a=i.needLogin,!1}),a}function a(){if(null!=_&&_.length>0)var e=setTimeout(function(){$.each(_,function(e,t){var a=new Global_StorageHelper.GetLocalToStorage(t.storagekey);0!=!!a&&0!=!!a.StorageData&&JSON.parse(a.StorageData).Version==y&&0!=!!JSON.parse(a.StorageData).TempHtml||s(t.cdnTempUrl,!0,function(e){if(e){var a=l(e);0==a?d(t.serverApiUrl,function(e){c(e,t.storagekey)}):c(e,t.storagekey)}else d(t.serverApiUrl,function(e){c(e,t.storagekey)})})}),clearTimeout(e)},3e3)}function i(e){e.indexOf(f)>=0?(p=b.Other.container,u=b.Other.appendType):(p=b.Page.container,u=b.Page.appendType);var t=$(p);0==!!t||0==p?console.log("获取容器["+p+"]失败"):"append"==u?t.append(e):t.html(e)}function o(e){var t=n(e);if(0==!!t)return"";var a=v.replace("{id}",r(e)).replace("{inner}",t);return a}function r(e){var t=e.match(/(\/{1}[\w]*[^\/]){2}/gi);return null!=t&&t.length>0&&(e=t[0]),e.toLowerCase().replace("/","_").replace("/","_")}function n(e){var t="[]",a=h+r(e),i=new Global_StorageHelper.GetLocalToStorage(a),o="";return null!=i&&null!=i.StorageData&&(t=JSON.parse(i.StorageData)),t&&t.TempHtml&&(o=t.TempHtml),o}function l(e){if(e){var t=/(?:<!--Version:)([\s\S]*)(:?-->)/,a=e.match(t);if(a&&null!=a[1])return a[1]==y}return!1}function s(e,t,a){if(0==!!e)return void a();var i="";$.ajax({type:"get",url:e,async:t,success:function(e){i=e,a&&"function"==typeof a&&a(i)},error:function(){a(),console.log("TemplateHelper.getDataByAjax方法错误")}})}function d(e,t){return 0==!!e?void t():void $.ajax({type:"post",url:e,async:!0,success:function(e){t&&"function"==typeof t&&t(JSON.parse(e))},error:function(a,i,o){t&&"function"==typeof t&&t(),console.log("接口["+e+"]请求错误")}})}function c(e,t){if(e){var a={TempHtml:e.PageMainContent,Version:y};Global_StorageHelper.SetLocalToStorage(t,JSON.stringify(a));var i={TempHtml:e.PageOtherContent,Version:y};Global_StorageHelper.SetLocalToStorage(g,JSON.stringify(i))}}var u="append",p="",h="95laibei_template",m="_page_other",g="95laibei_template_page_other",f="<templatehtml>",v='<div id="{id}" data-role="page" class="laibei_page" data-module="page"><div class="page-loading-template"></div>{inner}</div>',y="",b=null,S="http://cdn.other.file.95laibei.com",_=[];this.Init=function(){y=$("#ResourcesVersion000").val(),null!=_&&0!=_.length||(_=[{storagekey:"95laibei_template_article_list",cdnTempUrl:S+"/article_list.temphtml",serverApiUrl:"/generatehtml/GetArticleListHtmlApi",needLogin:!1},{storagekey:"95laibei_template_my_index",cdnTempUrl:S+"/my_index.temphtml",serverApiUrl:"/generatehtml/GetMyIndexHtmlApi",needLogin:!0},{storagekey:"95laibei_template_page_other",cdnTempUrl:S+"/page_other.temphtml",serverApiUrl:"",needLogin:!1}]),null==b&&(b={Page:{appendType:"",container:""},Other:{appendType:"",container:""}}),a(),this.loadingHide()},this.getTempHtml=function(e,t){var a="",o=new Global_StorageHelper.GetLocalToStorage(t);if(o&&o.StorageData){var r=JSON.parse(o.StorageData);r.Versoin==y&&(a=r.TempHtml)}0==!!a?s(e,!1,function(e){if(e){var a={TempHtml:e,Versoin:y};Global_StorageHelper.SetLocalToStorage(t,JSON.stringify(a)),i(e)}}):i(a)},this.applyHtmlToDom=function(t,a,i){e(a,i,"html"),this.getTempHtml(t,a)},this.appendHtmlToDom=function(t,a,i){e(a,i,"append"),this.getTempHtml(t,a)},this.changePage=function(e){var a=e;try{e.indexOf(Global_ServiceUrlHelper.CurrentDomain)>=0?e=e.replace(Global_ServiceUrlHelper.CurrentDomain,""):a=Global_ServiceUrlHelper.CurrentDomain+e;var i=t(e),n="";if(i){var l=Global_BaseInfoHelper.CheckLogin();0==l&&(n=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+encodeURIComponent(a))}if(n)$.mobile.changePage(n);else{var s=o(e);if(s){var d="#"+r(e);0!=!!$(d)&&0!=$(d).length||$("body").append(s),$.mobile.changePage(d),history.pushState({},"",a)}else $.mobile.changePage(a)}}catch(e){Global_CommonHelper.SetServerLog("MWeb静态分离:TemplateHelper.changePage方法错误:"+e),$.mobile.changePage(a)}finally{}},this.loadingHide=function(){var e=setTimeout(function(){$(".page-loading-template").remove(),clearTimeout(e)},300)}},Global_GeoCoderHelper=new function(){this.GetGeoCoder=function(e,t){function a(t){var a=t.lat,i=t.lon;
$.ajax({url:Global_ServiceUrlHelper.Common_GetGeoCoder,type:"POST",data:{reqJson:'{"lat":'+a+',"lng":'+i+"}"},dataType:"json",success:function(t){PositionAddressName=t.ProvinceName+" "+t.CityName+" "+t.DistrictName,PositionProvinceId=t.ProvinceID,PositionCityId=t.CityID,PositionDistrictId=t.DistrictID,$("#"+e).html(PositionAddressName).attr("data-Province",t.ProvinceID).attr("data-City",t.CityID).attr("data-District",t.DistrictID),$(".BaiDuAddress").html(PositionAddressName)}})}function i(t){$("#"+e).html(Global_MessageHelper.PositionError).attr("data-Province",PositionProvinceId).attr("data-City",PositionCityId).attr("data-District",PositionDistrictId),$(".BaiDuAddress").html(PositionAddressName)}setTimeout(function(){Global_ApicloudHelper.getLocation(a,i)},500)},ChooseProvinceId=0,ChooseProvinceName=0,ChooseCityId=0,ChooseCityName=0,ChooseDistrictId=0,ChooseDistrictName=0,CurrentMainPage="",CurrentParentId=0,CurrentParentName="",CurrentCoreLevel=0,PositionAddressName="定位失败，请选择",PositionProvinceId=0,PositionCityId=0,PositionDistrictId=0,this.GetGeoCoderStorage=function(e,t,a,i){var o=this;CurrentMainPage=e,CurrentParentId=t,CurrentParentName=a,CurrentCoreLevel=i,Global_StorageHelper.GetCoreDataByKey(t,o.CoderStorageSucFun)},this.CoderStorageSucFun=function(e){"err"!=e&&""!=e?1==CurrentCoreLevel?ShowProvincePage(CurrentMainPage,CurrentParentId,CurrentParentName,e):2==CurrentCoreLevel?ShowCityPage(CurrentMainPage,CurrentParentId,CurrentParentName,e):ShowDistrictPage(CurrentMainPage,CurrentParentId,CurrentParentName,e):Global_PopupHelper.alert({title:"地理位置获取失败"})},ShowProvincePage=function(e,t,a,i){var o="",r=JSON.parse(i);$.each(r,function(t,a){o+='<li class="borderbottom"><div class="localname" onclick="Global_GeoCoderHelper.ShowCorePage(\''+e+"',"+a.RegionId+",'"+a.RegionName+'\',2)" data-RegionId="'+a.RegionId+'"><h1>'+a.RegionName+'</h1></div><div class="iconfont arrow" >&#xe61e;</div></li>'}),$("#ProvinceSelectUl").html(o),$("#"+e).hide(),$("#ProvincePageDiv").show(),$("#CityPageDiv").hide(),$("#DistrictPageDiv").hide()},ShowCityPage=function(e,t,a,i){var o="",r=JSON.parse(i);$.each(r,function(t,a){o+='<li class="borderbottom"><div class="localname" onclick="Global_GeoCoderHelper.ShowCorePage(\''+e+"',"+a.RegionId+",'"+a.RegionName+'\',3)" data-RegionId="'+a.RegionId+'"><h1>'+a.RegionName+'</h1></div><div class="iconfont arrow">&#xe61e;</div></li>'}),$("#CitySelectUl").html(o),$("#"+e).hide(),$("#ProvincePageDiv").hide(),$("#CityPageDiv").show(),$("#DistrictPageDiv").hide(),ChooseProvinceId=t,ChooseProvinceName=a},ShowDistrictPage=function(e,t,a,i){var o="",r=JSON.parse(i);$.each(r,function(t,a){o+='<li class="borderbottom"><div class="localname" onclick="Global_GeoCoderHelper.ChooseCore(\''+e+"',"+a.RegionId+",'"+a.RegionName+'\')" data-RegionId="'+a.RegionId+'"><h1>'+a.RegionName+"</h1></div></li>"}),$("#DistrictSelectUl").html(o),$("#"+e).hide(),$("#ProvincePageDiv").hide(),$("#CityPageDiv").hide(),$("#DistrictPageDiv").show(),ChooseCityId=t,ChooseCityName=a},this.ShowCorePage=function(e,t,a,i){var o=this;o.GetGeoCoderStorage(e,t,a,i)},this.BackProvincePage=function(e){$("#"+e).show(),$("#ProvincePageDiv").hide(),$("#CityPageDiv").hide(),$("#DistrictPageDiv").hide()},this.BackCityPage=function(e){$("#"+e).hide(),$("#ProvincePageDiv").show(),$("#CityPageDiv").hide(),$("#DistrictPageDiv").hide()},this.BackDistrictPage=function(e){$("#"+e).hide(),$("#ProvincePageDiv").hide(),$("#CityPageDiv").show(),$("#DistrictPageDiv").hide()},this.BaiDuAddressClick=function(e){var t=this;t.BackProvincePage(e),$("#"+t.AddressDocumentName).html(PositionAddressName).attr("data-Province",PositionProvinceId).attr("data-City",PositionCityId).attr("data-District",PositionDistrictId)},this.AddressDocumentName="",this.ChooseCore=function(e,t,a){var i=this;i.BackProvincePage(e),ChooseDistrictId=t,ChooseDistrictName=a,$("#"+i.AddressDocumentName).html(ChooseProvinceName+" "+ChooseCityName+" "+ChooseDistrictName).attr("data-Province",ChooseProvinceId).attr("data-City",ChooseCityId).attr("data-District",ChooseDistrictId).removeClass("thirdtext")},this.GetPosition=function(e,t){function a(t){o.code=0,o.lat=t.coords.latitude,o.lon=t.coords.longitude,e(o)}function i(e){o.code=1,o.error=e,t(o)}var o={};if(navigator.geolocation){var r={enableHighAccuracy:!0,timeout:6e3,maximumAge:5e3};navigator.geolocation.getCurrentPosition(a,i,r)}else o.code=-1,t(o)},this.CoderChooseInit=function(){var e=this;Global_StorageHelper.GetCoreDataByKey(0,e.ChooseProvinceSucFun)},this.ChooseProvinceSucFun=function(e){if("err"!=e&&""!=e){var t='<li class="ChannelChooseAllCity" data-regionid="0">全国</li>',a=JSON.parse(e),i=0;$.each(a,function(e,a){0==e&&(i=a.RegionId),t+='<li class="ChannelChooseCity" onclick="Global_GeoCoderHelper.ChooseCitySub('+a.RegionId+')" data-regionid="'+a.RegionId+'">'+a.RegionName+"</li>"}),$("#ChooseProvinceUl").html(t)}else Global_PopupHelper.alert({title:"产品分类获取失败"})},this.ChooseCitySub=function(e){ChooseProvinceId=e,Global_StorageHelper.GetCoreDataByKey(e,ChooseCitySucFun)},ChooseCitySucFun=function(e){var t="",a=JSON.parse(e);$.each(a,function(e,a){t+='<li class="ChannelChooseCity" data-regionid="'+a.RegionId+'">'+a.RegionName+"</li>"}),$("#ChooseCityUl").html(t),$("#ChooseProvinceUl [data-regionid="+ChooseProvinceId+"]").addClass("checked").siblings("li").removeClass("checked")}},Global_SwiperHelper=new function(){this.thumb="",this.lightbox="",this.mainpage="",this.mySwiper="",this.myPerView=3;var e=new function(){};this.ShowLightBox=function(){var e=this,t=e.thumb;e.mySwiper=new Swiper("#"+t,{slidesPerView:e.myPerView,preventLinksPropagation:!1,onTap:function(t,a){console.log(t.clickedIndex);for(var i=$("#"+e.lightbox+" img"),o=$(window).height(),r=$(window).width(),n=0;n<i.length;n++){var l=$(i[n]);$(i[n]).attr("src",$(i[n]).attr("src").replace("standard_square_s","standard_src_l")).load(function(){var e=this.height,t=this.width;console.log(t),console.log(r),t<r&&l.css("marginLeft",(r-t)/2+"px"),$(this).css("marginTop",(o-e)/2+"px")})}if(!isNaN(t.clickedIndex)){a.preventDefault(),$("#"+e.mainpage).hide(),$(".swiperlightbox").show();new Swiper("#"+e.lightbox,{initialSlide:t.clickedIndex,observer:!0,observeParents:!0,pagination:".swiper-pagination",paginationType:"fraction"})}}})},this.SwiperLightboxClick=function(t){$(".swiperlightbox").on("click",function(a){a.preventDefault(),$(".swiperlightbox").hide(),e.destroy(),$(".swiperlightbox .swiper-wrapper").css("transform","translate3d(0px, 0px, 0px)"),$("#"+t).show()})},this.DirectShowSwiper=function(t,a,i){$(".swiperlightbox").show(),$("#"+a).hide(),e=new Swiper("#"+i,{initialSlide:t,observer:!0,observeParents:!0,pagination:".swiper-pagination",paginationType:"fraction"});for(var o=$("#"+i+" img"),r=0;r<o.length;r++){$(o[r]);$(o[r]).attr("src",$(o[r]).attr("src").replace("standard_square_s","standard_src_l"))}}},Global_PopupHelper=new function(){this.alert=function(e){function t(){var e='<div class="laibeimask"></div><div class="alertbox"><h1>'+r.title+"</h1><p>"+r.content+'</p><input type="button" value="'+r.btnName+'" /></div>';i=$(e).appendTo($("body"));var t=i.find('input[type="button"]');t.off("click",a).on("click",a)}function a(){i.remove(),r.confirmCallback&&"function"==typeof r.confirmCallback&&r.confirmCallback()}var i,o={content:"",title:"来呗",btnName:"确认",confirmCallback:null},r=$.extend(o,e||{});t()},this.alertImg=function(e){function t(){var e="";""!=r.imgPath&&(e='<div class="dialogpic"><img src="'+r.imgPath+'"></div>');var t='<div class="laibeimask"></div><div class="alertbox">'+e+"<h1>"+r.title+"</h1><p>"+r.content+'</p><input type="button" value="'+r.btnName+'" /></div>';i=$(t).appendTo($("body"));var o=i.find('input[type="button"]');o.off("click",a).on("click",a)}function a(){i.remove(),r.confirmCallback&&"function"==typeof r.confirmCallback&&r.confirmCallback()}var i,o={content:"",title:"来呗",btnName:"确认",imgPath:"",confirmCallback:null},r=$.extend(o,e||{});t()},this.Alert_Tips=function(e){function t(){var e='<div class="laibeimask" id="'+o.Id+'"></div><div class="alertbox" style="width:120px;" ><img style="vertical-align: middle;width: 20px;" src="/Content/Images/sending.gif" ><span>'+o.content+"</span></div>";a=$(e).appendTo($("body"))}var a,i={content:"",Id:""},o=$.extend(i,e||{});t()},this.confirm=function(e){function t(){var e='<div class="laibeimask"></div><div class="alertbox"><h1>'+n.title+'</h1><input type="button" class="confirmbtn" value="'+n.cancelName+'" /><input type="button" class="confirmbtn" value="'+n.confirmName+'" /></div>';o=$(e).appendTo($("body"));var t=o.find('input[type="button"]');t.eq(0).off("click",i).on("click",i),t.eq(1).off("click",a).on("click",a)}function a(){o.remove(),n.confirmCallback&&"function"==typeof n.confirmCallback&&n.confirmCallback()}function i(){o.remove(),n.cancelCallback&&"function"==typeof n.cancelCallback&&n.cancelCallback()}var o,r={title:"",confirmName:"确认",cancelName:"取消",confirmCallback:null,cancelCallback:null},n=$.extend(r,e||{});t()},this.prompt=function(e){function t(){s+="3"==l.type?'<textarea type="text" id="GlobalPromptInput" maxlength="'+l.maxlength+'"  class="prompttextarea" placeholder="'+l.inputPlaceholder+'">'+l.inputValue+"</textarea>":"2"==l.type?'<div class="inputdiv"><span>'+l.inputtitle+'</span><input type="text" id="GlobalPromptInput" maxlength="'+l.maxlength+'" placeholder="'+l.inputPlaceholder+'" value="'+l.inputValue+'"/></div>':'<input type="text" id="GlobalPromptInput" maxlength="'+l.maxlength+'"  class="promptinput" placeholder="'+l.inputPlaceholder+'" value="'+l.inputValue+'"/>',s+='<input type="button" class="confirmbtn" value="取消" /><input type="button" class="confirmbtn" value="确认" /></div>',r=$(s).appendTo($("body"));var e=r.find('input[type="button"]');e.eq(0).off("click",o).on("click",o),e.eq(1).off("click",i).on("click",i);var t=r.find('input[type="text"]');t.eq(0).off("input",a).on("input",a)}function a(){l.inputMethod&&"function"==typeof l.inputMethod&&l.inputMethod()}function i(){l.confirmCallback&&"function"==typeof l.confirmCallback&&l.confirmCallback(),r.remove()}function o(){r.remove(),l.cancelCallback&&"function"==typeof l.cancelCallback&&l.cancelCallback()}var r,n={title:"",inputPlaceholder:"",inputValue:"",maxlength:"",type:"1",inputtitle:"",confirmdisabled:!1,inputMethod:null,confirmCallback:null,cancelCallback:null},l=$.extend(n,e||{}),s='<div class="laibeimask"></div><div class="alertbox"><h1>'+l.title+"</h1>";t()},this.dialogautoclose=function(e){function t(){var e="1"==r.type?'<div class="laibeiwhitemask"><div class="dialogautoclose"><span class="lb-line lb-tip"></span><span class="lb-line lb-long"></span><div class="lb-placeholder"></div><p>'+r.title+"</p></div></div>":'<div class="laibeiwhitemask"><div class="dialogautoclose"><span class="lb-line lb-lline"></span><span class="lb-line lb-rline"></span><div class="lb-placeholder"></div><p>'+r.title+"</p></div></div>";i=$(e).appendTo($("body")),setTimeout(a,r.timer)}function a(){r.confirmCallback&&"function"==typeof r.confirmCallback&&r.confirmCallback(),i.remove()}var i,o={title:"",timer:"2000",type:"1",confirmCallback:null},r=$.extend(o,e||{});t()},this.OperationMethod=function(e){function t(){var e='<div class="laibeiwhitemask"></div>';o=$(e).appendTo($("body")),a()}function a(){n.confirmCallback&&"function"==typeof n.confirmCallback?(n.confirmCallback(),setTimeout(i,50)):i()}function i(){o.remove()}var o,r={confirmCallback:null},n=$.extend(r,e||{});t()}},Global_TagHelper=new function(){this.TagFun=function(e){$("#"+e).on("tap",".tag-btn",function(){var e=$(this);e.hasClass("tagchecked")?e.removeClass("tagchecked"):e.addClass("tagchecked")})},this.SetTagList=function(e,t){var a=null,i=new Global_StorageHelper.GetSessionToStorage("Tag_Type"+e);void 0==i||null==i.StorageData?$.ajax({url:Global_ServiceUrlHelper.Common_GetTagList,type:"POST",data:{reqJson:'{"tagType":"'+e+'"}'},dataType:"json",async:!1,success:function(t){void 0!=t&&t.Content.length>0&&(a=t.Content,Global_StorageHelper.SetSessionToStorage("Tag_Type"+e,JSON.stringify(a)))},beforeSend:function(e,t){},complete:function(e,t){}}):a=JSON.parse(i.StorageData);var o="";$.each(a,function(e,t){o+='<li class="tag-btn" data-id="'+t.TagBaseId+'">'+t.name+"</li>"}),$("#"+t).append(o)}},Global_CategoryHelper=new function(){CurrentMainPage="",CurrentTopId=0,this.GetCategoryStorage=function(e){0==e?Global_StorageHelper.GetTopCategoryDataByKey(e,CategoryStorageSucFun):Global_StorageHelper.GetSubCategoryDataByKey(e,CategoryStorageSucFun)},CategoryStorageSucFun=function(e){"err"!=e&&""!=e?0==CurrentTopId?ShowTopPage(e):ShowSubPage(e):Global_PopupHelper.alert({title:"产品分类获取失败"})},ShowTopPage=function(e){var t="",a=JSON.parse(e);$.each(a,function(e,a){t+='<li class="borderbottom"><div class="localname" onclick="Global_CategoryHelper.ShowCategoryPage('+a.CategoryTopId+",'"+CurrentMainPage+'\')" data-CategoryTopId="'+a.CategoryTopId+'"><h1>'+a.Name+'</h1></div><div class="iconfont arrow" >&#xe61e;</div></li>'}),$("#CategoryTopSelectUl").html(t),$("#"+CurrentMainPage).hide(),$("#CategoryTopPageDiv").show(),$("#CategorySubPageDiv").hide()},ShowSubPage=function(e){var t="",a=JSON.parse(e);$.each(a,function(e,a){t+='<li class="borderbottom"><div class="localname" onclick="Global_CategoryHelper.ChooseCategory('+a.CategoryTopId+","+a.CategorySubId+",'"+a.Name+"')\" ><h1>"+a.Name+"</h1></div></li>"}),$("#CategorySubSelectUl").html(t),$("#"+CurrentMainPage).hide(),$("#CategoryTopPageDiv").hide(),$("#CategorySubPageDiv").show()},this.CategoryDocumentName="",this.ChooseCategory=function(e,t,a){var i=this;$("#"+i.CategoryDocumentName).html(a).attr("data-TopId",e).attr("data-subid",t).removeClass("fourthtext").addClass("firsttext"),i.BackCategoryTopPage()},this.ShowCategoryPage=function(e,t){var a=this;CurrentTopId=e,CurrentMainPage=t,a.GetCategoryStorage(e)},this.BackCategoryTopPage=function(){$("#"+CurrentMainPage).show(),$("#CategoryTopPageDiv").hide(),$("#CategorySubPageDiv").hide()},this.BackCategorySubPage=function(){$("#"+CurrentMainPage).hide(),$("#CategoryTopPageDiv").show(),$("#CategorySubPageDiv").hide()},this.SearchCategoryInit=function(){Global_StorageHelper.GetTopCategoryDataByKey(0,SearchCategoryInitSucFun)},SearchCategoryInitSucFun=function(e){if("err"!=e&&""!=e){var t="",a=JSON.parse(e),i=0;$.each(a,function(e,a){1029!=a.CategoryTopId&&(0==i?(i=a.CategoryTopId,t+='<li data-index="'+a.CategoryTopId+'" class="active" onclick="Global_CategoryHelper.SearchCategorySub('+a.CategoryTopId+')">'+a.Name+"</li>"):t+='<li data-index="'+a.CategoryTopId+'" onclick="Global_CategoryHelper.SearchCategorySub('+a.CategoryTopId+')">'+a.Name+"</li>")}),$("#seachClassifyTopList").html(t),Global_CategoryHelper.SearchCategorySub(i)}else Global_PopupHelper.alert({title:"产品分类获取失败"})},this.SearchCategorySub=function(e){CurrentTopId=e,Global_StorageHelper.GetSubCategoryDataByKey(e,SearchCategorySubSucFun)},SearchCategorySubSucFun=function(e){if("err"!=e&&""!=e){var t="",a=JSON.parse(e),i="";$.each(a,function(e,a){i=Global_ServiceUrlHelper.CurrentDomain+"/Search/Product?CategorySubId="+a.CategorySubId+"&searchWord="+a.Name,t+='<li><a href="'+i+'"><img src="'+a.Path+'" /><p>'+a.Name+"</p></a></li>"}),$("#seachClassifySubListByTopId").html(t),$("#seachClassifyTopList>li").removeClass("active"),$("#seachClassifyTopList li[data-index='"+CurrentTopId+"']").addClass("active")}else Global_PopupHelper.alert({title:"产品分类获取失败"})},this.ChanelCategoryInit=function(){Global_StorageHelper.GetTopCategoryDataByKey(0,ChanelCategoryInitSucFun)},ChanelCategoryInitSucFun=function(e){if("err"!=e&&""!=e){var t="",a=JSON.parse(e),i=0;$.each(a,function(e,a){0==e&&(i=a.CategoryTopId),t+='<li data-index="'+a.CategoryTopId+'" onclick="Global_CategoryHelper.ChanelCategorySub('+a.CategoryTopId+')">'+a.Name+"</li>"}),$("#ChanelClassifyTopList").html(t),Global_CategoryHelper.ChanelCategorySub(i)}else Global_PopupHelper.alert({title:"产品分类获取失败"})},this.ChanelCategorySub=function(e){CurrentTopId=e,Global_StorageHelper.GetSubCategoryDataByKey(e,ChanelCategorySubSucFun)},ChanelCategorySubSucFun=function(e){var t="";if("err"!=e&&""!=e){var a=JSON.parse(e);$.each(a,function(e,a){t+='<li data-id="'+a.CategorySubId+'" data-topid="'+CurrentTopId+'" class="ChannelChooseCategorySub" >'+a.Name+"</li>"})}$("#ChanelClassifySubListByTopId").html(t),$("#ChanelClassifyTopList li[data-index='"+CurrentTopId+"']").addClass("active").siblings("li").removeClass("checked")}},Global_CharityHelper=new function(){this.CharityFun=function(e){$("#"+e).on("tap",".tag-btn",function(){var e=$(this);e.addClass("tagchecked").siblings("li").removeClass("tagchecked")})},this.SetCurrentCharity=function(e,t){$("#ul_Charity [data-id="+t+"]").addClass("tagchecked").siblings("li").removeClass("tagchecked")}},Global_ValidCodeHelper=new function(){function e(t){if(0==a)t.removeAttr("disabled"),t.removeClass("regetvalidcodebtn"),t.html("获取验证码"),validCode="",a=60;else{t.attr("disabled",!0),t.addClass("regetvalidcodebtn"),t.html("重新获取("+a+")"),a--;setTimeout(function(){e(t)},1e3)}}var t=Global_ServiceUrlHelper.MobileCheckStr,a=60;this.GetValidCode=function(i,o,r){$("#"+r).attr("disabled",!0);var n=$("#"+o).val();if(""==n)return Global_PopupHelper.alert({title:"手机号码不能为空"}),void $("#"+r).removeAttr("disabled");if(!t.test(n))return Global_PopupHelper.alert({title:"您填写的手机号格式有误，请输入11位大陆手机号码"}),void $("#"+r).removeAttr("disabled");var l=new GetValidCodeTime(n);if(l.StartTime<=60&&l.StartTime>0)return Global_PopupHelper.alert({title:"获取验证码过于频繁，请稍后再试"}),void $("#"+r).removeAttr("disabled");a=60;var s=new AddValidCode(i,n);$.ajax({url:Global_ServiceUrlHelper.Account_AddValidCode,type:"POST",data:{reqJson:JSON.stringify(s)},dataType:"json",async:!1,success:function(t){if("00000000"==t.ResultNo){var a=new Date,o={mobile:n,time:a};Global_StorageHelper.SetSessionToStorage("validCodeCache"+i,JSON.stringify(o)),Global_StorageHelper.SetSessionToStorage("validCodeTime"+n,JSON.stringify(a)),e($("#"+r))}else $("#"+r).removeAttr("disabled"),Global_PopupHelper.alert({title:"信息发送失败，请重试"})}})},this.GetCodeCache=function(t,i,o){var r=new Global_StorageHelper.GetSessionToStorage("validCodeCache"+o);if(null!=r.StorageData){r=JSON.parse(r.StorageData);var n=new Date(r.time),l=new Date,s=(l.getTime()-n.getTime())/1e3;60-parseInt(s)>0&&(a=60-parseInt(s),$("#"+t).val(r.mobile),e($("#"+i)))}},this.GetCodeCacheTime=function(e){this.StartTime=-1;var t=new Global_StorageHelper.GetSessionToStorage("validCodeCache"+e);if(null!=t.StorageData){t=JSON.parse(t.StorageData);var a=new Date(t.time),i=new Date,o=(i.getTime()-a.getTime())/1e3;this.StartTime=o}},GetValidCodeTime=function(e){this.StartTime=-1;var t=new Global_StorageHelper.GetSessionToStorage("validCodeTime"+e);if(null!=t.StorageData){t=JSON.parse(t.StorageData);var a=new Date(t),i=new Date,o=(i.getTime()-a.getTime())/1e3;this.StartTime=o}},AddValidCode=function(e,t){this.BizType=e,this.Mobile=t}},Global_BaseInfoHelper={GetLoginInfo:function(e){var t=null,a=new Global_StorageHelper.GetStorageDataByKey("UserToken");if(null!=a.StorageData){var i=JSON.parse(a.StorageData),o=i.Token;$.ajax({url:Global_ServiceUrlHelper.Account_GetBaseByToken,type:"POST",data:{reqJson:'{"Token":"'+o+'"}'},dataType:"json",async:!1}).done(function(a){if("00000000"==a.ResultNo)Global_StorageHelper.SetSessionToStorage("BaseInfo",JSON.stringify(a)),t=a;else if(e)throw new Error(JSON.stringify(a))}).fail(function(){console.log("请求发生异常")})}return t},GetToken:function(){var e=null,t=new Global_StorageHelper.GetStorageDataByKey("UserToken");if(null!=t.StorageData){var a=JSON.parse(t.StorageData);e=a.Token}return{Token:e}},CheckLogin:function(){var e=!1,t=new Global_StorageHelper.GetStorageDataByKey("UserToken");if(null!=t.StorageData){var a=JSON.parse(t.StorageData),i=a.Token;$.ajax({url:Global_ServiceUrlHelper.Account_CheckBaseByToken,type:"POST",data:{reqJson:'{"Token":"'+i+'"}'},dataType:"json",async:!1}).done(function(t){"00000000"==t.ResultNo&&(e=!0)}).fail(function(){console.log("请求发生异常")})}return e}},Global_MessageHelper=new function(){var e=Global_BaseInfoHelper.GetLoginInfo(),t="麻麻",a="哎呦，";null!=e&&1==e.Sex&&(t="粑粑"),this.SetName=function(e){t="麻麻",1==e&&(t="粑粑")},this.ContentEmpty=a+t+"，忘记写内容啦",this.ContentNotEnough=t+"，就不能凑够10个字吗",this.TitleEmpty=a+t+"，忘记写标题啦",this.TitleNotEnough=t+"，就不能凑够2个字吗",this.PicEmpty=t+"，发一张漂漂照吧",this.PriceEmpty=a+t+"，忘记写价格啦",this.CategoryEmpty=a+t+"，忘记选分类啦",this.EditPageReturn=t+"，事情还没做完呢！",this.PositionEmpty=t+",忘记定位了！",this.TagEmpty=a+t+"，忘记选标签啦",this.PageEmpty="它已经被"+t+"丢到垃圾桶去了",this.FowardPlaceholder=t+"，留个转发脚印呗",this.PageDrodloadNoData=t+"，已经到底啦",this.PriceErr="价格为1~999999",this.RechargeErr="充值贝壳金额为1~999999",this.PayPageReturn="真的不带宝宝回家吗",this.PositionError="定位失败，请选择",this.BtnTextEmpty="知道啦",this.BtnTextNotEnough="去凑够",this.BtnTextPicEmpty="发靓照",this.BtnTextNotCheck="去选取",this.BtnTextConfirm="继续做！",this.BtnTextCancel="不做完",this.BtnTextPayConfirm="带带带",this.BtnTextPayCancel="坚决不带"},Global_ReturnHelper=new function(){this.IsDisabled=!1;var e=null;this.EditPageReturn=function(){var e=this;Global_PopupHelper.confirm({title:Global_MessageHelper.EditPageReturn,confirmName:Global_MessageHelper.BtnTextConfirm,cancelName:Global_MessageHelper.BtnTextCancel,cancelCallback:function(){e.AllowPageReturnHistory()}})},this.PayPageReturn=function(){var e=this;Global_PopupHelper.confirm({title:Global_MessageHelper.PayPageReturn,confirmName:Global_MessageHelper.BtnTextPayConfirm,cancelName:Global_MessageHelper.BtnTextPayCancel,cancelCallback:function(){e.AllowPageReturnHistory()}})},this.SetReturnUrl=function(){var e=["/release","/change/","/account","/order/paysucess/","/pay/goodspay","/pay/recharge","/pay/withdrawdetail","/article/forward/"],a=window.location.pathname.toLowerCase(),i=!1;if($(e).each(function(e,t){if(a.indexOf(t)>=0)return i=!0,!1}),!i){var o="[]",r=window.location.href,n=r;"/"==window.location.pathname&&(n=window.location.origin),o=JSON.parse(o.replace(/&quot;/gm,'"'));var l={Url:r},s=new Global_StorageHelper.GetSessionToStorage("PageUrl");if(null!=s&&null!=s.StorageData)o=JSON.parse(s.StorageData.replace(/&quot;/gm,'"')),n.toLocaleLowerCase()==t.GetListPageUrl(n)&&Global_StorageHelper.DelSessionByKey("ListPageDate"),o.length>0&&r==o[0].Url&&Global_CommonHelper.ArrayDel(0,o),o.length>=20&&Global_CommonHelper.ArrayDel(19,o);else{var d=t.GetRetuenUrl(r);Global_StorageHelper.SetSessionToStorage("landUrl",d)}o.unshift(l),Global_StorageHelper.SetSessionToStorage("PageUrl",JSON.stringify(o))}},this.ReturnUrlSave=function(e){var a="[]";a=JSON.parse(a.replace(/&quot;/gm,'"'));var i={Url:e},o=new Global_StorageHelper.GetSessionToStorage("PageUrl");if(null!=o&&null!=o.StorageData){if(a=JSON.parse(o.StorageData.replace(/&quot;/gm,'"')),a.length>0&&e==a[0].Url)return!1;a.length>=20&&Global_CommonHelper.ArrayDel(19,a)}else{var r=t.GetRetuenUrl(e);Global_StorageHelper.SetSessionToStorage("landUrl",r)}a.unshift(i),Global_StorageHelper.SetSessionToStorage("PageUrl",JSON.stringify(a))},this.ReturnHistoryPage=function(){if(!this.IsDisabled){this.IsDisabled=!0;var e=imPublic.pageSwitch.getTraceStack();if(e)imPublic.pageSwitch.restorePage(e),imPublic.pageSwitch.clearTraceStack(),this.IsDisabled=!1;else{var a=t.GetPageReturnUrl(1);a==Global_ServiceUrlHelper.CurrentDomain&&(a="/");var i=window.location.href;"/"==window.location.pathname&&(i=window.location.origin),i.toLocaleLowerCase()==t.GetListPageUrl(i)&&Global_StorageHelper.DelSessionByKey("ListPageDate"),TemplateHelper.changePage(a)}}},this.AllowPageReturnHistory=function(){if(!this.IsDisabled){this.IsDisabled=!0;var e=t.GetPageReturnUrl(0),a=this;a.GetJumpPageWay(e)}},this.SetListDateToStorage=function(e,t,a,i,o){var r=$(document).scrollTop(),n={Url:e,ListDate:$("#"+t).html(),pageIndex:a,Total:i,other:o,silentScroll:r};Global_StorageHelper.SetSessionToStorage("ListPageDate",JSON.stringify(n))},this.GetListDateToStorage=function(e){this.StorageData=null;var t=new Global_StorageHelper.GetSessionToStorage("ListPageDate");if(null!=t&&null!=t.StorageData){var a=JSON.parse(t.StorageData.replace(/&quot;/gm,'"'));a.Url.toLowerCase()==e.toLowerCase()&&(this.StorageData=a)}},this.GetBlankPageHtml=function(e){this.Html='<div class="listload"><img src="/Content/Images/listloading.png"></div>'},this.SetArticleChannelToStorage=function(e){Global_StorageHelper.SetDataToStorageWithExpTimeSeconds("ArticleChannels",e,600)},this.GetArticleChannelFromStorage=function(){var e=new Global_StorageHelper.GetStorageDataByKeyWithExpTimeSeconds("ArticleChannels");return e},this.SetSelectArticleChannelToStorage=function(e){Global_StorageHelper.SetDataToStorageWithExpTimeSeconds("CurrentChannel",e,30)},this.GetSelectArticleChannelFromStorage=function(){var e=new Global_StorageHelper.GetStorageDataByKeyWithExpTimeSeconds("CurrentChannel");return e};var t={GetRetuenUrl:function(e){var t=!1,a=[/.95laibei.com\/$/];return $(a).each(function(a,i){if(i.test(e))return t=!0,!1}),t||(e=Global_ServiceUrlHelper.CurrentDomain),e},GetLandUrl:function(){var e=Global_ServiceUrlHelper.CurrentDomain,t=new Global_StorageHelper.GetSessionToStorage("landUrl");return void 0!=t&&null!=t.StorageData&&(e=t.StorageData),e},GetPageReturnUrl:function(a){var i=new Global_StorageHelper.GetSessionToStorage("PageUrl");if(null!=i&&null!=i.StorageData){var o="[]";if(o=JSON.parse(i.StorageData.replace(/&quot;/gm,'"')),1==a&&Global_CommonHelper.ArrayDel(0,o),Global_StorageHelper.SetSessionToStorage("PageUrl",JSON.stringify(o)),o.length>0)return e=o[0].PageStack,o[0].Url;Global_StorageHelper.DelStorageByKey("PageUrl")}return t.GetLandUrl()},GetListPageUrl:function(e){var t="",a=new Global_ReturnHelper.GetListDateToStorage(e);return null!=a.StorageData&&(t=a.StorageData.Url.toLocaleLowerCase()),t}};this.GetJumpPageWay=function(e){try{var t=0,a=document.domain,i=e.split("//")[1];i&&0!=i.indexOf(a)&&(t=1),1==t?location.href=e:$.mobile.changePage(e)}catch(t){$.mobile.changePage(e)}},window.Global_Data||(window.Global_Data={});var a=window.Global_Data;this.setChangePageCallback=function(e){"function"===$.type(e)&&(a.ChangePageCallback||(a.ChangePageCallback=[]),a.ChangePageCallback.push(e))},this.fetchChangePageCallback=function(){var e=a.ChangePageCallback;if(e){for(var t=0;t<e.length;t++){var i=e[t];i()}a.ChangePageCallback=[]}}},Global_SearchKeyHelper=new function(){this.GetSearchKey={GetHotDateList:function(e){var t=null,a=new Global_StorageHelper.GetSessionToStorage("HotSearchKey"+e);return void 0==a||null==a.StorageData?$.ajax({url:Global_ServiceUrlHelper.Search_GetHotSearch,type:"POST",data:{reqJson:'{"searchType":'+e+',"pageIndex":1,"pageSize":20}'},dataType:"json",async:!1}).done(function(a){t=a.Data,void 0!=t&&t.length>0&&Global_StorageHelper.SetSessionToStorage("HotSearchKey"+e,JSON.stringify(t))}).fail(function(){console.log("请求发生异常")}):t=JSON.parse(a.StorageData),t},GetUserDateList:function(e){var t=null,a=new Global_StorageHelper.GetStorageDataByKey("UserSearchKey"+e);return void 0!=a&&null!=a.StorageData&&(t=JSON.parse(a.StorageData.replace(/&quot;/gm,'"'))),t}},this.SetUserSearch=function(e,t){var a="[]";a=JSON.parse(a.replace(/&quot;/gm,'"'));var i={SearchKey:e},o=new Global_StorageHelper.GetStorageDataByKey("UserSearchKey"+t);null!=o&&null!=o.StorageData&&(a=JSON.parse(o.StorageData.replace(/&quot;/gm,'"')),$.each(a,function(t,i){if(e==i.SearchKey)return Global_CommonHelper.ArrayDel(t,a),!1}),a.length>20&&Global_CommonHelper.ArrayDel(0,a)),a.unshift(i),Global_StorageHelper.SetDataToStorage("UserSearchKey"+t,a,Global_ServiceUrlHelper.UserSearchExpTime)},this.ClearUserSearchkey=function(e){Global_StorageHelper.DelStorageByKey("UserSearchKey"+e)}},Global_GenderHelper=new function(){this.SetBaseGender=function(){$(".female,.male").on("tap",function(e){e.preventDefault();var t=$(this),a=t.find(".selectgenderspan").attr("data-sex"),i=new Global_BaseInfoHelper.GetToken;$.ajax({url:Global_ServiceUrlHelper.Account_ChangeBaseSex,type:"POST",data:{reqJson:'{"Sex":"'+a+'","Token":"'+i.Token+'"}'},dataType:"json",success:function(e){"undefined"==typeof e.ResultNo||"00000000"!=e.ResultNo?Global_PopupHelper.alert({title:"性别设置失败，请到个人中心设置"}):Global_MessageHelper.SetName(a),$("#sharedselectgender").hide(),$(".selectgender").hide()}})}),$("#sharedselectgender").on("tap",function(e){e.preventDefault(),$("#sharedselectgender").hide(),$(".selectgender").hide()})}},Global_WeiXinHelper=new function(){this.Pay=function(e,t,a,i,o,r){var n=new Global_BaseInfoHelper.GetToken;if(Global_ApicloudHelper.IsApp()){var l={Amount:e,PaymentMethod:4,Remark:t,type:a,relationId:i,Token:n.Token};$.ajax({url:Global_ServiceUrlHelper.WeiXin_GetOrderId,type:"POST",data:{reqJson:JSON.stringify(l)},dataType:"json",async:!1,success:function(e){"00000000"==e.ResultNo?Global_ApicloudHelper.wxPay(e.mchId,e.nonceStr,e.orderId,e.payDetailId,e.timeStamp,e.sign,o,r):r()},error:function(){r()}})}else{var s=Global_WeiXinHelper.GetOpenId(),l={Amount:e,PaymentMethod:2,Remark:t,Token:n.Token,type:a,relationId:i,openId:s};$.ajax({url:Global_ServiceUrlHelper.WeiXin_GetJsApiParam,type:"POST",data:{reqJson:JSON.stringify(l)},dataType:"json",async:!1,success:function(e){"00000000"==e.ResultNo?Global_WeiXinHelper.callpay(JSON.parse(e.jsApiParamJson),e.payDetailId,o,r):r()},error:function(){r()}})}},this.callpay=function(e,t,a,i){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",Global_WeiXinHelper.jsApiCall,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",Global_WeiXinHelper.jsApiCall),document.attachEvent("onWeixinJSBridgeReady",Global_WeiXinHelper.jsApiCall)):Global_WeiXinHelper.jsApiCall(e,t,a,i)},this.jsApiCall=function(e,t,a,i){WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(e){"get_brand_wcpay_request:ok"==e.err_msg?a(t):i()})},this.IsWXBrowser=function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)},this.GetOpenId=function(){var e=null,t=new Global_StorageHelper.GetSessionToStorage("MainOpenId");return null!=t.StorageData&&(e=JSON.parse(t.StorageData)),e},this.SetOpenId=function(e){""!=e&&Global_StorageHelper.SetSessionToStorage("MainOpenId",JSON.stringify(e))},this.GetOauthUrl=function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.WeiXin_GetOauthUrl,type:"POST",data:{reqJson:'{"state":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){"00000000"==e.ResultNo&&(t=e.OauthUrl)}).fail(function(){console.log("请求发生异常")}),t},this.weixinjsApi=function(e,t,a,i,o,r,n){var l=this;$.ajax({url:Global_ServiceUrlHelper.WeiXin_GetJsApiConfig,type:"POST",data:{reqJson:'{"url":"'+e+'"}'},dataType:"json",async:!1,success:function(e){"00000000"==e.ResultNo&&wx.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]})}}),wx.ready(function(){wx.checkJsApi({jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"],success:function(e){l.sharefriend(t,a,i,o,r,n),l.shareqq(t,a,i,o,r,n),l.shareqqweibo(t,a,i,o,r,n),l.shareqzone(t,a,i,o,r,n),l.sharefrcircle(t,i,o,r,n)}})})},this.sharefriend=function(e,t,a,i,o,r){wx.onMenuShareAppMessage({title:e,desc:t,link:a,imgUrl:i,trigger:function(e){},success:function(e){"function"==typeof o&&o()},cancel:function(e){"function"==typeof r&&r()},fail:function(e){alert(JSON.stringify(e))}})},this.sharefrcircle=function(e,t,a,i,o){wx.onMenuShareTimeline({title:e,link:t,imgUrl:a,trigger:function(e){},success:function(e){"function"==typeof i&&i()},cancel:function(e){"function"==typeof o&&o()},fail:function(e){alert(JSON.stringify(e))}})},this.shareqq=function(e,t,a,i,o,r){wx.onMenuShareQQ({title:e,desc:t,link:a,imgUrl:i,trigger:function(e){},success:function(e){"function"==typeof o&&o()},cancel:function(e){"function"==typeof r&&r()},fail:function(e){alert(JSON.stringify(e))}})},this.shareqqweibo=function(e,t,a,i,o,r){wx.onMenuShareWeibo({
title:e,desc:t,link:a,imgUrl:i,trigger:function(e){},success:function(e){"function"==typeof o&&o()},cancel:function(e){"function"==typeof r&&r()},fail:function(e){alert(JSON.stringify(e))}})},this.shareqzone=function(e,t,a,i,o,r){wx.onMenuShareQZone({title:e,desc:t,link:a,imgUrl:i,trigger:function(e){},success:function(e){"function"==typeof o&&o()},cancel:function(e){"function"==typeof r&&r()},fail:function(e){alert(JSON.stringify(e))}})}},Global_CommonHelper={Format:function(e,t){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in a)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return t},ArrayDel:function(e,t){for(var a=t.length,i=0;i<a;i+=1)if(i==e){for(var o=i+1;o<a;o+=1)t[o-1]=t[o];t.length--}},SetErrLog:function(e,t,a){$.ajax({url:Global_ServiceUrlHelper.Common_SetErrLog,type:"POST",data:{reqJson:'{"Msg":"'+e+'","Url":"'+t+'","Line":"'+a+'"}'},dataType:"json",async:!1,success:function(e){}})},SetServerLog:function(e){try{$.ajax({url:Global_ServiceUrlHelper.Common_SetServerLog,type:"POST",data:{reqJson:'{"Msg":"'+e+'"}'},dataType:"json",async:!0,success:function(e){}})}catch(e){}},SetMonitorHijackingLog:function(){var e=setTimeout(function(){try{var t=$("script[src!='http']:not([src*='95laibei.com'])");if(t){var a="【{src}】",i="",o="JsMonitorHijacking";if(t.each(function(e,t){i+=a.replace("{src}",$(t).attr("src"))}),i){var r=new Global_StorageHelper.GetSessionToStorage(o);if(r&&r.StorageData){var n=JSON.parse(r.StorageData);if(i==n.data)return}var l=encodeURIComponent(document.documentElement.outerHTML);$.ajax({url:Global_ServiceUrlHelper.Common_SetMonitorHijackingLog,type:"POST",data:{reqJson:'{"Msg":"'+l+'"}'},dataType:"json",async:!0,success:function(e){Global_StorageHelper.SetSessionToStorage(o,JSON.stringify({data:i}))}})}}}catch(e){}finally{clearTimeout(e)}},3e3)},ArticlePraise:function(e){var t=null,a=$(e).attr("data-id"),i=$(e).attr("data-isarticle"),o=new Global_BaseInfoHelper.GetToken;if(null==o.Token){var r=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(r)}else $.ajax({url:Global_ServiceUrlHelper.Article_BasePraise,type:"POST",data:{reqJson:'{"ArticleBaseId":'+a+',"IsArticle":'+i+',"Token":"'+o.Token+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){});return t},ListPagePraise:function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=Global_CommonHelper.ArticlePraise(e);if(null!=t)if("undefined"!=typeof t&&"00000000"==t.ResultNo)t.IsAdd?$(e).html('<i class="likeicon"></i>'+Global_CommonHelper.GetShowCount(t.PraiseCount)):0==t.PraiseCount?$(e).html('<i class="unlikeicon"></i>赞'):$(e).html('<i class="unlikeicon"></i>'+Global_CommonHelper.GetShowCount(t.PraiseCount));else{var a="操作失败";"undefined"!=typeof t.ResultRemark&&(a=t.ResultRemark),Global_PopupHelper.alert({title:a})}}})},BaseAttention:function(e){var t=null,a=new Global_BaseInfoHelper.GetToken;if(null==a.Token){var i=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(i)}else $.ajax({url:Global_ServiceUrlHelper.Account_BaseAttention,type:"POST",data:{reqJson:'{"UserId":'+e+',"Token":"'+a.Token+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){});return t},CheckOnlyNumber:function(e,t){e.value=e.value.replace(/\D/g,""),e.value.length>t&&(e.value=e.value.substring(0,t))},ChechNumberOneDecimal:function(e,t){var a=/^\d{0,5}(\.\d{0,1})?$/g,i=/^\d{0,5}(\.\d{0,1}[0])?$/g;if(!a.test(e.value)&&!i.test(e.value)){var o=e.value.length-1;e.value=e.value.substring(0,o)}},CheckNumberLetter:function(e,t){e.value=e.value.replace(/[\W]/g,""),e.value.length>t&&(e.value=e.value.substring(0,t))},GoTop:function(){return $("html,body").animate({scrollTop:"0px"},800),!1},GetShowCount:function(e){return e<1e4?e:parseInt(e/1e4)+"万"},GetCategoryClass:function(e){return 1==e?"seatlog":2==e?"expertlog":3==e?"businesslog":""},GetCategoryName:function(e){return 1==e?"安全座椅用户":2==e?"达人专家":3==e?"来呗官方账号及商家":""},GetPriceHtml:function(e){return"&yen; "+e/10},BindChatEvent:function(e,t,a){window.imChatDialog.chatWith({ClientID:e,Nickname:t,LinkType:a})},MoveFixedSever:function(){var e,t,a,i,o,r,n=$("#sever"),l=$("#sever").width(),s=$("#sever").height(),d=$(window).width(),c=$(window).height();$("body");n.on({touchstart:function(o){e=o.originalEvent.targetTouches[0].pageX,t=o.originalEvent.targetTouches[0].pageY-$(window).scrollTop(),a=$(this).offset().left,i=$(this).offset().top-$(window).scrollTop(),leftX=e-a,rightX=d-l+leftX,topY=t-i,bottomY=c-s+topY},touchmove:function(n){n.preventDefault(),o=n.originalEvent.targetTouches[0].pageX,r=n.originalEvent.targetTouches[0].pageY-$(window).scrollTop(),o<leftX&&(o=leftX),o>rightX&&(o=rightX),r<topY&&(r=topY),r>bottomY&&(r=bottomY),$(this).css({right:d-(o+a-e+l),bottom:c-(r+i-t+s)})}})},GetQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=null;if(window.location.search&&(a=window.location.search.substr(1).match(t)),null==a){t=/(?:(\/{1}))(\d+)(?:[?&]?)/gi;var i=window.location.href.match(t),o="";return null!=i&&i.length>0&&(o=i[i.length-1]),o&&null!=o.match(/\d+/)?o.match(/\d+/)[0]:""}return null!=a?unescape(a[2]):null},SetUrlFormat:function(e){var t=/\[URL\]([\s\S]*?)(?:\[\/URL\]){1}/gi;return e=e.replace(t,function(e){return 0==e.toLocaleLowerCase().replace("[url]","").indexOf("/")?"http://"+window.location.host+e.toLocaleLowerCase().replace("[url]","").replace("[/url]","").replace(/\s/g,""):e})},SetUrlFormatA:function(e){var t=/\[URL\]([\s\S]*?)(?:\[\/URL\]){1}/gi;return e=e.replace(t,function(e){return 0==e.toLocaleLowerCase().replace("[url]","").indexOf("/")?"<a style='color:#376fb3' href='http://"+window.location.host+e.toLocaleLowerCase().replace("[url]","").replace("[/url]","").replace(/\s/g,"")+"'>点击阅读</a>":e})}};window.Global_LoadMask={show:function(){$(".ui-loader").show()},hide:function(){$(".ui-loader").hide()}};var Global_OrderHelper=new function(){this.PageToGoodsPay=function(e){var t=Global_ServiceUrlHelper.CurrentDomain+"/Pay/GoodsPay?id="+e;Global_WeiXinHelper.IsWXBrowser()?window.location.href=t:$.mobile.changePage(t)},this.ReminderDelivery=function(e){var t=new Global_BaseInfoHelper.GetToken;if(null==t.Token){var a=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(a)}else $.ajax({url:Global_ServiceUrlHelper.Order_ReminderDelivery,type:"POST",data:{reqJson:'{"OrderBaseId":'+e+',"Token":"'+t.Token+'"}'},async:!1,dataType:"json",success:function(e){if("undefined"!=typeof e&&"00000000"==e.ResultNo)Global_PopupHelper.alert({title:"提醒发货成功"});else if("undefined"!=typeof e&&null!=e.ResultRemark)Global_PopupHelper.alert({title:e.ResultRemark});else{var t="操作失败";"undefined"!=typeof e&&null!=e.ResultRemark&&(t=e.ResultRemark),Global_PopupHelper.alert({title:t})}}})}},Global_ReleaseHelper=new function(){var e;this.Release=function(){function t(e){e.preventDefault()}e=Global_BaseInfoHelper.CheckLogin(),e?($("#fabu").on("tap",function(e){var a=document.body.scrollTop;a<5&&$("body").scrollTop(5),$("#fabupage").show(),$(".fabu_share,.fabu_free").animate({},1e3).addClass("active"),e.preventDefault(),document.body.style.overflow="hidden",document.addEventListener("touchmove",t,!1)}),$(".fabu_back").on("tap",function(e){e.preventDefault(),$(".fabu_share,.fabu_free").removeClass("active"),setTimeout(function(){$("#fabupage").hide()},1e3),document.body.style.overflow="auto",document.removeEventListener("touchmove",t,!1)}),$(".show-page-loading-msg").on("tap",function(){document.body.style.overflow="auto",document.removeEventListener("touchmove",t,!1)}),$("#fabupage").click(function(e){e.stopPropagation(),$(".fabu_share,.fabu_free").removeClass("active"),setTimeout(function(){$("#fabupage").hide()},1e3),document.body.style.overflow="auto",document.removeEventListener("touchmove",t,!1)})):$("#fabu").on("tap",function(){var e=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(e)})}},Global_ForwardHelper={GetForwardHtml:function(e){var t="";if(null!=e){var a="",i="oneimg",o=Global_ServiceUrlHelper.CurrentDomain+"/Article/Detail/"+e.ArticleBaseId;if(null!=e.ImgList)if(e.ImgList.length>1){i="moreimg thumb";for(var r=0;r<e.ImgList.length;r++)a+='<img src="'+e.ImgList[r].Path+'@!standard_square_m" alt="" />'}else for(var r=0;r<e.ImgList.length;r++)a+='<img src="'+e.ImgList[r].Path+'@!standard_rectangle_m" alt="" />';e.IsArticle||(o=Global_ServiceUrlHelper.CurrentDomain+"/Optimization/Detail/"+e.ArticleBaseId);var n=Global_CommonHelper.SetUrlFormat(e.Content);t='<div class="productitem bgef"><a href="'+o+'"><div class="productimg '+i+'">'+a+'</div><div class="detail"><p class="ellipsis"><span class="at">@'+e.CreateUserName+"</span>"+n+"</p></div></a></div>"}return t},GetForwardUrl:function(e,t,a){var i="",o=0;return null!=a?(a.IsArticle||(o=1),i=Global_ServiceUrlHelper.CurrentDomain+"/Article/Forward/"+a.ArticleBaseId+"?ForwardId="+e+"&Type="+o):(t||(o=1),i=Global_ServiceUrlHelper.CurrentDomain+"/Article/Forward/"+e+"?ForwardId="+e+"&Type="+o),i},ForwardMethod:function(e){var t=$(e).attr("data-href"),a=$(e).attr("data-islogin");if("false"==a.toLowerCase()){var i=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(i)}else $.mobile.changePage(t)}},Global_ExpressHelper={GetExpressDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Common_GetExpressByOrderId,type:"POST",data:{reqJson:'{"OrderBaseId":'+e+',"Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){"00000000"==e.ResultNo&&(a=e)}).fail(function(){console.log("请求发生异常")}),a}},Global_AlipayHelper=new function(){var e={GetApiData:function(e,t,a,i,o,r){var n=null,l=new Global_BaseInfoHelper.GetToken,s={Amount:e,PaymentMethod:1,Remark:t,Token:l.Token,showUrl:a,body:i,type:o,relationId:r};return $.ajax({url:Global_ServiceUrlHelper.Alipay_Pay,type:"POST",data:{reqJson:JSON.stringify(s)},dataType:"json",async:!1}).done(function(e){n=e}).fail(function(){console.log("请求发生异常")}),n},GetAppPayData:function(e,t,a,i,o,r,n,l){var s=null,d=new Global_BaseInfoHelper.GetToken,c={Amount:e,PaymentMethod:1,Remark:t,Token:d.Token,showUrl:a,body:i,type:o,relationId:r};return $.ajax({url:Global_ServiceUrlHelper.Alipay_AppPay,type:"POST",data:{reqJson:JSON.stringify(c)},dataType:"json",async:!1}).done(function(e){s=e}).fail(function(){console.log("请求发生异常")}),s},ListStrBuilder:function(e){var t='<form id="alipaysubmit" name="alipaysubmit" action="'+e.action+'" method="get">';return t+=' <input type="hidden" name="_input_charset" value="'+e._input_charset+'"/>',t+=' <input type="hidden" name="body" value="'+e.body+'"/>',t+=' <input type="hidden" name="notify_url" value="'+e.notify_url+'"/>',t+=' <input type="hidden" name="out_trade_no" value="'+e.out_trade_no+'"/>',t+=' <input type="hidden" name="partner" value="'+e.partner+'"/>',t+=' <input type="hidden" name="payment_type" value="'+e.payment_type+'"/>',t+=' <input type="hidden" name="return_url" value="'+e.return_url+'"/>',t+=' <input type="hidden" name="seller_id" value="'+e.seller_id+'"/>',t+=' <input type="hidden" name="service" value="'+e.service+'"/>',t+=' <input type="hidden" name="show_url" value="'+e.show_url+'"/>',t+=' <input type="hidden" name="subject" value="'+e.subject+'"/>',t+=' <input type="hidden" name="total_fee" value="'+e.total_fee+'"/>',t+=' <input type="hidden" name="sign" value="'+e.sign+'"/>',t+=' <input type="hidden" name="sign_type" value="'+e.sign_type+'"/>',t+=' <input type="submit" value="确认" style="display:none;"/></form>'}};this.Pay=function(t,a,i,o,r,n,l,s){if(Global_ApicloudHelper.IsApp()){var d=e.GetAppPayData(t,a,i,o,r,n,l,s);"00000000"==d.ResultNo?Global_ApicloudHelper.aliPay(d.AlipayHtml,l,s):Global_PopupHelper.alert({title:"支付失败，请重试"})}else{var d=e.GetApiData(t,a,i,o,r,n);if("00000000"==d.ResultNo){var c=e.ListStrBuilder(JSON.parse(d.AlipayHtml));$(c).appendTo("body").submit()}else Global_PopupHelper.alert({title:"支付失败，请重试"})}}},Global_ShareHelper=new function(){this.MobShare=function(e,t,a,i,o){mobShare.config({appkey:"156cd0b7c209c",params:{url:e,title:t,description:a,pic:i,reason:""}});var r=mobShare("weibo"),n=mobShare("weixin"),l=(mobShare("qzone"),mobShare("qq"));mobShare("renren"),mobShare("kaixin"),mobShare("douban");$(".mob-share-weibo").click(function(o){function n(o){o?Global_ApicloudHelper.weibo_shareWebpage(t,a,i,e):alert("您手机未安装微博")}o.preventDefault(),Global_ApicloudHelper.IsApp()?Global_ApicloudHelper.IsweiboInstalled(n):r.send(),$(".mob-share-ui").slideUp(),$(".mob-share-ui-bg").hide()}),$(".mob-share-qq").click(function(o){o.preventDefault(),Global_ApicloudHelper.IsApp()?Global_ApicloudHelper.qq_shareNews(t,a,i,e,"QFriend"):l.send(),$(".mob-share-ui").slideUp(),$(".mob-share-ui-bg").hide()}),$(".mob-share-weixin").click(function(r){function l(r){r?Global_ApicloudHelper.wxshareWebpage(t,a,i,e,"session",o):n.send()}r.preventDefault(),Global_ApicloudHelper.IsApp()?Global_ApicloudHelper.isInstalled(l):n.send(),$(".mob-share-ui").slideUp(),$(".mob-share-ui-bg").hide()}),$(".mob-share-weixin_quan").click(function(r){function l(r){r?Global_ApicloudHelper.wxshareWebpage(t,a,i,e,"timeline",o):n.send()}r.preventDefault(),Global_ApicloudHelper.IsApp()?Global_ApicloudHelper.isInstalled(l):n.send(),$(".mob-share-ui").slideUp(),$(".mob-share-ui-bg").hide()}),$(".share").on("tap",function(e){e.preventDefault(),$(".mob-share-ui").slideDown(),$(".mob-share-ui-bg").show()}),$(".mob-share-ui-bg,.mob-share-close").on("tap",function(e){e.preventDefault(),$(".mob-share-ui").slideUp(),$(".mob-share-ui-bg").hide()})},this.MyArticleProductShare=function(e){var t=e.getAttribute("data-sharetitle"),a=e.getAttribute("data-sharelink"),i=e.getAttribute("data-shareContent"),o=e.getAttribute("data-shareimg");Global_ShareHelper.MobShare(a,t,i,o),$(".mob-share-ui").slideDown(),$(".mob-share-ui-bg").show()}},Global_ApicloudHelper=new function(){this.WX_getUserInfo=function(e){function t(t){a.getUserInfo({accessToken:t.accessToken,openId:t.openId},function(t,a){t.status&&(""!=t.headimgurl?t.headimgurl=t.headimgurl.substring(0,t.headimgurl.length-1)+"64":t.headimgurl=Global_ServiceUrlHelper.CurrentDomain+"/Content/Images/default_face.png",e(t))})}var a=api.require("wx"),i=this;i.WX_getToken(a,t)},this.WX_getToken=function(e,t){function a(a){a.status&&e.getToken({apiKey:"",apiSecret:"",code:a.code},function(e,a){0==a.code&&t(e)})}var i=this;i.WX_auth(e,a)},this.WX_auth=function(e,t){e.auth({apiKey:""},function(e,a){t(e)})},this.QQLogin=function(e){var t=api.require("qq");t.login(function(a,i){a.status&&Global_ApicloudHelper.QQ_GetUserInfo(t,e,a.openId)})},this.QQ_GetUserInfo=function(e,t,a){e.getUserInfo(function(e,i){e.status&&(e.openid=a,e.nickname=e.info.nickname,e.sex=e.info.gender,e.headimgurl=e.info.figureurl_qq_1,t(e))})},this.qq_shareNews=function(e,t,a,i,o){var r=api.require("qq");r.shareNews({url:i,title:e,description:t,imgUrl:a,type:o})},this.wxshareWebpage=function(e,t,a,i,o,r){function n(n){a="file://"+n,Global_ApicloudHelper.shareWebpage(e,t,a,i,o,r)}function l(n){a=n,Global_ApicloudHelper.shareWebpage(e,t,a,i,o,r)}Global_ApicloudHelper.DownloadFunc(a,n,l)},this.shareWebpage=function(e,t,a,i,o,r){var n=api.require("wx");n.shareWebpage({apiKey:"",scene:o,title:e,description:t,thumb:a,contentUrl:i},function(e,t){e.status&&void 0!=r&&r()})},this.weibo_shareWebpage=function(e,t,a,i){function o(o){a="file://"+o,Global_ApicloudHelper.shareWebpage2weibo(e,t,a,i)}function r(o){a=o,Global_ApicloudHelper.shareWebpage2weibo(e,t,a,i)}Global_ApicloudHelper.DownloadFunc(a,o,r)},this.shareWebpage2weibo=function(e,t,a,i){var o=api.require("weibo");o.shareWebPage({text:"",title:e,description:t,thumb:a,contentUrl:i})},this.IsweiboInstalled=function(e){var t=api.require("weibo");t.isInstalled(function(t){e(t.status)})},this.isInstalled=function(e){var t=api.require("wx");t.isInstalled(function(t,a){e(t.installed)})},this.DownloadFunc=function(e,t,a){api.download({url:e,savePath:"",report:!1,cache:!0,allowResume:!0},function(i,o){1==i.state?t(i.savePath):a(e)})},this.aliPay=function(e,t,a){var i=api.require("aliPay");i.payOrder({orderInfo:e},function(e,i){"9000"==e.code?t():a()})},this.wxPay=function(e,t,a,i,o,r,n,l){var s=api.require("wxPay");s.payOrder({orderId:a,mchId:e,nonceStr:t,timeStamp:o,sign:r},function(e,t){e.status?n(i):l()})},this.get_appVersion=function(){return api.appVersion},this.get_systemType=function(){return api.systemType},this.get_systemVersion=function(){return api.systemVersion},this.get_deviceId=function(){return api.deviceId},this.get_deviceModel=function(){return api.deviceModel},this.get_deviceName=function(){return api.deviceName},this.get_operator=function(){return api.operator},this.get_screenWidth=function(){return api.screenWidth},this.get_screenHeight=function(){return api.screenHeight},this.get_connectionType=function(){return api.connectionType},this.getLocation=function(e,t){if(Global_ApicloudHelper.IsApp()){var a=api.require("bMap");a.getLocation({accuracy:"100m",autoStop:!0,filter:1},function(a,i){a.status?e(a):t()})}else Global_GeoCoderHelper.GetPosition(e,t)},this.IsApp=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("apicloud_laibei")>0}},Global_SiteAccessLogHelper=new function(){this.GetSiteAccessInfo=function(){function e(e){1==e.status&&(r.positionType="2"),r.Longitude=e.lon,r.Latitude=e.lat,Global_SiteAccessLogHelper.AddSiteAccessLog(r)}function t(){Global_SiteAccessLogHelper.AddSiteAccessLog(r)}var a=(new Global_StorageHelper.GetSessionToStorage("SiteAccessLog"),new Global_StorageHelper.GetLocalToStorage("SiteAccesslocalStorage")),i=new Global_StorageHelper.GetLocalToStorage("ClientId"),o=new Global_StorageHelper.GetSessionToStorage("AppQueryString");if(null==a.StorageData){var r={AppChannel:"",AppType:"",AppVersion:"",SystemType:"",DeviceId:"",DeviceModel:"",DeviceName:"",Operator:"",ScreenWidth:"",ScreenHeight:"",ConnectionType:"",MemberAccount:"",PositionType:"1",Longitude:"",Latitude:"",URL:window.location.href,GUID:""},n=Global_BaseInfoHelper.GetLoginInfo();if(null!=n&&(r.MemberAccount=n.BaseId),null!=i.StorageData&&(r.GUID=i.StorageData),null!=o.StorageData){var l=JSON.parse(o.StorageData);r.AppChannel=l.AppChannel,r.AppType=l.AppType}Global_ApicloudHelper.IsApp()?(r.AppVersion=Global_ApicloudHelper.get_appVersion(),r.SystemType=Global_ApicloudHelper.get_systemType(),r.DeviceId=Global_ApicloudHelper.get_deviceId(),r.DeviceModel=Global_ApicloudHelper.get_deviceModel(),r.DeviceName=Global_ApicloudHelper.get_deviceName(),r.Operator=Global_ApicloudHelper.get_operator(),r.ScreenWidth=Global_ApicloudHelper.get_screenWidth(),r.ScreenHeight=Global_ApicloudHelper.get_screenHeight(),r.ConnectionType=Global_ApicloudHelper.get_connectionType(),""==r.AppChannel&&"ios"==r.SystemType&&(r.AppChannel="AS",""==r.AppType&&(r.AppType="12"))):Global_WeiXinHelper.IsWXBrowser()?r.AppChannel="WX":r.AppChannel="OT",Global_ApicloudHelper.getLocation(e,t)}},this.AddSiteAccessLog=function(e){$.ajax({url:Global_ServiceUrlHelper.Common_AddSiteAccessLog,type:"POST",data:{reqJson:JSON.stringify(e)},dataType:"json",success:function(t){if("undefined"!=typeof t.ResultNo&&"00000000"==t.ResultNo){var a={AppChannel:e.AppChannel,AppType:e.AppType,AppVersion:e.AppVersion,SystemType:e.SystemType,DeviceId:e.DeviceId,DeviceModel:e.DeviceModel,DeviceName:e.DeviceName,ScreenWidth:e.ScreenWidth,ScreenHeight:e.ScreenHeight,GUID:t.GUID};Global_StorageHelper.SetSessionToStorage("SiteAccessLog",JSON.stringify(a)),Global_StorageHelper.SetLocalToStorage("SiteAccesslocalStorage",JSON.stringify(a)),Global_StorageHelper.SetLocalToStorage("ClientId",t.GUID)}}})},this.SetAppQueryString=function(){var e=Global_SiteAccessLogHelper.GetQueryString("AppChannel"),t=Global_SiteAccessLogHelper.GetQueryString("AppType"),a={AppChannel:e,AppType:t};null!=e&&null!=t&&Global_StorageHelper.SetSessionToStorage("AppQueryString",JSON.stringify(a))},this.GetQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},this.SaveAppInfo=function(){var e=new Global_StorageHelper.GetSessionToStorage("LocationInfo");if(null==e.StorageData){var t={positionType:"1",Longitude:"0",Latitude:"0"};setTimeout(function(){function e(e){1==e.status&&(t.positionType="2"),t.Longitude=e.lon,t.Latitude=e.lat,Global_StorageHelper.SetSessionToStorage("LocationInfo",JSON.stringify(t))}function a(){}Global_ApicloudHelper.getLocation(e,a)},1e3)}}},Global_CommentHelper=new function(){this.Comment=function(e){var t=e.getAttribute("data-username"),a=e.getAttribute("data-userid"),i=e.getAttribute("data-id"),o=e.getAttribute("data-isarticle"),r=Global_ServiceUrlHelper.CurrentDomain+"/Optimization/Detail/"+i,n="宝贝夸一夸，生活顶呱呱";if("true"==o&&(r=Global_ServiceUrlHelper.CurrentDomain+"/Article/Detail/"+i,n="给宝宝捧个人场呗"),"title_comment"==e.getAttribute("class"))$.mobile.changePage(r);else{var l=Global_BaseInfoHelper.GetLoginInfo();null!=l?(a&&"0"!=a?n="回复"+t+":":a=0,$(".comment_input").attr("data-touersid",a),$(".comment_input").attr("placeholder",n),$(".comment_input").attr("data-tonikename",t),$(".comment_input").attr("data-id",i),$(".comment_input").attr("data-isarticle",o),$("#mainpage,#ArticleMainpage").hide(),$("#comment_div").show(),$(".comment_input").focus()):$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+r)}},this.AddComment=function(e,t){$(".laibei_page:last #comment_submit").on("tap",function(a){a.preventDefault(),$("#comment_div textarea").blur();var i=$(".comment_input"),o=$.trim(i.val()),r=i.attr("data-touersid"),n=i.attr("data-tonikename"),l=i.attr("data-id"),s=i.attr("data-isarticle");if(o.length<1||o.length>100)return void Global_PopupHelper.alert({title:"评论的字数在1-100之间"});var d,c;"true"==s?(d=new ArtitleCommentAddModel(e,l,r,o),c=Global_ServiceUrlHelper.Article_AddArticleComment):(d=new ProductCommentAddModel(e,l,r,o),c=Global_ServiceUrlHelper.Product_AddProductComment),$("#comment_div").hide(),$("#mainpage,#ArticleMainpage").show(),$.ajax({url:c,type:"POST",data:{reqJson:JSON.stringify(d)},dataType:"json",success:function(e){"00000000"==e.ResultNo?t(e,l,r,n,o):Global_PopupHelper.dialogautoclose({title:e.ResultRemark,timer:"2000",type:"1"})},error:function(){Global_PopupHelper.dialogautoclose({title:"评论失败",timer:"2000",type:"2"})}})}),$("#comment_cancel").on("tap",function(e){e.preventDefault(),$("#comment_div textarea").blur(),$("#comment_div").hide(),$("#mainpage,#ArticleMainpage").show()})}},Global_GoTopHelper={GoTop:function(){var e=window.screen.height;$(document).ready(function(){$(window).scroll(function(){var t=document.body.scrollTop;t>2*e?$("#gotop").show():$("#gotop").hide()})})}},Global_ConnectLoginHelper=new function(){var e={CheckLogin:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Account_CheckLoginByConnect,type:"POST",data:{reqJson:'{"Type":"'+e+'","UnionId":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a}};this.wxlogin=function(){function t(t){var a=Global_ServiceUrlHelper.CurrentDomain,i=e.CheckLogin("1",t.unionid);if("undefined"!=typeof i.ResultNo&&"00000000"==i.ResultNo){Global_StorageHelper.SetUserTokenToStorage(i),Global_StorageHelper.DelSessionByKey("BaseInfo");var o=new Global_StorageHelper.GetSessionToStorage("wx_login_backurl");null!=o.StorageData&&(a=o.StorageData);var r=SSO_Helper.IsSSOLogin(a);r?(a=SSO_Helper.GetReturnUrlWithToken(a,i.Token),location.href=a):$.mobile.changePage(a)}else{var n=Global_ServiceUrlHelper.CurrentDomain+"/Account/Bindphone?type=1&unionid="+t.unionid+"&sex="+t.sex+"&headimgurl="+t.headimgurl+"&ReturnUrl="+a+"&nickname="+t.nickname;$.mobile.changePage(n)}}Global_ApicloudHelper.WX_getUserInfo(t)},this.qqlogin=function(t){function a(a){var i=e.CheckLogin("2",a.openid);if("undefined"!=typeof i.ResultNo&&"00000000"==i.ResultNo){Global_StorageHelper.SetUserTokenToStorage(i),Global_StorageHelper.DelSessionByKey("BaseInfo");var o=SSO_Helper.IsSSOLogin(t);o?(t=SSO_Helper.GetReturnUrlWithToken(t,i.Token),location.href=t):$.mobile.changePage(t)}else{var r=Global_ServiceUrlHelper.CurrentDomain+"/Account/Bindphone?type=2&unionid="+a.openid+"&sex="+a.sex+"&headimgurl="+a.headimgurl+"&ReturnUrl="+t+"&nickname="+a.nickname;$.mobile.changePage(r)}}Global_ApicloudHelper.QQLogin(a)}},Global_PageVisitStatistics={LogServerDomain:Global_ServiceUrlHelper?Global_ServiceUrlHelper.APIDomain:"",PageVisit:function(){var e=this,t=e.GetRouteUrl(),a=e.GetToken(),i={NewOrOldMember:"1",Token:a.Token,PositionType:"1",Longitude:"0",Latitude:"0",FullUrl:t.FullUrl,AbsoluteUrl:t.AbsoluteUrl,ConciseUrl:t.ConciseUrl,VisitOrigin:t.VisitOrigin,ClientId:"",SessionId:""},o=e.GetSessionToStorage("LocationInfo");if(null!=o){var r=JSON.parse(o);i.Longitude=r.Longitude,i.PositionType=r.PositionType,i.Latitude=r.Latitude}var n=e.GetLocalToStorage("ClientId");null!=n&&(i.ClientId=n);var l=new Date,s=e.GetLocalToStorage("VisitTime"),d=e.GetSessionToStorage("Conversation"),c=l.getFullYear()+"-"+parseInt(l.getMonth()+1)+"-"+l.getDate();if(null!=s){var u=s;u!=c&&(i.NewOrOldMember="2")}else e.SetLocalToStorage("VisitTime",c);null!=d&&(i.SessionId=d),e.AddPageVisit(i)},AddPageVisit:function(e){$.ajax({url:this.LogServerDomain+"/MWeb/BehaviorAnalysis/AddPageVisit",type:"POST",data:{reqJson:JSON.stringify(e)},dataType:"json",success:function(e){if("undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo){var t=e.SessionId;Global_PageVisitStatistics.SetSessionToStorage("Conversation",t),Global_PageVisitStatistics.SetLocalToStorage("ClientId",e.ClientId)}},complete:function(e,t){TemplateHelper.loadingHide()}})},PageDuration:function(){var e=this,t=e.GetSessionToStorage("Duration"),a=e.GetRouteUrl(),i={FullUrl:a.FullUrl,AbsoluteUrl:a.AbsoluteUrl,ConciseUrl:a.ConciseUrl,DurationTime:0},o=new Date,r=o.getFullYear()+"-"+parseInt(o.getMonth()+1)+"-"+o.getDate()+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds();if(null!=t){var n=JSON.parse(t),l=n.Time;i.FullUrl=n.FullUrl;var s=new Date(l).getTime();i.DurationTime=parseInt((o.getTime()-s)/1e3),i.DurationTime>0&&$.ajax({url:this.LogServerDomain+"/MWeb/BehaviorAnalysis/AddPageDuration",type:"POST",data:{reqJson:JSON.stringify(i)},dataType:"json",success:function(e){}})}var d={FullUrl:i.FullUrl,Time:r};e.SetSessionToStorage("Duration",JSON.stringify(d))},GetStorageDataByKey:function(e){var t=null,a=window.localStorage,i=a.getItem(e),o="";if(null!=i){o=JSON.parse(i);var r=new Date,n=new Date(o.ExpTime);r<n&&(t=o.ObjectData)}return t},SetLocalToStorage:function(e,t){var a=window.localStorage;a.setItem(e,t)},GetLocalToStorage:function(e){var t=window.localStorage,a=null;return a=t.getItem(e)},SetSessionToStorage:function(e,t){var a=window.sessionStorage;a.setItem(e,t)},GetSessionToStorage:function(e){var t=window.sessionStorage,a=null;return a=t.getItem(e)},GetRouteUrl:function(){var e=window.location.href.toLowerCase(),t="",a="",i="";if(e.indexOf("?")>-1){var o=e.split("?");t=o[0],a=o[1]}else t=e;"undefined"!=typeof window.VisitOrigin&&(i=window.VisitOrigin);var r={FullUrl:e,AbsoluteUrl:t,ConciseUrl:a,VisitOrigin:i};if($("#page_route").length>0){var n=JSON.parse($("#page_route").html());r.AbsoluteUrl=(location.protocol+"//"+location.host+n.AbsoluteUrl).toLowerCase(),r.ConciseUrl=(location.protocol+"//"+location.host+n.ConciseUrl).toLowerCase()}return r},GetToken:function(){var e=null,t=Global_PageVisitStatistics.GetStorageDataByKey("UserToken");if(null!=t){var a=JSON.parse(t);e=a.Token}return{Token:e}},IsApp:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("apicloud_laibei")>0}},Global_PageLoadHelper=new function(){function e(){Global_StorageHelper.Subscribe("IM-AutoLogin",function(e,t,a,i){"UserToken"==a&&(t==this.OperationType.Set?imClient.isConnetioned()&&imClient.reStart({MbrToken:i.Token}):t==this.OperationType.Remove&&imClient.stop())}),ServiceShow()}function t(){var e=new Global_StorageHelper.GetStorageDataByKey("UserToken",Global_ServiceUrlHelper.TokenExpTime);if(null==e||null==e.StorageData)imPublic.bindUnLoginEvent(),console.log("用户未登录！");else{var t=JSON.parse(e.StorageData),a=t.Token,i=null;try{i=Global_BaseInfoHelper.GetLoginInfo(!0)}catch(e){var o=JSON.parse(e.message);"00000000"!=o.ResultNo}if(null==i)return imPublic.bindUnLoginEvent(),void console.log("获取当前用户的登录信息失败！");imClient.init({imServerUrl:Global_ServiceUrlHelper.IMServiceUrl+"/signalr",qs:{MbrToken:a}}).initPublic({User:i}).start()}}this.PageBeforeCreate=function(){$(".iReturnHistoryEvent").on("tap",function(e){e.preventDefault(),Global_ReturnHelper.ReturnHistoryPage()})},this.PageShowBefore=function(){$(".laibei_page").removeClass("ui-page"),imPublic.pageSwitch.isHide("page")||imPublic.pageSwitch.showPage(),e()},this.PageShowAfter=function(){Global_ReturnHelper.fetchChangePageCallback(),t(),Global_ReturnHelper.SetReturnUrl(),Global_ReturnHelper.IsDisabled=!1;var e=["article/detail","product/detail","optimization","charitable","charity","activepage","activitys/"],a=window.location.pathname.toLowerCase(),i=!1;$(e).each(function(e,t){a.indexOf(t)>=0&&(i=!0)}),i||Global_WeiXinHelper.weixinjsApi(window.location.href.split("#")[0],"来呗，亲子家庭分享服务平台","让全天下儿童安全健康成长",Global_ServiceUrlHelper.CurrentDomain,Global_ServiceUrlHelper.CurrentDomain+"/Content/Images/wxshare.jpg"),Global_PageVisitStatistics.PageVisit(),Global_PageVisitStatistics.PageDuration(),Global_SiteAccessLogHelper.SetAppQueryString(),Global_CommonHelper.MoveFixedSever(),setTimeout(function(){Global_SiteAccessLogHelper.GetSiteAccessInfo()},3e3),TemplateHelper.Init()},this.PageHide=function(){$(".laibei_page").length>1&&$(".laibei_page:first").remove()},ServiceShow=function(){var e=["article/list","/account","/my/about"],t=!0,a=window.location.pathname.toLowerCase();return"/"==a?void $("#sever").hide():($(e).each(function(e,i){if(a.indexOf(i)>=0)return void(t=!1)}),void(t?$("#sever").show():$("#sever").hide()))}},SSO_Helper=function(){function e(e,t){if(e)try{var a=new SSOParams(e,t),i=Global_ServiceUrlHelper.SSO_GetSSOInfo;$.ajax({url:i,type:"post",dataType:"json",async:!1,data:{reqJson:JSON.stringify(a)},success:function(e){"00000000"===e.ResultNo&&e.BackCenterUrl&&(t=e.BackCenterUrl)}})}catch(e){}return t}function t(e){var t=decodeURIComponent(e);return e.endWith("Token=")||t.endWith("Token=")}function a(e,t){return e+t}function i(e){var t=Global_ServiceUrlHelper.SSO_GetSSOInfo;return $.post(t,{Code:e,ClientBackUrl:clientBackUrl},function(e){return"00000000"===e.ResultNo?e:null},"json"),null}return SSOParams=function(e,t){this.Code=e,this.ClientBackUrl=t},String.prototype.endWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substring(this.length-e.length)==e},{GetClientBackUrl:e,GetSSOInfo:i,IsSSOLogin:t,GetReturnUrlWithToken:a}}(),Account_Bindphone=new function(){var e=Global_ServiceUrlHelper.MobileCheckStr;ConnectLogin=function(e,t,a,i,o,r,n){this.Mobile=e,this.ValidCode=t,this.Type=a,this.UnionId=i,this.NickName=o,this.Sex=r,this.Headimgurl=n,this.RegRequestURL=window.location.href.split("#")[0]},this.GetValidCode=function(){Global_ValidCodeHelper.GetValidCode(51,"tel","sendVerifyCode")},this.LoginFun=function(t,a,i,o,r,n){$("#tel,#valid").on("keyup",function(){var e=$("#tel").val(),t=$("#valid").val();e&&t?$("#Account_Bindphone_Submit").removeClass("disabled").removeAttr("disabled"):$("#Account_Bindphone_Submit").addClass("disabled").attr("disabled","disabled")}),$("#Account_Bindphone_Submit").on("tap",function(l){l.preventDefault(),$("#Account_Bindphone_Submit").attr("disabled","disabled");var s=$("#tel").val(),d=$("#valid").val();if($("#tel,#valid").blur(),""==s)return Global_PopupHelper.alert({
title:"手机号码不能为空"}),void $("#Account_Bindphone_Submit").removeAttr("disabled");if(!e.test(s))return Global_PopupHelper.alert({title:"您填写的手机号格式有误，请输入11位大陆手机号码"}),void $("#Account_Bindphone_Submit").removeAttr("disabled");if(""==d)return Global_PopupHelper.alert({title:"验证码不能为空"}),void $("#Account_Bindphone_Submit").removeAttr("disabled");if(4!=d.length)return Global_PopupHelper.alert({title:"验证码位数错误"}),void $("#Account_Bindphone_Submit").removeAttr("disabled");var c=new ConnectLogin(s,d,a,i,o,r,n);$.ajax({url:Global_ServiceUrlHelper.Account_AddConnectMBRBase,type:"POST",data:{reqJson:JSON.stringify(c)},dataType:"json",success:function(e){if("undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo){Global_StorageHelper.SetUserTokenToStorage(e),Global_StorageHelper.DelSessionByKey("BaseInfo"),Global_StorageHelper.DelSessionByKey("validCodeCache21"),Global_MessageHelper.SetName(e.Sex);var i=SSO_Helper.IsSSOLogin(t);i?(t=SSO_Helper.GetReturnUrlWithToken(t,e.Token),location.href=t):$.mobile.changePage(t)}else if("undefined"!=typeof e.ResultRemark){var o=e.ResultRemark;"04130001"==e.ResultNo&&(1==a?o="您的手机已经绑定过其他微信":2==a&&(o="您的手机已经绑定过其他QQ")),Global_PopupHelper.alert({title:o})}else Global_PopupHelper.alert({title:"操作失败，请重试"});$("#Account_Bindphone_Submit").removeAttr("disabled")}})})}},Account_ForgetPassword=new function(){var e=Global_ServiceUrlHelper.MobileCheckStr,t=Global_ServiceUrlHelper.PasswordCheckStr;this.GetValidCode=function(){Global_ValidCodeHelper.GetValidCode(11,"telForget","ForgetsendVerifyCode")},this.RegFun=function(e){$("#telForget,#validForget").on("keyup",function(){var e=$("#telForget").val(),t=$("#validForget").val();e&&t?$("#nextForgetPage").removeClass("disabled").removeAttr("disabled"):$("#nextForgetPage").addClass("disabled").attr("disabled","disabled")}),$("#nextForgetPage").on("tap",function(e){e.preventDefault(),$("#telForget,#validForget").blur();var t=TelAndValidCheck(),a=$("#telForget").val(),i=$("#validForget").val();t&&$.ajax({url:Global_ServiceUrlHelper.Account_CheckValidCode,type:"POST",data:{reqJson:'{"BizType":11,"Mobile":"'+a+'","ValidCode":"'+i+'"}'},dataType:"json",success:function(e){if("undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo)$("#firstPage").hide(500),$("#SecondPage").show(500);else{var t="验证码错误";"undefined"!=typeof e.ResultRemark&&(t=e.ResultRemark),Global_PopupHelper.alert({title:t})}}})}),$("#new-pwd,#repeat-pwd").on("keyup",function(){var e=$("#new-pwd").val(),t=$("#repeat-pwd").val();e&&t?$("#btnForgetReg").removeClass("disabled").removeAttr("disabled"):$("#btnForgetReg").addClass("disabled").attr("disabled","disabled")}),$("#btnForgetReg").on("tap",function(a){a.preventDefault(),$("#nextForgetPage").attr("disabled","disabled"),$("#new-pwd,#repeat-pwd").blur();var i=TelAndValidCheck();if(!i)return void $("#btnForgetReg").removeAttr("disabled");var o=$("#telForget").val(),r=$("#validForget").val(),n=$("#new-pwd").val(),l=$("#repeat-pwd").val();if(""==n)return Global_PopupHelper.alert({title:"密码不能为空"}),void $("#btnForgetReg").removeAttr("disabled");if(!t.test(n))return Global_PopupHelper.alert({title:"请填写正确的密码6-16位"}),void $("#btnForgetReg").removeAttr("disabled");if(l!=n)return Global_PopupHelper.alert({title:"密码不一致"}),void $("#btnForgetReg").removeAttr("disabled");var s=new RegModel(o,n,r);$.ajax({url:Global_ServiceUrlHelper.Account_ChangePassword,type:"POST",data:{reqJson:JSON.stringify(s)},dataType:"json",success:function(t){if("undefined"!=typeof t.ResultNo&&"00000000"==t.ResultNo){Global_StorageHelper.SetUserTokenToStorage(t),Global_StorageHelper.DelSessionByKey("BaseInfo"),Global_StorageHelper.DelSessionByKey("validCodeCache11");var a=SSO_Helper.IsSSOLogin(e);a?location.href=e:$.mobile.changePage(e)}else"undefined"!=typeof t.ResultRemark?Global_PopupHelper.alert({title:t.ResultRemark}):Global_PopupHelper.alert({title:"操作失败，请重试"});$("#btnForgetReg").removeAttr("disabled")}})}),$("#SecondPageBack").on("tap",function(e){e.preventDefault(),$("#firstPage").show(500),$("#SecondPage").hide(500)})},RegModel=function(e,t,a){this.Mobile=e,this.Password=t,this.ValidCode=a},TelAndValidCheck=function(){var t=$("#telForget").val(),a=$("#validForget").val();return""==t?(Global_PopupHelper.alert({title:"手机号码不能为空"}),!1):e.test(t)?""==a?(Global_PopupHelper.alert({title:"验证码不能为空"}),!1):4==a.length||(Global_PopupHelper.alert({title:"验证码位数错误"}),!1):(Global_PopupHelper.alert({title:"您填写的手机号格式有误，请输入11位大陆手机号码"}),!1)}},Account_Index=new function(){var e=Global_ServiceUrlHelper.MobileCheckStr;Global_ServiceUrlHelper.PasswordCheckStr;LoginByValidCode=function(e,t){this.Mobile=e,this.ValidCode=t,this.RegRequestURL=window.location.href.split("#")[0]},this.PageInit=function(){Global_ApicloudHelper.IsApp()||Global_WeiXinHelper.IsWXBrowser()||($("#wx_login").hide(),$(".thirdparty").hide())},this.GetValidCode=function(){Global_ValidCodeHelper.GetValidCode(21,"tel","sendVerifyCode")},this.LoginFun=function(t){$("#wx_login").click(function(){var e=Global_ServiceUrlHelper.CurrentDomain+"/WeChat/Authorize?state=wxlogin",t=$(this).attr("data-returnUrl");Global_StorageHelper.SetSessionToStorage("wx_login_backurl",t),Global_WeiXinHelper.IsWXBrowser()?window.location.href=e:Global_ConnectLoginHelper.wxlogin()}),$("#qq_login").click(function(){var e=$(this).attr("data-returnUrl");Global_ConnectLoginHelper.qqlogin(e)}),$("#tel,#valid").on("keyup",function(){var e=$("#tel").val(),t=$("#valid").val();e&&t?$("#Account_Index_Submit").removeClass("disabled").removeAttr("disabled"):$("#Account_Index_Submit").addClass("disabled").attr("disabled","disabled")}),$("#Account_Index_Submit").on("tap",function(){$("#Account_Index_Submit").attr("disabled","disabled");var a=$("#tel").val(),i=$("#valid").val();if($("#tel,#valid").blur(),""==a)return Global_PopupHelper.alert({title:"手机号码不能为空"}),void $("#Account_Index_Submit").removeAttr("disabled");if(!e.test(a))return Global_PopupHelper.alert({title:"您填写的手机号格式有误，请输入11位大陆手机号码"}),void $("#Account_Index_Submit").removeAttr("disabled");if(""==i)return Global_PopupHelper.alert({title:"验证码不能为空"}),void $("#Account_Index_Submit").removeAttr("disabled");if(4!=i.length)return Global_PopupHelper.alert({title:"验证码位数错误"}),void $("#Account_Index_Submit").removeAttr("disabled");var o=new LoginByValidCode(a,i);$.ajax({url:Global_ServiceUrlHelper.Account_CheckLoginByValidCode,type:"POST",data:{reqJson:JSON.stringify(o)},dataType:"json",success:function(e){if("undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo){Global_StorageHelper.SetUserTokenToStorage(e),Global_StorageHelper.DelSessionByKey("BaseInfo"),Global_StorageHelper.DelSessionByKey("validCodeCache21"),Global_MessageHelper.SetName(e.Sex);var a=SSO_Helper.IsSSOLogin(t);a?(t=SSO_Helper.GetReturnUrlWithToken(t,e.Token),location.href=t):TemplateHelper.changePage(t)}else"undefined"!=typeof e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.alert({title:"操作失败，请重试"});$("#Account_Index_Submit").removeAttr("disabled")}})})}},Account_Login=new function(){var e=Global_ServiceUrlHelper.MobileCheckStr,t=Global_ServiceUrlHelper.PasswordCheckStr;LoginByPassword=function(e,t){this.Mobile=e,this.Password=t},this.LoginFun=function(a){$("#tel_psw,#password").on("keyup",function(){var e=$("#tel_psw").val(),t=$("#password").val();e&&t?$("#btnPswLogin").removeClass("disabled").removeAttr("disabled"):$("#btnPswLogin").addClass("disabled").attr("disabled","disabled")}),$("#btnPswLogin").on("tap",function(){$("#btnPswLogin").attr("disabled","disabled");var i=$("#tel_psw").val(),o=$("#password").val();if($("#tel_psw,#password").blur(),""==i)return Global_PopupHelper.alert({title:"手机号码不能为空"}),void $("#btnPswLogin").removeAttr("disabled");if(!e.test(i))return Global_PopupHelper.alert({title:"您填写的手机号格式有误，请输入11位大陆手机号码"}),void $("#btnPswLogin").removeAttr("disabled");if(""==o)return Global_PopupHelper.alert({title:"密码不能为空"}),void $("#btnPswLogin").removeAttr("disabled");if(!t.test(o))return Global_PopupHelper.alert({title:"请填写正确的密码6-16位"}),void $("#btnPswLogin").removeAttr("disabled");var r=new LoginByPassword(i,o);$.ajax({url:Global_ServiceUrlHelper.Account_CheckLoginByPwd,type:"POST",data:{reqJson:JSON.stringify(r)},dataType:"json",success:function(e){if("undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo){Global_StorageHelper.SetUserTokenToStorage(e),Global_StorageHelper.DelSessionByKey("BaseInfo"),Global_MessageHelper.SetName(e.Sex);var t=SSO_Helper.IsSSOLogin(a);t?(a=SSO_Helper.GetReturnUrlWithToken(a,e.Token),location.href=a):TemplateHelper.changePage(a)}else"undefined"!=typeof e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.alert({title:"操作失败，请重试"});$("#btnPswLogin").removeAttr("disabled")}})})}},Account_SignOut=function(){function e(e){var t=new Global_BaseInfoHelper.GetToken;$.ajax({url:Global_ServiceUrlHelper.Account_SignOut,type:"POST",data:{reqJson:'{"Token":"'+t.Token+'"}'},async:!1,dataType:"json",success:function(t){Global_StorageHelper.DelSessionByKey("BaseInfo"),Global_StorageHelper.DelSessionByKey("ListPageDate"),Global_StorageHelper.DelSessionByKey("PageUrl"),Global_StorageHelper.DelStorageByKey("UserToken"),void 0!=e&&"function"==typeof e&&e()}})}return{SignOut:e}}(),Article_Change=new function(){this.ArticleFun=function(e){function t(e,t,a,i,o){this.Id=e,this.Content=t,this.Tag=a,this.Img=i,this.Token=o}var a=0;Global_TagHelper.TagFun("j_tag"),Article_ImgHelper.ArticleImgFun(a),$("#PromptTopBack").on("tap",function(e){e.preventDefault(),$("#Article_Chang_Content").blur();var t=$("#Article_Chang_Content").val();""==t?Global_ReturnHelper.AllowPageReturnHistory():Global_ReturnHelper.EditPageReturn()}),$("#Article_Change_submit").on("tap",function(){$("#Article_Change_submit").attr("disabled",!0);var a=$.trim($("#Article_Chang_Content").val()),i=$(".tagchecked"),o="";$.each(i,function(e,t){o+=$(t).attr("data-id")+","});var r=$("li[data-role='img']"),n="";if($.each(r,function(e,t){n+=$(t).find("img").attr("data-imgbaseid")+","}),""==a)return Global_PopupHelper.alert({title:Global_MessageHelper.ContentEmpty,btnName:Global_MessageHelper.BtnTextEmpty}),void $("#Article_Change_submit").removeAttr("disabled");if(a.length<10)return Global_PopupHelper.alert({title:Global_MessageHelper.ContentNotEnough,btnName:Global_MessageHelper.BtnTextNotEnough}),void $("#Article_Change_submit").removeAttr("disabled");if(""==o.replace(",",""))return Global_PopupHelper.alert({title:Global_MessageHelper.TagEmpty,btnName:Global_MessageHelper.BtnTextNotCheck}),void $("#Article_Change_submit").removeAttr("disabled");var l=new Global_BaseInfoHelper.GetToken,s=new t(e,a,o,n,l.Token);$.ajax({url:Global_ServiceUrlHelper.Article_ChageBase,type:"POST",data:{reqJson:JSON.stringify(s)},dataType:"json",success:function(t){t.ArticleBaseId>0?Global_PopupHelper.dialogautoclose({title:"发布成功",timer:"2000",confirmCallback:function(){$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Article/Detail/"+e)}}):"undefined"!=typeof t.ResultRemark?(Global_PopupHelper.alert({title:t.ResultRemark}),$("#Article_Change_submit").removeAttr("disabled")):(Global_PopupHelper.dialogautoclose({title:"发布失败",timer:"2000",type:"2"}),$("#Article_Change_submit").removeAttr("disabled"))}})})}},Article_Detail=new function(){var e;this.PageInit=function(a){function i(e,t,a,i,o){var r=$(".ArticleDetailComment").html();"评论"==r&&(r="0");var n="评论成功";a&&"0"!=a&&(n="回复成功",o="回复@"+i+":"+o);var s='<li class="item borderbottom">';s+='<div class="info">',s+='<div class="avatar '+Global_CommonHelper.GetCategoryClass(l.Category)+'"><img src="'+l.FaceImage+'" /></div>',s+='<div class="nickname">'+l.Nickname+"</div>",s+='<div class="time">'+e.CreateTime+"</div>",s+="</div>",s+='<p class="commenttext" onclick="Global_CommentHelper.Comment(this)" data-isarticle="true" data-id="'+t+'" data-userid="'+l.BaseId+'" data-username="'+l.Nickname+'">'+o+"</p>",s+="</li>",0==$("#ArticleDetailCommentList").find("li").length?$("#ArticleDetailCommentList").append(s):$("#ArticleDetailCommentList li").eq(0).prepend(s),$(".comment_input").val(""),$(".ArticleDetailComment").html(parseInt(r)+1),$("#commentamount").html(parseInt(r)+1),$("#NoComment").remove(),Global_PopupHelper.dialogautoclose({title:n,timer:"2000",type:"1"})}e=new Global_BaseInfoHelper.GetToken;var o=t.GetApiDate(a),r=window.location.href.split("#")[0],n=Global_ServiceUrlHelper.CurrentDomain+"/Article/Detail/"+a;if("00000000"==o.ResultNo){if(0==o.Status)return void Article_Detail.PageEmpty();var l=(t.SetArticleHtml(o),Global_BaseInfoHelper.GetLoginInfo());null!=l&&l.BaseId==o.CreateUserId?($(".laibei_page:last #insidefooter").show(),$(".laibei_page:last #outsidefooter").remove(),$(".laibei_page:last .cancern").hide()):($(".laibei_page:last #outsidefooter").show(),$(".laibei_page:last #insidefooter").remove()),imPublic.bindChatEvent({ClientID:o.CreateUserId,Nickname:o.CreateUserName,LinkType:imPublic.enum.ChatMessage.Article});var s=Global_ServiceUrlHelper.CurrentDomain+"/Content/Images/wxshare.jpg";""!=o.ImgList&&(s=o.ImgList[0].Path+"@!standard_square_s"),Global_WeiXinHelper.weixinjsApi(r,o.CreateUserName+"的说说",o.Content,n,s),Global_ShareHelper.MobShare(n,o.CreateUserName+"的说说",o.Content,s)}else Article_Detail.PageEmpty();$(".laibei_page:last .uncancernbtn").on("click",function(e){e.preventDefault(),Global_PopupHelper.OperationMethod({confirmCallback:function(){var e=Global_CommonHelper.BaseAttention(o.CreateUserId);if(null!=e)if("undefined"!=typeof e&&"00000000"==e.ResultNo)$(".uncancernbtn").hide(),$(".cancernbtn").show();else{var t="操作失败";"undefined"!=typeof e.ResultRemark&&(t=e.ResultRemark),Global_PopupHelper.alert({title:t})}}})}),$(".laibei_page:last .cancernbtn").on("click",function(e){e.preventDefault(),Global_PopupHelper.OperationMethod({confirmCallback:function(){var e=Global_CommonHelper.BaseAttention(o.CreateUserId);if(null!=e)if("undefined"!=typeof e&&"00000000"==e.ResultNo)$(".cancernbtn").hide(),$(".uncancernbtn").show();else{var t="操作失败";"undefined"!=typeof e.ResultRemark&&(t=e.ResultRemark),Global_PopupHelper.alert({title:t})}}})}),Global_CommentHelper.AddComment(e.Token,i)},this.PageEmpty=function(){$(".laibei_page:last #ArticleMainEmptyContent").html(Global_MessageHelper.PageEmpty),$(".laibei_page:last #ArticleMainEmptyPage").show(),$(".laibei_page:last #ArticleMainpage").hide()},this.DetailShowLightBox=function(t){Global_SwiperHelper.SwiperLightboxClick("ArticleMainpage"),$("#ArticleShowSwiper img").on("tap",function(e){e.preventDefault();var t=$(this).index();Global_SwiperHelper.DirectShowSwiper(t,"ArticleMainpage","lightbox")}),$("#morebtn").on("tap",function(e){e.preventDefault(),$(".popupbtngroup").show(),$(".menu").slideDown()}),$("#cancel").on("tap",function(e){e.preventDefault(),$(".popupbtngroup").hide(),$(".menu").hide()}),$("#articleDel").on("tap",function(a){Global_PopupHelper.confirm({title:"确定删除说说",confirmCallback:function(){var a=new ArticleDelModel(t,e.Token);$.ajax({url:Global_ServiceUrlHelper.Article_DelBase,type:"POST",data:{reqJson:JSON.stringify(a)},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.StatusNo?Global_PopupHelper.dialogautoclose({title:"删除成功",timer:"2000",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):Global_PopupHelper.dialogautoclose({title:"删除失败",timer:"2000",type:"2"})}})}}),a.preventDefault()})},ArticleDelModel=function(e,t){this.ArticleBaseId=e,this.Token=t},ArtitleCommentAddModel=function(e,t,a,i){this.Token=e,this.ArticleBaseId=t,this.ToUserId=a,this.Content=i};var t={GetApiDate:function(t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Article_GetBaseById,type:"POST",data:{reqJson:'{"ArticleBaseId":"'+t+'","Token":"'+e.Token+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},GetCommentList:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Article_GetCommentList,type:"POST",data:{reqJson:'{"ArticleBaseId":"'+e+'","pageIndex":"'+t+'","pageSize":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},SetCommentHtml:function(e,t){for(var a="",i=0;i<e.Data.length;i++)a+='<li class="item borderbottom"><div class="info"><div class="avatar '+Global_CommonHelper.GetCategoryClass(e.Data[i].Category)+'"><img src="'+e.Data[i].CreateUserFaceImage+'" /></div><div class="nickname">'+e.Data[i].CreateUserName+'</div><div class="time">'+e.Data[i].CreateTime+'</div></div><p class="commenttext" onclick="Global_CommentHelper.Comment(this)" data-isarticle="true"  data-id="'+t+'" data-userid="'+e.Data[i].CreateUserId+'" data-username="'+e.Data[i].CreateUserName+'" >'+e.Data[i].Content+"</p></li>";return a},SetArticleHtml:function(e){$(".laibei_page:last #ArticleDetailCreateUserName").html(e.CreateUserName),$(".laibei_page:last .avatar").addClass(Global_CommonHelper.GetCategoryClass(e.Category)),$(".laibei_page:last #ArticleDetailCreateTime").html(e.CreateTime+'<span class="address"> | 来自'+e.CityName+"</span>");var t=Global_CommonHelper.SetUrlFormatA(e.Content);$(".laibei_page:last #ArticleDetailContent").html(t),$(".laibei_page:last #ArticleDetailUserUrl").attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.CreateUserId),$(".laibei_page:last #ArticleDetailFaceImg").attr("src",e.CreateUserFaceImage);var a;if(null!=e.ImgList)if(e.ImgList.length>1){for(var i=0;i<e.ImgList.length;i++)a+='<img src="'+e.ImgList[i].Path+'@!standard_square_m" alt="" />';$(".laibei_page:last #ArticleShowSwiper").addClass("moreimg").addClass("thumb")}else{for(var i=0;i<e.ImgList.length;i++)a+='<img src="'+e.ImgList[i].Path+'@!standard_rectangle_m" alt="" />';$(".laibei_page:last #ArticleShowSwiper").addClass("oneimg")}$(".laibei_page:last #ArticleShowSwiper").html(a);var o="";if(null!=e.ImgList)for(var i=0;i<e.ImgList.length;i++)o+='<div class="swiper-slide"><img src="'+e.ImgList[i].Path+'@!standard_square_s" /></div>';$(".laibei_page:last #SwiperLightBoxImgList").html(o);var r="";if(null!=e.CommentList){var n=e.CommentList.length;if("0"==n)$(".laibei_page:last #NoComment").show();else{$(".laibei_page:last #NoComment").remove();for(var i=0;i<n;i++)r+='<li class="item borderbottom"><div class="info"><div class="avatar '+Global_CommonHelper.GetCategoryClass(e.CommentList[i].Category)+'"><img src="'+e.CommentList[i].CreateUserFaceImage+'" /></div><div class="nickname">'+e.CommentList[i].CreateUserName+'</div><div class="time">'+e.CommentList[i].CreateTime+'</div></div><p class="commenttext" onclick="Global_CommentHelper.Comment(this)" data-isarticle="true"  data-id="'+e.ArticleBaseId+'" data-userid="'+e.CommentList[i].CreateUserId+'" data-username="'+e.CommentList[i].CreateUserName+'" >'+e.CommentList[i].Content+"</p></li>"}}$(".laibei_page:last #ArticleDetailCommentList").html(r);var l="转发",s="评论",d="赞",c="unlikeicon";e.IsCurrentUserPraise&&(c="likeicon"),0!=e.ForwardCount&&(l=e.ForwardCount),0!=e.CommentCount&&(s=e.CommentCount),0!=e.PraiseCount&&(d=Global_CommonHelper.GetShowCount(e.PraiseCount)),e.IsCurrentUserPraise?$(".laibei_page:last .ArticleDetailPraiseIcon").addClass("likeicon"):$(".laibei_page:last .ArticleDetailPraiseIcon").addClass("unlikeicon"),$(".laibei_page:last #chat").attr("data-createuserid",e.CreateUserId),$(".laibei_page:last .ArticleDetailComment").html(s),$(".laibei_page:last .ArticleDetailPraise").html(d),$(".laibei_page:last .ArticleDetailForward").html(l),$(".laibei_page:last #commentamount").html(e.CommentCount),e.IsAttention?($(".laibei_page:last .cancernbtn").show(),$(".laibei_page:last .uncancernbtn").hide()):($(".laibei_page:last .uncancernbtn").show(),$(".laibei_page:last .cancernbtn").hide()),null!=e.ForwardBase&&$(".laibei_page:last #articleChange").remove();var u=Global_ForwardHelper.GetForwardHtml(e.ForwardBase);$(".laibei_page:last #ArticleDetailInfo").append(u);var p=Global_BaseInfoHelper.CheckLogin();p?$(".laibei_page:last .ArticleDetailForwardUrl").attr("href",Global_ForwardHelper.GetForwardUrl(e.ArticleBaseId,!0,e.ForwardBase)):$(".laibei_page:last .ArticleDetailForwardUrl").on("tap",function(){var e=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(e)})}};this.ArticlePraise=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=Global_CommonHelper.ArticlePraise(e);if(null!=t)if("undefined"!=typeof t&&"00000000"==t.ResultNo)t.IsAdd?($(".ArticleDetailPraise").html(Global_CommonHelper.GetShowCount(t.PraiseCount)),$(".ArticleDetailPraiseIcon").addClass("likeicon")):(0==t.PraiseCount?$(".ArticleDetailPraise").html("赞"):$(".ArticleDetailPraise").html(Global_CommonHelper.GetShowCount(t.PraiseCount)),$(".ArticleDetailPraiseIcon").removeClass("likeicon").addClass("unlikeicon"));else{var a="操作失败";"undefined"!=typeof t.ResultRemark&&(a=t.ResultRemark),Global_PopupHelper.alert({title:a})}}})},this.CommentDropload=function(e,a,i){$(function(){var o=parseInt($("#commentamount").html()),r=$(window).height(),n=$("#ArticleMainpage").outerHeight(!0);n<=r||o<20||$("#ArticleDetailCommentDiv").dropload({scrollArea:window,loadDownFn:function(o){var r=t.GetCommentList(e,a,i);if(null==r||"00000000"!=r.ResultNo)o.lock(),o.noData(),o.resetload();else{a+=1;var n=t.SetCommentHtml(r,e);i>r.Data.length&&(o.lock(),o.noData()),setTimeout(function(){$("#ArticleDetailCommentList").append(n),o.resetload()},1e3)}}})})}},Article_Forward=new function(){function e(e,t,a,i,o,r,n,l){this.BaseId=e,this.ForwardId=t,this.Type=a,this.Content=i,this.ProvinceId=o,this.CityId=r,this.DistrictId=n,this.Token=l}var t=!1;this.PageIntit=function(e,t){if(""==t)return void Global_PopupHelper.alert({title:"转发类型不存在",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}});$("#ForwardContent").attr("placeholder",Global_MessageHelper.FowardPlaceholder);var i=a.GetApiDate(e,t);if("00000000"==i.ResultNo){var o=Global_ForwardHelper.GetForwardHtml(i.ForwardBase);""==o?Global_PopupHelper.alert({title:"数据已经被删除",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):$("#ReleaseContent").append(o)}else Global_PopupHelper.alert({title:"数据已经被删除",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}})},this.PageFun=function(a,i,o){$("#ForwardAddress").on("click",function(){Global_GeoCoderHelper.ShowCorePage("ReleaseContent",0,"",1),Global_GeoCoderHelper.AddressDocumentName="ForwardAddress"}),Global_GeoCoderHelper.GetGeoCoder("ForwardAddress"),$("#Forward_submit").on("tap",function(r){if(r.preventDefault(),!t){t=!0;var n=$.trim($("#ForwardContent").val()),l=$("#ForwardAddress").attr("data-Province"),s=$("#ForwardAddress").attr("data-City"),d=$("#ForwardAddress").attr("data-District");if(""==n)return Global_PopupHelper.alert({title:Global_MessageHelper.ContentEmpty,btnName:Global_MessageHelper.BtnTextEmpty}),void(t=!1);if(n.length<10)return Global_PopupHelper.alert({title:Global_MessageHelper.ContentNotEnough,btnName:Global_MessageHelper.BtnTextNotEnough}),void(t=!1);var c=new Global_BaseInfoHelper.GetToken,u=new e(a,i,o,n,l,s,d,c.Token);$.ajax({url:Global_ServiceUrlHelper.Article_BaseForward,type:"POST",data:{reqJson:JSON.stringify(u)},dataType:"json",success:function(e){e.ArticleBaseId>0?Global_PopupHelper.dialogautoclose({title:"发布成功",timer:"2000",confirmCallback:function(){$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Article/Detail/"+e.ArticleBaseId)}}):"undefined"!=typeof e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"发布失败",timer:"2000",type:"2"}),t=!1}})}})};var a={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Article_GetForwardByID,type:"POST",data:{reqJson:'{"BaseId":"'+e+'","Type":'+t+"}"},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a}}},Article_ImgHelper=new function(){var e,t=9;this.ArticleImgFun=function(a){function i(e,t,a){$("#aiiImg_"+a).attr("src",e.Path+"@!standard_square_s").attr("data-imgbaseid",e.ImgBaseId)}function o(e){Global_PopupHelper.alert({title:"图片上传失败，请重试"})}$("#aii_file").change(function(){var e=$("li[data-role='img']").length;if(e>=t)return void $("li[data-role='addfile']").hide();if(e+this.files.length>t)return void Global_PopupHelper.alert({title:"图片超过"+t+"张"});for(var r=0;r<this.files.length;r++){Global_ImgHelper.ZipAndUploadImg(this.files[r],1,1,i,o,a);var n='<li data-role="img" onclick="Article_ImgHelper.LiImgClick(this)"><img src="/Content/Images/loading.gif" id="aiiImg_'+a+'" /><span class="delimg" onclick="Article_ImgHelper.SpanDelImg(this)"></span></li>';$(".pic-group li:last").before(n),$("li[data-role='img']").length>=t&&$("li[data-role='addfile']").hide(),a++}}),$(".lightboxmask").on("tap","img",function(e){$(".content").show(),$(".lightboxmask").hide(),e.preventDefault()}),$(".lightboxback").on("tap",function(e){$(".content").show(),$(".lightboxmask").hide(),e.preventDefault()}),$(".lightboxdel").on("tap",function(a){Global_PopupHelper.confirm({title:"确定删除图片",confirmCallback:function(){e.remove(),$(".content").show(),$(".lightboxmask").hide();var a=$("li[data-role='img']").length;a<t&&$("li[data-role='addfile']").show()}}),a.preventDefault()})},this.SpanDelImg=function(e){window.event.stopPropagation(),$(e).parent().remove();var a=$("li[data-role='img']").length;a<t&&$("li[data-role='addfile']").show()},this.LiImgClick=function(t){var a=$(t).find("img").attr("src").replace("standard_square_s","standard_src_l");$("#lightboxPicSrc").attr("src",a),$(".lightboxmask").show(),$(".content").hide(),e=t},this.ChangeMaxImgCount=function(e){t=e}},Article_List=new function(){var e,t,a,i,o,r=1,n=0,l=0,s=0,d=12,c="";this.PageInit=function(p){e=new Global_BaseInfoHelper.GetToken,t=Global_BaseInfoHelper.CheckLogin(),s=0==!!p||"0"==p?Global_CommonHelper.GetQueryString("id"):p,a="",o="",i="";var h=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Article/list");null!=h.StorageData?(n=h.StorageData.silentScroll,$("#articleList").html(new Global_ReturnHelper.GetBlankPageHtml(n).Html),a=h.StorageData.ListDate,r=h.StorageData.pageIndex,l=h.StorageData.Total,h.StorageData.other&&h.StorageData.other.currentChannel&&(o=h.StorageData.other.currentChannel.key,i=h.StorageData.other.currentChannel.tagids)):Article_List.PageDataInit(),"G20_ArticleChannel_Rec"==o&&$(".searchbox").show(),$("#articleList").on("tap",".item a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Article/list","articleList",r,l,{currentChannel:{key:o,tagids:i}})}),$("#articleDroploadDiv").on("tap",".article-search-input",function(){$.mobile.changePage(window.location.origin+"/Search/Vague")}),$("#articleDroploadDiv").on("swipe",".article-search",function(){$(".article-search").slideDown()}),$("#List_Release").on("tap",function(){t?$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Article/Release"):$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+Global_ServiceUrlHelper.CurrentDomain+"/Article/List")}),$("#search_video").keydown(function(e){if(13==e.keyCode){if(e.preventDefault(),c=$(".laibei_page:last #search_video").val().replace(/[ ]/g,""),""==c)return!1;r=1;var t=u.GetVideoDate(c,r,d);if("00000000"==t.ResultNo){var a=u.VideoStrBuilder(t);l=t.Total,$("#articleList").html(a),0==l&&$("#articleList").html(Article_List.NoDataTip("暂时没有视频哦")),l<=d?$(".dropload-down").hide():$(".dropload-down").show()}}})},this.PageDataInit=function(){r=1,a="",n=0;var e="暂时没有说说哦",t="";if(""==o&&s<=0||"VideoList"==o){var i=u.GetVideoDate("",r,d);if("00000000"==i.ResultNo){var c=u.VideoStrBuilder(i);t+=c,l=i.Total,e="暂时没有视频哦",$(".videosearchbox").show()}}else{if(s>0&&1==r&&(""==o||"G20_ArticleChannel_Rec"==o)){var i=u.GetFirstDate(s);"00000000"==i.ResultNo&&(t=u.GetArticleItemHtml(i))}var i=u.GetApiDate(r,d);if("00000000"==i.ResultNo){var c=u.ArticleStrBuilder(i);t+=c,l=i.Total}}$("#articleList").html(t),0==l&&$("#articleList").html(Article_List.NoDataTip(e))},this.PageScoll=function(){""!=a&&($.mobile.silentScroll(n),$("#articleList").html(a))},this.ProductDropload=function(){Article_List.dropload=$("#articleDroploadDiv").dropload({scrollArea:window,loadDownFn:function(e){if(l>0){r+=1;var t;if(t=""==o&&s<=0||"VideoList"==o?u.GetVideoDate(c,r,d):u.GetApiDate(r,d),null==t||"00000000"!=t.ResultNo)e.lock(),e.noData(),e.resetload();else{var a;l=t.Total,a=""==o&&s<=0||"VideoList"==o?u.VideoStrBuilder(t):u.ArticleStrBuilder(t),d>t.Data.length&&(e.lock(),e.noData()),a&&setTimeout(function(){$("#articleList #NoChannelProduct").remove(),$("#articleList").append(a),e.resetload()},1e3)}}l<=d?$(".dropload-down").hide():$(".dropload-down").show()}})};var u={GetApiDate:function(t,a){var r=null;return $.ajax({url:Global_ServiceUrlHelper.Article_GetBaseList,type:"POST",data:{reqJson:'{"contentKey":"","pageIndex":"'+t+'","pageSize":"'+a+'","Token":"'+e.Token+'","TagIds":"'+i+'","ChannelKey":"'+o+'"}'},dataType:"json",async:!1}).done(function(e){r=e}).fail(function(){console.log("请求发生异常")}),r},GetVideoDate:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Video_GetBaseList,type:"POST",data:{reqJson:'{"Video_Title":"'+e+'","pageIndex":"'+t+'","pageSize":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},GetFirstDate:function(t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Article_GetBaseById,type:"POST",data:{reqJson:'{"ArticleBaseId":"'+t+'","Token":"'+e.Token+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},ArticleStrBuilder:function(e){for(var t="",a=(Global_ServiceUrlHelper.CurrentDomain,0);a<e.Data.length;a++)t+=u.GetArticleItemHtml(e.Data[a]);return t},GetArticleItemHtml:function(e){var a="",i=Global_ServiceUrlHelper.CurrentDomain,o="",r="oneimg",n=i+"/Article/Detail/"+e.ArticleBaseId,l="转发",s="评论",d="赞",c="unlikeicon";if(e.IsCurrentUserPraise&&(c="likeicon"),"0"!=e.ForwardCount&&(l=e.ForwardCount),"0"!=e.CommentCount&&(s=e.CommentCount),"0"!=e.PraiseCount&&(d=Global_CommonHelper.GetShowCount(e.PraiseCount)),null!=e.ImgList&&e.ImgList.length>0){if(e.ImgList.length>1){r="moreimg thumb",o+='<div class="productimg '+r+'">';for(var u=0;u<e.ImgList.length;u++)o+='<img src="'+e.ImgList[u].Path+'@!standard_square_m" />'}else o+='<div class="productimg '+r+'">',o+='<img src="'+e.ImgList[0].Path+'@!standard_rectangle_m" />';o+="</div>"}var p=p=Global_ForwardHelper.GetForwardUrl(e.ArticleBaseId,!0,e.ForwardBase),h=Global_CommonHelper.SetUrlFormat(e.Content);return a='<li class="item" id="hashitem_'+e.ArticleBaseId+'"><div class="info clearfix"><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.CreateUserId+'"><div class="avatar '+Global_CommonHelper.GetCategoryClass(e.Category)+'"><img src="'+e.CreateUserFaceImage+'"/></div><div class="nickname"><p class="name">'+e.CreateUserName+'<span></span></p><p class="time">'+e.CreateTime+'</p></div></a></div><a href="'+n+'">'+o+'<div class="detail"><p class="ellipsis">'+h+"</p></div></a>"+Global_ForwardHelper.GetForwardHtml(e.ForwardBase)+'<div class="extend bordertop"><div class="location">来自'+e.CityName+'</div><div class="spread"><span class="title_forward"><a class="ArticleListForwardUrl" onclick="Global_ForwardHelper.ForwardMethod(this)" href="#" data-islogin="'+t+'" data-href="'+p+'"><i class="iconfont">&#xe610; </i>'+l+'</a></span><span class="title_comment" onclick="Global_CommentHelper.Comment(this)" data-isarticle="true"  data-id="'+e.ArticleBaseId+'"><i class="iconfont">&#xe626; </i>'+s+'</span><span class="title_like"  onclick="Article_List.ArticlePraise(this)" data-id="'+e.ArticleBaseId+'" data-isarticle="true"><i class="'+c+'"></i>'+d+"</span></div></div></li>"},VideoStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){var o=parseInt(e.Data[i].Video_TimeLength/60),r=parseInt(e.Data[i].Video_TimeLength%60);o<10&&(o="0"+o),r<10&&(r="0"+r),t+='<li class="video"><div class="video-item"><img class="video-play" src="'+a+'/Content/Images/video-play.png"  data-path="'+e.Data[i].VideoPath+'" data-cover="'+e.Data[i].ImgPath+'" data-id="'+e.Data[i].VideoBaseID+'" onclick="Article_List.PalyVideo(this)"/><img src="'+e.Data[i].ImgPath+'" /></div><p class="video-desc">'+e.Data[i].Video_Title+'</p><span class="video-time">'+o+":"+r+"</span></li>";
}return t}};this.PalyVideo=function(e){$(e).parent().find("img").hide();var t=$(e).attr("data-path"),a=$(e).attr("data-cover"),i="video_"+$(e).attr("data-id");$(e).parent().parent().find("span").hide(),$("#"+i).length<=0?$(e).parent().append('<video  id="'+i+'" controls src="'+t+'" width="100%"  data-path="'+t+'" data-id="'+$(e).attr("data-id")+'" data-cover="'+a+'" onpause="Article_List.pauseFunction(this)" onseeking="Article_List.Seeking(this)"></video>'):$(e).parent().find("video").show();var o=document.getElementById(i);o.play()},this.Seeking=function(e){$(e).parent().find("img").hide()},this.pauseFunction=function(e){$(e).parent().find("img").show(),$(e).parent().parent().find("span").show()},this.ArticlePraise=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=Global_CommonHelper.ArticlePraise(e);if(null!=t)if("undefined"!=typeof t&&"00000000"==t.ResultNo)t.IsAdd?$(e).html('<i class="likeicon"></i>'+Global_CommonHelper.GetShowCount(t.PraiseCount)):0==t.PraiseCount?$(e).html('<i class="unlikeicon"></i>赞'):$(e).html('<i class="unlikeicon"></i>'+Global_CommonHelper.GetShowCount(t.PraiseCount));else{var a="操作失败";"undefined"!=typeof t.ResultRemark&&(a=t.ResultRemark),Global_PopupHelper.alert({title:a})}}})},this.NoDataTip=function(e){var t="";return t+='<div class="noorder" id="NoChannelProduct" style="display: block;">',t+='            <img src="/Content/Images/emptyorder.png">',t+="            <p>"+e+"</p>",t+="        </div>"},this.ArticleChannels={Show:function(){var e=new Global_ReturnHelper.GetArticleChannelFromStorage,t="";if(e.StorageData&&(t=Article_List.ArticleChannels.GenerateHtml(JSON.parse(e.StorageData))),t)$("#productChannels").html(t).show(),Article_List.ArticleChannels.TapEvent();else{var a=Global_ServiceUrlHelper.Article_Channels,i={reqJson:"{}"};$.post(a,i,function(e){t=Article_List.ArticleChannels.GenerateHtml(e),$("#productChannels").html(t).show(),Article_List.ArticleChannels.TapEvent(),new Global_ReturnHelper.SetArticleChannelToStorage(e)},"json")}},GenerateHtml:function(e){if(!e)return"";var t="";if(null!=e&&e.length>0){var a=-1;$.each(e,function(e,t){if(t.Key==o)return void(a=e)}),s>0&&(""==o||"G20_ArticleChannel_Rec"==o)&&(a=0),t+="<li class='ui-block-a'><a class='ui-link ui-btn ui-link-channel "+(a==-1?"ui-btn-active":"")+"' data-key='VideoList' data-id='0' data-tagids=''>视频</a></li>",$.each(e,function(e,i){t+="<li class='ui-block-a'><a class='ui-link ui-btn ui-link-channel "+(e==a?"ui-btn-active":"")+"' data-key='"+i.Key+"' data-id='"+i.Id+"' data-tagids='"+i.TagIds+"'>"+i.Name+"</a></li>"})}return t},TapEvent:function(){$("#articleDroploadDiv").on("tap",".ui-link-channel",function(){var e=$(this);$("a.ui-link").removeClass("ui-btn-active"),e.addClass("ui-btn-active"),i=e.attr("data-tagids"),o=e.attr("data-key"),Article_List.PageDataInit(),Article_List.dropload.direction="up",Article_List.dropload.noData(!1),Article_List.dropload.unlock(),Article_List.dropload.resetload(),Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Article/list","articleList",r,l,{currentChannel:{key:o,tagids:i}}),"G20_ArticleChannel_Rec"==o?$(".searchbox").show():$(".searchbox").hide(),"VideoList"==o?$(".videosearchbox").show():$(".videosearchbox").hide()})}}},Article_Release=new function(){function e(e,t,a,i,o,r,n){this.Content=e,this.ProvinceId=t,this.CityId=a,this.DistrictId=i,this.Tag=o,this.Img=r,this.Token=n}this.ArticleFun=function(){var t=0;Global_TagHelper.SetTagList("1","j_tag"),Global_TagHelper.TagFun("j_tag"),$(".address").on("click",function(){Global_GeoCoderHelper.ShowCorePage("ReleaseContent",0,"",1),Global_GeoCoderHelper.AddressDocumentName="address"}),Article_ImgHelper.ArticleImgFun(t),Global_GeoCoderHelper.GetGeoCoder("address"),$("#Article_Release_submit").on("tap",function(){$("#Article_Release_submit").attr("disabled",!0);var t=$.trim($(".evaluate").val()),a=$("#address").attr("data-Province"),i=$("#address").attr("data-City"),o=$("#address").attr("data-District"),r=$(".tagchecked"),n="";$.each(r,function(e,t){n+=$(t).attr("data-id")+","});var l=$("li[data-role='img']"),s="";if($.each(l,function(e,t){s+=$(t).find("img").attr("data-imgbaseid")+","}),""==t)return Global_PopupHelper.alert({title:Global_MessageHelper.ContentEmpty,btnName:Global_MessageHelper.BtnTextEmpty}),void $("#Article_Release_submit").removeAttr("disabled");if(t.length<10)return Global_PopupHelper.alert({title:Global_MessageHelper.ContentNotEnough,btnName:Global_MessageHelper.BtnTextNotEnough}),void $("#Article_Release_submit").removeAttr("disabled");if(""==n.replace(",",""))return Global_PopupHelper.alert({title:Global_MessageHelper.TagEmpty,btnName:Global_MessageHelper.BtnTextNotCheck}),void $("#Article_Release_submit").removeAttr("disabled");var d=new Global_BaseInfoHelper.GetToken,c=new e(t,a,i,o,n,s,d.Token);$.ajax({url:Global_ServiceUrlHelper.Article_Add,type:"POST",data:{reqJson:JSON.stringify(c)},dataType:"json",success:function(e){"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"发布成功",timer:"2000",confirmCallback:function(){$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Article/Detail/"+e.ArticleBaseId)}}):"undefined"!=typeof e.ResultRemark?(Global_PopupHelper.alert({title:e.ResultRemark}),$("#Article_Release_submit").removeAttr("disabled")):(Global_PopupHelper.dialogautoclose({title:"发布失败",timer:"2000",type:"2"}),$("#Article_Release_submit").removeAttr("disabled"))}})}),$("#PromptTopBack").on("tap",function(e){e.preventDefault();var t=$(".evaluate").val();$(".evaluate").blur(),""==t?Global_ReturnHelper.AllowPageReturnHistory():Global_ReturnHelper.EditPageReturn()})}},Home_Channel=new function(){this.SetDownLoadAddressByType=function(){var e=navigator.userAgent,t=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),a=e.indexOf("Android")>-1||e.indexOf("Adr")>-1;1==t&&$("#download_app").attr("href","https://itunes.apple.com/us/app/95lai-bei/id1141843861"),1==a&&$("#download_app").attr("href","http://www.95laibei.com/apk/LaiBeiV1.1.30_OW.apk")},this.ShowMask=function(){Global_WeiXinHelper.IsWXBrowser()?$("#sectionWeChat").css("display","block"):$("#sectionBrowser").css("display","block")}},Home_Index=new function(){var e;this.SetHeade=function(){var e="",t="";if(Global_WeiXinHelper.IsWXBrowser()?(e="立即关注",t=" 关注95来呗 随时查订单领福利"):(e="立即下载",t=" 95来呗 - 关爱儿童安全健康成长"),!Global_ApicloudHelper.IsApp()){var a='<div class="appdl" id="headMenu"><div class="left"><img src="http://cdn.sys.img.95laibei.com/Optimization/Images/delete1.png" class="del" onclick="Home_Index.Close()" /><img src="http://cdn.sys.img.95laibei.com/Optimization/Images/logo_2x.png" class="logo" />'+t+'</div> <a id="aOper" href="javascript:void(0)" class="right" onclick="Home_Index.DownLoad()">'+e+"</a> </div>",i=new Global_StorageHelper.GetLocalToStorage("IsClose");if(void 0!=i){var o=i.StorageData;null==o&&($("div").hasClass("appdl")||($("#topwrap").before(a),$("#mainContent").css("margin-top","2rem"),Home_Index.WindowScroll()))}else $("#topwrap").before(a),$("#mainContent").css("margin-top","2rem"),Home_Index.WindowScroll()}},this.PageInit=function(){if($("#Home_Index_Main").hide(),e=Global_BaseInfoHelper.CheckLogin(),Global_ApicloudHelper.IsApp()){var t="",a=new Global_StorageHelper.GetLocalToStorage("AppVersion");null!=a.StorageData&&(t=a.StorageData),apiready=function(){t=api.appVersion,Global_StorageHelper.SetLocalToStorage("AppVersion",t)};var i=new Global_StorageHelper.GetLocalToStorage("IsFirst");if(null==i.StorageData||i.StorageData!=t){var o='<div class="swiper-start"><div class="swiper-wrapper"><div class="swiper-slide"><img src="http://cdn.sys.img.95laibei.com/Content/Images/start01.jpg" alt="" /></div><div class="swiper-slide"><img src="http://cdn.sys.img.95laibei.com/Content/Images/start02.jpg" alt="" /></div><div class="swiper-slide"><img src="http://cdn.sys.img.95laibei.com/Content/Images/start03.jpg" alt="" /><a id="skip" onclick="Home_Index.Skip();"  data-role="none">进入来呗</a></div></div><div class="swiper-pagination swiper-pagination-red"></div></div>';$(o).appendTo("body");new Swiper(".swiper-start",{slidesPerView:1,speed:400,pagination:".swiper-pagination"})}else Home_Index.ShowMain()}else Home_Index.ShowMain()},this.WindowScroll=function(){var e=window.screen.width;$(document).ready(function(){$(window).scroll(function(){var t=new Global_StorageHelper.GetLocalToStorage("IsClose"),a=t.StorageData,i=document.body.scrollTop;i>e/7.5?$(".appdl").length>0&&($(".appdl").hide(),$('[role="main"]').css("margin-top","1rem")):$(".appdl").length>0&&1!=a&&($(".appdl").show(),$('[role="main"]').css("margin-top","2rem"))})})},this.Close=function(){Global_StorageHelper.SetDataToStorage("IsClose",1,Global_ServiceUrlHelper.UserSearchExpTime),$("#headMenu").remove(),$("#mainContent").css("margin-top","1rem")},this.DownLoad=function(){var e=Global_ServiceUrlHelper.CurrentDomain+"/Home/Channel";$.mobile.changePage(e)},this.HeadLine=function(){$(function(){function e(){o/100==i&&(t.removeClass("sss"),t.css("transform","translateY(0)"),o=0),100==o&&t.addClass("sss"),t.css("transform","translateY(-"+o+"%)"),o+=100}var t=($("#headline"),$(".line").eq(0)),a=t.find("li").length,i=a%2==0?a/2:(a+1)/2,o=(Math.floor(document.documentElement.clientWidth/15),100);setInterval(e,4e3)})},this.Skip=function(){$(".swiper-start").remove(),Home_Index.ShowMain();var e=Global_ApicloudHelper.get_appVersion();Global_StorageHelper.SetLocalToStorage("IsFirst",e)},this.ShowMain=function(){$("#Home_Index_Main").show();new Swiper(".swiper-container",{loop:!0,speed:400,autoplay:3e3,pagination:".swiper-pagination",paginationClickable:!0,autoplayDisableOnInteraction:!1}),new Swiper(".swiper-ad",{slidesPerView:3,paginationClickable:!0,spaceBetween:10})}},My_About=new function(){var e=imPublic.enum;this.ChangePage=function(){var e=new Global_StorageHelper.GetLocalToStorage("SiteAccesslocalStorage"),t=new Global_StorageHelper.GetSessionToStorage("Conversation");if(null!=e.StorageData){var a=null!=t.StorageData?t.StorageData:"",i=JSON.parse(e.StorageData),o="版本识别码:"+i.AppChannel+"|"+i.AppType+"|"+i.AppVersion+"|"+a+"|"+i.GUID;$("#App_Ver").html(o)}},this.getAssistantData=function(e){var t=this;$.ajax({type:"POST",url:Global_ServiceUrlHelper.IMServiceUrl+"/api/chatmessage/GetCustomerAssistant",data:{reqJson:JSON.stringify({ClientID:e})},success:function(e){t.initAssistantStatus(e.Content)},error:function(){console.log("请求客服当前状态失败！")}})},this.initAssistant=function(e){for(var t=0;t<e.length;t++)this.getAssistantData(e[t])},this.getUserStatusFromHtml=function(e){if(e){var t=parseInt(e.data("chatstatus"));if(!isNaN(t))return t}return 0},this.initAssistantStatus=function(t){var a=t.ChatStatus,i=$("#assistant_"+t.ClientID);if(t.UserCategory==e.UserCategory.CustomerAssistant&&i.length>0){var o=this.getUserStatusFromHtml(i);if(o!=a){i.data("chatstatus",a);var r=i.data("assistant-name");a==e.UserStatus.Online?(i.find(".statusImg").attr("src","http://cdn.sys.img.95laibei.com/Content/Images/"+r+"_online.png"),i.find(".statusTxt").html("在线")):a==e.UserStatus.Offline&&(i.find(".statusImg").attr("src","http://cdn.sys.img.95laibei.com/Content/Images/"+r+"_offline.png"),i.find(".statusTxt").html("离线"))}}}},My_AddAddress=new function(){var e=Global_ServiceUrlHelper.MobileCheckStr;this.AddAddressIntit=function(a){var i=!1,o=!1,r=1,n="",l="";if("0"!=a){var s=t.GetApiDate(a);null!=s&&"00000000"==s.ResultNo?($("#MyAddAddressRealName").val(s.RealName),$("#MyAddAddressMobile").val(s.Mobile),$("#MyAddAddressCoder").attr("data-Province",s.ProvinceId).attr("data-City",s.CityId).attr("data-District",s.DistrictId).html(s.CityName),$("#MyAddAddressFullAddress").val(s.FullAddress),i=s.IsDefault,r=s.OrderNo,n=s.Phone,l=s.Postcode):Global_PopupHelper.alert({title:"数据获取失败，请重试"})}else Global_GeoCoderHelper.GetGeoCoder("MyAddAddressCoder");$("#MyAddAddressCoder").on("click",function(e){e.preventDefault(),Global_GeoCoderHelper.ShowCorePage("ReleaseContent",0,"",1),Global_GeoCoderHelper.AddressDocumentName="MyAddAddressCoder"}),$("#confirmBtn").on("tap",function(t){if(t.preventDefault(),!o){o=!0;var s=$.trim($("#MyAddAddressRealName").val()),d=$.trim($("#MyAddAddressMobile").val()),c=$("#MyAddAddressCoder").attr("data-Province"),u=$("#MyAddAddressCoder").attr("data-City"),p=$("#MyAddAddressCoder").attr("data-District"),h=$.trim($("#MyAddAddressFullAddress").val());if(""==s)return Global_PopupHelper.alert({title:"收货人不能为空"}),void(o=!1);if(s.length<1||s.length>20)return Global_PopupHelper.alert({title:"请填写正确的收货人1-20个字符"}),void(o=!1);if(""==d)return Global_PopupHelper.alert({title:"手机号码不能为空"}),o=!1,!1;if(!e.test(d))return Global_PopupHelper.alert({title:"请填写正确的手机号码"}),o=!1,!1;if(parseInt(p)<1)return Global_PopupHelper.alert({title:"请选择省市区"}),void(o=!1);if(""==h)return Global_PopupHelper.alert({title:"详细地址不能为空"}),void(o=!1);if(h.length<1||h.length>50)return Global_PopupHelper.alert({title:"请填写正确的详细地址"}),void(o=!1);var m=new Global_BaseInfoHelper.GetToken,g=new AddressModel(a,i,r,s,d,n,h,c,u,p,l,m.Token);$.ajax({url:Global_ServiceUrlHelper.Account_AddConsignee,type:"POST",data:{reqJson:JSON.stringify(g)},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"保存成功",timer:"2000",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):(Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),o=!1)}})}})};var t={GetApiDate:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetConsigneeById,type:"POST",data:{reqJson:'{"ConsigneeId":'+e+"}"},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t}};AddressModel=function(e,t,a,i,o,r,n,l,s,d,c,u){this.ConsigneeId=e,this.IsDefault=t,this.OrderNo=a,this.RealName=i,this.Mobile=o,this.Phone=r,this.FullAddress=n,this.ProvinceId=l,this.CityId=s,this.DistrictId=d,this.Postcode=c,this.Token=u}},My_AddressManage=new function(){var e=!1,t=new Global_BaseInfoHelper.GetToken,a=0;this.AddressManageIntit=function(e,o,r){t=new Global_BaseInfoHelper.GetToken;var n=i.GetApiDate(e,o);if(null!=n&&"00000000"==n.ResultNo)if(a=n.Total,a>0){var l=i.AddressStrBuilder(n,r);$("#MyAddressManageList").html(l),$("#NoAddress").remove()}else $("#NoAddress").show();else $("#NoAddress").show()},this.AddressManageFun=function(){$("#OnlySureConfirm").on("tap",function(e){e.preventDefault();var t=Global_ServiceUrlHelper.CurrentDomain+"/My/AddAddress";$.mobile.changePage(t)})},this.MyAddressManageDropload=function(e,t,o){a<=20||$(function(){$("#MyAddressManageList").dropload({scrollArea:window,loadDownFn:function(a){var r=i.GetApiDate(e,t);if(null==r||"00000000"!=r.ResultNo)a.lock(),a.noData(),a.resetload();else{e+=1;var n=i.AddressStrBuilder(r,o);t>r.Data.length&&(a.lock(),a.noData()),setTimeout(function(){$("#MyAddressManageList").append(n),a.resetload()},1e3)}}})})},this.SetDefault=function(a,i){var o=$(i.firstChild);e||(e=!0,o.hasClass("checked")?e=!1:$.ajax({url:Global_ServiceUrlHelper.Account_SetConsigneeIsDefault,type:"POST",data:{reqJson:'{"ConsigneeId":'+a+',"Token":"'+t.Token+'"}'},dataType:"json",success:function(t){"undefined"!=typeof t.ResultNo&&"00000000"==t.ResultNo&&($(".setdefault.checked").removeClass("checked").addClass("unchecked"),o.removeClass("unchecked").addClass("checked")),e=!1}}))},this.RemoveConsignee=function(a,i){var o=$(i);e||(e=!0,Global_PopupHelper.confirm({title:"确定要删除地址吗？",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Account_RemoveConsignee,type:"POST",data:{reqJson:'{"ConsigneeId":'+a+',"Token":"'+t.Token+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"删除成功",timer:"2000",confirmCallback:function(){o.parent().parent().parent().remove()}}):Global_PopupHelper.dialogautoclose({title:"删除失败",timer:"2000",type:"2"})}})}}),e=!1)},this.ChooseAddress=function(e,t){Global_StorageHelper.SetSessionToStorage("ChooseConsigneeId",t),""!=e&&$.mobile.changePage(e)};var i={GetApiDate:function(e,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetConsigneeByMbrBaseId,type:"POST",data:{reqJson:'{"Token":"'+t.Token+'","pageIndex":'+e+',"pageSize":'+a+"}"},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},AddressStrBuilder:function(e,t){for(var a="",i="",o=0;o<e.Data.length;o++){var r="unchecked";1==e.Data[o].IsDefault&&(r="checked"),i=Global_ServiceUrlHelper.CurrentDomain+"/My/AddAddress/"+e.Data[o].ConsigneeId,a+='<section class="confirmadd addlist"><div class="addinfo borderbottom"><div class="line"><span class="name">收货人: <span>'+e.Data[o].RealName+'</span></span><span class="tel">'+e.Data[o].Mobile+'</span></div><a href="#" onclick="My_AddressManage.ChooseAddress(\''+t+"',"+e.Data[o].ConsigneeId+')"><div class="para">'+e.Data[o].FullAddress+'</div></a></div><div class="handle clearfix"><div class="left" onclick="My_AddressManage.SetDefault('+e.Data[o].ConsigneeId+',this)"><label class="setdefault '+r+'" ></label> 默认地址</div><div class="right"><a href="'+i+'" class="edit" ><span class="iconfont">&#xe610;</span> 编辑</a> <a href="#" class="del" onclick="My_AddressManage.RemoveConsignee('+e.Data[o].ConsigneeId+',this)"><span class="iconfont">&#xe632;</span> 删除</a></div></div></section>'}return a}}},My_Article=new function(){var e,t,a=!1,i=2,o="",r=0,n=0,l={GetApiDate:function(t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Article_GetBaseListByUserId,type:"POST",data:{reqJson:'{"Token":"'+e.Token+'","pageIndex":"'+t+'","pageSize":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},ListStrBuilder:function(e){for(var a=Global_ServiceUrlHelper.CurrentDomain,i="",o=0;o<e.Data.length;o++){var r="",n="oneimg",l=a+"/Article/Detail/"+e.Data[o].ArticleBaseId,s=a+"/Article/Change/"+e.Data[o].ArticleBaseId,d="",c=Global_ServiceUrlHelper.CurrentDomain+"/Content/Images/wxshare.jpg";if(null!=e.Data[o].ImgList){var u="";e.Data[o].ImgList.length>1?(n="moreimg thumb",u="@!standard_square_m"):u="@!standard_rectangle_m";for(var p=0;p<e.Data[o].ImgList.length;p++)r+='<img src="'+e.Data[o].ImgList[p].Path+u+'" alt="" />';e.Data[o].ImgList.length>0&&(c=e.Data[o].ImgList[0].Path+"@!standard_square_s")}null==e.Data[o].ForwardBase&&(d='<a href="'+s+'" data-role="none">编辑</a>');var h=Global_CommonHelper.SetUrlFormat(e.Data[o].Content);i+='<li class="item" id="hashitem_'+e.Data[o].ArticleBaseId+'"><a href="'+l+'"><div class="detail"><pre class="ellipsis">'+h+'</pre></div><div class="productimg '+n+'">'+r+"</div></a>"+Global_ForwardHelper.GetForwardHtml(e.Data[o].ForwardBase)+'<div class="extend qxp"><div class="left"><span>'+e.Data[o].CommentCount+" </span>评论&nbsp;&nbsp;&nbsp;&nbsp;<span>"+Global_CommonHelper.GetShowCount(e.Data[o].PraiseCount)+' </span>赞</div><div class="right">'+e.Data[o].CreateTime+'</div></div><div class="bordertop sharemorebtn"><a class="myArticleDel" data-id="'+e.Data[o].ArticleBaseId+'" data-role="none">删除</a>'+d;var m=t.Nickname+"的说说",g=e.Data[o].Content;i+='<a data-role="none" onclick="Global_ShareHelper.MyArticleProductShare(this)" data-shareimg="'+c+'" data-shareContent="'+g+'"  data-sharelink="'+l+'" data-sharetitle="'+m+'" >分享</a></div></li>'}return i}};this.PageInit=function(){e=new Global_BaseInfoHelper.GetToken,t=Global_BaseInfoHelper.GetLoginInfo();var s=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/My/Article");if(null!=s.StorageData)r=s.StorageData.silentScroll,$("#NoMyArticle").remove(),$("#myArticleList").html(new Global_ReturnHelper.GetBlankPageHtml(r).Html),o=s.StorageData.ListDate,i=s.StorageData.pageIndex,n=s.StorageData.Total;else{i=2,o="",r=0;var d=l.GetApiDate(1,20);if("00000000"==d.ResultNo){n=d.Total;var c=l.ListStrBuilder(d);$("#myArticleList").html(c),n>0?$("#NoMyArticle").remove():$("#NoMyArticle").show()}else $("#NoMyArticle").show()}$("#myArticleList").on("tap",".myArticleDel",function(t){if(t.preventDefault(),!a){a=!0;var i=$(this).attr("data-id"),o=this;Global_PopupHelper.confirm({title:"确定删除说说",confirmCallback:function(){var t=new ArticleDelModel(i,e.Token);$.ajax({url:Global_ServiceUrlHelper.Article_DelBase,type:"POST",data:{reqJson:JSON.stringify(t)},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.StatusNo?Global_PopupHelper.dialogautoclose({title:"删除成功",timer:"2000",confirmCallback:function(){$(o).parent().parent(".item").remove()}}):Global_PopupHelper.dialogautoclose({title:"删除失败",timer:"2000",type:"2"}),a=!1}})}}),a=!1}}),$("#myArticleList").on("tap",".item a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/My/Article","myArticleList",i,n)})},this.PageScoll=function(){""!=o&&($.mobile.silentScroll(r),$("#myArticleList").html(o))},this.MyArticleDropload=function(e){n<=20||$(function(){$("#myArticleDroploadDiv").dropload({scrollArea:window,loadDownFn:function(t){var a=l.GetApiDate(i,e);if(null==a||"00000000"!=a.ResultNo)t.lock(),t.noData(),t.resetload();else{i+=1;var o=l.ListStrBuilder(a);e>a.Data.length&&(t.lock(),t.noData()),setTimeout(function(){$("#myArticleList").append(o),t.resetload()},1e3)}}})})},ArticleDelModel=function(e,t){this.ArticleBaseId=e,this.Token=t}},My_Attention=new function(){var e=new Global_BaseInfoHelper.GetToken,t=0,a=2,i="",o=0,r=0,n={GetApiDate:function(t,a,i){var o=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetAttrntionList,type:"POST",data:{reqJson:'{"Type":0,"UserId":"'+t+'","pageIndex":"'+a+'","pageSize":"'+i+'","Token":"'+e.Token+'"}'},dataType:"json",async:!1}).done(function(e){o=e}).fail(function(){console.log("请求发生异常")}),o},ListStrBuilder:function(e){var a=(Global_ServiceUrlHelper.CurrentDomain,""),i=e.Data.length;if(i<1)$("#NoAttention").show();else{$("#NoAttention").remove();for(var o=0;o<i;o++){var r="已关注",n="cancern",l="";t!=e.Data[o].ID&&(l='<button type="button" data-role="none" data-id="'+e.Data[o].ID+'" data-city="'+e.Data[o].CityName+'" data-carecount="'+e.Data[o].CareCount+'" data-isattention="'+e.Data[o].IsAttention+'" onclick="Search_Users.Attention(this)" class="addcancern '+n+'">'+r+"</button>"),a+='<li class="item" id="hashitem_'+e.Data[o].ID+'"><div class="info"><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.Data[o].ID+'"><div class="avatar '+Global_CommonHelper.GetCategoryClass(e.Data[o].Category)+'"><img src="'+e.Data[o].UserFaceImage+'" /></div><div class="nickname"><p class="name">'+e.Data[o].Nickname+'</p><p class="time" id="SearchUsersCare_'+e.Data[o].ID+'">粉丝:'+e.Data[o].CareCount+" | 来自"+e.Data[o].CityName+"</p></div></a></div>"+l+"</li>"}}return a}};this.PageInit=function(l,s){e=new Global_BaseInfoHelper.GetToken,t=l;var d=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/My/Attention/"+s);if(null!=d.StorageData)o=d.StorageData.silentScroll,$("#NoAttention").remove(),$("#AttentionUserList").html(new Global_ReturnHelper.GetBlankPageHtml(o).Html),i=d.StorageData.ListDate,a=d.StorageData.pageIndex,r=d.StorageData.Total;else{a=2,i="",o=0;var c=n.GetApiDate(s,1,20);if("00000000"==c.ResultNo){r=c.Total;var u=n.ListStrBuilder(c);$("#AttentionUserList").html(u)}else $("#NoAttention").show()}$("#AttentionUserList").on("tap",".item a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/My/Attention/"+s,"AttentionUserList",a,r)})},this.PageScoll=function(){""!=i&&($.mobile.silentScroll(o),$("#AttentionUserList").html(i))},this.UserDropload=function(e,t){r<=20||$(function(){$("#AttentionUsersDroploadDiv").dropload({scrollArea:window,loadDownFn:function(i){var o=n.GetApiDate(e,a,t);if(null==o||"00000000"!=o.ResultNo)alert("dsada"),i.lock(),i.noData(),i.resetload();else{a+=1;var r=n.ListStrBuilder(o);t>o.Data.length&&(i.lock(),i.noData()),setTimeout(function(){$("#AttentionUserList").append(r),i.resetload()},1e3)}}})})},this.Attention=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=$(e).attr("data-id"),a=$(e).attr("data-isattention"),i=$(e).attr("data-city"),o=Global_CommonHelper.BaseAttention(t);if(null!=o)if("undefined"!=typeof o&&"00000000"==o.ResultNo){var r=parseInt($(e).attr("data-carecount"));"true"==a?($(e).html("关注").attr("data-isattention","false").attr("data-carecount",r-1).removeClass("cancern"),$("#SearchUsersCare_"+t).html("粉丝:"+(r>0?r-1:0)+" | 来自"+i)):($(e).html("已关注").attr("data-isattention","true").attr("data-carecount",r+1).addClass("cancern"),$("#SearchUsersCare_"+t).html("粉丝:"+(r+1)+" | 来自"+i))}else{var n="操作失败";"undefined"!=typeof o.ResultRemark&&(n=o.ResultRemark),Global_PopupHelper.alert({title:n})}}})}},My_Bindset=new function(){var e={GetApiData:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetBindInfo,type:"POST",data:{reqJson:'{"Token":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t},RemoveBinding:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Account_RemoveBindingConnect,type:"POST",data:{reqJson:'{"Token":"'+t+'","Type":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},Binding:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Account_BindingConnect,type:"POST",data:{reqJson:'{"Type":"'+e+'","UnionId":"'+t+'","Token":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i}};this.PageInit=function(){var t=new Global_BaseInfoHelper.GetToken,a=e.GetApiData(t.Token);null!=a&&"undefined"!=typeof a.ResultNo&&"00000000"==a.ResultNo&&($("#wx_bind").attr("data-IsWxBind",a.IsWxBind),$("#qq_bind").attr("data-IsQQBind",a.IsQQBind),a.IsWxBind?($("#wx_span").html("绑定"),$("#wx_bind").html("解除绑定")):($("#wx_span").html(""),$("#wx_bind").html("立即绑定")),a.IsQQBind?($("#qq_span").html("绑定"),$("#qq_bind").html("解除绑定")):($("#qq_span").html(""),$("#qq_bind").html("立即绑定")))},this.BindFun=function(){var t=new Global_BaseInfoHelper.GetToken;$("#wx_bind").on("tap",function(a){function i(a){var i=e.Binding("1",a.unionid,t.Token);"undefined"!=typeof i.ResultNo&&"00000000"==i.ResultNo?($("#wx_span").html("绑定"),$("#wx_bind").html("解除绑定"),$("#wx_bind").attr("data-IsWxBind","true"),Global_PopupHelper.dialogautoclose({title:"绑定微信成功",timer:"2000",type:"1"})):"undefined"!=typeof i&&null!=i.ResultRemark?Global_PopupHelper.alert({title:i.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}a.preventDefault();var o=$(this).attr("data-IsWxBind");if("true"==o){var r=e.RemoveBinding("1",t.Token);null!=r&&"undefined"!=typeof r.ResultNo&&"00000000"==r.ResultNo?($("#wx_span").html(""),$("#wx_bind").html("立即绑定"),$("#wx_bind").attr("data-IsWxBind","false"),Global_PopupHelper.dialogautoclose({title:"解绑成功",timer:"2000",type:"1"})):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}else{var n=Global_ServiceUrlHelper.CurrentDomain+"/WeChat/Authorize?state=wxlogin";Global_WeiXinHelper.IsWXBrowser()?window.location.href=n:Global_ApicloudHelper.IsApp()?Global_ApicloudHelper.WX_getUserInfo(i):Global_PopupHelper.alert({title:"微信绑定请在app内或者微信内",btnName:"好的"})}}),$("#qq_bind").on("tap",function(a){function i(a){var i=e.Binding("2",a.openid,t.Token);"undefined"!=typeof i.ResultNo&&"00000000"==i.ResultNo?($("#qq_span").html("绑定"),$("#qq_bind").html("解除绑定"),$("#qq_bind").attr("data-IsQQBind","true"),Global_PopupHelper.dialogautoclose({title:"绑定QQ成功",timer:"2000",type:"1"})):"undefined"!=typeof i&&null!=i.ResultRemark?Global_PopupHelper.alert({title:i.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}a.preventDefault();var o=$(this).attr("data-IsQQBind");if("true"==o){var r=e.RemoveBinding("2",t.Token);null!=r&&"undefined"!=typeof r.ResultNo&&"00000000"==r.ResultNo?($("#qq_span").html(""),$("#qq_bind").html("立即绑定"),$("#qq_bind").attr("data-IsQQBind","false"),Global_PopupHelper.dialogautoclose({title:"解绑成功",timer:"2000",type:"1"})):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}else Global_ApicloudHelper.IsApp()?Global_ApicloudHelper.QQLogin(i):Global_PopupHelper.alert({title:"QQ绑定请在app内",btnName:"好的"})})}},My_BuyIn=new function(){var e=new Global_BaseInfoHelper.GetToken,t=!1,a=2,i=0;this.BuyInInit=function(){e=new Global_BaseInfoHelper.GetToken,a=2;var t=o.GetApiDate(1,20);if(null!=t&&"00000000"==t.ResultNo){i=t.Total;var r=o.ListStrBuilder(t);$("#MyBuyInList").html(r),$("#MyBuyInList").show(),i>0?$("#NoMyBuy").remove():$("#NoMyBuy").show()}else $("#MyBuyInList").remove(),$("#NoMyBuy").show()},this.MyBuyInDropload=function(e){i<=20||$(function(){$("#myBuyInDropload").dropload({scrollArea:window,loadDownFn:function(t){var i=o.GetApiDate(a,e);if(null==i||"00000000"!=i.ResultNo)t.lock(),t.noData(),t.resetload();else{a+=1;var r=o.ListStrBuilder(i);e>i.Data.length&&(t.lock(),t.noData()),setTimeout(function(){$("#MyBuyInList").append(r),t.resetload()},1e3)}}})})};var o={GetApiDate:function(t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetMyList,type:"POST",data:{reqJson:'{"Token":"'+e.Token+'","pageIndex":"'+t+'","pageSize":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},ListStrBuilder:function(e){for(var t=Global_ServiceUrlHelper.CurrentDomain,a="#",i="#",o="",r="#",n="#",l="#",s=0;s<e.Data.length;s++){var d="",c="",u="";a=t+"/Order/BuyDetail/"+e.Data[s].OrderBaseId,i=t+"/Order/ApplyRefund/"+e.Data[s].OrderBaseId,r=t+"/Order/Express/"+e.Data[s].OrderBaseId,n=t+"/My/Points",l=t+"/Order/RefundHistory/"+e.Data[s].OrderBaseId,1==e.Data[s].OrderStatus?1==e.Data[s].PayStatus?(d="等待买家付款",c='<li><a onclick="Global_OrderHelper.PageToGoodsPay('+e.Data[s].OrderBaseId+')" href="#">我要付款</a></li><li data-id="'+e.Data[s].OrderBaseId+'" onclick="My_BuyIn.CancleOrdel(this)">关闭交易</li>'):2==e.Data[s].PayStatus?1==e.Data[s].ExpressStatus?(d="等待卖家发货",c='<li date-id="'+e.Data[s].OrderBaseId+'" onclick="My_BuyIn.ReminderDelivery(this)">提醒发货</li><li><a href="'+i+'">我要退款</a></li>'):2==e.Data[s].ExpressStatus?(d="等待买家收货",c=e.Data[s].IsLineExpress?'<li><a href="'+i+'">我要退款</a></li><li onclick="My_BuyIn.ConfirmExpress(this)" data-id="'+e.Data[s].OrderBaseId+'" data-price="'+e.Data[s].PointsQuantity+'">确认收货</li>':'<li><a href="'+i+'">我要退款</a></li><li><a href="'+r+'">查看物流</a></li><li onclick="My_BuyIn.ConfirmExpress(this)" data-id="'+e.Data[s].OrderBaseId+'" data-price="'+e.Data[s].PointsQuantity+'">确认收货</li>'):3==e.Data[s].ExpressStatus&&(d="交易成功",c='<li><a href="'+n+'">查看贝壳</a></li>'):3==e.Data[s].PayStatus?(d="退款中",c='<li onclick="My_BuyIn.CancelRefund(this)" data-islineexpress="'+e.Data[s].IsLineExpress+'" data-id="'+e.Data[s].OrderBaseId+'" data-status="'+e.Data[s].ExpressStatus+'">撤销申请</li><li><a href="'+l+'">退款详情</a></li>'):4==e.Data[s].PayStatus&&(d="退款成功",c='<li><a href="'+l+'">退款详情</a></li><li><a href="'+n+'">查看贝壳</a></li>'):2==e.Data[s].OrderStatus?4==e.Data[s].PayStatus?(d="退款成功",c='<li><a href="'+l+'">退款详情</a></li><li><a href="'+n+'">查看贝壳</a></li>'):(d="交易成功",c='<li><a href="'+n+'">查看贝壳</a></li>'):9==e.Data[s].OrderStatus&&(d="交易关闭",c="");for(var p="",h=0;h<e.Data[s].OrderGoodsList.length;h++)u="",""!=e.Data[s].OrderGoodsList[h].PropertyValueId1Name&&(u='<p class="style">规格：'+e.Data[s].OrderGoodsList[h].PropertyValueId1Name+"，款式："+e.Data[s].OrderGoodsList[h].PropertyValueId2Name+"<span>x"+e.Data[s].OrderGoodsList[h].GoodsQuantity+"</span></p>"),p+='<div class="item borderbottom clearfix"><a href="'+a+'"><div class="left"><img src="'+e.Data[s].OrderGoodsList[h].GoodsImgPath+'@!standard_square_s" /></div><div class="right"><p>'+e.Data[s].OrderGoodsList[h].GoodsTitle+"</p>"+u+'<p class="price textcolorr"><span>'+Global_CommonHelper.GetPriceHtml(e.Data[s].OrderGoodsList[h].GoodsPrice)+"</span></p></div></a></div>";o+='<li class="hashItem" id="hashitem_'+e.Data[s].OrderBaseId+'"><div class="borderbottom"><div class="padf"><span>'+e.Data[s].CreateTime+'</span><span class="state" id="MyBuyInOrderState_'+e.Data[s].OrderBaseId+'">'+d+"</span></div></div>"+p+'<div class="o-tabbtn clearfix"><a date-id="'+e.Data[s].OrderBaseId+'" date-userid="'+e.Data[s].OrderGoodsList[0].GoodsCreateUserId+'" date-username="'+e.Data[s].OrderGoodsList[0].GoodsCreateUserName+'" onclick="My_BuyIn.BindChatEvent(this)"><i class="iconfont">&#xe612;</i>联系卖家</a><ul class="MyBuyInOrderOper">'+c+"</ul></div></li>";
}return o}};this.CancleOrdel=function(a){if(!t){t=!0;var i=$(a).attr("data-id");Global_PopupHelper.confirm({title:"是否确定关闭交易？",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_CancelBase,type:"POST",data:{reqJson:'{"OrderBaseId":'+i+',"Token":"'+e.Token+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){$(a).parent().remove(),$("#MyBuyInOrderState_"+i).html("关闭交易")}}):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),t=!1}})}}),t=!1}},this.ConfirmExpress=function(a){if(!t){t=!0;var i=$(a).attr("data-id");PointsQuantity=$(a).attr("data-price"),Global_PopupHelper.confirm({title:"确认收货后"+Global_CommonHelper.GetPriceHtml(PointsQuantity)+"将打给卖家",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_ConfirmExpress,type:"POST",data:{reqJson:'{"OrderBaseId":'+i+',"Token":"'+e.Token+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){var e=Global_ServiceUrlHelper.CurrentDomain+"/My/Points";$(a).parent().html('<li><a href="'+e+'">查看贝壳</a></li>'),$("#MyBuyInOrderState_"+i).html("交易成功")}}):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),t=!1}})}}),t=!1}},this.CancelRefund=function(a){if(!t){t=!0;var i=$(a).attr("data-id"),o=$(a).attr("data-status"),r=$(a).attr("data-islineexpress");Global_PopupHelper.confirm({title:"确定要撤销退款申请吗？",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_CancelRefund,type:"POST",data:{reqJson:'{"OrderBaseId":'+i+',"Token":"'+e.Token+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){var e="",t="",n=Global_ServiceUrlHelper.CurrentDomain+"/Order/ApplyRefund/"+i,l=Global_ServiceUrlHelper.CurrentDomain+"/Order/Express/"+i;1==o?(e="等待卖家发货",t='<li date-id="'+i+'" onclick="My_BuyIn.ReminderDelivery(this)">提醒发货</li><li><a href="'+n+'">我要退款</a></li>'):2==o&&(e="等待买家确认收货",t=r?'<li><a href="'+n+'">我要退款</a></li><li>确认收货</li>':'<li><a href="'+n+'">我要退款</a></li><li><a href="'+l+'">查看物流</a></li><li>确认收货</li>'),$(a).parent().html(t),$("#MyBuyInOrderState_"+i).html(e)}}):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),t=!1}})}}),t=!1}},this.BindChatEvent=function(e){var t=$(e).attr("date-userid"),a=$(e).attr("date-username"),i=$(e).attr("date-id");window.imChatDialog.chatWith({ClientID:t,Nickname:a,BaseID:i,LinkType:imPublic.enum.ChatMessage.Article.Order})},this.ReminderDelivery=function(e){var t=$(e).attr("date-id");Global_OrderHelper.ReminderDelivery(t)}},My_ChangePassword=new function(){var e=Global_ServiceUrlHelper.PasswordCheckStr;this.PageInit=function(){var t=new Global_BaseInfoHelper.GetToken;$("#new-pwd,#repeat-pwd").on("keyup",function(){var e=$("#new-pwd").val(),t=$("#repeat-pwd").val();e&&t?$("#btnSetReg").removeClass("disabled").removeAttr("disabled"):$("#btnSetReg").addClass("disabled").attr("disabled","disabled")}),$("#btnSetReg").on("tap",function(a){a.preventDefault(),$("#new-pwd,#repeat-pwd").blur();var i=$("#old-pwd").val(),o=$("#new-pwd").val(),r=$("#repeat-pwd").val();return""==i?void Global_PopupHelper.alert({title:"原密码不能为空"}):""==o?void Global_PopupHelper.alert({title:"密码不能为空"}):e.test(o)?r!=o?void Global_PopupHelper.alert({title:"密码不一致"}):i==o?void Global_PopupHelper.alert({title:"新密码不能与原密码相同"}):void $.ajax({url:Global_ServiceUrlHelper.Account_ModifyPassword,type:"POST",data:{reqJson:'{"Token":"'+t.Token+'","oldPassword":"'+i+'","newPassword":"'+o+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):"undefined"!=typeof e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.alert({title:"操作失败，请重试"})}}):void Global_PopupHelper.alert({title:"请填写正确的密码6-16位"})})}},My_DataSet=new function(){var e=0,t="",a={GetApiDate:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetBackgroundImage,type:"POST",data:{reqJson:'{"Token":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t},ListStrBuilder:function(a){for(var i="",o=0;o<a.Content.length;o++)1==a.Content[o].IsCheck?(e=a.Content[o].BackgroundImageId,t=a.Content[o].BackgroundPath,i+='<div class="coloritem checked" data-imgId="'+a.Content[o].BackgroundImageId+'" data-imgpath="'+a.Content[o].BackgroundPath+'" style="background-image:url('+a.Content[o].BackgroundPath+'@!standard_rectangle_m);background-size: cover;"></div>'):i+='<div class="coloritem" data-imgId="'+a.Content[o].BackgroundImageId+'" data-imgpath="'+a.Content[o].BackgroundPath+'"  style="background-image:url('+a.Content[o].BackgroundPath+'@!standard_rectangle_m);background-size: cover;"></div>';return i}};this.PageInit=function(){function i(e,t,a){$("#faceimg").attr("src",e.Path+"@!standard_square_s").attr("data-imgbaseid",e.ImgBaseId),$("#MyDataSet_Img_Alert").next().remove(),$("#MyDataSet_Img_Alert").remove(),$.ajax({url:Global_ServiceUrlHelper.Account_ChangeFaceImg,type:"POST",data:{reqJson:'{"Token":"'+r.Token+'","FaceImgId":"'+e.ImgBaseId+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",type:"1"}):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})},error:function(){Global_PopupHelper.dialogautoclose({title:"图片上传失败",timer:"2000",type:"2"})}})}function o(e){$("#MyDataSet_Img_Alert").next().remove(),$("#MyDataSet_Img_Alert").remove(),Global_PopupHelper.alert({title:"图片上传失败，请重试"})}var r=new Global_BaseInfoHelper.GetToken,n=Global_BaseInfoHelper.GetLoginInfo();if(null==n){var l=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+Global_ServiceUrlHelper.CurrentDomain+"/My/DataSet";$.mobile.changePage(l)}else{$("#faceimg").attr("src",n.FaceImage),$("#loginName").html(n.Mobile),$("#nickName").html(n.Nickname),$(".tag-arrow label.gender").each(function(){$(this).attr("data-gender")==n.Sex&&$(this).addClass("selected")}),$("#birthday").val(n.Birthday),$("#birthdayspan").html(n.Birthday),n.Category>0&&($("#PersonalCategoryDescTag").show(),$("#DataSetCategoryDesc").html(n.CategoryDesc)),$("#signature").html(n.Signature);var s=a.GetApiDate(r.Token);if(null!=s&&null!=s.Content&&s.Content.length>0){var d=a.ListStrBuilder(s);$(".colorlist").html(d),""!=t&&$("#ChangeBG").children(".bgcolor1").append("<style>.bgcolor1::before{ background-image:url("+t+"@!standard_square_s);background-size: cover; }</style>")}else Global_PopupHelper.alert({title:"数据获取失败，请重试"})}$("#face_file").change(function(){if(this.files.length>0){var e=this.files[0].name,t=e.substr(e.lastIndexOf(".")).toLowerCase(),a=1;a=".png"==t?2:".gif"==t?3:1,Global_ImgHelper.ZipAndUploadImg(this.files[0],a,3,i,o,1),Global_PopupHelper.Alert_Tips({content:"图片上传中",Id:"MyDataSet_Img_Alert"})}}),$("#Changenickname").on("tap",function(e){e.preventDefault();var t=$.trim($("#nickName").html());Global_PopupHelper.prompt({title:"更改昵称",inputValue:t,maxlength:"20",type:"1",confirmCallback:function(){return t=$.trim($("#GlobalPromptInput").val()),t.length<1||t.length>20?void Global_PopupHelper.alert({title:"昵称字数为1-20字符"}):($("#nickName").html(t),void $.ajax({url:Global_ServiceUrlHelper.Account_ChangeNickName,type:"POST",data:{reqJson:'{"Token":"'+r.Token+'","NikeName":"'+t+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",type:"1"}):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}}))}})}),$(".tag-arrow label.gender").on("tap",function(e){e.preventDefault(),$(".gender.selected").removeClass("selected"),$(this).addClass("selected");var t=$(this).attr("data-gender");$.ajax({url:Global_ServiceUrlHelper.Account_ChangeBaseSex,type:"POST",data:{reqJson:'{"Sex":"'+t+'","Token":"'+r.Token+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?(Global_MessageHelper.SetName(t),Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",type:"1"})):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}})}),$("#birthday").change(function(e){e.preventDefault();var t=$(this).val();""!=t&&$.ajax({url:Global_ServiceUrlHelper.Account_ChangeBirthday,type:"POST",data:{reqJson:'{"Birthday":"'+t+'","Token":"'+r.Token+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?$("#birthdayspan").html($("#birthday").val()):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}})}),$("#PersonalSign").on("tap",function(e){e.preventDefault();var t=$.trim($("#signature").html());Global_PopupHelper.prompt({title:"个性签名",inputValue:t,maxlength:"100",type:"3",confirmCallback:function(){return t=$.trim($("#GlobalPromptInput").val()),t.length<1||t.length>100?void Global_PopupHelper.alert({title:"个性签名字数为1-100字符"}):void $.ajax({url:Global_ServiceUrlHelper.Account_ChangeSignature,type:"POST",data:{reqJson:'{"Token":"'+r.Token+'","Signature":"'+t+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?($("#signature").html(t),Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",type:"1"})):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}})}})}),$("#PersonalCategoryDesc").on("tap",function(e){e.preventDefault();var t=$.trim($("#DataSetCategoryDesc").html());Global_PopupHelper.prompt({title:"来呗认证说明",inputValue:t,maxlength:"100",type:"3",confirmCallback:function(){return t=$.trim($("#GlobalPromptInput").val()),t.length<1||t.length>20?void Global_PopupHelper.alert({title:"来呗认证说明字数为1-20字符"}):void $.ajax({url:Global_ServiceUrlHelper.Account_ChangeCategoryDesc,type:"POST",data:{reqJson:'{"Token":"'+r.Token+'","CategoryDesc":"'+t+'"}'},dataType:"json",success:function(e){if("undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo)$("#DataSetCategoryDesc").html(t),Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",type:"1"});else{var a="操作失败";"undefined"!=typeof e&&null!=e.ResultRemark&&(a=e.ResultRemark),Global_PopupHelper.alert({title:a})}}})}})}),$(".coloritem").on("tap",function(a){a.preventDefault(),$(".coloritem.checked").removeClass("checked"),$(this).addClass("checked");var i=$(this).attr("data-imgId"),o=$(this).attr("data-imgpath");e=i,t=o}),$("#ChangeBG").on("tap",function(e){e.preventDefault(),$(".bgcolorlist").show()}),$("#BackBG").on("tap",function(e){e.preventDefault(),$(".bgcolorlist").hide()}),$("#SelectBG").on("tap",function(a){a.preventDefault(),$.ajax({url:Global_ServiceUrlHelper.Account_ChangeBackgroundImg,type:"POST",data:{reqJson:'{"Token":"'+r.Token+'","BackgroundImgId":"'+e+'"}'},dataType:"json",async:!1,success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?($(".bgcolorlist").hide(),$("#ChangeBG").children(".bgcolor1").append("<style>.bgcolor1::before{ background-image:url("+t+"@!standard_square_s);background-size: cover; }</style>"),Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",type:"1"})):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}})})}},My_Fans=new function(){var e=new Global_BaseInfoHelper.GetToken,t=0,a=2,i="",o=0,r=0,n={GetApiDate:function(t,a,i){var o=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetAttrntionList,type:"POST",data:{reqJson:'{"Type":1,"UserId":"'+t+'","pageIndex":"'+a+'","pageSize":"'+i+'","Token":"'+e.Token+'"}'},dataType:"json",async:!1}).done(function(e){o=e}).fail(function(){console.log("请求发生异常")}),o},ListStrBuilder:function(e){var a=(Global_ServiceUrlHelper.CurrentDomain,""),i=e.Data.length;if(i<1)$("#NoFuns").show();else{$("#NoFuns").remove();for(var o=0;o<i;o++){var r="+关注",n="";e.Data[o].IsAttention&&(r="已关注",n="cancern");var l="";t!=e.Data[o].ID&&(l='<button data-role="none" data-id="'+e.Data[o].ID+'" data-city="'+e.Data[o].CityName+'" data-carecount="'+e.Data[o].CareCount+'" data-isattention="'+e.Data[o].IsAttention+'" onclick="Search_Users.Attention(this)" class="addcancern '+n+'">'+r+"</button>"),a+='<li class="item" id="hashitem_'+e.Data[o].ID+'"><div class="info"><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.Data[o].ID+'"><div class="avatar '+Global_CommonHelper.GetCategoryClass(e.Data[o].Category)+'"><img src="'+e.Data[o].UserFaceImage+'" /></div><div class="nickname"><p class="name">'+e.Data[o].Nickname+'</p><p class="time" id="SearchUsersCare_'+e.Data[o].ID+'">粉丝:'+e.Data[o].CareCount+" | 来自"+e.Data[o].CityName+"</p></div></a></div>"+l+"</li>"}}return a}};this.PageInit=function(l,s){e=new Global_BaseInfoHelper.GetToken,t=l;var d=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/My/Fans");if(null!=d.StorageData)o=d.StorageData.silentScroll,$("#NoFuns").remove(),$("#FansUserList").html(new Global_ReturnHelper.GetBlankPageHtml(o).Html),i=d.StorageData.ListDate,a=d.StorageData.pageIndex,r=d.StorageData.Total;else{a=2,i="",o=0;var c=n.GetApiDate(s,1,20);if("00000000"==c.ResultNo){r=c.Total;var u=n.ListStrBuilder(c);$("#FansUserList").html(u)}else $("#NoFuns").show()}$("#FansUserList").on("tap",".item a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/My/Fans","FansUserList",a,r)})},this.PageScoll=function(){""!=i&&($.mobile.silentScroll(o),$("#FansUserList").html(i))},this.UsersDropload=function(e,t){r<=20||$(function(){$("#FansUsersDroploadDiv").dropload({scrollArea:window,loadDownFn:function(i){var o=n.GetApiDate(e,a,t);if(null==o||"00000000"!=o.ResultNo)i.lock(),i.noData(),i.resetload();else{a+=1;var r=n.ListStrBuilder(o);t>o.Data.length&&(i.lock(),i.noData()),setTimeout(function(){$("#FansUserList").append(r),i.resetload()},1e3)}}})})},this.Attention=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=$(e).attr("data-id"),a=$(e).attr("data-isattention"),i=$(e).attr("data-city"),o=Global_CommonHelper.BaseAttention(t);if(null!=o)if("undefined"!=typeof o&&"00000000"==o.ResultNo){var r=parseInt($(e).attr("data-carecount"));"true"==a?($(e).html("+关注").attr("data-isattention","false").attr("data-carecount",r-1).removeClass("cancern"),$("#SearchUsersCare_"+t).html("粉丝:"+(r>0?r-1:0)+" | 来自"+i)):($(e).html("已关注").attr("data-isattention","true").attr("data-carecount",r+1).addClass("cancern"),$("#SearchUsersCare_"+t).html("粉丝:"+(r+1)+" | 来自"+i))}else{var n="操作失败";"undefined"!=typeof o.ResultRemark&&(n=o.ResultRemark),Global_PopupHelper.alert({title:n})}}})}},My_Index=new function(){this.GetMbrInfo=function(){var e=null,t=new Global_BaseInfoHelper.GetToken;return $.ajax({url:Global_ServiceUrlHelper.Account_GetMyIndex,type:"POST",data:{reqJson:'{"Token":"'+t.Token+'"}'},dataType:"json",async:!1}).done(function(t){"00000000"==t.ResultNo&&(e=t)}).fail(function(){console.log("请求发生异常")}),e},this.PageInit=function(){var e=My_Index.GetMbrInfo();if("undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo)2==e.Sex?($("#sharedselectgender").show(),$(".selectgender").show(),Global_GenderHelper.SetBaseGender()):($("#sharedselectgender").hide(),$(".selectgender").hide()),$("#Index_points").html(e.PointsUsable),$("#My_Index_NikeName").html(e.Nickname),$(".laibei_page:last .avatar").addClass(Global_CommonHelper.GetCategoryClass(e.Category)),$("#MyIndexPersonalIn").attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.BaseId),$("#MyIndexAttentionUrl").attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/Attention/"+e.BaseId),$("#MyIndexFansUrl").attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/Fans/"+e.BaseId),$("#My_Index_FaceImg").attr("src",e.FaceImage),$("#MyIndexAttentionCount").html(e.AttentionCount),$("#MyIndexFansCount").html(e.FanCount),$("#MyIndexArticleCount").html(e.ArticleCount),$("#MyIndexSellCount").html(e.SellCount),$("#MyIndexBuyCount").html(e.BuyCount),$("#MyIndexPraiseCount").html(e.PraiseCount),""!=e.BackgroundImg&&null!=e.BackgroundImg?$(".miheader").attr("style","background-image:url("+e.BackgroundImg+"@!standard_src_l);background-size: cover;"):$(".laibei_page:last .ocmask").hide();else{var t="数据获取失败";"undefined"!=typeof data&&null!=data.ResultRemark&&(t=data.ResultRemark),Global_PopupHelper.alert({title:t,confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}})}}},My_PersonalIn=new function(){var e,t=new Global_BaseInfoHelper.GetToken,a="",i="",o=0,r=2,n=20,l=0,s=1,d=!1,c=0,u=0,p=0,h=!1,m="";this.PersonalInit=function(i){t=new Global_BaseInfoHelper.GetToken,e=Global_BaseInfoHelper.CheckLogin(),l=i,h=!0;var o=g.GetApiDate(i);if("00000000"==o.ResultNo){var n=(g.SetPageHtml(o),new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/My/PersonalIn/"+i));if(null!=n.StorageData)u=n.StorageData.silentScroll,$(".laibei_page:last #PersonalInArticleList").html(new Global_ReturnHelper.GetBlankPageHtml(u).Html),n.StorageData.other.IsBusiness?""!=n.StorageData.other.OtherData?$(".laibei_page:last #PersonalInProductList").html(n.StorageData.other.OtherData).show():$(".laibei_page:last #PersonalInProductList").hide():$(".laibei_page:last .hisshop").hide(),$(".laibei_page:last #PersonalInDetail").hide(),$(".laibei_page:last #NoPersonalIn").hide(),m=n.StorageData.ListDate,r=n.StorageData.pageIndex,p=n.StorageData.Total;else{r=2,m="",u=0;var d;if(o.IsBusiness){s=1,d=g.GetApiArticleDate(i,1,1,20);var c=g.GetApiArticleDate(i,2,1,6);if("00000000"==c.ResultNo){var f=g.ProductListStrBuilder(c);$(".laibei_page:last #PersonalInProductList .goods").html(f).show()}else $(".laibei_page:last #PersonalInProductList").hide()}else s=1,$(".laibei_page:last .hisshop").hide(),d=g.GetApiArticleDate(i,1,1,20);if("00000000"==d.ResultNo){p=d.Total;var f=g.ListStrBuilder(d);$(".laibei_page:last #PersonalInArticleList").html(f),p>0?$(".laibei_page:last #NoPersonalIn").hide():$(".laibei_page:last #NoPersonalIn").show()}else $(".laibei_page:last #NoPersonalIn").show()}imPublic.bindChatEvent({ClientID:o.BaseId,Nickname:o.Nickname,LinkType:0})}else $(".laibei_page:last #NoPersonalIn").show();$(".laibei_page:last #menubox").on("tap",function(){$(".laibei_page:last .menu").toggle()}),e||$(".laibei_page:last .PersonalInForwardUrl").on("tap",function(){var e=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(e)}),$(".laibei_page:last #PersonalInArticleList").on("tap",".item a",function(){var e;e=o.IsBusiness?{IsBusiness:o.IsBusiness,OtherData:$(".laibei_page:last #PersonalInProductList").html()}:{IsBusiness:o.IsBusiness,OtherData:""},Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/My/PersonalIn/"+i,"PersonalInArticleList",r,p,e)}),$(".laibei_page:last #PersonalInSignatureChange").on("tap",function(e){if(e.preventDefault(),o.IsCurrentUser){var a=$.trim($("#PersonalInSignature").html());Global_PopupHelper.prompt({title:"个性签名",inputValue:a,confirmCallback:function(){return a=$.trim($("#GlobalPromptInput").val()),a.length<1||a.length>100?void Global_PopupHelper.alert({title:"个性签名字数为1-100字符"}):void $.ajax({url:Global_ServiceUrlHelper.Account_ChangeSignature,type:"POST",data:{reqJson:'{"Token":"'+t.Token+'","Signature":"'+a+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?($("#PersonalInSignature").html(a),Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",type:"1"})):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"})}})}})}});var v=window.location.origin+"/My/PersonalIn/"+i;Global_WeiXinHelper.weixinjsApi(window.location.href.split("#")[0],o.Nickname+"的个人主页","",v,a),Global_ShareHelper.MobShare(v,o.Nickname+"的个人主页","",a)},this.PageScoll=function(){""!=m&&($.mobile.silentScroll(u),$(".laibei_page:last #PersonalInArticleList").html(m),$(".laibei_page:last #PersonalInDetail").show())},this.PersonalInDropload=function(e){e.dropload=$(".laibei_page:last #PersonalInDroploadDiv").dropload({scrollArea:window,loadDownFn:function(e){if(p<=20&&h)return void $("#PersonalInDroploadDiv .dropload-down").hide();var t=g.GetApiArticleDate(l,s,r,n);if(null==t||"00000000"!=t.ResultNo)e.lock(),e.noData(),e.resetload();else{r+=1;var a=g.ListStrBuilder(t);n>t.Data.length&&(e.lock(),e.noData()),setTimeout(function(){$("#PersonalInArticleList").append(a),e.resetload()},1e3)}}})};var g={GetApiDate:function(e){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetMyHomePage,type:"POST",data:{reqJson:'{"UserId":'+e+',"Token":"'+t.Token+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},GetApiArticleDate:function(e,a,i,o){var r,n=null;return 2==a&&(r=new Array,r[0]=1),$.ajax({url:Global_ServiceUrlHelper.Account_GetUserArticleList,type:"POST",data:{reqJson:'{"UserId":'+e+',"Type":'+a+',"Status":'+JSON.stringify(r)+',"pageIndex":'+i+',"pageSize":'+o+',"Token":"'+t.Token+'"}'},dataType:"json",async:!1}).done(function(e){n=e}).fail(function(){console.log("请求发生异常")}),n},SetPageHtml:function(e){$(".laibei_page:last #PersonalInFaceImage").attr("src",e.FaceImage),a=e.FaceImage,o=e.Category,$(".laibei_page:last #PersonalInNickname").html(e.Nickname),$(".laibei_page:last .avatar").addClass(Global_CommonHelper.GetCategoryClass(e.Category)),e.Category>0&&$(".laibei_page:last #PersonalInCategory").show().html("来呗认证："+(""==e.CategoryDesc||null==e.CategoryDesc?Global_CommonHelper.GetCategoryName(e.Category):e.CategoryDesc)),i=e.Nickname,c=parseInt(e.FanCount),$(".laibei_page:last #PersonalInAttentionUrl").html("关注 "+e.AttentionCount),$(".laibei_page:last #PersonalInFansUrl").html("粉丝 "+e.FanCount),$(".laibei_page:last #PersonalInSignature").html(""==e.Signature?"这家伙很懒，一个字符都不留":e.Signature),$(".laibei_page:last #PersonalInCityName").html(e.CityName),d=e.IsAttention,d?$(".laibei_page:last #PersonalInAttention").html("已关注").addClass("cancern").removeClass("uncancern"):$(".laibei_page:last #PersonalInAttention").html("+ 关注").addClass("uncancern").removeClass("cancern"),e.IsCurrentUser?($(".laibei_page:last #PersonalInPre").hide(),$(".laibei_page:last #PersonalInFaceImage").parent().attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/DataSet")):$(".laibei_page:last .off-con .tag-arrow").remove(),""!=e.BackgroundImg&&null!=e.BackgroundImg?$(".laibei_page:last .offcenter").attr("style","background-image:url("+e.BackgroundImg+"@!standard_src_l);background-size: cover;"):$(".laibei_page:last .ocmask").hide(),$(".laibei_page:last #PersonalInShopHome").attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/Shop/"+l),$(".laibei_page:last #aJoinCharity").html("参与的公益 "+e.JoinCharityCount),$(".laibei_page:last #aJoinCharity").attr("href",Global_ServiceUrlHelper.CurrentDomain+"/Charity/JoinedCharity/"+l)},ListStrBuilder:function(t){for(var r="",n=(t.Total,Global_ServiceUrlHelper.CurrentDomain),l=0;l<t.Data.length;l++){var s="",d="oneimg",c=t.Data[l].ForwardCount>0?t.Data[l].ForwardCount:"转发",u=t.Data[l].CommentCount>0?t.Data[l].CommentCount:"评论",p=t.Data[l].PraiseCount>0?Global_CommonHelper.GetShowCount(t.Data[l].PraiseCount):"赞",h="",m=n+"/Article/Detail/"+t.Data[l].ProductBaseId,g="unlikeicon";if(t.Data[l].IsCurrentUserPraise&&(g="likeicon"),null!=t.Data[l].ImgList)if(t.Data[l].ImgList.length>1){d="moreimg thumb";for(var f=0;f<t.Data[l].ImgList.length;f++)s+='<img src="'+t.Data[l].ImgList[f].Path+'@!standard_square_m" alt="" />'}else for(var f=0;f<t.Data[l].ImgList.length;f++)s+='<img src="'+t.Data[l].ImgList[f].Path+'@!standard_rectangle_m" alt="" />';t.Data[l].IsArticle||(h='<div class="price"><span>'+Global_CommonHelper.GetPriceHtml(t.Data[l].Price)+"</span></div>",m=n+"/Optimization/Detail/"+t.Data[l].ProductBaseId);var v=Global_ForwardHelper.GetForwardUrl(t.Data[l].ProductBaseId,t.Data[l].IsArticle,t.Data[l].ForwardBase),y=Global_CommonHelper.SetUrlFormat(t.Data[l].Content);r+='<li class="item" id="hashitem_'+t.Data[l].ProductBaseId+t.Data[l].IsArticle+'"><div class="info clearfix"><div class="avatar '+Global_CommonHelper.GetCategoryClass(o)+'"><img src="'+a+'"/></div><div class="nickname"><p class="name">'+i+'<span></span></p><p class="time">'+t.Data[l].CreateTime+"</p></div>"+h+'</div><a href="'+m+'"><div class="productimg '+d+'">'+s+'</div><div class="detail"><p class="ellipsis">'+y+"</p></div></a>"+Global_ForwardHelper.GetForwardHtml(t.Data[l].ForwardBase)+'<div class="extend bordertop"><div class="location">来自'+t.Data[l].CityName+'</div><div class="spread"><span class="title_forward"><a class="PersonalInForwardUrl" onclick="Global_ForwardHelper.ForwardMethod(this)" href="#" data-islogin="'+e+'" data-href="'+v+'"><i class="iconfont">&#xe610; </i>'+c+'</a></span><span class="title_comment"onclick="Global_CommentHelper.Comment(this)"  data-isarticle="'+t.Data[l].IsArticle+'"  data-id="'+t.Data[l].ProductBaseId+'"><i class="iconfont">&#xe626; </i>'+u+'</span><span class="title_like" onclick="Global_CommonHelper.ListPagePraise(this)" data-id="'+t.Data[l].ProductBaseId+'" data-isarticle="'+t.Data[l].IsArticle+'"><i class="'+g+'"></i>'+p+"</span></div></div></li>"}return r},ProductListStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){var o=a+"/Optimization/Detail/"+e.Data[i].ProductBaseId;t+='<div class="swiper-slide"><a href="'+o+'"><img src="'+e.Data[i].ImgList[0].Path+'@!standard_square_m" /><p class="name">'+e.Data[i].Title+'</p><p class="price textcolorr">'+Global_CommonHelper.GetPriceHtml(e.Data[i].Price)+"</p></a></div>"}return t}};this.Attention=function(){Global_PopupHelper.OperationMethod({confirmCallback:function(){var e=Global_CommonHelper.BaseAttention(l);if(null!=e)if("undefined"!=typeof e&&"00000000"==e.ResultNo)d?(d=!1,c=c>0?c-1:0,$("#PersonalInAttention").html("+ 关注").addClass("uncancern").removeClass("cancern"),$("#PersonalInFansUrl").html("粉丝 "+c.toString())):(d=!0,c+=1,$("#PersonalInAttention").html("已关注").addClass("cancern").removeClass("uncancern"),$("#PersonalInFansUrl").html("粉丝 "+c.toString()));else{var t="操作失败";"undefined"!=typeof e.ResultRemark&&(t=e.ResultRemark),Global_PopupHelper.alert({title:t})}}})},this.Swiper=function(){new Swiper(".laibei_page:last .swiper-ad",{slidesPerView:4,paginationClickable:!0,spaceBetween:10})}},My_Points=new function(){var e=2,t=20,a=0,i=0,o=0,r={GetApiDate:function(e,t,a,i){var o=null;return $.ajax({url:Global_ServiceUrlHelper.Points_GetBaseList,type:"POST",data:{reqJson:'{"UserId":"'+e+'","pageIndex":"'+t+'","pageSize":"'+a+'","status":"'+i+'"}'},dataType:"json",async:!1}).done(function(e){o=e}).fail(function(){console.log("请求发生异常")}),o},ListStrBuilder:function(e){for(var t="",a=0;a<e.Data.length;a++)t+=' <section class="pointsec"><div class="fline clearfix">',t+=parseInt(e.Data[a].PointsQuantity)>0?'<div style="color:#33a6ff;" class="left"  >+'+e.Data[a].PointsQuantity+"</div>":'<div style="color:#ff4965;" class="left" >'+e.Data[a].PointsQuantity+"</div>",t+='<div class="right">'+e.Data[a].OrderType+'</div></div><div class="sline clearfix"><div class="left">余额：'+e.Data[a].PointsBalance+'</div><div class="right">'+e.Data[a].CreateTime+'</div></div><div class="para">'+e.Data[a].Remark+"</div></section>";return t}};this.PageInit=function(t){var i=new My_Index.GetMbrInfo;null!=i&&$("#My_points").html(i.PointsUsable),a=t;var n=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/My/Points");if(null!=n.StorageData)$("#NoPointsIn").hide(),e=n.StorageData.pageIndex,o=n.StorageData.Total;else{e=2;var l=r.GetApiDate(t,1,20,0);if("00000000"==l.ResultNo){var s=r.ListStrBuilder(l);o=l.Total,$("#myPointsDroploadList").html(s),o>0?$("#NoPointsIn").hide():$("#NoPointsIn").show()}else $("#NoPointsIn").show()}$("#menubox").on("tap",function(){$(".menu").toggle()})},this.SearcheClick=function(n){var l=this;i=n,e=1,o=0;var s=r.GetApiDate(a,1,t,i);if("00000000"==s.ResultNo){var d=r.ListStrBuilder(s);o=s.Total,$("#myPointsDroploadList").html(d),o>0?$("#NoPointsIn").hide():$("#NoPointsIn").show()}$(".menu").toggle(),l.dropload.direction="up",l.dropload.noData(!1),l.dropload.resetload(),l.dropload.unlock(),o>20?$("#myPointsDroploadDiv .dropload-down").show():$("#myPointsDroploadDiv .dropload-down").hide()},this.MyPointsDropload=function(n){n.dropload=$("#myPointsDroploadDiv").dropload({scrollArea:window,loadDownFn:function(n){if(o<=20)return void $("#myPointsDroploadDiv .dropload-down").hide();var l=r.GetApiDate(a,e,t,i);if(null==l||"00000000"!=l.ResultNo)n.lock(),n.noData(),n.resetload();else{e+=1;var s=r.ListStrBuilder(l);t>l.Data.length&&(n.lock(),n.noData()),setTimeout(function(){$("#myPointsDroploadList").append(s),n.resetload()},1e3)}}})}},My_Praise=new function(){var e=new Global_BaseInfoHelper.GetToken,t=0,a=0,i="",o=2,r=20,n=1,l={GetArticleApiDate:function(t,a,i,o){var r=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetPraiseList,type:"POST",data:{reqJson:'{"pageIndex":'+t+',"pageSize":'+a+',"Token":"'+e.Token+'","IsArticle":'+i+',"IsBusiness":'+o+"}"},dataType:"json",async:!1}).done(function(e){r=e}).fail(function(){console.log("请求发生异常")}),r},ListStrBuilder:function(e,t,a){var i="";if(0==t&&1==a)for(var o=0;o<e.Data.length;o++){var r=e.Data[o];if(i+='<section class="my-charity-list"><div class="my-charity-container"><a href="/Optimization/Detail/'+r.ProductBaseId+'"><div class="donation-image">',null!=r&&null!=r.ImgList&&r.ImgList.length>0){var n=r.ImgList[0];i+='<img src="'+n.Path+'@!standard_square_s" />'}i+='</div><div class="donation-item"><p>'+r.Title+"</p><p>"+Global_CommonHelper.GetPriceHtml(e.Data[o].Price)+'</p></div></a><div class="my-charity myzan-product-container" onclick="My_Praise.ListPagePraise(this)" data-id="'+r.ProductBaseId+'" data-isarticle="'+r.IsArticle+'"><i id="'+r.ProductBaseId+'" class="iconfont">&#xe655;</i></div></div></section>'}else for(var l=Global_ServiceUrlHelper.CurrentDomain,o=0;o<e.Data.length;o++){var s="",d="oneimg",c=e.Data[o].ForwardCount>0?e.Data[o].ForwardCount:"转发",u=e.Data[o].CommentCount>0?e.Data[o].CommentCount:"评论",p=e.Data[o].PraiseCount>0?Global_CommonHelper.GetShowCount(e.Data[o].PraiseCount):"赞",h="",m=l+"/Article/Detail/"+e.Data[o].ProductBaseId,g="likeicon";if(null!=e.Data[o].ImgList)if(e.Data[o].ImgList.length>1){d="moreimg thumb";for(var f=0;f<e.Data[o].ImgList.length;f++)s+='<img src="'+e.Data[o].ImgList[f].Path+'@!standard_square_m" alt="" />'}else for(var f=0;f<e.Data[o].ImgList.length;f++)s+='<img src="'+e.Data[o].ImgList[f].Path+'@!standard_rectangle_m" alt="" />';var v=Global_CommonHelper.SetUrlFormat(e.Data[o].Content);i+='<li class="item" id="hashitem_'+e.Data[o].ProductBaseId+e.Data[o].IsArticle+'"><div class="info clearfix"><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.Data[o].CreateUserId+'"><div class="avatar '+Global_CommonHelper.GetCategoryClass(e.Data[o].Category)+'"><img src="'+e.Data[o].CreateUserFaceImage+'"/></div><div class="nickname"><p class="name">'+e.Data[o].CreateUserName+'<span></span></p><p class="time">'+e.Data[o].CreateTime+"</p></div></a>"+h+'</div><a href="'+m+'"><div class="productimg '+d+'">'+s+'</div><div class="detail"><p class="ellipsis">'+v+"</p></div></a>"+Global_ForwardHelper.GetForwardHtml(e.Data[o].ForwardBase)+'<div class="extend bordertop"><div class="location">来自'+e.Data[o].CityName+'</div><div class="spread"><span class="title_forward"><a href="'+Global_ForwardHelper.GetForwardUrl(e.Data[o].ProductBaseId,e.Data[o].IsArticle,e.Data[o].ForwardBase)+'"><i class="iconfont">&#xe610; </i>'+c+'</a></span><span class="title_comment"onclick="My_Praise.PostComment(this)"  data-isarticle="'+e.Data[o].IsArticle+'"  data-id="'+e.Data[o].ProductBaseId+'"><i class="iconfont">&#xe626; </i>'+u+'</span><span class="title_like" onclick="My_Praise.ListPagePraiseIsBusiness(this)" data-id="'+e.Data[o].ProductBaseId+'" data-isarticle="'+e.Data[o].IsArticle+'"><i class="'+g+'"></i>'+p+"</span></div></div></li>";
}return i}};this.PageInit=function(){e=new Global_BaseInfoHelper.GetToken;var r=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/My/Praise");if(null!=r.StorageData)t=r.StorageData.silentScroll,n=r.StorageData.other.PraiseType,$("#PraiseHead").html(r.StorageData.other.OtherData),1==n?($("#PraiseBusinessList").html(new Global_ReturnHelper.GetBlankPageHtml(t).Html),$("#NoPraiseOne").hide()):($("#PraiseArticleList").html(new Global_ReturnHelper.GetBlankPageHtml(t).Html),$("#myzan-product").hide(),$("#myzan-say").show(),$("#NoPraiseTwo").hide()),i=r.StorageData.ListDate,o=r.StorageData.pageIndex,a=r.StorageData.Total;else{o=2,i="",t=0,n=1;var s=l.GetArticleApiDate(1,20,!1,!0);if("00000000"==s.ResultNo)if(a=s.Total,a>0){var d=l.ListStrBuilder(s,!1,!0);$("#PraiseBusinessList").html(d),$("#NoPraiseOne").hide()}else $("#NoPraiseOne").show();else $("#NoPraiseOne").show()}$("#PraiseDroploadDiv").on("tap","a",function(){var e,t={PraiseType:n,OtherData:$("#PraiseHead").html()};e=1==n?"PraiseBusinessList":"PraiseArticleList",Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/My/Praise",e,o,a,t)})},this.PageScoll=function(){""!=i&&($.mobile.silentScroll(t),1==n?$("#PraiseBusinessList").html(i):$("#PraiseArticleList").html(i))},this.MenuClick=function(e){$(e).addClass("myzan-active").parent().siblings().children().removeClass("myzan-active");var t=this;o=2,a=0;var i;if(n=$(e).attr("data-type"),"1"==n){$("#myzan-product").show(),$("#myzan-say").hide(),$("#myzan-unused").hide();var i=l.GetArticleApiDate(1,20,!1,!0);if("00000000"==i.ResultNo)if(a=i.Total,a>0){var r=l.ListStrBuilder(i,!1,!0);$("#PraiseBusinessList").html(r),$("#NoPraiseOne").hide()}else $("#NoPraiseOne").show()}else{$("#myzan-product").hide(),$("#myzan-say").show(),$("#myzan-unused").hide();var i=l.GetArticleApiDate(1,20,!0,!0);if("00000000"==i.ResultNo)if(a=i.Total,a>0){var r=l.ListStrBuilder(i,!0,!0);$("#PraiseArticleList").html(r),$("#NoPraiseTwo").hide()}else $("#NoPraiseTwo").show()}t.dropload.direction="up",t.dropload.noData(!1),t.dropload.unlock(),t.dropload.resetload(),a>20?$("#PraiseDroploadDiv .dropload-down").show():$("#PraiseDroploadDiv .dropload-down").hide()},this.PraiseDropload=function(e){e.dropload=$("#PraiseDroploadDiv").dropload({scrollArea:window,loadDownFn:function(e){if(a<=20)return void $("#PraiseDroploadDiv .dropload-down").hide();var t,i,s;if("1"==n?(t=l.GetArticleApiDate(o,20,!1,!0),i=!1,s=!0):(t=l.GetArticleApiDate(o,20,!0,!0),i=!0,s=!0),null==t||"00000000"!=t.ResultNo)e.lock(),e.noData(),e.resetload();else{o+=1;var d=l.ListStrBuilder(t,i,s);r>t.Data.length&&(e.lock(),e.noData()),setTimeout(function(){"1"==n?$("#PraiseBusinessList").append(d):$("#PraiseArticleList").append(d),e.resetload()},1e3)}}})},this.ListPagePraise=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=$(e),a=Global_CommonHelper.ArticlePraise(e);if(null!=a)if("undefined"!=typeof a&&"00000000"==a.ResultNo)a.IsAdd?(t.find("i").removeAttr("class"),t.find("i").addClass("iconfont")):(t.find("i").removeAttr("class"),t.find("i").addClass("iconfont myzan-delete-zan"));else{var i="操作失败";"undefined"!=typeof a.ResultRemark&&(i=a.ResultRemark),Global_PopupHelper.alert({title:i})}}})},this.ListPagePraiseIsBusiness=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=Global_CommonHelper.ArticlePraise(e);if(null!=t)if("undefined"!=typeof t&&"00000000"==t.ResultNo)t.IsAdd?$(e).html('<i class="likeicon"></i>'+Global_CommonHelper.GetShowCount(t.PraiseCount)):0==t.PraiseCount?$(e).html('<i class="unlikeicon"></i>赞'):$(e).html('<i class="unlikeicon"></i>'+Global_CommonHelper.GetShowCount(t.PraiseCount));else{var a="操作失败";"undefined"!=typeof t.ResultRemark&&(a=t.ResultRemark),Global_PopupHelper.alert({title:a})}}})}},My_SellOut=new function(){var e=new Global_BaseInfoHelper.GetToken,t=!1,a=2,i=0;this.SellOutInit=function(){e=new Global_BaseInfoHelper.GetToken,a=2;var t=o.GetApiDate(1,20);if("00000000"==t.ResultNo){i=t.Total;var r=o.ListStrBuilder(t);$("#MySellOutList").html(r),i>0?$("#NoSellOut").remove():$("#NoSellOut").show()}else $("#MySellOutList").remove(),$("#NoSellOut").show()},this.MyBuyInDropload=function(e){i<=20||$(function(){$("#mySellOutDropload").dropload({scrollArea:window,loadDownFn:function(t){var i=o.GetApiDate(a,e);if(null==i||"00000000"!=i.ResultNo)t.lock(),t.noData(),t.resetload();else{a+=1;var r=o.ListStrBuilder(i);e>i.Data.length&&(t.lock(),t.noData()),setTimeout(function(){$("#MySellOutList").append(r),t.resetload()},1e3)}}})})};var o={GetApiDate:function(t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetMyList,type:"POST",data:{reqJson:'{"Token":"'+e.Token+'","type":1,"pageIndex":"'+t+'","pageSize":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},ListStrBuilder:function(e){for(var t=Global_ServiceUrlHelper.CurrentDomain,a="#",i="#",o="#",r="",n="#",l="#",s="#",d=0;d<e.Data.length;d++){var c="",u="",p="";a=t+"/Order/SellDetail/"+e.Data[d].OrderBaseId,i=t+"/Order/RefuseRefund/"+e.Data[d].OrderBaseId,o=t+"/Order/SendGoods/"+e.Data[d].OrderBaseId,n=t+"/Order/Express/"+e.Data[d].OrderBaseId,l=t+"/My/Points",s=t+"/Order/RefundHistory/"+e.Data[d].OrderBaseId,1==e.Data[d].OrderStatus?1==e.Data[d].PayStatus?(c="等待买家付款",u='<li data-id="'+e.Data[d].OrderBaseId+'" data-price="'+e.Data[d].PointsQuantity+'" onclick="My_SellOut.ChangeOrdelPrice(this)" >修改价格</li>'):2==e.Data[d].PayStatus?1==e.Data[d].ExpressStatus?(c="等待卖家发货",u='<li><a href="'+o+'">我要发货</a></li>'):2==e.Data[d].ExpressStatus?(c="等待买家收货",u=e.Data[d].IsLineExpress?'<li>提醒收货</li><li><a href="'+o+'">修改物流</a></li>':'<li>提醒收货</li><li><a href="'+o+'">修改物流</a></li><li><a href="'+n+'">查看物流</a></li>'):3==e.Data[d].ExpressStatus&&(c="交易成功",u='<li><a href="'+l+'">查看贝壳</a></li>'):3==e.Data[d].PayStatus?(c="退款中",u='<li><a href="'+s+'">退款详情</a></li><li><a href="'+i+'">拒绝退款</a></li><li data-id="'+e.Data[d].OrderBaseId+'" data-price="'+e.Data[d].PointsQuantity+'" onclick="My_SellOut.ConfrimRefund(this)">同意退款</li>'):4==e.Data[d].PayStatus&&(c="退款成功",u='<li><a href="'+s+'">退款详情</a></li><li><a href="'+l+'">查看贝壳</a></li>'):2==e.Data[d].OrderStatus?4==e.Data[d].PayStatus?(c="退款成功",u='<li><a href="'+s+'">退款详情</a></li><li><a href="'+l+'">查看贝壳</a></li>'):(c="交易成功",u='<li><a href="'+l+'">查看贝壳</a></li>'):9==e.Data[d].OrderStatus&&(c="交易关闭",u="");for(var h="",m=0;m<e.Data[d].OrderGoodsList.length;m++)p="",""!=e.Data[d].OrderGoodsList[m].PropertyValueId1Name&&(p='<p class="style">规格：'+e.Data[d].OrderGoodsList[m].PropertyValueId1Name+"，款式："+e.Data[d].OrderGoodsList[m].PropertyValueId2Name+"<span>x"+e.Data[d].OrderGoodsList[m].GoodsQuantity+"</span></p>"),h+='<div class="item borderbottom clearfix"><a href="'+a+'"><div class="left"><img src="'+e.Data[d].OrderGoodsList[m].GoodsImgPath+'@!standard_square_s" /></div><div class="right"><p>'+e.Data[d].OrderGoodsList[m].GoodsTitle+"</p>"+p+'<p class="price textcolorr"><span id="MyBuyInPirce_'+e.Data[d].OrderGoodsList[m].OrderBaseId+'">'+Global_CommonHelper.GetPriceHtml(e.Data[d].OrderGoodsList[m].GoodsPrice)+"</span></p></div></a></div>";r+='<li class="hashitem" id="hashitem_'+e.Data[d].OrderBaseId+'"><div class="borderbottom"><div class="padf"><span>'+e.Data[d].CreateTime+'</span><span class="state" id="MyBuyInOrderState_'+e.Data[d].OrderBaseId+'">'+c+"</span></div></div>"+h+'<div class="o-tabbtn clearfix"><a date-id="'+e.Data[d].OrderBaseId+'" date-userid="'+e.Data[d].CreateUserId+'" date-username="'+e.Data[d].CreateUserName+'" onclick="My_SellOut.BindChatEvent(this)"><i class="iconfont">&#xe626;</i>联系买家</a><ul class="MyBuyInOrderOper" id="MyBuyInOrderOper_'+e.Data[d].OrderBaseId+'">'+u+"</ul></div></li>"}return r}};this.ChangeOrdelPrice=function(a){if(!t){t=!0;var i=$(a).attr("data-id"),o=$(a).attr("data-price");Global_PopupHelper.prompt({title:"修改订单价格",inputPlaceholder:"输入订单价格",inputValue:o,type:"2",inputtitle:"&yen; ",confirmdisabled:!0,inputMethod:function(){Global_CommonHelper.ChechNumberOneDecimal(document.getElementById("GlobalPromptInput"),5),""!=$("#GlobalPromptInput").val()&&$("#GlobalPromptInput").val()>0?$(".alertbox input.confirmbtn").eq(1).removeAttr("disabled").removeClass("disabled"):$(".alertbox input.confirmbtn").eq(1).addClass("disabled").attr("disabled","disabled")},confirmCallback:function(){var a=$("#GlobalPromptInput").val();a=10*parseFloat(a);var o=/^(999999|[1-9]\d{0,5}|1)$/;return o.test(a)?void $.ajax({url:Global_ServiceUrlHelper.Order_ChangeBasePice,type:"POST",data:{reqJson:'{"OrderBaseId":'+i+',"OrderPice":'+a+',"Token":"'+e.Token+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){$("#MyBuyInPirce_"+i).html(Global_CommonHelper.GetPriceHtml(a))}}):"undefined"!=typeof e&&null!=e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),t=!1}}):(Global_PopupHelper.alert({title:Global_MessageHelper.PriceErr}),void(t=!1))},cancelCallback:function(){t=!1}})}},this.ConfrimRefund=function(a){if(!t){t=!0;var i=$(a).attr("data-id"),o=$(a).attr("data-price");Global_PopupHelper.confirm({title:" 同意退款后 "+Global_CommonHelper.GetPriceHtml(o)+" 将退回买家账号",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_BaseRefund,type:"POST",data:{reqJson:'{"OrderBaseId":'+i+',"Token":"'+e.Token+'","RefundType":1}'},dataType:"json",success:function(e){if("undefined"!=typeof e&&"00000000"==e.ResultNo){var a=Global_ServiceUrlHelper.CurrentDomain+"/Order/RefundHistory/"+i,o=Global_ServiceUrlHelper.CurrentDomain+"/My/Points",r="",n="";r="退款成功",n='<li><a href="'+a+'">退款详情</a></li><li><a href="'+o+'">查看贝壳</a></li>',$("#MyBuyInOrderState_"+i).html(r),$("#MyBuyInOrderOper_"+i).html(n)}else{var l="操作失败";"undefined"!=typeof e&&null!=e.ResultRemark&&(l=e.ResultRemark),Global_PopupHelper.alert({title:l})}t=!1}})},cancelCallback:function(){t=!1}})}},this.BindChatEvent=function(e){var t=$(e).attr("date-userid"),a=$(e).attr("date-username"),i=$(e).attr("date-id");window.imChatDialog.chatWith({ClientID:t,Nickname:a,BaseID:i,LinkType:imPublic.enum.ChatMessage.Order})}},My_SetPassword=new function(){var e=Global_ServiceUrlHelper.PasswordCheckStr;this.PageInit=function(){var t=new Global_BaseInfoHelper.GetToken;$("#new-pwd,#repeat-pwd").on("keyup",function(){var e=$("#new-pwd").val(),t=$("#repeat-pwd").val();e&&t?$("#btnSetReg").removeClass("disabled").removeAttr("disabled"):$("#btnSetReg").addClass("disabled").attr("disabled","disabled")}),$("#btnSetReg").on("tap",function(a){a.preventDefault(),$("#new-pwd,#repeat-pwd").blur();var i=$("#new-pwd").val(),o=$("#repeat-pwd").val();return""==i?void Global_PopupHelper.alert({title:"密码不能为空"}):e.test(i)?o!=i?void Global_PopupHelper.alert({title:"密码不一致"}):void $.ajax({url:Global_ServiceUrlHelper.Account_SetPassword,type:"POST",data:{reqJson:'{"Token":"'+t.Token+'","Password":"'+i+'"}'},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):"undefined"!=typeof e.ResultRemark?Global_PopupHelper.alert({title:e.ResultRemark}):Global_PopupHelper.alert({title:"操作失败，请重试"})}}):void Global_PopupHelper.alert({title:"请填写正确的密码6-16位"})})}},My_Setting=new function(){var e={CheckPwdFunc:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Account_CheckPassword,type:"POST",data:{reqJson:'{"Token":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t}};this.PageFun=function(){var t=new Global_BaseInfoHelper.GetToken;$("#MySettingSignOut").on("tap",function(e){e.preventDefault(),Account_SignOut.SignOut(function(){$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Account/Index")})});var t=new Global_BaseInfoHelper.GetToken,a=e.CheckPwdFunc(t.Token);if(null!=a&&"undefined"!=typeof a.ResultNo&&"00000000"==a.ResultNo){var i=Global_ServiceUrlHelper.CurrentDomain+"/My/ChangePassword";$("#ChangePassword").attr("href",i)}}},My_Shop=new function(){function e(){var e=document.body.clientWidth/7.5,t=$("#ShopProductList");t.imagesLoaded(function(){t.masonry({itemSelector:".masonry-item",gutterWidth:.2*e}),""!=d&&$.mobile.silentScroll(l)})}function t(e){var t=$("#ShopProductList"),i=$(e);t.append(i).masonry("appended",i,!0),$(".Shop_lazyload_img").lazyload({failurelimit:400,event:"scrollstop",load:function(){t.imagesLoaded(function(){t.masonry()})}}),a()}function a(){$(".optimization-product-sellout2").css("top","0"),$(".optimization-product-sellout2").css("left","0")}var i=new Global_BaseInfoHelper.GetToken,o=2,r=20,n=!1,l=0,s=0,d="",c="1",u="",p="",h=!1;this.ShopInit=function(e){h=!0,i=new Global_BaseInfoHelper.GetToken;var t=m.GetApiDate(e);if(p=e,c="1",r=20,"00000000"==t.ResultNo){var a=(m.SetPageHtml(t),new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/My/Shop/"+e));if(null!=a.StorageData)l=a.StorageData.silentScroll,$("#ShopProductList").html(new Global_ReturnHelper.GetBlankPageHtml(l).Html),""==a.StorageData.other.ShopArticle&&$("#ShopArticle").hide(),$("#ShopChooseChannel").html(a.StorageData.other.ChooseChannel),$("#ShopArticle").html(a.StorageData.other.ShopArticle),$("#ShopDetail").hide(),c=a.StorageData.other.Sort,d=a.StorageData.ListDate,o=a.StorageData.pageIndex,s=a.StorageData.Total;else{o=2,d="",l=0;var n;ThisType=2,n=m.GetApiArticleDate(e,2,1,20,1);var g=m.GetApiArticleDate(e,1,1,1,0);if("00000000"==g.ResultNo){var f=m.ArticleListStrBuilder(g);""==f&&$("#ShopArticle").hide(),$("#ShopArticle").html(f)}else $("#ShopArticle").hide();if("00000000"==n.ResultNo){s=n.Total;var f=m.ListStrBuilder(n);$("#ShopProductList").html(f),s>0?$("#NoShop").hide():$("#NoShop").show()}else $("#NoShop").show()}imPublic.bindChatEvent({ClientID:t.BaseId,Nickname:t.Nickname,LinkType:0})}else $("#NoShop").show();$("#ShopProductList").on("tap","a",function(){var t={Sort:c,ShopArticle:$("#ShopArticle").html(),ChooseChannel:$("#ShopChooseChannel").html()};Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/My/Shop/"+e,"ShopProductList",o,s,t)});var v=window.location.origin+"/My/Shop/"+e;Global_WeiXinHelper.weixinjsApi(window.location.href.split("#")[0],t.Nickname+"的店铺主页","",v,u),Global_ShareHelper.MobShare(v,t.Nickname+"的店铺主页","",u)},this.PageScoll=function(){$(function(){""!=d&&($("#ShopProductList").html(d),$("#ShopDetail").show()),e(),$(".Shop_lazyload_img").lazyload({failurelimit:400,event:"scrollstop",load:e}),a()})},this.ShopDropload=function(e){e.dropload=$("#ShopDroploadDiv").dropload({scrollArea:window,loadDownFn:function(e){var a=m.GetApiArticleDate(p,2,o,r,c);if(null==a||"00000000"!=a.ResultNo)e.lock(),e.noData(),e.resetload(),$("#NoShop").show();else{o+=1;var i=m.ListStrBuilder(a);r>a.Data.length&&(e.lock(),e.noData()),s=a.Total,s>0?$("#NoShop").hide():$("#NoShop").show(),setTimeout(function(){t(i),s<=20?$("#ShopDroploadDiv .dropload-down").hide():$("#ShopDroploadDiv .dropload-down").show(),e.resetload()},1e3)}}}),h&&(e.dropload._scrollContentHeight=$(window).height())},this.ChooseChannel=function(e){var a=this;h=!1,o=2,s=0,"3"==c&&$(e).children("a").hasClass("bussinessstore-active")&&($("#ShopPriceSort").html("&#xe64f;"),$(e).attr("data-sort","4")),"4"==c&&$(e).children("a").hasClass("bussinessstore-active")&&($("#ShopPriceSort").html("&#xe617;"),$(e).attr("data-sort","3")),c=$(e).attr("data-sort"),$(e).children("a").addClass("bussinessstore-active").parent().siblings().children("a").removeClass("bussinessstore-active");var i=m.GetApiArticleDate(p,2,1,20,c);if("00000000"==i.ResultNo){s=i.Total;var r=m.ListStrBuilder(i);$("#ShopProductList").html(""),s>0?$("#NoShop").hide():$("#NoShop").show(),t(r)}a.dropload.direction="up",a.dropload.noData(!1),a.dropload.unlock(),a.dropload.resetload(),a.dropload._scrollContentHeight=$(window).height(),s>20?$("#ShopDroploadDiv .dropload-down").show():$("#ShopDroploadDiv .dropload-down").hide()};var m={GetApiDate:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetMyHomePage,type:"POST",data:{reqJson:'{"UserId":'+e+',"Token":"'+i.Token+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t},GetApiArticleDate:function(e,t,a,o,r){var n=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetUserArticleList,type:"POST",data:{reqJson:'{"UserId":'+e+',"Type":'+t+',"Sort":'+r+',"pageIndex":'+a+',"pageSize":'+o+',"Token":"'+i.Token+'"}'},dataType:"json",async:!1}).done(function(e){n=e}).fail(function(){console.log("请求发生异常")}),n},SetPageHtml:function(e){$("#ShopFaceImage").attr("src",e.FaceImage),u=e.FaceImage,$("#ShopNickname").html(e.Nickname),$(".laibei_page:last .avatar").addClass(Global_CommonHelper.GetCategoryClass(e.Category)),n=e.IsAttention,n?$("#ShopAttention").html("已关注").addClass("cancern").removeClass("uncancern"):$("#ShopAttention").html("+ 关注").addClass("uncancern").removeClass("cancern"),e.IsCurrentUser&&($("#ShopPre").hide(),$("#ShopFaceImage").parent().attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/DataSet")),""!=e.BackgroundImg&&null!=e.BackgroundImg?$(".offcenter").attr("style","background-image:url("+e.BackgroundImg+"@!standard_src_l);background-size: cover;"):$(".laibei_page:last .ocmask").hide()},ListStrBuilder:function(e){for(var t="",a=(e.Total,Global_ServiceUrlHelper.CurrentDomain),i=0;i<e.Data.length;i++){var o=a+"/Optimization/Detail/"+e.Data[i].ProductBaseId,r="";3==e.Data[i].Status&&(r='<div class="optimization-product-sellout2 optimization-waterfallproduct-sellout"><img src="/Content/Images/optimization-selledout.png" /></div>'),t+='<li class="masonry-item"><a href="'+o+'"><div class="optimization-shadow-wrapper"><img class="Shop_lazyload_img" src="/Content/Images/sending.gif" data-original="'+e.Data[i].ImgList[0].Path+'@!standard_src_M" style="display: inline;" />'+r+'</div><p class="optimization-list-category-desc">'+e.Data[i].Title+'</p><p class="optimization-list-category-price">'+Global_CommonHelper.GetPriceHtml(e.Data[i].Price)+"</p></a></li>"}return t},ArticleListStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){var o=Global_CommonHelper.SetUrlFormat(e.Data[i].Content),r="/Content/Images/articledefaultpic.jpg";null!=e.Data[i].ImgList&&e.Data[i].ImgList.length>0&&(r=e.Data[i].ImgList[0].Path+"@!standard_src_M"),t+='<a href="'+a+"/Article/Detail/"+e.Data[i].ProductBaseId+'"><img src="'+r+'" /><p>'+o+"</p></a>"}return t}};this.Attention=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=Global_CommonHelper.BaseAttention(e);if(null!=t)if("undefined"!=typeof t&&"00000000"==t.ResultNo)n?(n=!1,$("#ShopAttention").html("+ 关注").addClass("uncancern").removeClass("cancern")):(n=!0,$("#ShopAttention").html("已关注").addClass("cancern").removeClass("uncancern"));else{var a="操作失败";"undefined"!=typeof t.ResultRemark&&(a=t.ResultRemark),Global_PopupHelper.alert({title:a})}}})}},Order_ApplyRefund=new function(){this.ApplyRefundInit=function(t,a){var i=new Global_BaseInfoHelper.GetToken,o=e.GetApiDate(t,i.Token);if(null!=o&&"00000000"==o.ResultNo){o.CreateUserId!=a&&$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/My/BuyIn");var r=Global_CommonHelper.GetPriceHtml(o.PointsPay)+"(";o.PointsBalancePay>0&&(r+='<i class="shellgrey"></i>'+o.PointsBalancePay),o.PointCashPay>0&&(o.PointsBalancePay>0&&(r+=" + "),r+="&yen; "+o.PointCashPay),r+=")",$("#OrderApplyRefundPrice").html(r),$("#ApplyRefundCauseTxt").val(o.RefundCauseTxt);var n=e.GetRefundCauseList(o);$("#ApplyRefundCauseList").html(n);var l=e.GetPicList(o);$(".pic-group li:last").before(l),2!=o.PayStatus&&Global_PopupHelper.alert({title:"订单状态已改变，请刷新后操作",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}})}else $.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/My/BuyIn");var s=0;Article_ImgHelper.ChangeMaxImgCount(3),Article_ImgHelper.ArticleImgFun(s),$("#ApplyRefundOarcause").on("tap",function(){$(".refundcause").slideDown()}),$("#qxoarcause").on("tap",function(e){e.stopPropagation(),$(".refundcause").slideUp()}),$("#qroarcause").on("tap",function(e){e.stopPropagation(),$("#ApplyRefundArcause").html($(".refundcause .item .active").html()).attr("data-type",$(".refundcause .item .active").attr("data-type")).removeClass("thirdtext"),$(".refundcause").slideUp()}),$(".refundcause .item a").on("tap",function(){$(".refundcause .item .active").removeClass("active"),$(this).addClass("active")}),$("#ApplyRefundConfirm").on("tap",function(){$("#ApplyRefundConfirm").attr("disabled",!0);var e=$("#ApplyRefundArcause").attr("data-type"),t=$("#ApplyRefundCauseTxt").val(),a=$("li[data-role='img']"),i="";if($.each(a,function(e,t){i+=$(t).find("img").attr("data-imgbaseid")+","}),""==e)return Global_PopupHelper.alert({title:"请选择退款原因"}),void $("#ApplyRefundConfirm").removeAttr("disabled");var r=new Global_BaseInfoHelper.GetToken,n=new ProductObject(o.RefundId,o.OrderBaseId,e,t,i,r.Token);$.ajax({url:Global_ServiceUrlHelper.Order_ChangeRefundByOrderId,type:"POST",data:{reqJson:JSON.stringify(n)},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"提交成功",timer:"2000",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):"undefined"!=typeof e&&null!=e.ResultRemark?(Global_PopupHelper.alert({title:e.ResultRemark}),$("#ApplyRefundConfirm").removeAttr("disabled")):(Global_PopupHelper.dialogautoclose({title:"提交失败",timer:"2000",type:"2"}),$("#ApplyRefundConfirm").removeAttr("disabled"))}})})};var e={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetRefundByOrderId,type:"POST",data:{reqJson:'{"OrderBaseId":"'+e+'","Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},GetRefundCauseList:function(e){var t="";if(null==e.RefundCauseList)return t;for(var a=0;a<e.RefundCauseList.length;a++){var i="";e.RefundCauseList[a].Type==e.RefundCauseType&&(i="active",$("#ApplyRefundArcause").html(e.RefundCauseList[a].Name).attr("data-type",e.RefundCauseType).removeClass("thirdtext")),t+='<a href="#" data-type="'+e.RefundCauseList[a].Type+'" class="'+i+'">'+e.RefundCauseList[a].Name+"</a>"}return t},GetPicList:function(e){var t="";if(null==e.RefundImgList)return t;for(var a=0;a<e.RefundImgList.length;a++)t+='<li data-role="img" onclick="Article_ImgHelper.LiImgClick(this)"><img src="'+e.RefundImgList[a].Path+'@!standard_square_s" data-imgbaseid="'+e.RefundImgList[a].Id+'"><span class="delimg" onclick="Article_ImgHelper.SpanDelImg(this)"></span></li>';return e.RefundImgList.length>=3&&$("li[data-role='addfile']").hide(),t}};ProductObject=function(e,t,a,i,o,r){this.RefundId=e,this.OrderBaseId=t,this.RefundCauseType=a,this.RefundCauseTxt=i,this.Img=o,this.Token=r}},Order_BuyDetail=new function(){var e=!1;this.BuyDetailInit=function(a){var i=new Global_BaseInfoHelper.GetToken,o=t.GetApiDate(a,i.Token);if(null!=o&&"00000000"==o.ResultNo){if(t.SetDetailHtml(o),1!=o.ExpressStatus){var r="";if(o.IsLineExpress)r='<a href="#"><p>【线下交易】</p></a>';else{var n=Global_ExpressHelper.GetExpressDate(a,i.Token);null!=n&&null!=n.Traces&&n.Traces.length>0&&(r='<a href="'+Global_ServiceUrlHelper.CurrentDomain+"/Order/Express/"+a+'"><p>【物流信息】</p><p>'+n.Traces[0].AcceptStation+"</p><p>"+n.Traces[0].AcceptTime+'</p><span class="arrow iconfont">&#xe61e;</span></a>')}$(".laibei_page:last #BuyDetailWuliu").html(r).show()}$(".laibei_page:last #BuyDetailchat").attr("date-userid",o.OrderGoodsList[0].GoodsCreateUserId).attr("date-username",o.OrderGoodsList[0].GoodsCreateUserName)}$(".laibei_page:last #BuyDetailCancelRefund").on("tap",function(t){t.preventDefault(),e||(e=!0,Global_PopupHelper.confirm({title:"确定要撤销退款申请吗？",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_CancelRefund,type:"POST",data:{reqJson:'{"OrderBaseId":'+a+',"Token":"'+i.Token+'"}'},dataType:"json",success:function(t){"undefined"!=typeof t&&"00000000"==t.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){var e="",t="",a=Global_ServiceUrlHelper.CurrentDomain+"/Order/ApplyRefund/"+o.OrderBaseId;Global_ServiceUrlHelper.CurrentDomain+"/Order/Express/"+o.OrderBaseId;1==o.ExpressStatus?(e="等待卖家发货",t='<li date-id="'+o.OrderBaseId+'" onclick="Order_BuyDetail.ReminderDelivery(this)">提醒发货</li><li><a href="'+a+'">我要退款</a></li>'):2==o.ExpressStatus&&(e="等待买家确认收货",t='<li><a href="'+a+'">我要退款</a></li><li>确认收货</li>'),$("#BuyDetailOrderState").html(e),$("#BuyDetailOrderOper").html(t)}}):"undefined"!=typeof t&&null!=t.ResultRemark?Global_PopupHelper.alert({title:t.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),e=!1}})},cancelCallback:function(){e=!1}}))}),$(".laibei_page:last #BuyDetailConfirmExpress").on("tap",function(t){t.preventDefault(),e||(e=!0,Global_PopupHelper.confirm({title:"确认收货后"+o.PointsQuantity+"贝壳将打给卖家",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_ConfirmExpress,type:"POST",data:{reqJson:'{"OrderBaseId":'+a+',"Token":"'+i.Token+'"}'},dataType:"json",success:function(t){"undefined"!=typeof t&&"00000000"==t.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){var e="交易成功",t="";$("#BuyDetailOrderState").html(e),$("#BuyDetailOrderOper").html(t)}}):"undefined"!=typeof t&&null!=t.ResultRemark?Global_PopupHelper.alert({title:t.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),e=!1}})},cancelCallback:function(){e=!1}}))}),$(".laibei_page:last .BuyDetailCancleOrdel").on("tap",function(t){if(!e){e=!0;var a=$(this).attr("data-id");Global_PopupHelper.confirm({title:"是否确定关闭交易？",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_CancelBase,type:"POST",data:{reqJson:'{"OrderBaseId":'+a+',"Token":"'+i.Token+'"}'},dataType:"json",success:function(t){"undefined"!=typeof t&&"00000000"==t.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){var e="交易关闭";$("#BuyDetailOrderState").html(e),$("#BuyDetailFooter").hide()}}):"undefined"!=typeof t&&null!=t.ResultRemark?Global_PopupHelper.alert({title:t.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),e=!1}})},cancelCallback:function(){e=!1}})}})};var t={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetBaseDetailByID,type:"POST",data:{reqJson:'{"OrderBaseId":"'+e+'","Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},SetDetailHtml:function(e){var t=Global_ServiceUrlHelper.CurrentDomain,a=t+"/Order/ApplyRefund/"+e.OrderBaseId,i=(t+"/Order/Express/"+e.OrderBaseId,t+"/My/Points"),o=t+"/Order/RefundHistory/"+e.OrderBaseId,r="",n="",l="",s="";1!=e.PayStatus&&(parseInt(e.PointsBalancePay)>0&&parseFloat(e.PointCashPay)>0?s='<span class="thirdtext">( <i class="shellgrey"></i>'+e.PointsBalancePay+"+ &yen; "+e.PointCashPay+")</span>":parseFloat(e.PointCashPay)>0&&(s='<span class="thirdtext">( &yen; '+e.PointCashPay+")</span>")),e.RefundStatus!=-1,1==e.OrderStatus?(l='支付总额：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsQuantity)+" </span></span>",1==e.PayStatus?(r="等待买家付款",n='<li><a onclick="Global_OrderHelper.PageToGoodsPay('+e.OrderBaseId+')" href="#">我要付款</a></li><li data-id="'+e.OrderBaseId+'" class="BuyDetailCancleOrdel">关闭交易</li>',l='需支付：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsQuantity)+" </span></span>"):2==e.PayStatus?1==e.ExpressStatus?(r="等待卖家发货",n='<li date-id="'+e.OrderBaseId+'" onclick="Order_BuyDetail.ReminderDelivery(this)">提醒发货</li><li><a href="'+a+'">我要退款</a></li>'):2==e.ExpressStatus?(r="等待买家确认收货",n='<li><a href="'+a+'">我要退款</a></li><li id="BuyDetailConfirmExpress">确认收货</li>'):3==e.ExpressStatus&&(r="交易成功",n='<li><a href="'+i+'">查看贝壳</a></li>'):3==e.PayStatus?(r="退款中",n=1==e.ExpressStatus?0==e.RefundStatus?'<li id="BuyDetailCancelRefund">撤销申请</li>':'<li><a href="'+a+'">重新申请</a></li>':0==e.RefundStatus?'<li id="BuyDetailCancelRefund">撤销退款</li>':'<li><a href="'+a+'">重新退款</a></li>',n+='<li><a href="'+o+'">退款详情</a></li>'):4==e.PayStatus&&(r="退款成功",n='<li><a href="'+o+'">退款详情</a></li><li><a href="'+i+'">查看贝壳</a></li>')):2==e.OrderStatus?(4==e.PayStatus?(r="退款成功",n='<li><a href="'+o+'">退款详情</a></li><li><a href="'+i+'">查看贝壳</a></li>'):(r="交易成功",n='<li><a href="'+i+'">查看贝壳</a></li>'),l='支付总额：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsQuantity)+" </span></span>"):9==e.OrderStatus&&(r="交易关闭",n="",l='需支付：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsQuantity)+" </span></span>");for(var d="",c=0;c<e.OrderGoodsList.length;c++){var u=t+"/Optimization/Detail/"+e.OrderGoodsList[c].ProductBaseId;PropertyValue="",""!=e.OrderGoodsList[c].PropertyValueId1Name&&(PropertyValue='<p class="style">规格：'+e.OrderGoodsList[c].PropertyValueId1Name+"，款式："+e.OrderGoodsList[c].PropertyValueId2Name+"<span>x"+e.OrderGoodsList[c].GoodsQuantity+"</span></p>"),d+='<div class="item borderbottom clearfix"><a href="'+u+'"><div class="left"><img src="'+e.OrderGoodsList[c].GoodsImgPath+'@!standard_square_s" /></div><div class="right"><p>'+e.OrderGoodsList[c].GoodsTitle+"</p>"+PropertyValue+'<p class="price textcolorr"><span>'+Global_CommonHelper.GetPriceHtml(e.OrderGoodsList[c].GoodsPrice)+"</span></p></div></a></div>"}$(".laibei_page:last #BuyDetailItemList").append(d),$(".laibei_page:last #BuyDetailOrderState").html(r),$(".laibei_page:last #BuyDetailOrderCode").html("订单编号："+e.OrderCode),$(".laibei_page:last #BuyDetailCreateTime").html("下单时间："+e.CreateTime),$(".laibei_page:last #BuyDetailPaymentMethod").html("支付方式："+e.PaymentMethod),""==e.ContactName?$(".laibei_page:last .o-add").hide():($(".laibei_page:last #BuyDetailContactName").html("收件人："+e.ContactName),$(".laibei_page:last #BuyDetailContactPhone").html(e.ContactPhone),$(".laibei_page:last #BuyDetailFullAddress").html("收货地址："+e.FullAddress)),$(".laibei_page:last #BuyDetailGoodsCreateUserName").html(e.OrderGoodsList[0].GoodsCreateUserName),$(".laibei_page:last #BuyDetailOrderOper").html(n),$(".laibei_page:last #BuyDetailPricePart").html(l+s),$(".laibei_page:last #BuyDetailUserUrl").attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.OrderGoodsList[0].GoodsCreateUserId),""!=e.OrderRemark&&($(".laibei_page:last #BuyDetailRemark").html(e.OrderRemark),$(".laibei_page:last #BuyDetailRemark").parent().parent().show())}};this.BindChatEvent=function(e){var t=$(e).attr("date-userid"),a=$(e).attr("date-username"),i=$(e).attr("date-id");window.imChatDialog.chatWith({ClientID:t,Nickname:a,BaseID:i,LinkType:imPublic.enum.ChatMessage.Order})},this.ReminderDelivery=function(e){var t=$(e).attr("date-id");Global_OrderHelper.ReminderDelivery(t)}},Order_Confirm=new function(){var e;this.ConfirmIntit=function(a,i){e=new Global_BaseInfoHelper.GetToken;var o=0,r=new Global_StorageHelper.GetSessionToStorage("ChooseConsigneeId");void 0!=r&&null!=r.StorageData&&(o=r.StorageData);var n=t.GetApiDate(a,o);if(null!=n&&"00000000"==n.ResultNo){var l=t.GetGoodsDate(n,i);$("#OrderComfirmGoodsInfo").html(l);var s=t.GetConsigneeDate(n,i);$("#OrderComfirmConsignee").html(s),t.SetOrderDate(n,i),o=n.ConsigneeId}else Global_PopupHelper.alert({title:"数据获取失败，请重试"});var d=!1;$("#OrderConfirmSubmit").on("tap",function(t){if(t.preventDefault(),!d){d=!0;var r=$.trim($("#OrderComfirmRemark").val());if(1!=n.Status)return Global_PopupHelper.dialogautoclose({title:"商品已下架",timer:"2000",type:"2"}),void(d=!1);if(parseInt(n.GoodsQuantity)<i)return Global_PopupHelper.dialogautoclose({title:"库存不足",timer:"2000",type:"2"}),void(d=!1);if("0"==o)return Global_PopupHelper.dialogautoclose({title:"请选择收货地址",timer:"2000",type:"2"}),void(d=!1);var l=new OrderConfirmModel(a,o,i,r,e.Token);
$.ajax({url:Global_ServiceUrlHelper.Order_AddBase,type:"POST",data:{reqJson:JSON.stringify(l)},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.ResultNo?Global_OrderHelper.PageToGoodsPay(e.OrderBaseId):"undefined"!=typeof e&&null!=e.ResultRemark?(Global_PopupHelper.alert({title:e.ResultRemark}),d=!1):(Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),d=!1)},error:function(e){Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),d=!1}})}})};var t={GetApiDate:function(t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Goods_GetBaseConsigneeByUserId,type:"POST",data:{reqJson:'{"GoodsBaseId":'+t+',"Token":"'+e.Token+'","ConsigneeId":'+a+"}"},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},GetGoodsDate:function(e,t){for(var a=Global_ServiceUrlHelper.CurrentDomain+"/Optimization/Detail/"+e.ProductBaseId,i="",o=0;o<e.ImgList.length;o++)i+='<img src="'+e.ImgList[o].Path+'@!standard_square_m" alt="" />';var r="";return r=e.IsBusiness?'<a href="'+a+'"> <div class="left">'+i+'</div><div class="right"><div class="detail">'+e.GoodsTitle+'</div><div class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.GoodsPrice)+'</span></div><div class="location">规格：'+e.PropertyValueId1Name+"；款式："+e.PropertyValueId2Name+"<span>&times;"+t+"</span></div></div></a>":'<a href="'+a+'"> <div class="left">'+i+'</div><div class="right"><div class="detail">'+e.GoodsTitle+'</div><div class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.GoodsPrice)+'</span></div><div class="location">来自'+e.GoodsCityName+"</div></div></a>"},GetConsigneeDate:function(e,t){var a=Global_ServiceUrlHelper.CurrentDomain+"/My/AddressManage?returnUrl="+Global_ServiceUrlHelper.CurrentDomain+"/Order/Confirm/"+e.GoodsId+"?Quantity="+t;if("0"!=e.ConsigneeId){var i='<a class="clearfix" href="'+a+'"><span class="title">收货地址</span><span class="arrow iconfont">&#xe61e;</span></a><div class="addinfo thirdtext"><div class="line"><span class="name">'+e.ContactName+'</span><span class="tel">'+e.ContactPhone+'</span></div><div class="para">'+e.FullAddress+"</div></div>";return i}var o=Global_ServiceUrlHelper.CurrentDomain+"/My/AddAddress",i='<a class="clearfix" href="'+o+'"><span class="title">收货地址</span><span style="color:#9fa0a0;">新增</span><span class="arrow iconfont">&#xe61e;</span></a>';return i},SetOrderDate:function(e,t){$("#OrderConfirmPointsPay").html(Global_CommonHelper.GetPriceHtml(e.GoodsPrice*t))}};OrderConfirmModel=function(e,t,a,i,o){this.ConsigneeId=t,this.Token=o,this.OrderRemark=i;for(var r=new Array,n=0;n<1;n++)r[n]=new Array;r[0][0]=e,r[0][1]=a,this.GoodsList=r}},Order_Express=new function(){this.PageInit=function(e){var t=new Global_BaseInfoHelper.GetToken,a=Global_ExpressHelper.GetExpressDate(e,t.Token),i="";if(null!=a){if(""==a.LogisticCode||null==a.LogisticCode?($(".expressname").hide(),$(".expresslist").attr("style","margin-top: 1rem;")):($("#OrderExpressName").html(a.ShipperName),$("#OrderLogisticCode").html(a.LogisticCode)),null!=a.Traces&&a.Traces.length>0)for(var o=0;o<a.Traces.length;o++)i+='<li><span class="dot"></span><div class="event">'+a.Traces[o].AcceptStation+'</div><div class="time thirdtext">'+a.Traces[o].AcceptTime+"</div></li>";$("#OrderExpressList").html(i)}}},Order_Pay=new function(){var e=0,t=0,a=0,i=null,o="";this.PayInit=function(n,l,s){i=new Global_BaseInfoHelper.GetToken;var d=r.GetApiDate(n,i.Token),c="";a=n;var u=!1;if(Global_ApicloudHelper.IsApp()||Global_WeiXinHelper.IsWXBrowser()||$("#wxPay").hide(),null!=d&&"00000000"==d.ResultNo){if(o=d.GoodsTitle,"1"!=d.PayStatus&&""==s)return void Global_PopupHelper.dialogautoclose({title:"订单已支付",timer:"2000",confirmCallback:function(){$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Order/BuyDetail/"+n)}});if($("#OrderPayPointsUsable").html(d.PointsUsable+'<span class="gstotal">('+Global_CommonHelper.GetPriceHtml(d.PointsUsable)+")</span>"),$("#OrderPayGoodsPay").html("&yen; "+Number(d.PointsQuantity/10).toFixed(2)),""!=s){var p=r.GetPayDetail(s,n);if(null!=p&&"00000000"==p.ResultNo){if(1==p.Status){t=parseInt(10*p.Amount);var h=t,m=Number(h/10).toFixed(2),g="";t<parseInt(d.PointsQuantity)?(g+='(<i class="shellgrey"></i>'+d.PointsUsable+" +",e=parseInt(d.PointsUsable),g+=" &yen; "+m,g+=" )"):(e=0,$("#OrderPayPointSelect").removeClass("selectpoint").addClass("unselectpoint"),$("#OrderPaySendVerifyCode").attr("disabled","disabled").addClass("regetvalidcodebtn"),$("#OrderPaySendVerifyCode").parents(".sectc").css("opacity",".7")),c="&yen; "+m,$("#zfbOrderPaySelect").addClass("selected"),$("#zfbPricePartOrderPay").html(c),$("#OrderPayTotalPoint").html(g)}1==p.Status&&"1"!=d.PayStatus&&(u=!0)}u?CashPaySucess(s):CashPayErr()}else{var g="";if(parseInt(d.PointsUsable)>0?g+=parseInt(d.PointsUsable)<parseInt(d.PointsQuantity)?'(<i class="shellgrey"></i>'+d.PointsUsable+" +":'(<i class="shellgrey"></i>'+d.PointsQuantity+")":0==parseInt(d.PointsUsable)&&($("#OrderPayPointsUsable").addClass("thirdtext"),$("#OrderPayPointSelect").removeClass("selectpoint").addClass("unselectpoint"),$("#OrderPaySendVerifyCode").attr("disabled","disabled").addClass("regetvalidcodebtn"),$("#OrderPaySendVerifyCode").parents(".sectc").css("opacity",".7"),$(".accountline").remove()),parseInt(d.PointsUsable)<parseInt(d.PointsQuantity)){var h=parseInt(d.PointsQuantity)-parseInt(d.PointsUsable),m=Number(h/10).toFixed(2);c="&yen; "+m,Global_WeiXinHelper.IsWXBrowser()?($("#wxOrderPaySelect").addClass("selected"),$("#wxPricePartOrderPay").html(c)):($("#zfbOrderPaySelect").addClass("selected"),$("#zfbPricePartOrderPay").html(c)),parseInt(d.PointsUsable)>0&&(g+=" &yen; "+m,g+=" )")}$("#OrderPayTotalPoint").html(g),parseInt(d.PointsUsable)>0&&SendValidCode()}}else Global_PopupHelper.alert({title:"数据获取失败，请重试"});$("#OrderPaySendVerifyCode").on("tap",function(e){e.preventDefault(),Global_ValidCodeHelper.GetValidCode(31,"OrderPayTel","OrderPaySendVerifyCode"),ShowSendPrompt()}),$(".OrderPaySelect").on("tap",function(e){if(e.preventDefault(),$(".selectpays").removeClass("selected"),$(this).children(".selectpays").addClass("selected"),$(".selectpays").siblings(".cprice").html(""),parseInt(d.PointsUsable)>=parseInt(d.PointsQuantity)){var t=parseInt(d.PointsQuantity),a=Number(t/10).toFixed(2);c="&yen; "+a;var i="";$("#OrderPayTotalPoint").html(i),$("#OrderPayPointSelect").removeClass("selectpoint").addClass("unselectpoint")}$(this).children(".selectpays").siblings(".cprice").html(c)}),$("#OrderPayPointSelect").on("tap",function(e){if(e.preventDefault(),0!=parseInt(d.PointsUsable)){var t=$(this),a="";c="";var i=0,o=0;$("#OrderPayPointSelect").hasClass("selectpoint")?(i=parseInt(d.PointsQuantity),o=Number(i/10).toFixed(2),c="&yen; "+o,$(".selectpays").hasClass("selected")||$("#zfbOrderPaySelect").addClass("selected"),t.removeClass("selectpoint").addClass("unselectpoint")):(parseInt(d.PointsUsable)<parseInt(d.PointsQuantity)?(i=parseInt(d.PointsQuantity)-parseInt(d.PointsUsable),o=Number(i/10).toFixed(2),c="&yen; "+o,a='(<i class="shellgrey"></i>'+d.PointsUsable+" + &yen; "+o+" )"):(i=parseInt(d.PointsQuantity),o=Number(i/10).toFixed(2),c="&yen; "+o,a='(<i class="shellgrey"></i>'+d.PointsQuantity+" )",$(".selectpays").removeClass("selected"),$(".selectpays").siblings(".cprice").html("")),t.removeClass("unselectpoint").addClass("selectpoint")),$("#OrderPayTotalPoint").html(a),$(".selected").siblings(".cprice").html(c)}}),$("#OrderPayConfirm").on("tap",function(a){a.preventDefault();var o=$("#OrderPayValidCode").val(),r=0;if($("#OrderPayPointSelect").hasClass("selectpoint")){if(""==o)return Global_PopupHelper.alert({title:"验证码不能为空"}),!1;if(4!=o.length)return Global_PopupHelper.alert({title:"验证码位数错误"}),!1;if(parseInt(d.PointsUsable)<parseInt(d.PointsQuantity))e=parseInt(d.PointsUsable),r=parseInt(d.PointsQuantity)-parseInt(d.PointsUsable),t=Number(r/10).toFixed(2),CashPay();else{e=parseInt(d.PointsQuantity);var l=new PayModel(o,n,e,i.Token);PointPay(l)}}else r=parseInt(d.PointsQuantity),t=Number(r/10).toFixed(2),CashPay()}),$("#PromptTopBack").on("tap",function(e){e.preventDefault(),Global_ReturnHelper.PayPageReturn()})},SendValidCode=function(){if(Global_ValidCodeHelper.GetCodeCache("OrderPayTel","OrderPaySendVerifyCode",31),!$("#OrderPaySendVerifyCode").prop("disabled")){var e=new Global_ValidCodeHelper.GetCodeCacheTime(31);(e.StartTime>600||e.StartTime<0)&&Global_ValidCodeHelper.GetValidCode(31,"OrderPayTel","OrderPaySendVerifyCode")}ShowSendPrompt()},ShowSendPrompt=function(){$("#OrderPaySendVerifyCode").prop("disabled")&&$(".validcodePrompt").html("验证码已发往"+$("#OrderPayTel").val().replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")).show()};var r={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetBaseById,type:"POST",data:{reqJson:'{"OrderBaseId":'+e+',"Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a}};PayModel=function(e,t,a,i){this.ValidCode=e,this.OrderBaseId=t,this.PayPoints=a,this.Token=i},PointPay=function(e){$.ajax({url:Global_ServiceUrlHelper.Order_Pay,type:"POST",data:{reqJson:JSON.stringify(e)},dataType:"json",async:!1,success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?PointPaySuccess():"undefined"!=typeof e.ResultRemark?"10010033"!=e.ResultNo&&Global_PopupHelper.alert({title:"对不起，支付失败",content:e.ResultRemark}):Global_PopupHelper.alert({title:"对不起，支付失败"})},error:function(e){Global_PopupHelper.alert({title:"对不起，支付失败"})}})},PointPaySuccess=function(){Global_StorageHelper.DelSessionByKey("validCodeCache31"),$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Order/PaySucess/"+a)},CashPay=function(){var r=0;e>0&&(r=1),$.ajax({url:Global_ServiceUrlHelper.Order_CheckPayment,type:"POST",data:{reqJson:'{"ValidCode":"'+$("#OrderPayValidCode").val()+'","OrderBaseId":'+a+',"PayPoints":'+e+',"IsMixPay":'+r+',"Token":"'+i.Token+'"}'},dataType:"json",async:!1,success:function(e){if("undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo)if("zfbOrderPaySelect"==$(".selected").attr("id")){var i=Global_ServiceUrlHelper.CurrentDomain+"/Pay/GoodsPay?id="+a;Global_AlipayHelper.Pay(t,"商品购买",i,"商品购买支出【"+o+"】",1,a,CashPaySucess,CashPayErr)}else"wxOrderPaySelect"==$(".selected").attr("id")?Global_WeiXinHelper.Pay(t,"商品购买",1,a,CashPaySucess,CashPayErr):"bankOrderPaySelect"==$(".selected").attr("id")&&alert("支付宝支付未做");else"undefined"!=typeof e.ResultRemark?Global_PopupHelper.alert({title:"对不起，支付失败",content:e.ResultRemark}):Global_PopupHelper.alert({title:"对不起，支付失败"})},error:function(e){Global_PopupHelper.alert({title:"对不起，支付失败"})}})},CashPaySucess=function(e){PointPaySuccess()},CashPayErr=function(){Global_PopupHelper.alert({title:"支付遇到阻碍，再试一次吧",btnName:"好的"})}},Order_PaySucess=new function(){this.PaySucessIntit=function(t){var a=new Global_BaseInfoHelper.GetToken,i=e.GetApiDate(t,a.Token);if(null!=i&&"00000000"==i.ResultNo){$("#OrderPaySucessPointPay").html(i.PointsQuantity);var o="(",r="";parseInt(i.PointsBalancePay)>0&&(o+='<i class="shellgrey"></i>'+i.PointsBalancePay,r+="贝壳",parseFloat(i.PointCashPay)>0&&(o+=" +",r+="+")),parseFloat(i.PointCashPay)>0&&(o+=" &yen; "+i.PointCashPay,r+="现金",o+=" )",$("#OrderPaySucessPricePart").html(o)),$("#OrderPaySucessGoodsTitle").html(i.GoodsTitle),$("#OrderPayLastUpdateTime").html(i.LastUpdateTime),$("#OrderPaySucessOrderCode").html(i.OrderCode),"1"==i.PayStatus&&$("#OrderPaySucessPayStatus").html("支付失败"),$("#OrderPaySucessCNPricePart").html(r)}else Global_PopupHelper.alert({title:"数据获取失败，请重试"});$("#OnlySureConfirm").on("tap",function(e){e.preventDefault();var t=Global_ServiceUrlHelper.CurrentDomain+"/My/BuyIn/";$.mobile.changePage(t)})};var e={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetBaseById,type:"POST",data:{reqJson:'{"OrderBaseId":'+e+',"Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a}}},Order_RefundHistory=new function(){var e=!1;this.RefundHistoryInit=function(a,i){var o=new Global_BaseInfoHelper.GetToken,r=t.GetApiDate(a,o.Token);if(null!=r&&"00000000"==r.ResultNo)if(i!=r.GoodsCreateUserId&&i!=r.CreateUserId)$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/My/BuyIn");else{t.SetGoodsHtml(r,i);var n=t.ListStrBuilder(r,i);$("#RefundHistoryList").html(n)}else Global_ReturnHelper.ReturnHistoryPage();$("#RefundHistoryCancelRefund").on("tap",function(t){t.preventDefault(),e||(e=!0,Global_PopupHelper.confirm({title:"确定要撤销退款申请吗？",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_CancelRefund,type:"POST",data:{reqJson:'{"OrderBaseId":'+a+',"Token":"'+o.Token+'"}'},dataType:"json",success:function(t){"undefined"!=typeof t&&"00000000"==t.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){$("#RefundHistoryStatusName").html("退款中");var e='<div class="title borderbottom"><div class="pad"><span>我</span><span class="time">'+Global_CommonHelper.Format(new Date,"yyyy-MM-dd hh:mm")+'</span></div></div><div class="con"><p>【买家撤销了退货退款申请】</p></div>';$(".tkinfo:last").html(e),$("#RefundHistoryHandList").html('<li><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/Order/ApplyRefund/"+a+'">我要退款</a></li>')}}):"undefined"!=typeof t&&null!=t.ResultRemark?Global_PopupHelper.alert({title:t.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),e=!1}})},cancelCallback:function(){e=!1}}))}),$("#RefundHistoryConfrimRefund").on("tap",function(t){t.preventDefault();var i=this;if(!e){e=!0;var r=$(i).attr("data-price");Global_PopupHelper.confirm({title:" 同意退款后 "+r+"贝壳 将退回买家账号",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_BaseRefund,type:"POST",data:{reqJson:'{"OrderBaseId":'+a+',"Token":"'+o.Token+'","RefundType":1}'},dataType:"json",success:function(t){if("undefined"!=typeof t&&"00000000"==t.ResultNo){$("#RefundHistoryStatusName").html("退款成功");'<div class="title borderbottom"><div class="pad"><span></</span><span class="time">'+Global_CommonHelper.Format(new Date,"yyyy-MM-dd hh:mm")+'</span></div></div><div class="con"><p>【卖家已同意申请】</p><p>卖家同意了本次退款申请</p><p>退款给买家'+r+"贝壳</p></div>";$(".tkinfo:last").html(CancelRefundStr),$("#RefundHistoryHandDiv").hide()}else{var a="操作失败";"undefined"!=typeof t&&null!=t.ResultRemark&&(a=t.ResultRemark),Global_PopupHelper.alert({title:a})}e=!1}})},cancelCallback:function(){e=!1}})}}),null!=$(".restTime-timer")&&$(".restTime-timer").length>0&&t.RestTimeTimer()};var t={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetRefundListByOrderId,type:"POST",data:{reqJson:'{"OrderBaseId":'+e+',"Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},SetGoodsHtml:function(e,t){var a=Global_ServiceUrlHelper.CurrentDomain+"/Order/BuyDetail/"+e.OrderBaseId;e.GoodsCreateUserId==t&&(a=Global_ServiceUrlHelper.CurrentDomain+"/Order/SellDetail/"+e.OrderBaseId);var i='<a href="'+a+'"><img src="'+e.GoodsImgPath+'@!standard_square_s" alt="" /><p class="title">'+e.GoodsTitle+'</p><p class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsPay)+'</span></p><p id="RefundHistoryStatusName">'+e.OrderStatusName+"</p></a>";$("#RefundHistoryGoods").html(i)},ListStrBuilder:function(e,t){var a="",i="我",o="卖家";e.GoodsCreateUserId==t&&(i="买家",o="我");for(var r=Global_ServiceUrlHelper.CurrentDomain+"/Order/RefuseRefund/"+e.OrderBaseId,n=Global_ServiceUrlHelper.CurrentDomain+"/Order/ApplyRefund/"+e.OrderBaseId,l=0;l<e.RefundList.length;l++){var s="",d="",c="",u="",p="";if(null!=e.RefundList[l].RefundImgList&&e.RefundList[l].RefundImgList.length>0){c='<p class="pz"><span>凭证：</span>';for(var h=0;h<e.RefundList[l].RefundImgList.length;h++)c+='<span class="pzi"><img src="'+e.RefundList[l].RefundImgList[h].Path+'@!standard_square_s" /></span>';c+="</p>"}if(null!=e.RefundList[l].ReplyImgList&&e.RefundList[l].ReplyImgList.length>0){u='<p class="pz"><span>凭证：</span>';for(var h=0;h<e.RefundList[l].ReplyImgList.length;h++)u+='<span class="pzi"><img src="'+e.RefundList[l].ReplyImgList[h].Path+'@!standard_square_s" /></span>';u+="</p>"}if(""!=e.RefundList[l].RefundCauseType&&(s='<section class="tkinfo"><div class="title borderbottom"><div class="pad"><span>'+i+'</span><span class="time">'+e.RefundList[l].CreateTime+'</span></div></div><div class="con"><p>【买家发起了退货退款申请】</p><p>退款原因：'+e.RefundList[l].RefundCauseType+"；</p><p>退款说明："+e.RefundList[l].RefundCauseTxt+"</p><p>退款金额："+e.PointsPay+"贝壳；</p>"+c+"</div></section>"),0==e.RefundList[l].Status)d=t==e.CreateUserId?'<section class="tkinfo"><div class="title borderbottom"><div class="pad"><span>来呗平台</span><span class="time"></span></div></div><div class="con"><p>等待卖家处理</p><p>卖家同意或者在<span class="restTime-timer" data-date='+e.RestTime+'>...</span>内未处理，系统将退款给您；</p><p class="refund-tipmsg"> 如果卖家发货，本次申请将关闭，如果还有问题，您可以再次发起申请；</p></div></section>':'<section class="tkinfo"><div class="title borderbottom"><div class="pad"><span>来呗平台</span><p class="time">剩 <span class="restTime-timer" data-date="'+e.RestTime+'">...</span></p></div></div><div class="con"><p>请处理退款</p><p class="refund-tipmsg">如未发货，请点击同意退款给买家；</p><p class="refund-tipmsg-hide">如实际已发货，请主动与买家联系确认后再去订单详情页面操作发货；</p><p class="refund-tipmsg-hide">逾期未处理，系统将自动退款给买家；</p></div></section>';else if(1==e.RefundList[l].Status){var m="";t==e.CreateUserId&&(m="（其中："+e.PaymentMethod+"） "),d='<section class="tkinfo"><div class="title borderbottom"><div class="pad"><span>'+o+'</span><span class="time">'+e.RefundList[l].ReplyTime+'</span></div></div><div class="con"><p>【卖家已同意申请】</p><p>'+(1===e.RefundList[l].RefundType?"卖家同意了本次退款申请":"超时系统自动处理为同意退款申请")+"</p><p>退款给买家"+e.PointsPay+"贝壳"+m+"</p></div></section>"}else 2==e.RefundList[l].Status?d='<section class="tkinfo"><div class="title borderbottom"><div class="pad"><span>'+o+'</span><span class="time">'+e.RefundList[l].ReplyTime+'</span></div></div><div class="con"><p>【卖家拒绝了退款申请】</p><p>拒绝原因：'+e.RefundList[l].ReplyCauseType+"；</p><p>拒绝说明："+e.RefundList[l].ReplyCauseTxt+"</p>"+u+"</div></section>":3==e.RefundList[l].Status&&(d='<section class="tkinfo"><div class="title borderbottom"><div class="pad"><span>'+i+'</span><span class="time">'+e.RefundList[l].ReplyTime+'</span></div></div><div class="con"><p>【买家撤销了退货退款申请】</p></div></section>');0==l&&(0==e.RefundList[l].Status?p=t==e.CreateUserId?'<li id="RefundHistoryCancelRefund">撤销退款</li>':'<li><a href="'+r+'">拒绝退款</a></li><li id="RefundHistoryConfrimRefund" data-price="'+e.PointsPay+'">同意退款</li>':2==e.RefundList[l].Status?t==e.CreateUserId&&(p='<li><a href="'+n+'">修改申请</a></li>'):3==e.RefundList[l].Status&&t==e.CreateUserId&&(p='<li><a href="'+n+'">我要退款</a></li>'),$("#RefundHistoryHandList").html(p),$("#RefundHistoryHandDiv").show()),a+=d+s}return a},RestTimeTimer:function(){var e=$(".restTime-timer"),t=e.data("date"),a=t.split("-"),i=parseInt(a[0]),o=parseInt(a[1]),r=parseInt(a[2])||0,n=parseInt(a[3])||0,l=24*i*60*60+60*o*60+60*r+n;l>0?setInterval(function(){i=Math.floor(l/86400),o=Math.floor(l/3600)-24*i,r=Math.floor(l/60)-24*i*60-60*o,n=Math.floor(l)-24*i*60*60-60*o*60-60*r;var t=' <span class="textcolorr">'+(i<9?"0"+i.toString():i.toString())+'</span> 天 <span class="textcolorr">'+(o<9?"0"+o.toString():o.toString())+'</span> 时 <span class="textcolorr">'+(r<9?"0"+r.toString():r.toString())+'</span> 分 <span class="textcolorr">'+(n<9?"0"+n.toString():n.toString())+"</span> 秒 ";e.html(t),l--},1e3):(e.html(" 00 天 00 时 00 分 00 秒").parent("p").hide(),$(".refund-tipmsg").html("超时系统自动处理为同意退款，退款成功；"),$(".refund-tipmsg-hide").hide(),$("#RefundHistoryHandDiv").hide())}}},Order_RefuseRefund=new function(){this.RefuseRefundInit=function(t,a){var i=new Global_BaseInfoHelper.GetToken,o=e.GetApiDate(t,i.Token);if(null!=o&&"00000000"==o.ResultNo){o.GoodsCreateUserId!=a&&$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/My/SellOut");var r=e.GetRefundCauseList(o);$("#ReplyCauseTxt").val(o.ReplyCauseTxt),$("#RefuseCauseList").html(r);var n=e.GetPicList(o);$(".pic-group li:last").before(n),3!=o.PayStatus&&Global_PopupHelper.alert({title:"订单状态已改变，请刷新后操作",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}})}else $.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/My/SellOut");var l=0;Article_ImgHelper.ChangeMaxImgCount(3),Article_ImgHelper.ArticleImgFun(l),$(".oarcause").on("tap",function(){$(".refundcause").slideDown()}),$("#qxoarcause").on("tap",function(){$(".refundcause").slideUp()}),$("#qroarcause").on("tap",function(){$("#RefuseArcause").html($(".refundcause .item .active").html()).attr("data-type",$(".refundcause .item .active").attr("data-type")).removeClass("thirdtext"),$(".refundcause").slideUp()}),$(".refundcause .item a").on("tap",function(){$(".refundcause .item .active").removeClass("active"),$(this).addClass("active")}),$("#RefuseRefundConfirm").on("tap",function(){$("#RefuseRefundConfirm").attr("disabled",!0);var e=$("#RefuseArcause").attr("data-type"),t=$("#ReplyCauseTxt").val(),a=$("li[data-role='img']"),r="";if($.each(a,function(e,t){r+=$(t).find("img").attr("data-imgbaseid")+","}),""==e)return Global_PopupHelper.alert({title:"请选择拒绝原因"}),void $("#RefuseRefundConfirm").removeAttr("disabled");var n=new ReplyObject(o.RefundId,e,t,r,i.Token);$.ajax({url:Global_ServiceUrlHelper.Order_ReplyRefundByOrderId,type:"POST",data:{reqJson:JSON.stringify(n)},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"提交成功",timer:"2000",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):"undefined"!=typeof e&&null!=e.ResultRemark?(Global_PopupHelper.alert({title:e.ResultRemark}),$("#RefuseRefundConfirm").removeAttr("disabled")):(Global_PopupHelper.dialogautoclose({title:"提交失败",timer:"2000",type:"2"}),$("#RefuseRefundConfirm").removeAttr("disabled"))}})})};var e={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetReplyByOrderId,type:"POST",data:{reqJson:'{"OrderBaseId":"'+e+'","Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},GetRefundCauseList:function(e){var t="";if(null==e.ReplyCauseList)return t;for(var a=0;a<e.ReplyCauseList.length;a++){var i="";e.ReplyCauseList[a].Type==e.ReplyCauseType&&(i="active",$("#RefuseArcause").html(e.ReplyCauseList[a].Name).attr("data-type",e.ReplyCauseList[a].Type).removeClass("thirdtext")),t+='<a href="#" data-type="'+e.ReplyCauseList[a].Type+'" class="'+i+'">'+e.ReplyCauseList[a].Name+"</a>"}return t},GetPicList:function(e){var t="";if(null==e.ReplyImgList)return t;for(var a=0;a<e.ReplyImgList.length;a++)t+='<li data-role="img" onclick="Article_ImgHelper.LiImgClick(this)"><img src="'+e.ReplyImgList[a].Path+'@!standard_square_s" data-imgbaseid="'+e.ReplyImgList[a].Id+'"><span class="delimg" onclick="Article_ImgHelper.SpanDelImg(this)"></span></li>';return e.ReplyImgList.length>=3&&$("li[data-role='addfile']").hide(),t}};ReplyObject=function(e,t,a,i,o){this.RefundId=e,this.ReplyCauseType=t,this.ReplyCauseTxt=a,this.Img=i,this.Token=o}},Order_SellDetail=new function(){var e=!1;this.SellDetailInit=function(a){var i=new Global_BaseInfoHelper.GetToken,o=t.GetApiDate(a,i.Token);if(null!=o&&"00000000"==o.ResultNo){if(t.SetDetailHtml(o),1!=o.ExpressStatus){var r="";if(o.IsLineExpress)r='<a href="#"><p>【线下交易】</p></a>';else{var n=Global_ExpressHelper.GetExpressDate(a,i.Token);null!=n&&null!=n.Traces&&n.Traces.length>0&&(r='<a href="'+Global_ServiceUrlHelper.CurrentDomain+"/Order/Express/"+a+'"><p>【物流信息】</p><p>'+n.Traces[0].AcceptStation+"</p><p>"+n.Traces[0].AcceptTime+'</p><span class="arrow iconfont">&#xe61e;</span></a>')}$(".laibei_page:last #SellDetailWuliu").html(r).show()}imPublic.bindChatEvent({ClientID:o.CreateUserId,Nickname:o.CreateUserName,BaseID:a,LinkType:imPublic.enum.ChatMessage.Order})}$(".laibei_page:last #SellDetailChangeOrdelPrice").on("tap",function(t){t.preventDefault();var a=this;if(!e){e=!0;var o=$(a).attr("data-id"),r=$(a).attr("data-price");Global_PopupHelper.prompt({title:"修改订单价格",inputPlaceholder:"输入订单价格",inputValue:r,type:"2",inputtitle:"&yen; ",inputMethod:function(){Global_CommonHelper.ChechNumberOneDecimal(document.getElementById("GlobalPromptInput"),5)},confirmCallback:function(){var t=$("#GlobalPromptInput").val();10*parseFloat(t);var a=/^(999999|[1-9]\d{0,5}|1)$/;return a.test(t)?void $.ajax({url:Global_ServiceUrlHelper.Order_ChangeBasePice,type:"POST",data:{reqJson:'{"OrderBaseId":'+o+',"OrderPice":'+t+',"Token":"'+i.Token+'"}'},dataType:"json",success:function(a){"undefined"!=typeof a&&"00000000"==a.ResultNo?Global_PopupHelper.dialogautoclose({title:"操作成功",timer:"2000",confirmCallback:function(){$("#SellDetailPointsQuantity").html(Global_CommonHelper.GetPriceHtml(t)),$("#SellDetailPricePart").html('订单总额：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(t)+" </span></span>")}}):"undefined"!=typeof a&&null!=a.ResultRemark?Global_PopupHelper.alert({title:a.ResultRemark}):Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),e=!1}}):(Global_PopupHelper.alert({title:Global_MessageHelper.PriceErr}),void(e=!1))},cancelCallback:function(){e=!1}})}}),$(".laibei_page:last #SellDetailConfrimRefund").on("tap",function(t){t.preventDefault();var o=this;if(!e){e=!0;var r=$(o).attr("data-price");Global_PopupHelper.confirm({title:" 同意退款后 "+Global_CommonHelper.GetPriceHtml(r)+" 将退回买家账号",confirmCallback:function(){$.ajax({url:Global_ServiceUrlHelper.Order_BaseRefund,type:"POST",data:{reqJson:'{"OrderBaseId":'+a+',"Token":"'+i.Token+'"}'},dataType:"json",success:function(t){if("undefined"!=typeof t&&"00000000"==t.ResultNo){var i=Global_ServiceUrlHelper.CurrentDomain+"/Order/RefundHistory/"+a,o=Global_ServiceUrlHelper.CurrentDomain+"/My/Points",r="退款成功",n='<li><a href="'+i+'">退款详情</a></li><li><a href="'+o+'">查看贝壳</a></li>';$("#SellDetailOrderState").html(r),$("#SellDetailOrderOper").html(n)}else{var l="操作失败";"undefined"!=typeof t&&null!=t.ResultRemark&&(l=t.ResultRemark),Global_PopupHelper.alert({title:l})}e=!1}})},cancelCallback:function(){e=!1}})}})};var t={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetBaseDetailByID,type:"POST",data:{reqJson:'{"OrderBaseId":"'+e+'","type":1,"Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},SetDetailHtml:function(e){var t=Global_ServiceUrlHelper.CurrentDomain,a=t+"/Order/RefuseRefund/"+e.OrderBaseId,i=t+"/Order/SendGoods/"+e.OrderBaseId,o=(t+"/Order/Express/"+e.OrderBaseId,t+"/My/Points"),r=t+"/Order/RefundHistory/"+e.OrderBaseId,n="",l="",s="",d="";1!=e.PayStatus&&(d="(",parseInt(e.PointsBalancePay)>0&&(d+='<i class="shellgrey"></i>'+e.PointsBalancePay,parseFloat(e.PointCashPay)>0&&(d+=" +")),parseFloat(e.PointCashPay)>0&&(d+=" &yen; "+e.PointCashPay),d+=" )"),e.RefundStatus!=-1,1==e.OrderStatus?(s='订单总额：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsQuantity)+" </span></span>",1==e.PayStatus?(n="等待买家付款",l='<li id="SellDetailChangeOrdelPrice" data-id="'+e.OrderBaseId+'" data-price="'+e.PointsQuantity+'">修改价格</li>',s='订单总额：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsQuantity)+" </span></span>"):2==e.PayStatus?1==e.ExpressStatus?(n="等待卖家发货",l='<li><a href="'+i+'">我要发货</a></li>'):2==e.ExpressStatus?(n="等待买家确认收货",l='<li>提醒收货</li><li><a href="'+i+'">修改物流</a></li>'):3==e.ExpressStatus&&(n="交易成功",l='<li><a href="'+o+'">查看贝壳</a></li>'):3==e.PayStatus?(n="退款中",l='<li><a href="'+r+'">退款详情</a></li><li><a href="'+a+'">拒绝退款</a></li><li id="SellDetailConfrimRefund" data-price="'+e.PointsQuantity+'">同意退款</li>'):4==e.PayStatus&&(n="退款成功",l='<li><a href="'+r+'">退款详情</a></li><li><a href="'+o+'">查看贝壳</a></li>')):2==e.OrderStatus?(4==e.PayStatus?(n="退款成功",l='<li><a href="'+r+'">退款详情</a></li><li><a href="'+o+'">查看贝壳</a></li>'):(n="交易成功",l='<li><a href="'+o+'">查看贝壳</a></li>'),s='订单总额：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsQuantity)+" </span></span>"):9==e.OrderStatus&&(n="交易关闭",l="",s='订单总额：<span class="price"><span>'+Global_CommonHelper.GetPriceHtml(e.PointsQuantity)+" </span></span>");for(var c="",u=0;u<e.OrderGoodsList.length;u++){var p=t+"/Optimization/Detail/"+e.OrderGoodsList[u].ProductBaseId;PropertyValue="",""!=e.OrderGoodsList[u].PropertyValueId1Name&&(PropertyValue='<p class="style">规格：'+e.OrderGoodsList[u].PropertyValueId1Name+"，款式："+e.OrderGoodsList[u].PropertyValueId2Name+"<span>x"+e.OrderGoodsList[u].GoodsQuantity+"</span></p>"),c+='<div class="item borderbottom clearfix"><a href="'+p+'"><div class="left"><img src="'+e.OrderGoodsList[u].GoodsImgPath+'@!standard_square_s" /></div><div class="right"><p>'+e.OrderGoodsList[u].GoodsTitle+"</p>"+PropertyValue+'<p class="price textcolorr"><span>'+Global_CommonHelper.GetPriceHtml(e.OrderGoodsList[u].GoodsPrice)+"</span></p></div></a></div>"}$(".laibei_page:last #SellDetailItemList").html(c),$(".laibei_page:last #SellDetailOrderState").html(n),$(".laibei_page:last #SellDetailOrderCode").html("订单编号："+e.OrderCode),$(".laibei_page:last #SellDetailCreateTime").html("下单时间："+e.CreateTime),$(".laibei_page:last #SellDetailPaymentMethod").html("支付方式："+e.PaymentMethod),""==e.ContactName?$(".laibei_page:last .o-add").hide():($(".laibei_page:last #SellDetailContactName").html("收件人："+e.ContactName),$(".laibei_page:last #SellDetailContactPhone").html(e.ContactPhone),$(".laibei_page:last #SellDetailFullAddress").html("收货地址："+e.FullAddress)),$(".laibei_page:last #SellDetailOrderOper").html(l),$(".laibei_page:last #SellDetailPricePart").html(s+d),""!=e.OrderRemark&&($(".laibei_page:last #SellDetailRemark").html(e.OrderRemark),$(".laibei_page:last #SellDetailRemark").parent().parent().show())}}},Order_SendGoods=new function(){this.SendGoodsInit=function(t,a){var i=new Global_BaseInfoHelper.GetToken,o=e.GetApiDate(t,i.Token);if(null!=o&&"00000000"==o.ResultNo){o.GoodsCreateUserId!=a&&$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/My/SellOut"),$("#SendGoodsContactName").html(o.ContactName),$("#SendGoodsContactPhone").html(o.ContactPhone),$("#SendGoodsFullAddress").html(o.FullAddress),$("#SendGoodsExpressCode").val(o.ExpressCode),"G13_LineExpress"==o.ExpressName&&($(".wlgs").hide(),$(".kddh").hide(),$(".selectfs.checked").removeClass("checked"),$(".selectfs[data-type=2]").addClass("checked"));var r=e.GetExpressList(o);$("#SendGoodsExpressList").html(r),2!=o.PayStatus&&Global_PopupHelper.alert({title:"订单状态已改变，请刷新后操作",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}})}else $.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/My/SellOut");$(".selectfs").on("tap",function(e){e.preventDefault(),"1"!==$(this).attr("data-type")?($(".wlgs").hide(),$(".kddh").hide()):($(".wlgs").show(),$(".kddh").show()),$(".selectfs.checked").removeClass("checked"),$(this).addClass("checked")}),$("#SendGoodsChooseExpress").on("tap",function(e){e.preventDefault(),$("#SendGoodsPageDiv").hide(),$("#ExpressPageDiv").show()}),$("#SendExpressBack").on("tap",function(e){e.preventDefault(),$("#SendGoodsPageDiv").show(),$("#ExpressPageDiv").hide()}),$(".borderbottom").on("tap",function(e){e.preventDefault();var t=this;$("#SendGoodsExpressName").html($(t).attr("data-name")).attr("data-type",$(t).attr("data-type")).attr("date-code",$(t).attr("data-code")),$("#SendGoodsPageDiv").show(),$("#ExpressPageDiv").hide()}),$("#SendGoodsConfirm").on("tap",function(e){e.preventDefault(),$("#SendGoodsConfirm").attr("disabled",!0);var a=$(".selectfs.checked").attr("data-type"),o=$("#SendGoodsExpressName").attr("data-type"),r=$("#SendGoodsExpressCode").val().trim();if(1==a){if(""==o)return Global_PopupHelper.alert({title:"请选择物流公司"}),void $("#SendGoodsConfirm").removeAttr("disabled");if(""==r)return Global_PopupHelper.alert({title:"请输入快递单号"}),void $("#SendGoodsConfirm").removeAttr("disabled");if(r.length<10)return Global_PopupHelper.alert({title:"快递单号需为10-18字符"}),void $("#SendGoodsConfirm").removeAttr("disabled");
}var n=new ExpressModel(t,a,o,r,i.Token);$.ajax({url:Global_ServiceUrlHelper.Order_SendGoodsByOrderId,type:"POST",data:{reqJson:JSON.stringify(n)},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"发货成功",timer:"2000",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):"undefined"!=typeof e&&null!=e.ResultRemark?(Global_PopupHelper.alert({title:e.ResultRemark}),$("#SendGoodsConfirm").removeAttr("disabled")):(Global_PopupHelper.dialogautoclose({title:"发货失败",timer:"2000",type:"2"}),$("#SendGoodsConfirm").removeAttr("disabled"))}})})};var e={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Order_GetSendGoodsByOrderId,type:"POST",data:{reqJson:'{"OrderBaseId":"'+e+'","Token":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},GetExpressList:function(e){var t="";if(null==e.ExpressList)return t;for(var a=0;a<e.ExpressList.length;a++)e.ExpressList[a].Type==e.ExpressName&&$("#SendGoodsExpressName").html(e.ExpressList[a].Name).attr("data-type",e.ExpressList[a].Type).attr("date-code",e.ExpressList[a].Code),t+='<li class="borderbottom" data-type="'+e.ExpressList[a].Type+'" data-code="'+e.ExpressList[a].Code+'" data-name="'+e.ExpressList[a].Name+'"><div class="localname"><h1>'+e.ExpressList[a].Name+"</h1></div></li>";return t}};ExpressModel=function(e,t,a,i,o){this.OrderBaseId=e,this.ExpressType=t,this.ExpressName=a,this.ExpressCode=i,this.Token=o}},Pay_AddCard=new function(){function e(e,t,a,i,o,r,n,l){this.AccountName=e,this.Bank=t,this.ProvinceId=i,this.CityId=o,this.DistrictId=r,this.OpeningBank=a,this.CardNumber=n,this.Token=l}CurrentMainPage="",this.AddCardInit=function(){$("#addcard_address").on("tap",function(e){e.preventDefault(),Global_GeoCoderHelper.ShowCorePage("ReleaseContent",0,"",1),Global_GeoCoderHelper.AddressDocumentName="PayAddCardCoder",$(".BaiDuAddress").html($("#PayAddCardCoder").html())}),$("#ShowCardBank").on("tap",function(e){e.preventDefault(),Pay_AddCard.ShowCardBankPage("ReleaseContent")}),$("#PayAddCard_submit").on("tap",function(t){t.preventDefault();var a=$("#PayAddCardCoder").attr("data-Province"),i=$("#PayAddCardCoder").attr("data-City"),o=$("#PayAddCardCoder").attr("data-District"),r=$.trim($("#PayAddCardAccountName").val()),n=$.trim($("#PayAddCardOpeningBank").val()),l=$.trim($("#PayAddCardCardNumber").val()),s=$("#PayAddCardBank").attr("data-Bank");if(""==r)return void Global_PopupHelper.alert({title:"请输入持卡人姓名"});if(""==s)return void Global_PopupHelper.alert({title:"请选择开户行"});if(parseInt(o)<0)return void Global_PopupHelper.alert({title:"请选择开户行地址"});if(""==n)return void Global_PopupHelper.alert({title:"请输入支行名称"});if(""==l)return void Global_PopupHelper.alert({title:"请输入卡号"});var d=/^[0-9]{10,30}$/;if(!d.test(l))return void Global_PopupHelper.alert({title:"请输入正确的银行卡号"});var c=new Global_BaseInfoHelper.GetToken,u=new e(r,s,n,a,i,o,l,c.Token);$.ajax({url:Global_ServiceUrlHelper.Account_AddBankCard,type:"POST",data:{reqJson:JSON.stringify(u)},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"添加成功",timer:"2000",confirmCallback:function(){Global_ReturnHelper.ReturnHistoryPage()}}):Global_PopupHelper.dialogautoclose({title:"添加失败",timer:"2000",type:"2"})}})})},CurrentMainPage="",this.ShowCardBankPage=function(e){var t=this;CurrentMainPage=e,t.GetCardBankStorage(e)},this.GetCardBankStorage=function(e){var t=this;Global_StorageHelper.GetBankDataByKey(t.CardBankStorageSucFun)},this.CardBankStorageSucFun=function(e){"err"!=e&&""!=e?ShowPayCardBank(CurrentMainPage,e):Global_PopupHelper.alert({title:"开户行获取失败"})},this.BackPage=function(e){$("#"+e).show(),$("#PayBankCardPageDiv").hide()},this.ChooseBank=function(e,t,a){var i=this;i.BackPage(e),$("#PayAddCardBank").html(a).attr("data-Bank",t).removeClass("thirdtext")},ShowPayCardBank=function(e,t){var a="",i=JSON.parse(t);$.each(i,function(t,i){var o=i.Name.split("|");a+='<li class="borderbottom"><div class="localname" onclick="Pay_AddCard.ChooseBank(\''+e+"','"+i.Type+"','"+o[0]+'\')" data-Type="'+i.Type+'"><h1>'+o[0]+"</h1></div></li>"}),$("#"+CurrentMainPage).hide(),$("#CardBankSelectUl").html(a),$("#PayBankCardPageDiv").show()}},Pay_ManageCard=new function(){var e=0,t={GetApiDate:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetBankCardListByMbrBaseId,type:"POST",data:{reqJson:'{"UserId":"'+e+'","pageIndex":"'+t+'","pageSize":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},ListStrBuilder:function(e){for(var t="",a=0;a<e.Data.length;a++){var i=e.Data[a].BankName.split("|"),o=e.Data[a].CardNumber.substring(e.Data[a].CardNumber.length-4);t+='<div class="onecard">',t+='<div class="top ChooseBank" data-id="'+e.Data[a].BankCardId+'">',t+='<div class="bank">',t+='<div class="icon"><i class="iconfont '+i[1]+'"></i></div>',t+='<div class="name">'+i[0]+"<br /><span>",t+="1"==e.Data[a].CardType?"储蓄卡":"信用卡",t+="</span></div></div>",t+='<div class="num">**** **** **** '+o+"</div>",t+="</div>",t+='<div class="bottom clearfix"><a class="payManageCardDel" data-id="'+e.Data[a].BankCardId+'" data-role="none"><i class="iconfont">&#xe632;</i> 删除</a></div></div>'}return t}};this.PageInit=function(a){var i=t.GetApiDate(a,1,20);if("00000000"==i.ResultNo){e=i.Total;var o=t.ListStrBuilder(i);$("#payManageCardDroploadList").html(o)}else Global_PopupHelper.alert({title:"数据获取失败，请重试"});$(".payManageCardDel").on("tap",function(e){e.preventDefault();var t=this,a=$(this).data("id");Global_PopupHelper.confirm({title:"确定删除银行卡",confirmCallback:function(){var e=new Global_BaseInfoHelper.GetToken;$.ajax({url:Global_ServiceUrlHelper.Account_DelBankCard,type:"POST",data:{reqJson:'{"BankCardId":"'+a+'","Token":"'+e.Token+'"}'},dataType:"json",success:function(e){"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"删除成功",timer:"2000",confirmCallback:function(){$(t).parent().parent(".onecard").remove()}}):Global_PopupHelper.dialogautoclose({title:"删除失败",timer:"2000",type:"2"})}})}})}),$(".ChooseBank").on("tap",function(e){e.preventDefault();var t=$(this).attr("data-id"),a=Global_ServiceUrlHelper.CurrentDomain+"/Pay/WithDraw?bankId="+t;$.mobile.changePage(a)})},this.payManageCardDropload=function(a,i,o){e<=20||$(function(){$("#payManageCardDroploadDiv").dropload({scrollArea:window,loadDownFn:function(e){var r=t.GetApiDate(a,i,o);if(null==r||"00000000"!=r.ResultNo)e.lock(),e.noData(),e.resetload();else{i+=1;var n=t.ListStrBuilder(r);o>r.Data.length&&(e.lock(),e.noData()),setTimeout(function(){$("#payManageCardDroploadList").append(n),e.resetload()},1e3)}}})})}},Pay_Recharge=new function(){this.RechargeFun=function(){$("#Pay_Recharge_amount").on("keyup",function(){var e=$(this).val(),t="";""!=e&&parseInt(e)>=1?(t="￥"+parseInt(e)/10,$("#Pay_Recharge_sumbmit").removeAttr("disabled")):$("#Pay_Recharge_sumbmit").attr("disabled","disabled"),$("#_Pay_Recharge_amount").html(t)}),Global_WeiXinHelper.IsWXBrowser()?($("#PayName").html("微信支付"),$("#PayIcon").html("&#xe615;"),$("#PayIcon").addClass("wxicon")):($("#PayName").html("支付宝支付"),$("#PayIcon").html("&#xe619;"),$("#PayIcon").addClass("zfbicon")),$("#Pay_Recharge_sumbmit").on("tap",function(){function e(e){Global_PopupHelper.dialogautoclose({title:"充值成功",timer:"2000",confirmCallback:function(){$.mobile.changePage("/My/Points")}})}function t(){Global_PopupHelper.dialogautoclose({title:"充值失败",timer:"2000",type:"2"})}var a=$("#Pay_Recharge_amount").val(),i=/^(999999|[1-9]\d{0,5}|1)$/;if(!i.test(a))return void Global_PopupHelper.alert({title:Global_MessageHelper.RechargeErr,btnName:Global_MessageHelper.BtnTextEmpty});if(Amount=parseInt(a)/10,Global_WeiXinHelper.IsWXBrowser())Global_WeiXinHelper.Pay(Amount,"充值","0","0",e,t);else{var o=Global_ServiceUrlHelper.CurrentDomain+"/My/Points",r=Global_ServiceUrlHelper.CurrentDomain+"/Pay/Recharge";Global_AlipayHelper.Pay(Amount,"充值",r,"充值"+Amount+"得到"+a+"贝壳币","0","0",o)}})}},Pay_WithDraw=new function(){var e=new Global_BaseInfoHelper.GetToken,t={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetDefaultBankCard,type:"POST",data:{reqJson:'{"Token":"'+e+'","BankId":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a}};this.PageInit=function(a){Global_ValidCodeHelper.GetCodeCache("pay_withdraw_tel","pay_withdraw_sendVerifyCode",41);var i=t.GetApiDate(e.Token,a),o="";if("00000000"==i.ResultNo){if("0"==i.BankCardId)o='<a href="AddCard">',o+='<div class="tag-title iconfont ">&#xe633;</div>',o+=' <div class="tag-core">添加银行卡<br /><span class="num"></span></div><div class="tag-arrow iconfont">&#xe60b;</div></a>';else{var r=i.Bank.split("|"),n=i.CardNumber.substring(i.CardNumber.length-4);o='<a href="ManageCard" id="Pay_WithDraw_Click" data-BankCardId="'+i.BankCardId+'">',o+='<div id="bankcardClass" class="tag-title iconfont '+r[1]+'"></div>',o+=' <div id="bankcardName" class="tag-core">'+r[0]+'<br /><span class="num">尾号 '+n+"</span></div>",o+='<div class="tag-arrow iconfont">&#xe60b;</div></a>'}$("#Pay_WithDraw_BankCard").html(o)}var l=new My_Index.GetMbrInfo;if(null!=l){var s=parseInt(l.PointsUsable);s>0&&s%1e3>0?$("#amount").attr("placeholder","最高可提现"+parseInt(s/1e3)+"000贝壳"):($("#amount").attr("placeholder","提现贝壳币不足"),$("#Pay_Recharge_next").attr("disabled","disabled"))}$("#pay_withdraw_sendVerifyCode").on("tap",function(e){e.preventDefault(),Global_ValidCodeHelper.GetValidCode(41,"pay_withdraw_tel","pay_withdraw_sendVerifyCode")}),$("#Pay_WithDraw_next").on("tap",function(e){e.preventDefault();var t=$("#Pay_WithDraw_Click").attr("data-BankCardId"),a=$("#amount").val();return!t||parseInt(t)<0?void Global_PopupHelper.alert({title:"请选择银行卡"}):0==parseInt(a)?void Global_PopupHelper.alert({title:"提现贝壳数不能为0"}):parseInt(a)%1e3!=0?void Global_PopupHelper.alert({title:"提现额不正确"}):($("#ReleaseContent").hide(),$("#ValidCodeDiv").show(),void GetValidCode())}),$("#amount").on("keyup",function(){var e=$("#amount").val();""!=e&&parseInt(e)%1e3==0?$("#Pay_WithDraw_next").removeClass("disabled").removeAttr("disabled"):$("#Pay_WithDraw_next").addClass("disabled").attr("disabled","disabled")}),$("#pay_withdraw_valid").on("keyup",function(){var e=$("#pay_withdraw_valid").val();e&&4==e.length?$("#Pay_WithDraw_sumbmit").removeClass("disabled").removeAttr("disabled"):$("#Pay_WithDraw_sumbmit").addClass("disabled").attr("disabled","disabled")}),$("#Pay_WithDraw_sumbmit").on("tap",function(t){t.preventDefault();var a=$("#Pay_WithDraw_Click").attr("data-BankCardId"),i=$("#amount").val(),o=$("#pay_withdraw_valid").val();if($("#pay_withdraw_valid").blur(),parseInt(a)<0)return void Global_PopupHelper.alert({title:"请选择银行卡"});if(0==parseInt(i))return void Global_PopupHelper.alert({title:"提现贝壳数不能为0"});if(parseInt(i)%1e3!=0)return void Global_PopupHelper.alert({title:"提现贝壳数必须是1000的整数倍"});if(""==o)return void Global_PopupHelper.alert({title:"验证码不能为空"});if(4!=o.length)return void Global_PopupHelper.alert({title:"验证码位数错误"});var r="您申请提现扣除"+i+"贝壳币",n=new AddWithdraw(e.Token,i,a,o,r);$.ajax({url:Global_ServiceUrlHelper.Account_AddWithdraw,type:"POST",data:{reqJson:JSON.stringify(n)},dataType:"json",success:function(e){"undefined"!=typeof e.ResultNo&&"00000000"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"提现申请成功",timer:"2000",confirmCallback:function(){$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Pay/WithdrawDetail/"+e.WithdrawId)}}):"undefined"!=typeof e.ResultNo&&"05010007"==e.ResultNo?Global_PopupHelper.dialogautoclose({title:"验证码有误",timer:"2000",type:"2"}):Global_PopupHelper.dialogautoclose({title:"提现申请失败",timer:"2000",type:"2"})}})})},GetValidCode=function(){if(!$("#pay_withdraw_sendVerifyCode").prop("disabled")){var e=new Global_ValidCodeHelper.GetCodeCacheTime(41);(e.StartTime>600||e.StartTime<0)&&Global_ValidCodeHelper.GetValidCode(41,"pay_withdraw_tel","pay_withdraw_sendVerifyCode")}},AddWithdraw=function(e,t,a,i,o){this.Token=e,this.PointsQuantity=t,this.ValidCode=i,this.BankCardId=a,this.Remark=o}},Pay_WithdrawDetail=new function(){this.PageInit=function(e){var t=new Global_BaseInfoHelper.GetToken;$.ajax({url:Global_ServiceUrlHelper.Account_GetWithdrawBase,type:"POST",data:{reqJson:'{"Token":"'+t.Token+'","WithdrawId":"'+e+'"}'},dataType:"json",success:function(e){if("00000000"==e.ResultNo){var t=e.Bank.split("|"),a=parseInt(e.PointsQuantity);$("#withdrawdetail_bank").html(t[0]),$(".price").html('<p class="price"><span>'+a+"</span>(&yen;"+a/10+".00)")}},error:function(){console.log("请求发生异常")}})}},Search_Article=new function(){var e,t,a=2,i="",o=0,r=0,n={GetApiDate:function(t,a,i){var o=null;return $.ajax({url:Global_ServiceUrlHelper.Search_GetArticleOrProduct,type:"POST",data:{reqJson:'{"CategorySubId":0,"contentKey":"'+t+'","IsArticle":true,"Token":"'+e.Token+'","pageIndex":"'+a+'","pageSize":"'+i+'","Token":"'+e.Token+'"}'},dataType:"json",async:!1}).done(function(e){o=e}).fail(function(){console.log("请求发生异常")}),o},ListStrBuilder:function(e){var a=Global_ServiceUrlHelper.CurrentDomain,i="",o=e.Data.length;if(o<1)$("#NoArticle").show();else{$("#NoArticle").remove();for(var r=0;r<o;r++){var n="",l="oneimg",s=a+"/Article/Detail/"+e.Data[r].ProductBaseId,d="转发",c="评论",u="赞",p="unlikeicon";if(e.Data[r].IsCurrentUserPraise&&(p="likeicon"),"0"!=e.Data[r].ForwardCount&&(d=e.Data[r].ForwardCount),"0"!=e.Data[r].CommentCount&&(c=e.Data[r].CommentCount),"0"!=e.Data[r].PraiseCount&&(u=Global_CommonHelper.GetShowCount(e.Data[r].PraiseCount)),null!=e.Data[r].ImgList&&e.Data[r].ImgList.length>0){if(e.Data[r].ImgList.length>1){l="moreimg thumb",n+='<div class="productimg '+l+'">';for(var h=0;h<e.Data[r].ImgList.length;h++)n+='<img src="'+e.Data[r].ImgList[h].Path+'@!standard_square_m" />'}else n+='<div class="productimg '+l+'">',n+='<img src="'+e.Data[r].ImgList[0].Path+'@!standard_rectangle_m" />';n+="</div>"}var m=Global_ForwardHelper.GetForwardUrl(e.Data[r].ProductBaseId,!0,e.Data[r].ForwardBase),g=Global_CommonHelper.SetUrlFormat(e.Data[r].Content);i+='<li class="item" id="hashitem_'+e.Data[r].ProductBaseId+'"><div class="info clearfix"><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.Data[r].CreateUserId+'"><div class="avatar '+Global_CommonHelper.GetCategoryClass(e.Data[r].Category)+'"><img src="'+e.Data[r].CreateUserFaceImage+'"/></div><div class="nickname"><p class="name">'+e.Data[r].CreateUserName+'<span></span></p><p class="time">'+e.Data[r].CreateTime+'</p></div></a></div><a href="'+s+'">'+n+'<div class="detail"><p class="ellipsis">'+g+"</p></div></a>"+Global_ForwardHelper.GetForwardHtml(e.Data[r].ForwardBase)+'<div class="extend bordertop"><div class="location">来自'+e.Data[r].CityName+'</div><div class="spread"><span class="title_forward"><a class="SearchArticleForwardUrl" onclick="Global_ForwardHelper.ForwardMethod(this)" href="#" data-islogin="'+t+'" data-href="'+m+'"><i class="iconfont">&#xe610; </i>'+d+'</a></span><span class="title_comment" onclick="Global_CommentHelper.Comment(this)" data-isarticle="true"  data-id="'+e.Data[r].ProductBaseId+'"><i class="iconfont">&#xe626; </i>'+c+'</span><span class="title_like" onclick="Global_CommonHelper.ListPagePraise(this)" data-id="'+e.Data[r].ProductBaseId+'" data-isarticle="true"><i class="'+p+'"></i>'+u+"</span></div></div></li>"}}return i}};this.PageInit=function(l){function s(){var e="";e=Global_ServiceUrlHelper.CurrentDomain+"/Search/Article?searchWord="+$(".laibei_page:last #articleSearchkey").val().replace(/[ ]/g,""),Global_SearchKeyHelper.SetUserSearch($(".laibei_page:last #articleSearchkey").val().replace(/[ ]/g,""),3),articleSearchFrom.action=e,articleSearchFrom.submit()}e=new Global_BaseInfoHelper.GetToken,t=Global_BaseInfoHelper.CheckLogin(),Global_SearchKeyHelper.SetUserSearch(l,3);var d=window.location.origin+"/Search/Article?searchWord="+encodeURI(l),c=new Global_ReturnHelper.GetListDateToStorage(d);if(null!=c.StorageData)o=c.StorageData.silentScroll,$("#NoArticle").remove(),$(".laibei_page:last #articleSearchList").html(new Global_ReturnHelper.GetBlankPageHtml(o).Html),i=c.StorageData.ListDate,a=c.StorageData.pageIndex,r=c.StorageData.Total;else{a=2,i="",o=0;var u=n.GetApiDate(l,1,20);if("00000000"==u.ResultNo){r=u.Total;var p=n.ListStrBuilder(u);$(".laibei_page:last #articleSearchList").html(p)}else $("#NoArticle").show()}$(".laibei_page:last #articleSearchkey").keydown(function(e){if(13==e.keyCode){if(e.preventDefault(),""==$(".laibei_page:last #articleSearchkey").val().replace(/[ ]/g,""))return!1;s()}}),t||$(".SearchArticleForwardUrl").on("tap",function(){var e=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(e)}),$(".laibei_page:last #articleSearchList").on("tap",".item a",function(){Global_ReturnHelper.SetListDateToStorage(d,"articleSearchList",a,r)})},this.PageScoll=function(){""!=i&&($.mobile.silentScroll(o),$(".laibei_page:last #articleSearchList").html(i))},this.ArticleDropload=function(e,t){r<=20||$(function(){$("#articleSearchDroploadDiv").dropload({scrollArea:window,loadDownFn:function(i){var o=n.GetApiDate(e,a,t);if(null==o||"00000000"!=o.ResultNo)i.lock(),i.noData(),i.resetload();else{a+=1;var r=n.ListStrBuilder(o);t>o.Data.length&&(i.lock(),i.noData()),setTimeout(function(){$("#articleSearchList").append(r),i.resetload()},1e3)}}})})}},Search_Classify=new function(){this.ClassifyInit=function(){Global_CategoryHelper.SearchCategoryInit()}},Search_OptimizationVague=new function(){this.VagueInit=function(e){function t(){var e="",t=$("#optimizationVagueSearchkey").val().replace(/[ ]/g,"");e=Global_ServiceUrlHelper.CurrentDomain+"/Search/Product?searchWord="+t,vagueSearchFrom.action=e,vagueSearchFrom.submit()}SetHotSearch(e),SetUserSearch(e),$("#optimizationVagueSearchkey").keydown(function(e){if(13==e.keyCode){if(e.preventDefault(),""==$("#optimizationVagueSearchkey").val().replace(/[ ]/g,""))return!1;t()}})},SetHotSearch=function(e){var t=Global_SearchKeyHelper.GetSearchKey.GetHotDateList(e);if(null!=t){var a="",i="Product",o=Global_ServiceUrlHelper.CurrentDomain+"/Search/"+i+"?searchWord=";$.each(t,function(e,t){a+='<li><a href="'+o+t.SearchKey+'">'+t.SearchKey+"</a></li>"}),$("#vagueHotList").html(a)}},SetUserSearch=function(e){var t=Global_SearchKeyHelper.GetSearchKey.GetUserDateList(e);if(null!=t){var a="",i="Product",o=Global_ServiceUrlHelper.CurrentDomain+"/Search/"+i+"?searchWord=";$.each(t,function(e,t){a+='<li><a href="'+o+t.SearchKey+'">'+t.SearchKey+"</a></li>"}),$("#vagueUserList").html(a)}else $("#vagueUserList").html("")},this.ClearUserSearchkey=function(){$("#vagueUserList").html("")}},Search_Product=new function(){var e,t,a=2,i="",o=0,r=0,n={GetApiDate:function(t,a,i,o){var r=null;return $.ajax({url:Global_ServiceUrlHelper.Search_GetArticleOrProduct,type:"POST",data:{reqJson:'{"CategorySubId":'+t+',"contentKey":"'+a+'","IsArticle":false,"Token":"'+e.Token+'","pageIndex":"'+i+'","pageSize":"'+o+'","Token":"'+e.Token+'"}'},dataType:"json",async:!1}).done(function(e){r=e}).fail(function(){console.log("请求发生异常")}),r},ListStrBuilder:function(e){var t=Global_ServiceUrlHelper.CurrentDomain,a="",i=e.Data.length;if(i<1)$("#NoProduct").show();else{$("#NoProduct").remove();for(var o=0;o<i;o++){var r="",n=(e.Data[o].ForwardCount>0?e.Data[o].ForwardCount:"转发",e.Data[o].CommentCount>0?e.Data[o].CommentCount:"评论",e.Data[o].PraiseCount>0?Global_CommonHelper.GetShowCount(e.Data[o].PraiseCount):"赞",t+"/Optimization/Detail/"+e.Data[o].ProductBaseId),l="unlikeicon";e.Data[o].IsCurrentUserPraise&&(l="likeicon"),null!=e.Data[o].ImgList&&(r+='<img src="'+e.Data[o].ImgList[0].Path+'@!standard_rectangle_m" />');Global_ForwardHelper.GetForwardUrl(e.Data[o].ProductBaseId,!1,e.Data[o].ForwardBase);a+='<section class="optimization-topten-item clearfix"><a href="'+n+'">'+r+'<p class="optimization-topten-title">'+e.Data[o].Title+'</p><p class="optimization-topten-desc">'+e.Data[o].Content+'</p><p class="optimization-topten-detail"><span class="optimization-topten-detail-price">'+Global_CommonHelper.GetPriceHtml(e.Data[o].Price)+'</span><span class="optimization-topten-detail-sales">'+e.Data[o].CityName+"</span></a></section>"}}return a}};this.PageInit=function(l,s){function d(){var e="";e=Global_ServiceUrlHelper.CurrentDomain+"/Search/Product?searchWord="+$(".laibei_page:last #productSearchkey").val().replace(/[ ]/g,""),Global_SearchKeyHelper.SetUserSearch($(".laibei_page:last #productSearchkey").val().replace(/[ ]/g,""),4),productSearchFrom.action=e,productSearchFrom.submit()}e=new Global_BaseInfoHelper.GetToken,t=Global_BaseInfoHelper.CheckLogin(),""!=s&&Global_SearchKeyHelper.SetUserSearch(s,0==l?4:1);var c=window.location.origin+"/Search/Product?searchWord="+encodeURI(s);l>0&&(c=window.location.origin+"/Search/Product?CategorySubId="+l+"&searchWord="+encodeURI(s));var u=new Global_ReturnHelper.GetListDateToStorage(c);if(null!=u.StorageData)o=u.StorageData.silentScroll,$("#NoProduct").remove(),$(".laibei_page:last #productSearchList").html(new Global_ReturnHelper.GetBlankPageHtml(o).Html),i=u.StorageData.ListDate,a=u.StorageData.pageIndex,r=u.StorageData.Total;else{a=2,i="",o=0;var p=n.GetApiDate(l,s,1,20);if("00000000"==p.ResultNo){r=p.Total;var h=n.ListStrBuilder(p);$(".laibei_page:last #productSearchList").html(h)}else $("#NoProduct").show()}$(".laibei_page:last #productSearchkey").keydown(function(e){if(13==e.keyCode){if(e.preventDefault(),""==$(".laibei_page:last #productSearchkey").val().replace(/[ ]/g,""))return!1;d()}}),t||$(".SearchProductForwardUrl").on("tap",function(){var e=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(e)}),$(".laibei_page:last #productSearchList").on("tap",".item a",function(){Global_ReturnHelper.SetListDateToStorage(c,"productSearchList",a,r)})},this.PageScoll=function(){""!=i&&($.mobile.silentScroll(o),$(".laibei_page:last #productSearchList").html(i))},this.ProductDropload=function(e,t,i){r<=20||$(function(){$("#productSearchDroploadDiv").dropload({scrollArea:window,loadDownFn:function(o){var r=n.GetApiDate(e,t,a,i);if(null==r||"00000000"!=r.ResultNo)o.lock(),o.noData(),o.resetload();else{a+=1;var l=n.ListStrBuilder(r);i>r.Data.length&&(o.lock(),o.noData()),setTimeout(function(){$("#productSearchList").append(l),o.resetload()},1e3)}}})})}},Search_Users=new function(){var e,t=0,a={GetApiDate:function(t,a,i){var o=null;return $.ajax({url:Global_ServiceUrlHelper.Search_GetUserList,type:"POST",data:{reqJson:'{"contentKey":"'+t+'","Token":"'+e.Token+'","pageIndex":"'+a+'","pageSize":"'+i+'","Token":"'+e.Token+'"}'},dataType:"json",async:!1}).done(function(e){o=e}).fail(function(){console.log("请求发生异常")}),o},ListStrBuilder:function(e){var t=(Global_ServiceUrlHelper.CurrentDomain,""),a=e.Data.length;if(a<1)$("#NoUser").show();else{$("#NoUser").remove();for(var o=0;o<a;o++){var r="+ 关注",n="";e.Data[o].IsAttention&&(r="已关注",n="cancern");var l="";i!=e.Data[o].ID&&(l='<button data-role="none" data-id="'+e.Data[o].ID+'" data-city="'+e.Data[o].CityName+'" data-carecount="'+e.Data[o].CareCount+'" data-isattention="'+e.Data[o].IsAttention+'" onclick="Search_Users.Attention(this)" class="addcancern '+n+'">'+r+"</button>"),t+='<li class="item" id="hashitem_'+e.Data[o].ID+'"><div class="info"><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.Data[o].ID+'"><div class="avatar '+Global_CommonHelper.GetCategoryClass(e.Data[o].Category)+'"><img src="'+e.Data[o].UserFaceImage+'" /></div><div class="nickname"><p class="name">'+e.Data[o].Nickname+'</p><p class="time" id="SearchUsersCare_'+e.Data[o].ID+'">粉丝:'+e.Data[o].CareCount+" | 来自"+e.Data[o].CityName+"</p></div></a></div>"+l+"</li>"}}return t}},i=0,o=2,r="",n=0;this.PageInit=function(l,s){function d(){var e="";e=Global_ServiceUrlHelper.CurrentDomain+"/Search/Users?searchWord="+$(".laibei_page:last #usersSearchkey").val().replace(/[ ]/g,""),Global_SearchKeyHelper.SetUserSearch($(".laibei_page:last #usersSearchkey").val().replace(/[ ]/g,""),2),usersSearchFrom.action=e,usersSearchFrom.submit()}e=new Global_BaseInfoHelper.GetToken,i=s,Global_SearchKeyHelper.SetUserSearch(l,2);var c=window.location.origin+"/Search/Users?searchWord="+encodeURI(l),u=new Global_ReturnHelper.GetListDateToStorage(c);if(null!=u.StorageData)n=u.StorageData.silentScroll,$("#NoUser").remove(),$(".laibei_page:last #searchUserList").html(new Global_ReturnHelper.GetBlankPageHtml(n).Html),r=u.StorageData.ListDate,o=u.StorageData.pageIndex,t=u.StorageData.Total;else{o=2,r="",n=0;var p=a.GetApiDate(l,1,20);if("00000000"==p.ResultNo){t=p.Total;var h=a.ListStrBuilder(p);$(".laibei_page:last #searchUserList").html(h)}else $("#NoUser").show()}$(".laibei_page:last #usersSearchkey").keydown(function(e){if(13==e.keyCode){if(e.preventDefault(),""==$(".laibei_page:last #usersSearchkey").val().replace(/[ ]/g,""))return!1;d()}}),$(".laibei_page:last #searchUserList").on("tap",".item a",function(){Global_ReturnHelper.SetListDateToStorage(c,"searchUserList",o,t)})},this.PageScoll=function(){""!=r&&($.mobile.silentScroll(n),$(".laibei_page:last #searchUserList").html(r))},this.UsersDropload=function(e,i){t<=20||$(function(){$("#searchUsersDroploadDiv").dropload({scrollArea:window,loadDownFn:function(t){var r=a.GetApiDate(e,o,i);if(null==r||"00000000"!=r.ResultNo)t.lock(),t.noData(),t.resetload();else{o+=1;var n=a.ListStrBuilder(r);i>r.Data.length&&(t.lock(),t.noData()),setTimeout(function(){$("#searchUserList").append(n),t.resetload()},1e3)}}})})},this.Attention=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=$(e).attr("data-id"),a=$(e).attr("data-isattention"),i=$(e).attr("data-city"),o=Global_CommonHelper.BaseAttention(t);if(null!=o)if("undefined"!=typeof o&&"00000000"==o.ResultNo){var r=parseInt($(e).attr("data-carecount"));"true"==a?($(e).html("+关注").attr("data-isattention","false").attr("data-carecount",r-1).removeClass("cancern"),$("#SearchUsersCare_"+t).html("粉丝:"+(r>0?r-1:0)+" | 来自"+i)):($(e).html("已关注").attr("data-isattention","true").attr("data-carecount",r+1).addClass("cancern"),$("#SearchUsersCare_"+t).html("粉丝:"+(r+1)+" | 来自"+i))}else{var n="操作失败";"undefined"!=typeof o.ResultRemark&&(n=o.ResultRemark),Global_PopupHelper.alert({title:n})}}})}},Search_Vague=new function(){this.VagueInit=function(e){function t(){var e="",t=$("#vagueNavigation [class='active']").attr("data-searchtype"),a=$("#vagueSearchkey").val().replace(/[ ]/g,"");e="3"==t?Global_ServiceUrlHelper.CurrentDomain+"/Search/Article?searchWord="+a:"2"==t?Global_ServiceUrlHelper.CurrentDomain+"/Search/Users?searchWord="+a:Global_ServiceUrlHelper.CurrentDomain+"/Search/Product?searchWord="+a,vagueSearchFrom.action=e,vagueSearchFrom.submit()}SetSearchPage(e),$(".navigation li").on("click",function(){var e=$(this),t=e.attr("data-searchtype");SetSearchPage(t),$("#vagueSearchkey").focus()}),$("#vagueSearchkey").keydown(function(e){if(13==e.keyCode){if(e.preventDefault(),""==$("#vagueSearchkey").val().replace(/[ ]/g,""))return!1;t()}})},SetSearchPage=function(e){var t=$(".navigation li[data-searchtype="+e+"]"),a=t.attr("data-id");t.siblings().removeClass("active prev next"),t.prevAll().addClass("prev"),t.nextAll().addClass("next"),t.addClass("active").removeClass("prev next"),$(".navigation").css("background-image","url(/Content/Images/searchbg"+a+".png)"),$(".inputbox").attr("placeholder","搜"+t.html()),SetHotSearch(e),SetUserSearch(e)},SetHotSearch=function(e){var t=Global_SearchKeyHelper.GetSearchKey.GetHotDateList(e);if(null!=t){var a="",i=4==e?"Product":3==e?"Article":"Users",o=Global_ServiceUrlHelper.CurrentDomain+"/Search/"+i+"?searchWord=";$.each(t,function(e,t){a+='<li><a href="'+o+t.SearchKey+'">'+t.SearchKey+"</a></li>"}),$("#vagueHotList").html(a)}},SetUserSearch=function(e){var t=Global_SearchKeyHelper.GetSearchKey.GetUserDateList(e);if(null!=t){var a="",i=4==e?"Product":3==e?"Article":"Users",o=Global_ServiceUrlHelper.CurrentDomain+"/Search/"+i+"?searchWord=";$.each(t,function(e,t){a+='<li><a href="'+o+t.SearchKey+'">'+t.SearchKey+"</a></li>"}),$("#vagueUserList").html(a)}else $("#vagueUserList").html("")},this.ClearUserSearchkey=function(){var e=$("#vagueNavigation [class='active']").attr("data-searchtype");Global_SearchKeyHelper.ClearUserSearchkey(e),$("#vagueUserList").html("")}},Charity_Detail=new function(){var e=0,t=2,a={GetApiData:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Charity_GetBaseById,type:"POST",data:{reqJson:'{"CharityBaseId":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t},GetSendData:function(e,t,a){var i=null,o={CharityBaseId:e,pageIndex:t,pageSize:a};return $.ajax({url:Global_ServiceUrlHelper.Charity_GetSendRecords,type:"POST",data:{reqJson:JSON.stringify(o)},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},SetCharityHtml:function(e){$("#Charty_Image").attr("src",e.Image+"@!standard_src_l"),$("#Charty_Title").html(e.Name);var t="",a=0;if(null!=e.ProductList){for(var i=0;i<e.ProductList.length;i++){var o="",r=parseInt(100*e.ProductList[i].SalesNumber/e.ProductList[i].Quantity);100==r&&(a+=1),(i==e.ProductList.length-1&&e.ProductList.length>1||1==e.ProductList.length)&&(o="detail-donation-last"),t+='<div class="detail-donation-item '+o+'"><div class="detail-donation-bag"><img src="'+e.ProductList[i].ProductImage+'@!standard_square_s" /></div><div class="detail-bags-desc"><div class="detail-bags-title"><p class="common-font-normal ">'+e.ProductList[i].Title+'</p><div class="process-bottom"></div><div class="process-up" style="width:'+.74*r+'%"></div><div class="detail-bags-sum"><ul><li>',t+=100==r?'<p class="common-font-normalless" style="font-size: 16px;line-height: 1.4;">已完成</p><p class="common-font-miniless" style="color: #9fa0a0;">项目进度</p></li><li></li><li><p class="common-font-normalless"><span class="common-font-larger">'+e.ProductList[i].Quantity+'</span>个</p><p class="common-font-miniless">目标数量</p>':'<p class="common-font-normalless"><span class="common-font-larger">'+e.ProductList[i].SalesNumber+'</span>个</p><p class="common-font-miniless">已捐数量</p></li><li><p class="common-font-normalless"><span class="common-font-larger">'+r+'</span>%</p><p class="common-font-miniless">项目进度</p></li><li><p class="common-font-normalless"><span class="common-font-larger">'+e.ProductList[i].Quantity+'</span>个</p><p class="common-font-miniless">目标数量</p>',t+="</li></ul></div></div></div></div>"}if(e.ProductList.length==a)$("#detail-footer").css("background-color","#cacaca"),$("#detail-footer").html("<a><span>已完成</span></a>");else{var n=Global_ServiceUrlHelper.CurrentDomain+"/Charity/Donate/"+e.CharityBaseId,l=Global_BaseInfoHelper.CheckLogin();l||(n=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+n),$("#detail-footer").html('<a href="'+n+'"><span>我要捐赠</span></a>')}}e.SurplusDays>0?$("#SurplusDays").html("剩余天数："+e.SurplusDays+"天"):($("#detail-footer").css("background-color","#cacaca"),$("#detail-footer").html("<a><span>已结束</span></a>"),$("#SurplusDays").html("已结束")),$("#Charty_Product").html(t);var s="";if(null!=e.MbrBaseList&&e.MbrBaseList.length>0){var d=e.MbrBaseList.length;d>=7&&(d=7);for(var i=0;i<d;i++)s+='<img src="'+e.MbrBaseList[i].FaceImage+'" />';$("#Charty_MbrFace").html(s),$("#Charty_MbrCount").html(e.MbrBaseList.length)}else $("#Charty_Mbr").hide();$("#Charty_CreateName").html('<span class="common-font-normal">'+e.CreateNickname+'<i class="iconfont">&#xe60b;</i></span>'),$("#Charty_CreateName").attr("href",Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.CreateUserId),$("#Detaile_Content").html(e.Content),setTimeout(function(){var e=$("#Detaile_Content").height();e>350&&$("#MoreContent").fadeIn()},500)},SetCharitySendHtml:function(e){for(var t="",a=0;a<e.Data.length;a++){var i="";t+='<section class="donation-record-list"><div class="donation-record"><div class="donation-username"><p>'+e.Data[a].UserName+"</p></div>";
for(var o=0;o<e.Data[a].SendList.length;o++)i+='<div class="doname-desc-item"><p>'+e.Data[a].SendList[o].ProductName+"</p><p><span>"+e.Data[a].SendList[o].SendNums+"</span>个</p><p>"+e.Data[a].SendList[o].SendTimes+"</p></div>";t+=i,t+="</div></section>"}return t}};this.PageInit=function(t){var i=a.GetApiData(t);if(null!=i&&"00000000"==i.ResultNo){if(0==i.Status)return void Charity_Detail.PageEmpty();a.SetCharityHtml(i);var o=i.Image+"@!standard_square_s",r=window.location.href.split("#")[0],n=Global_ServiceUrlHelper.CurrentDomain+"/Charity/Detail/"+t;Global_WeiXinHelper.weixinjsApi(r,i.Name,i.Introduction,n,o),Global_ShareHelper.MobShare(n,i.Name,i.Introduction,o)}else Charity_Detail.PageEmpty();var l=a.GetSendData(t,1,20);if("00000000"==l.ResultNo){e=l.Total;var s=a.SetCharitySendHtml(l);$("#CharityRecordList").append(s),e>0?$("#NoCharityRecordList").remove():$("#NoCharityRecordList").show()}else $("#NoCharityRecordList").show();$(".project-detail h2").addClass("project-active"),$(".detail-project-title h2").click(function(){$(this).addClass("project-active"),$(this).parent().siblings().children("h2").removeClass("project-active");var e="#"+$(this).parent().attr("class");$(e).css("display","block"),$(e).siblings().hide()}),$("#MoreContent").on("tap",function(e){e.preventDefault();var t=$(this).attr("data-direction"),a="";"down"==t?($(this).attr("data-direction","up"),$("#Detaile_Content").removeClass("detail-article-height"),a+="<h3>收起详情</h3>",a+='<i class="iconfont">&#xe60c;</i>'):($(this).attr("data-direction","down"),$("#Detaile_Content").addClass("detail-article-height"),a+="<h3>更多详情</h3>",a+='<i class="iconfont">&#xe609;</i>'),$(this).html(a)})},this.PageEmpty=function(){$(".laibei_page:last #CharityDetailEmptyContent").html(Global_MessageHelper.PageEmpty),$(".laibei_page:last #CharityDetailEmptyPage").show(),$(".laibei_page:last #CharityDetailpage").hide()},this.CharitySendDropload=function(i,o){e<=20||$(function(){$("#project-record").dropload({scrollArea:window,loadDownFn:function(e){var i=a.GetSendData(t,o);if(null==i||"00000000"!=i.ResultNo)e.lock(),e.noData(),e.resetload();else{t+=1;var r=a.SetCharitySendHtml(i);o>i.Data.length&&(e.lock(),e.noData()),setTimeout(function(){$("#CharityRecordList").append(r),e.resetload()},1e3)}}})})}},Charity_Donate=new function(){var e,t=!1;this.PageInit=function(i){e=new Global_BaseInfoHelper.GetToken,t=!1;var o=a.GetApiDate(i);if("00000000"==o.ResultNo){if(o.IsExpire)return void Global_PopupHelper.dialogautoclose({title:"项目已过期",timer:"2000",confirmCallback:function(){$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain+"/Charity/Detail/"+o.CharityBaseId)}});var r=a.CharityStrBuilder(o);$("#charityProductList").html(r)}$(".laibei_page:last #CharityOrderConfirmSubmit").on("tap",function(a){if(a.preventDefault(),!t){t=!0;var i=new CharityOrderConfirmModel(e.Token);$.ajax({url:Global_ServiceUrlHelper.Order_AddBase,type:"POST",data:{reqJson:JSON.stringify(i)},dataType:"json",success:function(e){"undefined"!=typeof e&&"00000000"==e.ResultNo?Global_OrderHelper.PageToGoodsPay(e.OrderBaseId):"undefined"!=typeof e&&null!=e.ResultRemark?(Global_PopupHelper.alert({title:e.ResultRemark}),t=!1):(Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),t=!1)},error:function(e){Global_PopupHelper.dialogautoclose({title:"操作失败",timer:"2000",type:"2"}),t=!1}})}})};var a={GetApiDate:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Charity_GetBaseProductById,type:"POST",data:{reqJson:'{"CharityBaseId":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t},CharityStrBuilder:function(e){for(var t="",a=(Global_ServiceUrlHelper.CurrentDomain,0);a<e.GoodsList.length;a++)e.GoodsList[a].Need>0&&(t+='<section class="todonation-item"><div onclick="Charity_Donate.CheckProduct('+e.GoodsList[a].GoodsBaseId+')"><div class="todonation-checked"><i class="iconfont" data-id="'+e.GoodsList[a].GoodsBaseId+'" id="charityGoods_'+e.GoodsList[a].GoodsBaseId+'">&#xe627;</i></div><div class="todonation-portrait"><img src="'+e.GoodsList[a].ProductImage+'@!standard_square_m" /></div><div class="todonate-desc"><p>'+e.GoodsList[a].Title+"</p><p>"+Global_CommonHelper.GetPriceHtml(e.GoodsList[a].GoodsPrice)+'</p></div></div><div class="todonate-nums" id="goodNums_'+e.GoodsList[a].GoodsBaseId+'" style="display:none;"><a href="#" onclick="Charity_Donate.SignDecrease(this,'+e.GoodsList[a].GoodsBaseId+')">-</a><input id="GoodsBuyQuantity_'+e.GoodsList[a].GoodsBaseId+'" oninput="Global_CommonHelper.CheckOnlyNumber(this, 10)" type="tel" value="1" data-id="'+e.GoodsList[a].GoodsBaseId+'" data-max="'+e.GoodsList[a].Need+'" oninput="Charity_Donate.GoodsBuyQuentityInput(this)"><a href="#" onclick="Charity_Donate.SignPlus(this, '+e.GoodsList[a].GoodsBaseId+')">+</a></div></section>');return t}};this.SignDecrease=function(e,t){var a=1,i=$("#GoodsBuyQuantity_"+t).attr("data-max");i=void 0==i?0:parseInt(i);var o=$("#GoodsBuyQuantity_"+t).val();o=void 0==o?0:parseInt(o),o!=a&&$("#GoodsBuyQuantity_"+t).val(o-1)},this.SignPlus=function(e,t){var a=$("#GoodsBuyQuantity_"+t).attr("data-max");a=void 0==a?0:parseInt(a);var i=$("#GoodsBuyQuantity_"+t).val();i=void 0==i?0:parseInt(i),i!=a&&$("#GoodsBuyQuantity_"+t).val(i+1)},this.GoodsBuyQuentityInput=function(e){var t=1,a=$(e).attr("data-max");a=void 0==a?0:parseInt(a);var i=$(e).val();i=void 0==i?0:parseInt(i),i<t&&$(e).val(t),i>a&&$(e).val(a)},CharityOrderConfirmModel=function(e){this.ConsigneeId=0,this.Token=e,this.OrderRemark="";for(var t=$(".todonate-active"),a=$(".todonate-active").length,i=new Array,o=0;o<a;o++)i[o]=new Array;$.each(t,function(e,t){var a=$(t).attr("data-id");i[e][0]=a,i[e][1]=$("#GoodsBuyQuantity_"+a).val()}),this.GoodsList=i},this.CheckProduct=function(e){"0"!=$("#GoodsBuyQuantity_"+e).attr("data-max")&&($("#charityGoods_"+e).hasClass("todonate-active")?($("#charityGoods_"+e).removeClass("todonate-active"),$("#goodNums_"+e).hide()):($("#charityGoods_"+e).addClass("todonate-active"),$("#goodNums_"+e).show()))}},Charity_Expire=new function(){var e=2,t="",a=0,i=0;this.PageInit=function(){var r=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Charity/Expire");if(null!=r.StorageData)a=r.StorageData.silentScroll,$("#charityExpireList").html(new Global_ReturnHelper.GetBlankPageHtml(a).Html),t=r.StorageData.ListDate,e=r.StorageData.pageIndex,i=r.StorageData.Total;else{e=2,t="",a=0;var n=o.GetApiDate(1,20);if("00000000"==n.ResultNo){i=n.Total;var l=o.CharityStrBuilder(n);$("#charityExpireList").html(l),i>0?$("#NoCharityExpire").remove():$("#NoCharityExpire").show()}else $("#NoCharityExpire").show()}$("#charityExpireList").on("tap","a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Charity/Expire","charityExpireList",e,i)})},this.PageScoll=function(){""!=t&&($.mobile.silentScroll(a),$("#charityExpireList").html(t))},this.CharityDropload=function(t){i<=20||$(function(){$("#charityExpireDroploadDiv").dropload({scrollArea:window,loadDownFn:function(a){var i=o.GetApiDate(e,t);if(null==i||"00000000"!=i.ResultNo)a.lock(),a.noData(),a.resetload();else{e+=1;var r=o.CharityStrBuilder(i);t>i.Data.length&&(a.lock(),a.noData()),setTimeout(function(){$("#charityExpireList").append(r),a.resetload()},1e3)}}})})};var o={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Charity_GetList,type:"POST",data:{reqJson:'{"IsOver":"2","PartUserCount":"6","pageIndex":"'+e+'","pageSize":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},CharityStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){for(var o=a+"/Charity/Detail/"+e.Data[i].CharityBaseId,r="",n=0;n<e.Data[i].MbrBaseList.length;n++)r+='<img src="'+e.Data[i].MbrBaseList[n].FaceImage+'" />';t+='<a href="'+o+'" class="item"><div class="mpic"><img src="'+e.Data[i].Image+'@!standard_src_l" /></div><p class="prap">'+e.Data[i].Name+'</p><div class="attend"><div class="extip">已结束</div><div class="total">有'+e.Data[i].PartCount+"人参与</div></div></a>"}return t}}},Charity_JoinedCharity=new function(){var e=1,t=0,a="",i=0;this.PageInit=function(i,o){var r=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Charity/JoinedCharity");null!=r.StorageData?(e=r.StorageData.pageIndex,t=r.StorageData.Total,a=r.StorageData.ListDate):Charity_JoinedCharity.PageDataInit(i,o),$("#contentList").on("tap",".my-charity-list a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Charity/JoinedCharity","contentList",e,t)})},this.PageDataInit=function(r,n){e=1,i=0,a="";var l=o.GetApiData(e,n,r);if("00000000"==l.ResultNo)if(t=l.Total,t>0){var s=o.GetContentStrBuilder(l.Data,r);a=s}else a=Charity_JoinedCharity.NoDataTip();else a=Charity_JoinedCharity.NoDataTip()},this.PageScoll=function(){""!=a&&($.mobile.silentScroll(i),$("#contentList").html(a))};var o={GetApiData:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Charity_GetList,type:"POST",data:{reqJson:'{"pageIndex":"'+e+'","pageSize":"'+t+'","PartUserId":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},GetContentStrBuilder:function(e,t){for(var a="",i=0;i<e.length;i++){var o=e[i];a+='<section class="my-charity-list">',a+='<div class="my-charity-container">',a=a+'<a href="/Charity/Detail/'+o.CharityBaseId+'">',a+='<div class="donation-image">',a=a+'<img src="'+o.Image+'@!standard_rectangle_m" />',a+="</div>",a+='<div class="donation-item">',a=a+"<p>"+o.Name+"</p>",a=a+"<p>"+o.PartCount+"人参与</p>",a+="&nbsp;&nbsp;|&nbsp;&nbsp;",a=a+"<p>剩余天数："+o.SurplusTime+"天</p>",a+="</div>",a+="</a>",a+='<div class="my-charity">',a=a+'<a href="'+Global_ServiceUrlHelper.CurrentDomain+"/Charity/MyCharity?id="+o.CharityBaseId+"&nUserId="+t+'">我的捐赠</a>',a+="</div>",a+="</div>",a+="</section>"}return a}};this.NoDataTip=function(){var e="";return e+='<div class="noorder" id="NoJoinedCharity" style="display: block;margin-top:2rem !important">',e+='            <img src="/Content/Images/emptyorder.png">',e+="            <p>暂时没有参与的公益</p>",e+="        </div>"},this.CharityDropload=function(a,i){t<=a||$(function(){$("#divContent").dropload({scrollArea:window,loadDownFn:function(t){e+=1;var r=o.GetApiData(e,a,i);if(null==r||"00000000"!=r.ResultNo)t.lock(),t.noData(),t.resetload();else{var n=o.GetContentStrBuilder(r.Data,i);a>r.Data.length&&(t.lock(),t.noData()),setTimeout(function(){$("#contentList").append(n),t.resetload()},1e3)}}})})}},Charity_List=new function(){var e,t=2,a="",i=0,o=0,r=1;this.PageInit=function(){var l=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Charity/List");if(null!=l.StorageData)e=!1,i=l.StorageData.silentScroll,$("#charityList").html(new Global_ReturnHelper.GetBlankPageHtml(i).Html),a=l.StorageData.ListDate,t=l.StorageData.pageIndex,o=l.StorageData.Total,r=l.StorageData.other;else{e=!0,r=1,t=2,a="",i=0;var s=n.GetApiDate(1,20);if("00000000"==s.ResultNo){if(o=s.Total,o>0){var d=n.CharityStrBuilder(s);$("#bqcharityList").html(d)}else $("#NoCharity").show();s.Data.length<20&&(t=1,r=2)}else $("#NoProduct").show()}$("#charityList").on("tap","a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Charity/List","charityList",t,o,r)})},this.PageScoll=function(){""!=a&&($.mobile.silentScroll(i),$("#charityList").html(a))},this.CharityDropload=function(a){$(function(){$("#charityDroploadDiv").dropload({scrollArea:window,loadDownFn:function(i){var o=n.GetApiDate(t,a);if(null==o||"00000000"!=o.ResultNo)i.lock(),i.noData(),i.resetload();else{t+=1;var l;if(l=1==r?n.CharityStrBuilder(o):n.OverCharityStrBuilder(o),a>o.Data.length&&(1==r?(t=1,r=2):(i.lock(),i.noData())),2==r&&e){if(e=!1,!(o.Total>0))return void $("#charityDroploadDiv .dropload-down").hide();var s='<div id="excharityList" class="excharity"><div class="dbdived"><span style="background-color:#efefef;">往期项目</span></div></div>';$("#charityList").append(s)}setTimeout(function(){$("#charityList").append(l),i.resetload()},1e3)}}})})};var n={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Charity_GetList,type:"POST",data:{reqJson:'{"IsOver":"'+r+'","PartUserCount":"6","pageIndex":"'+e+'","pageSize":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},CharityStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){for(var o=a+"/Charity/Detail/"+e.Data[i].CharityBaseId,r="",n=0;n<e.Data[i].MbrBaseList.length;n++)r+='<img src="'+e.Data[i].MbrBaseList[n].FaceImage+'" />';var l="";0==e.Data[i].MbrBaseList.length&&(l="display:none;"),t+='<a href="'+o+'" class="item"><div class="mpic"><img src="'+e.Data[i].Image+'@!standard_src_l" /></div><div class="tip">剩余天数：'+e.Data[i].SurplusTime+'天</div><p class="prap">'+e.Data[i].Name+'</p><div class="attend" style="'+l+'"><div class="avatar">'+r+'</div><div class="total">有'+e.Data[i].PartCount+"人参与</div></div></a>"}return t},OverCharityStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){for(var o=a+"/Charity/Detail/"+e.Data[i].CharityBaseId,r="",n=0;n<e.Data[i].MbrBaseList.length;n++)r+='<img src="'+e.Data[i].MbrBaseList[n].FaceImage+'" />';t+='<a href="'+o+'" class="item"><div class="mpic"><img src="'+e.Data[i].Image+'@!standard_src_l" /></div><p class="prap">'+e.Data[i].Name+'</p><div class="attend"><div class="extip">已结束</div><div class="total">有'+e.Data[i].PartCount+"人参与</div></div></a>"}return t}};this.Switchitem=function(){$(".js_charityclassify").on("tap",function(){$(".js_charityclassify").removeClass("project-active");var e=$(this);e.addClass("project-active"),$(".detail-donation-tab section").hide(),$("#"+e.data("id")).show()})}},Charity_MyCharity=new function(){var e=1,t=0,a="",i=0;this.PageInit=function(i,o,r){var n=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Charity/MyCharity");null!=n.StorageData?(e=n.StorageData.pageIndex,t=n.StorageData.Total,a=n.StorageData.ListDate):Charity_MyCharity.PageDataInit(i,o,r),$("#sectionContent").on("tap",".donation-portrait a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Charity/MyCharity","sectionContent",e,t)})},this.PageDataInit=function(r,n,l){e=1,i=0,a="";var s=o.GetApiData(e,l,r,n);if("00000000"==s.ResultNo)if(t=s.Total,t>0){var d=o.GetMyCharityOrdersStrBuilder(s.Data);a=d}else a=Charity_MyCharity.NoDataTip();else a=Charity_MyCharity.NoDataTip()},this.PageScoll=function(){""!=a&&($.mobile.silentScroll(i),$("#sectionContent").html(a))};var o={GetApiData:function(e,t,a,i){var o=null;return $.ajax({url:Global_ServiceUrlHelper.Charity_GetMyCharityOrders,type:"POST",data:{reqJson:'{"pageIndex":"'+e+'","pageSize":"'+t+'","CharityBaseId":"'+a+'","CurUserId":"'+i+'"}'},dataType:"json",async:!1}).done(function(e){o=e}).fail(function(){console.log("请求发生异常")}),o},GetMyCharityOrdersStrBuilder:function(e){var t="";t+="<p>感谢您的爱心支持</p>",t+='<div class="donation-record">',t+='<div class="donation-username my-donation-name">',t+='<div class="donation-portrait">';for(var a=0;a<e.length;a++){var i=e[a];0==a&&(t=t+'<a href="/My/PersonalIn/'+i.CurUserId+'">',t=t+'<img src="'+i.CreateUserFaceImg+'" />',t+="</a>",t+="</div>",t=t+"<p>"+i.Nickname+"</p>",t+="</div>"),t+='<div class="doname-desc-item">',t=t+"<p>"+i.GoodsTitle+"</p>",t=t+"<p><span>"+i.GoodsQuantity+"</span>个</p>",t=t+"<p>"+i.CreateTime+"</p>",t+="</div>"}return t+="</div>"}};this.NoDataTip=function(){var e="";return e+='<div class="noorder" id="NoJoinedCharity" style="display: block;margin-top:2rem !important">',e+='            <img src="/Content/Images/emptyorder.png">',e+="            <p>暂时没有我的捐赠</p>",e+="        </div>"}},Charity_Participant=new function(){var e=2,t="",a=0,i=0,o={GetApiData:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Charity_GetHelpers,type:"POST",data:{reqJson:'{"CharityBaseId":"'+e+'","pageIndex":"'+t+'","pageSize":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},SetHtml:function(e){for(var t="",a=0;a<e.Data.length;a++){for(var i="",o=0;o<e.Data[a].BuyInfoList.length;o++)i+='<div class="doname-desc-item"><p>'+e.Data[a].BuyInfoList[o].GoodsTitle+"</p><p><span>"+e.Data[a].BuyInfoList[o].GoodsQuantity+"</span>个</p><p>"+e.Data[a].BuyInfoList[o].BuyTime+"</p></div>";t+='<div class="donation-record"><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.Data[a].MbrBaseId+'"><div class="donation-username"><div class="donation-portrait"><img src="'+e.Data[a].FaceImage+'" /></div></a><p>'+e.Data[a].Nickname+"</p></div>"+i+"</div>"}return t}};this.PageInit=function(r){var n=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Charity/Participant");if(null!=n.StorageData)a=n.StorageData.silentScroll,$("#charityDroploadList").html(new Global_ReturnHelper.GetBlankPageHtml(a).Html),t=n.StorageData.ListDate,e=n.StorageData.pageIndex,i=n.StorageData.Total;else{e=2,t="",a=0;var l=o.GetApiData(r,1,20);if("00000000"==l.ResultNo){i=l.Total;var s=o.SetHtml(l);$("#charityDroploadList").html(s),i>0?$("#NoCharity").remove():$("#NoCharity").show()}else $("#NoCharity").show()}if(i>0){var d='<h1 class="donation-participants">感谢<scan>'+i+"</scan>位爱心人士的捐赠</h1>";$("#charityDroploadList").before(d)}$("#charityDroploadList").on("tap",".donation-record a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Charity/Participant","charityDroploadList",e,i)})},this.PageScoll=function(){""!=t&&($.mobile.silentScroll(a),$("#charityDroploadList").html(t))},this.CharityDropload=function(t,a){i<=20||$(function(){$("#charityDroploadDiv").dropload({scrollArea:window,loadDownFn:function(i){var r=o.GetApiDate(t,e,a);if(null==r||"00000000"!=r.ResultNo)i.lock(),i.noData(),i.resetload();else{e+=1;var n=o.SetHtml(r);a>r.Data.length&&(i.lock(),i.noData()),setTimeout(function(){$("#charityDroploadList").append(n),i.resetload()},1e3)}}})})}},Wechat_LoginCenter=new function(){var e={CheckLogin:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Account_CheckLoginByConnect,type:"POST",data:{reqJson:'{"Type":"'+e+'","UnionId":"'+t+'"}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},Binding:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Account_BindingConnect,type:"POST",data:{reqJson:'{"Type":"'+e+'","UnionId":"'+t+'","Token":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i}};this.CheckLogin=function(t,a,i,o,r){var n=new Global_BaseInfoHelper.GetToken,l=Global_BaseInfoHelper.GetLoginInfo();if(null!=l){var s=e.Binding(t,a,n.Token);if("undefined"!=typeof s.ResultNo&&"00000000"==s.ResultNo){var d=Global_ServiceUrlHelper.CurrentDomain+"/My/Bindset";$.mobile.changePage(d)}else"04130001"==s.ResultNo&&$.mobile.changePage(Global_ServiceUrlHelper.CurrentDomain)}else{var s=e.CheckLogin(t,a),c=Global_ServiceUrlHelper.CurrentDomain,u=new Global_StorageHelper.GetSessionToStorage("wx_login_backurl");if(null!=u.StorageData&&(c=u.StorageData),"undefined"!=typeof s.ResultNo&&"00000000"==s.ResultNo)Global_StorageHelper.SetUserTokenToStorage(s),Global_StorageHelper.DelSessionByKey("BaseInfo"),$.mobile.changePage(c);else{var d=Global_ServiceUrlHelper.CurrentDomain+"/Account/Bindphone?type=1&unionid="+a+"&sex="+o+"&headimgurl="+r+"&ReturnUrl="+c+"&nickname="+i;$.mobile.changePage(d)}}}},Optimization_CategoryList=new function(){function e(){var e=document.body.clientWidth/7.5,t=$("#CategoryList");t.imagesLoaded(function(){t.masonry({itemSelector:".masonry-item",gutterWidth:.2*e}),""!=i&&$.mobile.silentScroll(o)})}function t(){$(".optimization-product-sellout2").css("top","0"),$(".optimization-product-sellout2").css("left","0")}var a=2,i="",o=0,r=0,n={GetApiData:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Product_GetProductListByCategory,type:"POST",data:{reqJson:'{"CategoryTopId":"'+e+'","pageIndex":"'+t+'","pageSize":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},CategoryListStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){var o=a+"/Optimization/Detail/"+e.Data[i].ProductBaseId;t+='<li class="masonry-item"><a href="'+o+'"><div class="optimization-shadow-wrapper"><img class="optimization_lazyload_img" src="/Content/Images/sending.gif" data-original="'+e.Data[i].ImgList[0].Path+'@!standard_src_l" />',3==e.Data[i].Status&&(t+='<div class="optimization-product-sellout2 optimization-waterfallproduct-sellout"><img src="/Content/Images/optimization-selledout.png" /></div>'),t+='</div><p class="optimization-list-category-desc">'+e.Data[i].Title+'</p><p class="optimization-list-category-price">'+Global_CommonHelper.GetPriceHtml(e.Data[i].Price)+"</p></a></li>"}return t}};this.PageInit=function(e,t){var l=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Optimization/CategoryList/"+e+"?title="+encodeURI(t));if(null!=l.StorageData)o=l.StorageData.silentScroll,$("#NoCategoryList").remove(),$("#CategoryList").html(new Global_ReturnHelper.GetBlankPageHtml(o).Html),i=l.StorageData.ListDate,a=l.StorageData.pageIndex,r=l.StorageData.Total;else{a=2,i="",o=0;var s=n.GetApiData(e,1,20);if(null!=s&&"00000000"==s.ResultNo)if(r=s.Total,r>0){var d=n.CategoryListStrBuilder(s);$("#CategoryList").html(d),$("#NoCategoryList").remove()}else $("#NoCategoryList").show();else $("#NoCategoryList").show()}$("#CategoryList").on("tap","a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Optimization/CategoryList/"+e+"?title="+encodeURI(t),"CategoryList",a,r)})},this.PageScoll=function(){$(function(){""!=i&&$("#CategoryList").html(i),e(),$(".optimization_lazyload_img").lazyload({failurelimit:400,event:"scrollstop",load:e}),t()})},this.CategoryListDropload=function(e,i){var o=this;r<=20||$(function(){o.dropload=$("#CategoryListDroploadDiv").dropload({scrollArea:window,loadDownFn:function(o){var r=n.GetApiData(e,a,i);if(null==r||"00000000"!=r.ResultNo)o.lock(),o.noData(),o.resetload();else{a+=1;var l=n.CategoryListStrBuilder(r);i>r.Data.length&&(o.lock(),o.noData()),setTimeout(function(){var e=$("#CategoryList"),a=$(l);e.append(a).masonry("appended",a,!0),$(".optimization_lazyload_img").lazyload({failurelimit:400,event:"scrollstop",load:function(){e.imagesLoaded(function(){e.masonry()})}}),t(),o.resetload()},1e3)}}}),o.dropload._scrollContentHeight=$(window).height()})}},Optimization_Detail=new function(){function e(){var e=document.body.clientWidth/7.5,t=$("#divMoreDetail");t.imagesLoaded(function(){t.masonry({itemSelector:".masonry-item",gutterWidth:.2*e})})}var t,a,o,r=new Global_BaseInfoHelper.GetToken,n=!0;this.Swiper=function(){new Swiper(".laibei_page:last .js_swiper1",{loop:!0,speed:400,pagination:".swiper-pagination",paginationClickable:!0,autoplayDisableOnInteraction:!1})},this.PageInit=function(e,i){$(".laibei_page:last .more1").on("tap",function(e){e.preventDefault(),$(".laibei_page:last .sharehome").is(":hidden")?$(".laibei_page:last .sharehome").show():$(".laibei_page:last .sharehome").hide()}),$(".laibei_page:last #openrzsm").on("tap",function(e){e.preventDefault(),$(".laibei_page:last .selectmask,.rzsm").show()}),$(".laibei_page:last #closerzsm").on("tap",function(e){e.preventDefault(),$(".laibei_page:last .selectmask,.rzsm").hide()}),r=new Global_BaseInfoHelper.GetToken,t=Global_BaseInfoHelper.GetLoginInfo();var s=l.GetArticleBaseApiDate(e,i,r.Token);if("00000000"!=s.ResultNo||0==s.Status)return n=!1,void Optimization_Detail.PageEmpty(Global_MessageHelper.PageEmpty);if("00000000"==s.ResultNo&&imPublic.bindChatEvent({ClientID:s.CreateUserId,Nickname:s.CreateUserName,LinkType:imPublic.enum.ChatMessage.Product,Data:s}),void 0==s)return void Optimization_Detail.PageEmpty(Global_MessageHelper.PageEmpty);if(!(s.ResultNo="00000000"))return void Optimization_Detail.PageEmpty("查询错误");s.UserId==s.LoginUserId&&$("#outsidefooter").remove(),o=s.Status,a=s.PreferredBase;var d=l.ListStrBuilderHeadImg(s),c="",u="";void 0!=a&&null!=a.Image&&a.Image.length>0&&(u+='<img class="optimization-history-shiyong" src="'+a.Image+'">'),c+='<div class="swiper-wrapper" id="divHeadImgs">'+d+'</div><div class="swiper-pagination swiper-pagination-white"></div>'+u,$(".laibei_page:last #divHeadImageTop").html(c);var p=l.ListStrBuilderTitle(s);p.length>0?$(".laibei_page:last #divTitle").html(p):$(".laibei_page:last #divTitle").hide();var h=l.ListStrBuilderProperty(s);h.length>0?$(".laibei_page:last #divProductProperty").html(h):$(".laibei_page:last #divProductProperty").hide();var m="";null!=s&&null!=s.DetailContent&&s.DetailContent.length>0&&(m+='<div class="tw"><div class="headimg"><span>图文详情</span></div>'+s.DetailContent+"</div>");var g="";g=l.ListStrBuilderDetailContent(s),$(".laibei_page:last #divDetailContent").html(m+g);var f=l.ListStrBuilderEvalution(s);f.length>0?$(".laibei_page:last #sectionEvaluation").html(f):$(".laibei_page:last #sectionEvaluation").hide();var v=l.ListStrBuilderStoreMsg(s);v.length>0?$(".laibei_page:last #sectionStore").html(v):$(".laibei_page:last #sectionStore").hide(),$(".laibei_page:last #aShip").attr("href","/My/Shop/"+s.UserId);var y="赞";0!=s.PraiseCount&&(y=Global_CommonHelper.GetShowCount(s.PraiseCount)),$(".laibei_page:last #spanThumbUp").html(y),s.IsCurrentUserPraise?$(".laibei_page:last .ProductDetailPraiseIcon").addClass("likeicon"):$(".laibei_page:last .ProductDetailPraiseIcon").addClass("unlikeicon");var b=window.location.href.split("#")[0],S=Global_ServiceUrlHelper.CurrentDomain+"/Optimization/Detail/"+e+"?nPreferredId="+i,_="";null!=s.ImgList&&(_=s.ImgList[0].Path),Global_WeiXinHelper.weixinjsApi(b,s.Title,s.ProductContent,S,_+"@!standard_square_s"),Global_ShareHelper.MobShare(S,s.Title,s.ProductContent,_+"@!standard_square_s"),null!=s.ImgList?$(".laibei_page:last #ProductGoodsImg").html('<img src="'+s.ImgList[0].Path+'@!standard_square_m" alt="" />'):$(".laibei_page:last #ProductGoodsImg").html('<img src="" alt="" />'),$(".laibei_page:last #ProductGoodsPrice").html(Global_CommonHelper.GetPriceHtml(s.Price)),$(".laibei_page:last #ProductGoodsTitle").html(s.Title)},this.PageScoll=function(){0!=n&&$(function(){null!=a.ShowLeftTime&&Optimization_Detail.ShowLeftTime(a.ShowLeftTime,$(".laibei_page:last #divShowLeftTime")),e()})};var l={GetArticleBaseApiDate:function(e,t,a){var i=null;return $.ajax({url:Global_ServiceUrlHelper.Product_GetProductDetail,type:"POST",data:{reqJson:'{"ArticleBaseId":'+e+',"IsArticle":false,"IsBusiness":true,"PreferredBaseId":'+t+',"GetCount":4,"Token":"'+a+'"}'},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},ListStrBuilderHeadImg:function(e){var t="";if(null!=e&&e.ArticleBaseId>0){var a="";if(e.ImgList.length>0){for(i=0;i<e.ImgList.length;i++)a+='<div class="swiper-slide"><a href="javascript:;"><img src="'+e.ImgList[i].Path+'@!standard_src_l" alt="来呗优选" /></a></div>';t=a}}return t},ListStrBuilderTitle:function(e){var t="";if(null!=e&&e.ArticleBaseId>0){var a="";a+='<div class="title">'+e.Title+"</div>";var i="";i+='<div class="tip">'+e.ProductContent+"</div>",t=a+i}return t},ListStrBuilderProperty:function(e){var t="";if(null!=e&&e.ArticleBaseId>0){var i=Global_CommonHelper.GetPriceHtml(e.Price),o=Global_CommonHelper.GetPriceHtml(e.CostPrice),r="";r+='<div><span class="xj">'+i+'</span>&nbsp;&nbsp;<span class="yj">'+o+"</span></div>";var n="";n+='<div class="fhd">发货地：<span>'+e.ProvinceName+e.CityName+"</span></div>";var l="";if(null!=a.ShowLeftTime){var s=(new Date).getTime(),d=new Date(a.ShowLeftTime).getTime(),c=(d-s)/1e3;if(c>0){var u="还剩：<span>{day}</span>天<span>{hour}</span>时<span>{minute}</span>分",p=Math.floor(c/86400),h=Math.floor(c/3600)-24*p,m=Math.floor(c/60)-24*p*60-60*h,g=Math.floor(c)-24*p*60*60-60*h*60-60*m,f=u.replace("{day}",p<10?"0"+p:p.toString()).replace("{hour}",h<10?"0"+h:h.toString()).replace("{minute}",m<10?"0"+m:m.toString()).replace("{second}",g<10?"0"+g:g.toString());l+='<div class="djs" id="divShowLeftTime">'+f+"</div>"}}t=r+n+l}return t},ListStrBuilderDetailContent:function(e){var t="";if(null!=e&&e.ArticleBaseId>0){var a="",o="";if(null!=e.ListOtherProducts&&e.ListOtherProducts.length>0)for(a+='<div class="headimg"><span style="background-color:#efefef;">更多精选商品</span></div><div class="masonry-wrapper optimization-list-category-list"><ul class="masonry" style="margin:0;" id="divMoreDetail">',i=0;i<e.ListOtherProducts.length;i++){var r=e.ListOtherProducts[i],n="";r.ImgList.length>0&&(n=r.ImgList[0]),""!=n&&(o+='<li class="masonry-item"><a href="/Optimization/Detail/'+r.ArticleBaseId+'"><img class="specialdetail_lazyload_img"  src="'+n.Path+'@!standard_src_M" /><p class="optimization-list-category-desc">'+r.Title+'</p><p class="optimization-list-category-price">'+Global_CommonHelper.GetPriceHtml(r.Price)+"</p></a></li>")}3==e.Status&&($(".laibei_page:last #ProductDetailBuybtn").text("已售罄"),$(".laibei_page:last #ProductDetailBuybtn").removeClass("act-item buybtn"),$(".laibei_page:last #ProductDetailBuybtn").addClass("optimization-detail-purchase")),o.length>0&&(a+=o+"</ul></div>"),t=a}return t},ListStrBuilderEvalution:function(e){var t="";if(null!=e&&e.EvaluationId>0){var a=100*e.ColligationScore/5,i='<a href="/Optimization/Mmtrial/'+e.ArticleBaseId+'"><div class="top"><div class="name">妈妈试用团</div><div class="iconfont"><div class="score"><span style="width:'+parseInt(a)+'%;"></span></div><span>&#xe61e;</span></div></div><p>'+e.Content+"</p></a>";t=i}return t},ListStrBuilderStoreMsg:function(e){var t="",a="";if(null!=e.NickName&&(a=e.NickName),null!=e){var i="";null!=e.FaceImage&&(i=e.FaceImage),t+='<a href="/My/Shop/'+e.UserId+'" class="name"><img src="'+i+'" /><span class="jn">'+a+'</span></a><a href="/My/Shop/'+e.UserId+'" class="rrlbtn">进入店铺</a>'}return t}};this.ShowLeftTime=function(e,t){var a,i=t,o=(new Date).getTime(),r=new Date(e).getTime(),n=(r-o)/1e3;if(n>0){var l="还剩：<span>{day}</span>天<span>{hour}</span>时<span>{minute}</span>分";a=setInterval(function(){day=Math.floor(n/86400),hour=Math.floor(n/3600)-24*day,minute=Math.floor(n/60)-24*day*60-60*hour,second=Math.floor(n)-24*day*60*60-60*hour*60-60*minute;var e=l.replace("{day}",day<10?"0"+day:day.toString()).replace("{hour}",hour<10?"0"+hour:hour.toString()).replace("{minute}",minute<10?"0"+minute:minute.toString()).replace("{second}",second<10?"0"+second:second.toString());i.html(e),n--},1e3)}else clearInterval(a)},this.DetailFun=function(e,a,i,r){function l(){var e=$(".laibei_page:last .ProductDetailStyle"),t=$(".laibei_page:last .ProductDetailStandard");$.each(e,function(e,t){var a=$(t).attr("data-id");if(null!=u.GoodsBaseList&&u.GoodsBaseList.length>0){for(var i=!1,o=0;o<u.GoodsBaseList.length;o++)if(u.GoodsBaseList[o].PropertyValueId2==a&&u.GoodsBaseList[o].StockQuentity>0){i=!0;break}i||$(t).addClass("styledisabled")}}),$.each(t,function(e,t){var a=$(t).attr("data-id");if(null!=u.GoodsBaseList&&u.GoodsBaseList.length>0){for(var i=!1,o=0;o<u.GoodsBaseList.length;o++)if(u.GoodsBaseList[o].PropertyValueId1==a&&u.GoodsBaseList[o].StockQuentity>0){i=!0;break}i||$(t).addClass("styledisabled")}})}function d(e){var t=$(".laibei_page:last .ProductDetailStandard");$.each(t,function(t,a){var i=$(a).attr("data-id");if(null!=u.GoodsBaseList&&u.GoodsBaseList.length>0)for(var o=0;o<u.GoodsBaseList.length;o++)u.GoodsBaseList[o].PropertyValueId1==i&&u.GoodsBaseList[o].PropertyValueId2==e&&0==u.GoodsBaseList[o].StockQuentity&&$(a).addClass("styledisabled")})}function c(e){var t=$(".laibei_page:last .ProductDetailStyle");$.each(t,function(t,a){var i=$(a).attr("data-id");if(null!=u.GoodsBaseList&&u.GoodsBaseList.length>0)for(var o=0;o<u.GoodsBaseList.length;o++)u.GoodsBaseList[o].PropertyValueId1==e&&u.GoodsBaseList[o].PropertyValueId2==i&&0==u.GoodsBaseList[o].StockQuentity&&$(a).addClass("styledisabled");
})}if(0!=n){var u="";3!=o&&$(".laibei_page:last #ProductDetailBuybtn").on("tap",function(o){if(o.preventDefault(),null!=t)if(""==u&&(u=s.GetApiDate(e)),"00000000"==u.ResultNo&&null!=u.GoodsBaseList){if(2==u.Status)return void Global_PopupHelper.alert({title:"商品已经下架"});if(1==u.GoodsBaseList.length&&0==u.IsBusiness){var r=Global_ServiceUrlHelper.CurrentDomain+"/Order/Confirm/"+u.GoodsBaseList[0].GoodsBaseId+"?Quantity=1";$.mobile.changePage(r)}else{$(".laibei_page:last #"+a).show();var n=0,d="",c="";if(null!=u.GoodsBaseList&&u.GoodsBaseList.length>0)for(var p=0;p<u.GoodsBaseList.length;p++)n+=u.GoodsBaseList[p].StockQuentity;if(null!=u.StandardValueList&&u.StandardValueList.length>0)if(1==u.StandardValueList.length)d='<li class="ProductDetailStandard checked" data-id="'+u.StandardValueList[0].PropertyValueId+'">'+u.StandardValueList[0].PropertyValue+"</li>";else for(var p=0;p<u.StandardValueList.length;p++)d+='<li class="ProductDetailStandard" data-id="'+u.StandardValueList[p].PropertyValueId+'">'+u.StandardValueList[p].PropertyValue+"</li>";if(null!=u.StyleValueList&&u.StyleValueList.length>0)if(1==u.StyleValueList.length)c='<li class="ProductDetailStyle checked" data-id="'+u.StyleValueList[0].PropertyValueId+'">'+u.StyleValueList[0].PropertyValue+"</li>";else for(var p=0;p<u.StyleValueList.length;p++)c+='<li class="ProductDetailStyle" data-id="'+u.StyleValueList[p].PropertyValueId+'">'+u.StyleValueList[p].PropertyValue+"</li>";l(),null!=u.StandardValueList&&1==u.StandardValueList.length&&null!=u.StyleValueList&&1==u.StyleValueList.length&&$(".laibei_page:last #"+i).attr("data-max",n),$(".laibei_page:last #GoodsStockQuentity").html("(库存："+n+"件)"),$(".laibei_page:last #GoodsStandardValueList").html(d),$(".laibei_page:last #GoodsStyleValueList").html(c)}}else Global_PopupHelper.alert({title:"数据获取失败，请重试"});else{var r=Global_ServiceUrlHelper.CurrentDomain+"/Account/Index?ReturnUrl="+window.location.href;$.mobile.changePage(r)}}),$(".laibei_page:last #ProductGoodsBuybtn").on("tap",function(e){e.preventDefault();var t=$(".laibei_page:last #GoodsStandardValueList .checked").attr("data-id"),a=$(".laibei_page:last #"+r+" .checked").attr("data-id"),o=$(".laibei_page:last #"+i).val(),n=$(".laibei_page:last #"+i).attr("data-max");if(void 0==t)return void Global_PopupHelper.alert({title:"请选择规格"});if(void 0==a)return void Global_PopupHelper.alert({title:"请选择款式"});if(""==o||parseInt(o)>parseInt(n))return void Global_PopupHelper.alert({title:"数量需为1~"+n});if(null!=u.GoodsBaseList&&u.GoodsBaseList.length>0)for(var l=0;l<u.GoodsBaseList.length;l++)if(u.GoodsBaseList[l].PropertyValueId1==t&&u.GoodsBaseList[l].PropertyValueId2==a){var s=Global_ServiceUrlHelper.CurrentDomain+"/Order/Confirm/"+u.GoodsBaseList[l].GoodsBaseId+"?Quantity="+o;$.mobile.changePage(s)}}),$(".laibei_page:last #ProductDetailGoodsClose").on("tap",function(e){e.preventDefault(),$(".laibei_page:last #ProductDetailGoodsShow").hide()}),$(".laibei_page:last #GoodsStandardValueList").on("tap",".ProductDetailStandard",function(e){e.preventDefault();var t=this;if(!$(t).hasClass("styledisabled")){var a=$(t).attr("data-id"),i=$(".laibei_page:last .ProductDetailStyle"),o=($(".laibei_page:last .ProductDetailStandard"),$(".laibei_page:last #GoodsStyleValueList .checked").attr("data-id"));if($(i).removeClass("styledisabled"),$(t).hasClass("checked"))$(t).removeClass("checked"),$(".laibei_page:last .ProductDetailStandard").removeClass("styledisabled"),$(".laibei_page:last #ProductGoodsBuyQuentity").val(1),l(),void 0!=o&&d(o);else if($(".laibei_page:last .ProductDetailStandard").removeClass("checked"),$(t).addClass("checked"),c(a),null!=u.GoodsBaseList&&u.GoodsBaseList.length>0)for(var r=0;r<u.GoodsBaseList.length;r++)if(u.GoodsBaseList[r].PropertyValueId1==a&&u.GoodsBaseList[r].PropertyValueId2==o&&u.GoodsBaseList[r].StockQuentity>0){$(".laibei_page:last #ProductGoodsImg").html('<img src="'+u.GoodsBaseList[r].ImgPath+'@!standard_square_m" alt="" />'),$(".laibei_page:last #ProductGoodsTitle").html(u.GoodsBaseList[r].Title),$(".laibei_page:last #ProductGoodsPrice").html(Global_CommonHelper.GetPriceHtml(u.GoodsBaseList[r].Price)),$(".laibei_page:last #GoodsStockQuentity").html("(库存："+u.GoodsBaseList[r].StockQuentity+"件)"),$(".laibei_page:last #ProductGoodsBuyQuentity").attr("data-max",u.GoodsBaseList[r].StockQuentity);var n=$(".laibei_page:last #ProductGoodsBuyQuentity").val();parseInt(n)>u.GoodsBaseList[r].StockQuentity&&$(".laibei_page:last #ProductGoodsBuyQuentity").val(1)}}}),$(".laibei_page:last #GoodsStyleValueList").on("tap",".ProductDetailStyle",function(e){e.preventDefault();var t=this;if(!$(t).hasClass("styledisabled")){var a=$(t).attr("data-id"),i=($(".laibei_page:last .ProductDetailStyle"),$(".laibei_page:last .ProductDetailStandard")),o=$(".laibei_page:last #GoodsStandardValueList .checked").attr("data-id");if($(i).removeClass("styledisabled"),$(t).hasClass("checked"))$(t).removeClass("checked"),$(".laibei_page:last .ProductDetailStyle").removeClass("styledisabled"),$(".laibei_page:last #ProductGoodsBuyQuentity").val(1),l(),void 0!=o&&c(o);else if($(".laibei_page:last .ProductDetailStyle").removeClass("checked"),$(t).addClass("checked"),d(a),null!=u.GoodsBaseList&&u.GoodsBaseList.length>0)for(var r=0;r<u.GoodsBaseList.length;r++)if(u.GoodsBaseList[r].PropertyValueId1==o&&u.GoodsBaseList[r].PropertyValueId2==a&&u.GoodsBaseList[r].StockQuentity>0){$(".laibei_page:last #ProductGoodsImg").html('<img src="'+u.GoodsBaseList[r].ImgPath+'@!standard_square_m" alt="" />'),$(".laibei_page:last #ProductGoodsTitle").html(u.GoodsBaseList[r].Title),$(".laibei_page:last #ProductGoodsPrice").html(Global_CommonHelper.GetPriceHtml(u.GoodsBaseList[r].Price)),$(".laibei_page:last #GoodsStockQuentity").html("(库存："+u.GoodsBaseList[r].StockQuentity+"件)"),$(".laibei_page:last #ProductGoodsBuyQuentity").attr("data-max",u.GoodsBaseList[r].StockQuentity);var n=$(".laibei_page:last #ProductGoodsBuyQuentity").val();parseInt(n)>u.GoodsBaseList[r].StockQuentity&&$(".laibei_page:last #ProductGoodsBuyQuentity").val(1)}}}),$(".laibei_page:last .sign-plus").on("tap",function(e){e.preventDefault();var t=$(".laibei_page:last #ProductGoodsBuyQuentity").attr("data-max");t=void 0==t?0:parseInt(t);var a=$(".laibei_page:last #ProductGoodsBuyQuentity").val();a=void 0==a?0:parseInt(a),a!=t&&$(".laibei_page:last #ProductGoodsBuyQuentity").val(a+1)}),$(".laibei_page:last .sign-decrease").on("tap",function(e){e.preventDefault();var t=1,a=$(".laibei_page:last #ProductGoodsBuyQuentity").attr("data-max");a=void 0==a?0:parseInt(a);var i=$(".laibei_page:last #ProductGoodsBuyQuentity").val();i=void 0==i?0:parseInt(i),i!=t&&$(".laibei_page:last #ProductGoodsBuyQuentity").val(i-1)})}};var s={GetApiDate:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Goods_GetBaseListByProductId,type:"POST",data:{reqJson:'{"ProductBaseId":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t}};this.ProductPraise=function(e){Global_PopupHelper.OperationMethod({confirmCallback:function(){var t=Global_CommonHelper.ArticlePraise(e);Optimization_Detail.SetThumbUpIcon(t)}})},this.SetThumbUpIcon=function(e){if(null!=e)if("undefined"!=typeof e&&"00000000"==e.ResultNo)e.IsAdd?($(".laibei_page:last .ProductDetailPraise").html(Global_CommonHelper.GetShowCount(e.PraiseCount)),$(".laibei_page:last .ProductDetailPraiseIcon").addClass("likeicon")):(0==e.PraiseCount?$(".laibei_page:last .ProductDetailPraise").html("赞"):$(".laibei_page:last .ProductDetailPraise").html(Global_CommonHelper.GetShowCount(e.PraiseCount)),$(".laibei_page:last .ProductDetailPraiseIcon").removeClass("likeicon").addClass("unlikeicon"));else{var t="操作失败";"undefined"!=typeof e.ResultRemark&&(t=e.ResultRemark),Global_PopupHelper.alert({title:t})}},this.PageEmpty=function(e){$(".laibei_page:last #ProductMainEmptyContent").html(e),$(".laibei_page:last #ProductMainEmptyPage").show(),$(".laibei_page:last #mainpage").hide(),$("#outsidefooter").remove(),$("#popupmask").hide()}},Optimization_FindGoods=new function(){},Optimization_GoodStores=new function(){var e=2,t="",a=0,i=0;this.PageInit=function(){var r=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Optimization/GoodStores");if(null!=r.StorageData)a=r.StorageData.silentScroll,$("#NoGoodStores").remove(),$("#GoodStoresList").html(new Global_ReturnHelper.GetBlankPageHtml(a).Html),t=r.StorageData.ListDate,e=r.StorageData.pageIndex,i=r.StorageData.Total;else{e=2,t="",a=0;var n=o.GetApiDate(1,20);if("00000000"==n.ResultNo){i=n.Total;var l=o.ProductStrBuilder(n);$("#GoodStoresList").html(l),i>0?$("#NoGoodStores").remove():$("#NoGoodStores").show()}else $("#NoGoodStores").show()}$("#GoodStoresList").on("tap",".item a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Optimization/GoodStores","GoodStoresList",e,i)})},this.PageScoll=function(){""!=t&&($.mobile.silentScroll(a),$("#GoodStoresList").html(t))},this.ProductDropload=function(t){i<=20||$(function(){$("#GoodStoresDroploadDiv").dropload({scrollArea:window,loadDownFn:function(a){var i=o.GetApiDate(e,t);if(null==i||"00000000"!=i.ResultNo)a.lock(),a.noData(),a.resetload();else{e+=1;var r=o.ProductStrBuilder(i);t>i.Data.length&&(a.lock(),a.noData()),setTimeout(function(){$("#GoodStoresList").append(r),a.resetload()},1e3)}}})})};var o={GetApiDate:function(e,t){var a=null;return $.ajax({url:Global_ServiceUrlHelper.Account_GetRecommendBase,type:"POST",data:{reqJson:'{"pageIndex":"'+e+'","pageSize":"'+t+'","ProductCount":3}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},ProductStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){var o="";if(null!=e.Data[i].ProductList&&e.Data[i].ProductList.length>0)for(var r=0;r<e.Data[i].ProductList.length;r++)o+='<a href="'+a+"/Optimization/Detail/"+e.Data[i].ProductList[r].ProductBaseId+'"><img src="'+e.Data[i].ProductList[r].ImgPath+'@!standard_square_m"></a>';t+='<li class="item"><div class="info clearfix"><a href="'+a+"/My/PersonalIn/"+e.Data[i].BaseId+'"><div class="avatar businesslog"><img src="'+e.Data[i].FaceImage+'"></div><div class="nickname" style="width: 50%;"><p class="name">'+e.Data[i].Nickname+'<span></span></p><p class="time">来自'+(""==e.Data[i].CityName?"火星":e.Data[i].CityName)+'</p></div></a><div class="price"><a href="'+a+"/My/Shop/"+e.Data[i].BaseId+'"><span>进入店铺</span></a></div></div><div class="productimg moreimg thumb">'+o+"</div></li>"}return t}}},Optimization_Hitory=new function(){function e(){0==d&&$("[id^=greatselect-lefttime-"+r+"-]").each(function(e,a){var i=$(a).attr("leftTime");t(i,$(this))})}function t(e,t){var a,i=t,o=(new Date).getTime(),r=new Date(e).getTime(),n=(r-o)/1e3;if(n>0){var l="仅剩：{day}天{hour}小时{minute}分{second}秒";a=setInterval(function(){if(n>0){day=Math.floor(n/86400),hour=Math.floor(n/3600)-24*day,minute=Math.floor(n/60)-24*day*60-60*hour,second=Math.floor(n)-24*day*60*60-60*hour*60-60*minute;var e=l.replace("{day}",day<10?"0"+day:day.toString()).replace("{hour}",hour<10?"0"+hour:hour.toString()).replace("{minute}",minute<10?"0"+minute:minute.toString()).replace("{second}",second<10?"0"+second:second.toString());i.html(e),n--}else clearInterval(a)},1e3)}}var a,i,o,r=1,n=0,l=0,s=8,d=null;this.Init=function(t){if(a=new Global_BaseInfoHelper.GetToken,i=Global_BaseInfoHelper.CheckLogin(),o="",d=1,l=0,void 0!=t&&null!=t)d=t,Optimization_Hitory.PageDataInit();else{var s=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Optimization/history");null!=s.StorageData?(n=s.StorageData.silentScroll,o=s.StorageData.ListDate,r=s.StorageData.pageIndex,l=s.StorageData.Total,s.StorageData.other&&null!=s.StorageData.other.dataType&&(d=s.StorageData.other.dataType),$(".laibei_page:last #optimization-hisory-list").html(new Global_ReturnHelper.GetBlankPageHtml(n).Html),e()):Optimization_Hitory.PageDataInit()}$(".laibei_page:last #optimization-hisory-list").on("tap","section a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Optimization/history","optimization-hisory-list",r,l,{dataType:d})}),$(".laibei_page:last .optimization-history-head").removeClass("optimization-history-active").eq(d).addClass("optimization-history-active"),getPageTitle()},getPageTitle=function(){var e="往期回顾";0==d&&(e="本期精选"),$(".laibei_page:last #headerTitle").html(e)},this.TabEvent=function(){$(".laibei_page:last .optimization-history-head").on("tap",function(){d=$(this).data("val"),$(this).addClass("optimization-history-active").parent().siblings().children().removeClass("optimization-history-active"),Optimization_Hitory.PageDataInit(),Optimization_Hitory.dropload.direction="up",Optimization_Hitory.dropload.noData(!1),Optimization_Hitory.dropload.unlock(),Optimization_Hitory.dropload.resetload(),getPageTitle(),Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Optimization/history","optimization-hisory-list",r,l,{dataType:d})})},this.PageDataInit=function(){r=1,o="",n=0;var t="",a=c.GetApiDate(r,s);"00000000"==a.ResultNo&&(t=c.BuilderListHtml(a)),0==l&&(t=Optimization_Hitory.NoDataTip()),$(".laibei_page:last #optimization-hisory-list").html(t),e()},this.PageScoll=function(){""!=o&&($.mobile.silentScroll(n),$(".laibei_page:last  #optimization-hisory-list").html(o),e())},this.ProductDropload=function(){var t=[];Optimization_Hitory.dropload=$(".laibei_page:last #optimization-hisory-DroploadDiv").dropload({scrollArea:window,loadDownFn:function(a){if(l>0)if(r+=1,t=c.GetApiDate(r,s),null==t.Data||0==t.Data.length||"00000000"!=t.ResultNo)a.lock(),a.noData(),a.resetload();else{var i=c.BuilderListHtml(t);s>t.Data.length&&(a.lock(),a.noData()),setTimeout(function(){$(".laibei_page:last #optimization-hisory-list").append(i),e(),a.resetload()},1e3)}l<=s?$(".dropload-down").hide():$(".dropload-down").show()}})};var c={GetApiDate:function(e,t){var i="";i=1==d?Global_ServiceUrlHelper.Preferred_GetExpiredPreferredList:Global_ServiceUrlHelper.Preferred_GetEffectPreferredList;var o=null;return $.ajax({url:i,type:"POST",data:{reqJson:'{"pageIndex":"'+e+'","pageSize":"'+t+'","Token":"'+a.Token+'"}'},dataType:"json",async:!1}).done(function(e){o=e,e.Total&&(l=e.Total)}).fail(function(){console.log("请求发生异常")}),o},BuilderListHtml:function(e){var t="";Global_ServiceUrlHelper.CurrentDomain;if(1==d)for(var a=0;a<e.Data.length;a++)t+=c.GetExpiredItemHtml(e.Data[a]);else for(var a=0;a<e.Data.length;a++)t+=c.GetEffectItemHtml(e.Data[a]);return t},GetExpiredItemHtml:function(e){var t=Global_ServiceUrlHelper.CurrentDomain,a=t+"/Optimization/SpecialDetail/"+e.PreferredBaseId,i=t+"/Optimization/Detail/{id}?nPreferredId="+e.PreferredBaseId,o=e.Image+"@!standard_src_src",r=e.TagImg?e.TagImg+"@!standard_src_src":"",n="已售："+e.Sales+" 件",l="";return e.ProductList&&e.ProductList.length>1?(l+='<section class="greatselect categorylist-activity">',l+='    <a href="'+a+'" class="ui-link">',l+=o?'        <img src="'+o+'">':o,l+=r?'        <img class="optimization-history-shiyong" src="'+r+'" />':"",e.SellOut&&(l+=c.NotProductTip("optimization-listproduct-sellout")),l+="    </a>",l+='    <div class="swiper-container-horizontal">',l+='        <div class="swiper-wrapper">',$.each(e.ProductList,function(e,t){if(l+='            <div class="swiper-slide swiper-slide-active" style="width: 1.6rem; margin-right: 10px;"><a href="'+i.replace("{id}",t.ProductBaseId)+'" class="ui-link" style="margin-bottom:0"><img src="'+t.GoodsImg+'@!standard_square_s"></a></div>',e+1>=4)return!1}),l+="        </div>",l+="    </div>",l+="</section>"):(l+='<section class="greatselect">',l+='    <a href="'+a+'" class="ui-link">',l+=o?'        <img src="'+o+'" />':"",l+=r?'        <img class="optimization-history-shiyong" src="'+r+'" />':"",l+="",l+="        <p>",l+='            <span class="optimization-history-timeleft">'+n+"</span>",l+='            <span style="float:right;color:#ff4965;font-size:20px;">',l+="               "+Global_CommonHelper.GetPriceHtml(e.ProductList[0].Price)+' <span style="font-size:13px;color:#9fa0a0;text-decoration:line-through;">'+Global_CommonHelper.GetPriceHtml(e.ProductList[0].CostPrice)+"</span>",l+="            </span>",l+="        </p>",e.SellOut&&(l+=c.NotProductTip()),l+="    </a>",l+="</section>"),l},GetEffectItemHtml:function(e){var t=Global_ServiceUrlHelper.CurrentDomain,a=t+"/Optimization/SpecialDetail/"+e.PreferredBaseId,i=t+"/Optimization/Detail/{id}?nPreferredId="+e.PreferredBaseId,o=e.Image+"@!standard_src_src",n=e.TagImg?e.TagImg+"@!standard_src_src":"",l="仅剩：0天0小时0分0秒",s="";return e.ProductList&&e.ProductList.length>1?(s+='<section class="greatselect categorylist-activity">',s+='    <a href="'+a+'" class="ui-link">',s+=o?'        <img src="'+o+'">':"",s+=n?'        <img class="optimization-history-shiyong" src="'+n+'" />':"",e.SellOut&&(s+=c.NotProductTip("optimization-listproduct-sellout")),s+="    </a>",s+='    <div class="swiper-container-horizontal">',s+='        <div class="swiper-wrapper">',$.each(e.ProductList,function(e,t){if(s+='            <div class="swiper-slide swiper-slide-active" style="width: 1.6rem; margin-right: 10px;"><a href="'+i.replace("{id}",t.ProductBaseId)+'" class="ui-link" style="margin-bottom:0"><img src="'+t.GoodsImg+'@!standard_square_s"></a></div>',e+1>=4)return!1}),s+="            ",s+="        </div>",s+="    </div>",s+="</section>"):(s+='<section class="greatselect">',s+='    <a href="'+a+'" class="ui-link">',s+=o?'        <img src="'+o+'" />':"",s+=n?'        <img class="optimization-history-shiyong" src="'+n+'" />':n,s+="",s+="        <p>",s+="            <span leftTime='"+e.LeftTime+"' id=\"greatselect-lefttime-"+r+"-"+e.ProductList[0].ProductBaseId+'" class="optimization-history-timeleft">'+l+"</span>",s+='            <span style="float:right;color:#ff4965;font-size:20px;">',s+="               "+Global_CommonHelper.GetPriceHtml(e.ProductList[0].Price)+' <span style="font-size:13px;color:#9fa0a0;text-decoration:line-through;">'+Global_CommonHelper.GetPriceHtml(e.ProductList[0].CostPrice)+"</span>",s+="            </span>",s+="        </p>",e.SellOut&&(s+=c.NotProductTip()),s+="    </a>",s+="</section>"),s},NotProductTip:function(e){return""}};this.NoDataTip=function(){var e="";return e+='<div class="noorder" id="NoChannelProduct" style="display: block;">',e+='            <img src="/Content/Images/emptyorder.png">',e+="            <p>暂时没有内容哦</p>",e+="        </div>"}},Optimization_List=new function(){function e(e,t){var a='<span class="categorylist-goods-discountno">{num1}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.{num2}折';if(0==e||0==t)return a.replace("{num1}","0").replace("{num2}","0");if(e==t)return a.replace("{num1}","10").replace("{num2}","0");var i=(t/e*10).toFixed(2).toString(),o=i.substring(0,i.lastIndexOf(".")+2),r=o.split(".");return a.replace("{num1}",r[0]).replace("{num2}",r[1])}function t(){$("[id^=greatselect-lefttime-"+s+"-]").each(function(e,t){var a=$(t).attr("leftTime");i(a,$(this))})}function a(){var e='<span>{day}天</span> <span class="optimization-categorylist-specialwidth">{hour}</span>:<span class="optimization-categorylist-specialwidth">{minute}</span>:<span class="optimization-categorylist-specialcolor">{second}</span>',t=$("#optimization-categorylist-timer"),a=t.attr("leftTime");i(a,t,e)}function i(e,t,a){var i,o=t,r=(new Date).getTime(),n=new Date(e).getTime(),l=(n-r)/1e3;if(l>0){var s="仅剩：{day}天{hour}小时{minute}分{second}秒";a&&(s=a),i=setInterval(function(){if(l>0){day=Math.floor(l/86400),hour=Math.floor(l/3600)-24*day,minute=Math.floor(l/60)-24*day*60-60*hour,second=Math.floor(l)-24*day*60*60-60*hour*60-60*minute;var e=s.replace("{day}",day<10?"0"+day:day.toString()).replace("{hour}",hour<10?"0"+hour:hour.toString()).replace("{minute}",minute<10?"0"+minute:minute.toString()).replace("{second}",second<10?"0"+second:second.toString());o.html(e),l--}else clearInterval(i)},1e3)}}function o(e){var t=Global_ServiceUrlHelper.Preferred_GetBannerList;$.ajax({url:t,type:"POST",data:{reqJson:'{"BannerBaseCode":"Preferred_TopBanner"}'},dataType:"json",async:!0}).done(function(t){if("00000000"==t.ResultNo&&t.Data){var a="",i="";$.each(t.Data,function(e,t){a+='<div class="swiper-slide swiper-slide-next" style="width: 375px;">',a+='                <a href="'+t.Url+'" class="ui-link">',a+="                    <img alt='"+t.Title+"' src=\""+t.Img+'@!standard_src_src">',a+="                </a>",a+="            </div>",i+='<span class="swiper-pagination-bullet"></span>'}),$("#optimization-banners").html(a),$("#optimization-banners-icons").html(i),void 0!=e&&"function"==typeof e&&e()}else console.log(t.ResultRemark)}).fail(function(){console.log("请求发生异常")})}var r,n,l,s=1,d=0,c=0,u=8,p="";this.Init=function(e){r=new Global_BaseInfoHelper.GetToken,n=Global_BaseInfoHelper.CheckLogin(),l="",c=0;var t=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Optimization/list");t.StorageData?(d=t.StorageData.silentScroll,$(".laibei_page:last #optimization-list-content").html(new Global_ReturnHelper.GetBlankPageHtml(d).Html),l=t.StorageData.ListDate,s=t.StorageData.pageIndex,c=t.StorageData.Total,t.StorageData.other&&t.StorageData.other.firstHtml&&(p=t.StorageData.other.firstHtml,$(".laibei_page:last #optimization-first-content").html(p),a())):Optimization_List.PageDataInit(),$(".laibei_page:last .optimization-categorylist").on("tap","a",function(){var e=$(".laibei_page:last #optimization-first-content").html();Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Optimization/list","optimization-list-content",s,c,{firstHtml:e})})},this.PageDataInit=function(){s=1,l="",d=0;var e="",i=h.GetApiDate(s,u);if("00000000"==i.ResultNo){if(1==s&&i.Total>0){var o=h.GetFirstItemHtml(i.Data[0]);$(".laibei_page:last #optimization-first-content").html(o),a(),i.Data.shift()}e=h.BuilderListHtml(i)}0==c&&(e=Optimization_List.NoDataTip()),$(".laibei_page:last #optimization-list-content").html(e),t()},this.PageScoll=function(){return""==l?void $(".optimization-product-sellout").show():($.mobile.silentScroll(d),$("#optimization-list-content").html(l),$(".optimization-product-sellout").show(),void t())},this.ProductDropload=function(){if($(".dropload-down").remove(),!(c<u)){var e=[];Optimization_List.dropload=$(".laibei_page:last #optimization-hisory-DroploadDiv").dropload({scrollArea:window,loadDownFn:function(a){if(s+=1,e=h.GetApiDate(s,u),null==e.Data||0==e.Data.length||"00000000"!=e.ResultNo)a.lock(),a.noData(),a.resetload();else{var i=h.BuilderListHtml(e);u>e.Data.length&&(a.lock(),a.noData()),setTimeout(function(){$(".laibei_page:last #optimization-list-content").append(i),t(),a.resetload()},1e3)}}})}};var h={GetApiDate:function(e,t){var a=Global_ServiceUrlHelper.Preferred_GetEffectPreferredList,i=null;return $.ajax({url:a,type:"POST",data:{reqJson:'{"pageIndex":"'+e+'","pageSize":"'+t+'","Token":"'+r.Token+'"}'},dataType:"json",async:!1}).done(function(e){i=e,e.Total&&(c=e.Total)}).fail(function(){console.log("请求发生异常")}),i},BuilderListHtml:function(e){for(var t="",a=(Global_ServiceUrlHelper.CurrentDomain,0);a<e.Data.length;a++)t+=h.GetEffectItemHtml(e.Data[a]);return t},GetEffectItemHtml:function(e){var t=Global_ServiceUrlHelper.CurrentDomain,a=t+"/Optimization/SpecialDetail/"+e.PreferredBaseId,i=t+"/Optimization/Detail/{id}?nPreferredId="+e.PreferredBaseId,o=e.Image+"@!standard_src_src",r=e.TagImg?e.TagImg+"@!standard_src_src":"",n="仅剩：0天0小时0分0秒",l="";return e.ProductList&&e.ProductList.length>1?(l+='<section class="greatselect categorylist-activity">',l+='    <a href="'+a+'" class="ui-link">',l+=o?'        <img src="'+o+'">':"",l+=r?'        <img class="optimization-history-shiyong" src="'+r+'" />':"",e.SellOut&&(l+=h.NotProductTip("optimization-listproduct-sellout")),l+="    </a>",l+='    <div class="swiper-container-horizontal">',l+='        <div class="swiper-wrapper">',$.each(e.ProductList,function(e,t){l+='            <div class="swiper-slide" style="width: 1.6rem; margin-right: 10px;"><a href="'+i.replace("{id}",t.ProductBaseId)+'" class="ui-link" style="margin-bottom:0"><img src="'+t.GoodsImg+'@!standard_square_s"></a></div>'}),l+="         ",l+="        </div>",l+="    </div>",l+="</section>"):(l+='<section class="greatselect">',l+='    <a href="'+a+'" class="ui-link">',l+=o?'        <img src="'+o+'" />':"",l+=r?'        <img class="optimization-history-shiyong" src="'+r+'" />':"",l+="",l+="        <p>",l+="            <span leftTime='"+e.LeftTime+"' id=\"greatselect-lefttime-"+s+"-"+e.ProductList[0].ProductBaseId+'" class="optimization-history-timeleft">'+n+"</span>",l+='            <span style="float:right;color:#ff4965;font-size:20px;">',l+="                "+Global_CommonHelper.GetPriceHtml(e.ProductList[0].Price)+' <span style="font-size:13px;color:#9fa0a0;text-decoration:line-through;">'+Global_CommonHelper.GetPriceHtml(e.ProductList[0].CostPrice)+"</span>",l+="            </span>",l+="        </p>",e.SellOut&&(l+=h.NotProductTip()),l+="    </a>",l+="</section>"),l},GetFirstItemHtml:function(t){var a=Global_ServiceUrlHelper.CurrentDomain,i=a+"/Optimization/SpecialDetail/"+t.PreferredBaseId,o=a+"/Optimization/Detail/{id}?nPreferredId="+t.PreferredBaseId,r=(t.Image+"@!standard_src_src",t.Name),n=(t.TagImg?t.TagImg+"@!standard_src_src":"","");n+='<div class="optimization-categorylist-title">',n+='     <a href="'+i+'">',n+="        <h2>"+r+"</h2>",n+="        <div style='display:inline-block;' id='optimization-categorylist-timer' leftTime='"+t.LeftTime+'\'><span>0天</span> <span class="optimization-categorylist-specialwidth">00</span>:<span class="optimization-categorylist-specialwidth">00</span>:<span class="optimization-categorylist-specialcolor">00</span></div>',n+='        <i class="iconfont ">&#xe60b;</i>',n+="    </div>",n+='    <div class="optimization-categorylist-goods clearfix">',n+="        <div class=\"swiper-ad swiper-container-horizontal\" style='background:#fff;'>",n+='            <div class="swiper-wrapper">';var l=t.ProductList.length;return $.each(t.ProductList,function(t,a){n+='                <div class="swiper-slide">',n+='                    <a href="'+o.replace("{id}",a.ProductBaseId)+'" class="categorylist-goods-item" style="width: 1.875rem;">',n+='                        <div class="categorylist-goods-each'+(t+1==l?" categorylist-goods-each-last":"")+'">',n+='                            <img src="'+a.GoodsImg+'@!standard_square_s" />',n+='                            <span class="categorylist-goods-normalprice">'+Global_CommonHelper.GetPriceHtml(a.Price)+"</span>",n+='                            <p class="categorylist-goods-previousprice">'+Global_CommonHelper.GetPriceHtml(a.CostPrice)+"</p>",n+="                        </div>",n+='                        <p class="categorylist-goods-discount">'+e(a.CostPrice,a.Price)+"</p>",a.SellOut&&(n+='<div class="optimization-product-sellout optimization-categorylistproduct-sellout" style="display:none;"><img src="/Content/Images/optimization-selledout.png" /></div>'),n+="                    </a>",n+="                </div>"}),n+="            </div>",n+="        </div>",n+="     </a>",n+="    </div>"},NotProductTip:function(e){return""}};this.NoDataTip=function(){var e="";return e+='<div class="noorder" id="NoChannelProduct" style="display: block;">',e+='            <img src="/Content/Images/emptyorder.png">',e+="            <p>暂时没有内容哦</p>",e+="        </div>"},this.SwiperShow=function(){o(function(){new Swiper(".swiper-container",{loop:!0,autoplay:3e3,pagination:".swiper-pagination",paginationClickable:!0,autoplayDisableOnInteraction:!1})})}},Optimization_Mmtrial=new function(){var e=2,t="",a=0,i=0;this.MmtrialShowLightBox=function(){Global_SwiperHelper.SwiperLightboxClick("Mmtrialpage")};var o={GetApiData:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Preferred_GetFinalComment,type:"POST",data:{reqJson:'{"ProductBaseId":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t},GetCommentData:function(e,t,a){var i=null,o={ProductBaseId:e,pageIndex:t,pageSize:a};return $.ajax({url:Global_ServiceUrlHelper.Preferred_GetMamaCommentList,type:"POST",data:{reqJson:JSON.stringify(o)},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},ListStrBuilder:function(e){for(var t="",a=0;a<e.Data.length;a++){for(var i="",o=0;o<e.Data[a].ImgIDList.length;o++)i+='<li><img src="'+e.Data[a].ImgIDList[o].ImgPath+'@!standard_square_m" /></li>';t+='<li><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/My/PersonalIn/"+e.Data[a].Baseid+'"><div class="top"><img src="'+e.Data[a].FaceImage+'" class="avator" /><span class="name">'+e.Data[a].UserName+'</span><span class="age">'+e.Data[a].BabyAgeCN+'</span><span class="time">'+e.Data[a].FeedbackTime+'</span></div></a><div class="review">'+e.Data[a].TryingResults+'<ul class="imgSwiper">'+i+"</ul></div></li>"}return t}};this.PageInit=function(r){var n=o.GetApiData(r);if(null!=n&&"00000000"==n.ResultNo){$("#Mmtrial_Content").html(n.Content),$("#finalscore").css("width",""+100*n.ColligationScore/5+"%"),$("#nicescore").css("width",""+100*n.CostPerformance/5+"%"),$("#safescore").css("width",""+100*n.SafetyFactor/5+"%"),$("#lovescore").css("width",""+100*n.BabyLikesIndex/5+"%");var l=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Optimization/Mmtrial/"+r);if(null!=l.StorageData)a=l.StorageData.silentScroll,$("#NoCommentList").remove(),$("#Mmtrial_CommentList").html(new Global_ReturnHelper.GetBlankPageHtml(a).Html),t=l.StorageData.ListDate,e=l.StorageData.pageIndex,i=l.StorageData.Total;else{e=2,t="",a=0;var s=o.GetCommentData(r,1,20);if(null!=s&&"00000000"==s.ResultNo)if(i=s.Total,i>0){var d=o.ListStrBuilder(s);$("#Mmtrial_CommentList").html(d),$("#NoCommentList").remove()}else $("#NoCommentList").show()}}else Optimization_Mmtrial.PageEmpty();setTimeout(function(){var e=$("#Mmtrial_Content").height();e>70&&$("#openmore").fadeIn()},500),$("#Mmtrial_CommentList").on("tap","a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Optimization/Mmtrial/"+r,"Mmtrial_CommentList",e,i)}),$("#openmore").on("tap",function(e){e.preventDefault();var t=$(this).attr("data-direction"),a="";"down"==t?($(this).attr("data-direction","up"),$(this).prev(".content").css("max-height","initial"),a+="<h3>收起详情</h3>",a+='<i class="iconfont">&#xe60c;</i>'):($(this).attr("data-direction","down"),$(this).prev(".content").css("max-height","1.8rem"),a+="<h3>更多详情</h3>",a+='<i class="iconfont">&#xe609;</i>'),$(this).html(a)}),$(".imgSwiper").on("tap","img",function(e){e.preventDefault();var t="",a=$(this).parent().parent();$(this).attr("src").replace("@!standard_square_m","@!standard_square_s");$.each(a.children(),function(){t+='<div class="swiper-slide"><img src="'+$(this).children().attr("src").replace("@!standard_square_m","@!standard_square_s")+'" /></div>'}),$(".laibei_page:last #SwiperLightBoxImgList").html(t);var i=$(this).parent().index();$(".swiper-pagination-current").html(i+1),Global_SwiperHelper.DirectShowSwiper(i,"","lightbox")})},this.PageScoll=function(){""!=t&&($.mobile.silentScroll(a),$("#Mmtrial_CommentList").html(t))},this.PageEmpty=function(){$(".laibei_page:last #MmtrialContent").html(Global_MessageHelper.PageEmpty),$(".laibei_page:last #MmtrialEmptyPage").show(),$(".laibei_page:last #Mmtrialpage").hide()},this.MmtrialDropload=function(t,a){i<=20||$(function(){$("#Mmtrial_CommentDroploadDiv").dropload({scrollArea:window,loadDownFn:function(i){var r=o.GetCommentData(t,e,a);if(null==r||"00000000"!=r.ResultNo)i.lock(),i.noData(),i.resetload();else{e+=1;var n=o.ListStrBuilder(r);a>r.Data.length&&(i.lock(),i.noData()),setTimeout(function(){$("#Mmtrial_CommentList").append(n),i.resetload()},1e3)}}})})}},Optimization_SpecialDetail=new function(){function e(){var e=document.body.clientWidth/7.5,t=$("#ProductList");t.imagesLoaded(function(){t.masonry({itemSelector:".masonry-item",gutterWidth:.2*e}),""!=i&&$.mobile.silentScroll(o);
})}function t(){$(".optimization-product-sellout2").css("top","0"),$(".optimization-product-sellout2").css("left","0")}var a=2,i="",o=0,r=0,n="",l={GetApiData:function(e){var t=null;return $.ajax({url:Global_ServiceUrlHelper.Preferred_GetBaseById,type:"POST",data:{reqJson:'{"PreferredBaseId":"'+e+'"}'},dataType:"json",async:!1}).done(function(e){t=e}).fail(function(){console.log("请求发生异常")}),t},GetProductData:function(e,t,a){var i=null,o={PreferredBaseId:e,pageIndex:t,pageSize:a};return $.ajax({url:Global_ServiceUrlHelper.Preferred_GetProductListById,type:"POST",data:{reqJson:JSON.stringify(o)},dataType:"json",async:!1}).done(function(e){i=e}).fail(function(){console.log("请求发生异常")}),i},ListStrBuilder:function(e,t){for(var a="",i=Global_ServiceUrlHelper.CurrentDomain,o=0;o<e.Data.length;o++){var r=i+"/Optimization/Detail/"+e.Data[o].ProductBaseId+"?nPreferredId="+t;a+='<li class="masonry-item"><a href="'+r+'"><div class="optimization-shadow-wrapper"><img class="specialdetail_lazyload_img" src="/Content/Images/sending.gif" data-original="'+e.Data[o].ImagePath+'@!standard_src_l" />',3==e.Data[o].Status&&(a+='<div class="optimization-product-sellout2 optimization-waterfallproduct-sellout"><img src="/Content/Images/optimization-selledout.png" /></div>'),a+='</div><p class="optimization-list-category-desc">'+e.Data[o].Title+'</p><p class="optimization-list-category-price">'+Global_CommonHelper.GetPriceHtml(e.Data[o].Price)+"</p></a></li>"}return a}};this.PageInit=function(e){var t=l.GetApiData(e);if(null!=t&&"00000000"==t.ResultNo)if(n=t.Name,$("#Special_Detail_Image").attr("src",t.Image+"@!standard_src_l"),$("#Special_Detail_Desc").html(t.Introduction),$("#Special_Detail_Content").html(t.Content),t.Total>1){var s=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Optimization/SpecialDetail/"+e);if(null!=s.StorageData)o=s.StorageData.silentScroll,$("#ProductList").html(new Global_ReturnHelper.GetBlankPageHtml(o).Html),i=s.StorageData.ListDate,a=s.StorageData.pageIndex,r=s.StorageData.Total;else{a=2,i="",o=0,r=t.Total;var d=l.GetProductData(e,1,20);if(null!=d||"00000000"==t.ResultNo){var c=l.ListStrBuilder(d,e);$("#ProductList").html(c)}}$("#ProductDroploadDiv").show()}else if(1==t.Total){var u="",p="立即购买",h='<div class="optimization-specialdetail-purchase"><a href="'+Global_ServiceUrlHelper.CurrentDomain+"/Optimization/Detail/"+t.Data[0].ProductBaseId+"?nPreferredId="+e+'"><img src="'+t.Data[0].ImagePath+'@!standard_src_l" />';3==t.Data[0].Status&&(h+='<div class="optimization-product-sellout optimization-categorylistproduct-sellout optimization-special-sellout"><img src="/Content/Images/optimization-selledout.png" /></div>',u="optimization-detail-purchase",p="已售罄"),h+='<p class="optimization-specialdetail-productdesc">'+t.Data[0].Title+'</p><p class="optimization-specialdetail-price" id="Detail_Price">'+Global_CommonHelper.GetPriceHtml(t.Data[0].Price)+'</p><span href="javascript:;" class="optimization-special-link '+u+'">'+p+"</span></a></div>",$("#ProductDroploadDiv").after(h),$("#ProductDroploadDiv").hide()}else Optimization_SpecialDetail.PageEmpty();else Optimization_SpecialDetail.PageEmpty();$("#ProductList").on("tap","a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Optimization/SpecialDetail/"+e,"ProductList",a,r)})},this.PageEmpty=function(){$(".laibei_page:last #Special_DetailContent").html(Global_MessageHelper.PageEmpty),$(".laibei_page:last #Special_DetailEmptyPage").show(),$(".laibei_page:last #Special_Detailpage").hide()},this.PageScoll=function(){$(function(){""!=i&&$("#ProductList").html(i),e(),$(".specialdetail_lazyload_img").lazyload({failurelimit:400,event:"scrollstop",load:e}),t()})},this.PageTitle=function(){$("#headerTitle").html(n)},this.ListDropload=function(e,i){var o=this;r<=20||$(function(){o.dropload=$(".laibei_page:last #ProductDroploadDiv").dropload({scrollArea:window,loadDownFn:function(o){var r=l.GetProductData(e,a,i);if(null==r||"00000000"!=r.ResultNo)o.lock(),o.noData(),o.resetload();else{a+=1;var n=l.ListStrBuilder(r,e);i>r.Data.length&&(o.lock(),o.noData()),setTimeout(function(){var e=$("#ProductList"),a=$(n);e.append(a).masonry("appended",a,!0),$(".specialdetail_lazyload_img").lazyload({failurelimit:400,event:"scrollstop",load:function(){e.imagesLoaded(function(){e.masonry()})}}),t(),o.resetload()},1e3)}}}),o.dropload._scrollContentHeight=$(window).height()})}},Optimization_TopTen=new function(){var e="",t=0;this.PageInit=function(){var i=new Global_ReturnHelper.GetListDateToStorage(window.location.origin+"/Optimization/TopTen");if(null!=i.StorageData)t=i.StorageData.silentScroll,$("#MostSalesList").html(new Global_ReturnHelper.GetBlankPageHtml(t).Html),e=i.StorageData.ListDate;else{e="",t=0;var o=a.GetApiDate(1,20);if("00000000"==o.ResultNo){Total=o.Total;var r=a.ProductStrBuilder(o);$("#MostSalesList").html(r),Total>0?$("#NoMostSales").remove():$("#NoMostSales").show()}else $("#NoMostSales").show()}$("#MostSalesList").on("tap","a",function(){Global_ReturnHelper.SetListDateToStorage(window.location.origin+"/Optimization/TopTen","MostSalesList",0,0)})},this.PageScoll=function(){""!=e&&($.mobile.silentScroll(t),$("#MostSalesList").html(e))};var a={GetApiDate:function(e,t){var a=null,i=new Array;return i[0]=1,$.ajax({url:Global_ServiceUrlHelper.Account_GetUserArticleList,type:"POST",data:{reqJson:'{"UserId":0,"Type":2,"Sort":2,"pageIndex":1,"Status":'+JSON.stringify(i)+',"pageSize":10,"Token":""}'},dataType:"json",async:!1}).done(function(e){a=e}).fail(function(){console.log("请求发生异常")}),a},ProductStrBuilder:function(e){for(var t="",a=Global_ServiceUrlHelper.CurrentDomain,i=0;i<e.Data.length;i++){var o=a+"/Optimization/Detail/"+e.Data[i].ProductBaseId;t+='<section class="optimization-topten-item clearfix"><a href="'+o+'"><img src="'+e.Data[i].ImgList[0].Path+'@!standard_src_M" /><i class="'+GetIconFont(i)+'"></i><p class="optimization-topten-title">'+e.Data[i].Title+'</p><p class="optimization-topten-desc">'+e.Data[i].Content+'</p><p class="optimization-topten-detail"><span class="optimization-topten-detail-price">'+Global_CommonHelper.GetPriceHtml(e.Data[i].Price)+'</span><span class="optimization-topten-detail-sales">销量&nbsp;｜&nbsp;'+e.Data[i].Sales+'</span><span class="optimization-topten-detail-buy">立即购买</span></p></a></section>'}return t}};GetIconFont=function(e){switch(e){case 0:return"optimization-topten-one";case 1:return"optimization-topten-two";case 2:return"optimization-topten-three";case 3:return"optimization-topten-four";case 4:return"optimization-topten-five";case 5:return"optimization-topten-six";case 6:return"optimization-topten-seven";case 7:return"optimization-topten-eight";case 8:return"optimization-topten-nine";case 9:return"optimization-topten-ten"}}};